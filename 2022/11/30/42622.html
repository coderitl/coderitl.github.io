<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>SpringCloud | coder-itl</title>
  <meta name="author" content="coder-itl">
  <meta name="copyright" content="coder-itl">
  <meta name="format-detection" content="telephone=no">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="SpringCloud-全家桶微服务架构的概念以及优势什么是微服务 官方定义: 微服务就是由一系列围绕自己业务开发的微小服务构成，他们独立部署运行在自己的进程里,基于分布式的管理 通俗定义: 微服务是一种架构，这种架构是将单个的整体应用程序分割成更小的项目关联的独立的服务。一个服务通常实现一组独立的特性或功能,包含自己的业务逻辑和适配器。各个微服务之间的关联通过暴露api来实现。这些独立的">
  <meta property="og:type" content="article">
  <meta property="og:title" content="SpringCloud">
  <meta property="og:url" content="https://coderitl.github.io/2022/11/30/42622.html">
  <meta property="og:site_name" content="coder-itl">
  <meta property="og:description" content="SpringCloud-全家桶微服务架构的概念以及优势什么是微服务 官方定义: 微服务就是由一系列围绕自己业务开发的微小服务构成，他们独立部署运行在自己的进程里,基于分布式的管理 通俗定义: 微服务是一种架构，这种架构是将单个的整体应用程序分割成更小的项目关联的独立的服务。一个服务通常实现一组独立的特性或功能,包含自己的业务逻辑和适配器。各个微服务之间的关联通过暴露api来实现。这些独立的">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:image" content="https://i.328888.xyz/2023/04/01/i2p4AN.jpeg">
  <meta property="article:published_time" content="2022-11-30T08:39:03.000Z">
  <meta property="article:modified_time" content="2023-06-22T11:51:59.478Z">
  <meta property="article:author" content="coder-itl">
  <meta property="article:tag" content="coder-itl,Java,HTML+CSS,Hexo,MYSQL">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://i.328888.xyz/2023/04/01/i2p4AN.jpeg">
  <link rel="shortcut icon" href="https://img-blog.csdnimg.cn/f44f454681b440f3a8ae5f086d3c07d9.png">
  <link rel="canonical" href="https://coderitl.github.io/2022/11/30/42622.html">
  <link rel="preconnect" href="//cdn.jsdelivr.net">
  <link rel="preconnect" href="//busuanzi.ibruce.info">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'">
  <script>
    const GLOBAL_CONFIG = {
      root: '/',
      algolia: undefined,
      localSearch:
      {
        "path": "/search.xml",
        "preload": false,
        "languages":
        {
          "hits_empty": "找不到您查询的内容：${query}"
        }
      },
      translate: undefined,
      noticeOutdate: undefined,
      highlight:
      {
        "plugin": "highlighjs",
        "highlightCopy": true,
        "highlightLang": false,
        "highlightHeightLimit": false
      },
      copy:
      {
        success: '复制成功',
        error: '复制错误',
        noSupport: '浏览器不支持'
      },
      relativeDate:
      {
        homepage: false,
        post: false
      },
      runtime: '',
      date_suffix:
      {
        just: '刚刚',
        min: '分钟前',
        hour: '小时前',
        day: '天前',
        month: '个月前'
      },
      copyright: undefined,
      lightbox: 'fancybox',
      Snackbar: undefined,
      source:
      {
        justifiedGallery:
        {
          js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
          css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
        }
      },
      isPhotoFigcaption: false,
      islazyload: true,
      isAnchor: false,
      percent:
      {
        toc: true,
        rightside: false,
      }
    }

  </script>
  <script id="config-diff">
    var GLOBAL_CONFIG_SITE = {
      title: 'SpringCloud',
      isPost: true,
      isHome: false,
      isHighlightShrink: false,
      isToc: true,
      postUpdate: '2023-06-22 19:51:59'
    }

  </script><noscript>
    <style type="text/css">
      #nav
      {
        opacity: 1
      }

      .justified-gallery img
      {
        opacity: 1
      }

      #recent-posts time,
      #post-meta time
      {
        display: inline !important
      }

    </style>
  </noscript>
  <script>
    (win =>
    {
      win.saveToLocal = {
        set: function setWithExpiry(key, value, ttl)
        {
          if (ttl === 0) return
          const now = new Date()
          const expiryDay = ttl * 86400000
          const item = {
            value: value,
            expiry: now.getTime() + expiryDay,
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
        get: function getWithExpiry(key)
        {
          const itemStr = localStorage.getItem(key)
          if (!itemStr)
          {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = new Date()
          if (now.getTime() > item.expiry)
          {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
      win.getScript = url => new Promise((resolve, reject) =>
      {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function ()
        {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(script)
      })
      win.getCSS = url => new Promise((resolve, reject) =>
      {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        link.onload = () => resolve()
        link.onerror = () => reject()
        document.head.appendChild(link)
      })
      win.activateDarkMode = function ()
      {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null)
        {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function ()
      {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null)
        {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
      if (t === 'dark') activateDarkMode()
      else if (t === 'light') activateLightMode()
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined)
      {
        if (asideStatus === 'hide')
        {
          document.documentElement.classList.add('hide-aside')
        }
        else
        {
          document.documentElement.classList.remove('hide-aside')
        }
      }
      const detectApple = () =>
      {
        if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent))
        {
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)

  </script>
  <link rel="stylesheet" href="/css/modify.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.12/css/gitcalendar.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiper.min.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiperstyle.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/animate-css/animate.css@3.7.2/animate.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css" media="defer">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/globalfont@v0.0.4/my.css">
  <link rel="stylesheet" href="/css/my.css">
  <meta name="referrer" content="no-referrer"><!-- hexo injector head_end start -->
  <style>
    body hanla:after
    {
      content: ' ';
      display: inline;
      font-family: inherit;
      font-size: 0.45em;
    }

    html code hanla,
    html pre hanla,
    html kbd hanla,
    html samp hanla,
    html ruby hanla,
    html .tag-list-item hanla
    {
      display: none;
    }

    html ol>hanla,
    html ul>hanla
    {
      display: none;
    }

  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css">
  <style>
    #recent-posts>.recent-post-item>.recent-post-info>.article-meta-wrap>.tags:before
    {
      content: "\A";
      white-space: pre;
    }

    #recent-posts>.recent-post-item>.recent-post-info>.article-meta-wrap>.tags>.article-meta__separator
    {
      display: none
    }

  </style>
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'">
  <script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end -->
  <meta name="generator" content="Hexo 5.4.2">
  <link rel="alternate" href="/atom.xml" title="coder-itl" type="application/atom+xml">
</head>

<body>
  <div id="loading-box">
    <div class="loading-left-bg"></div>
    <div class="loading-right-bg"></div>
    <div class="spinner-box">
      <div class="configure-border-1">
        <div class="configure-core"></div>
      </div>
      <div class="configure-border-2">
        <div class="configure-core"></div>
      </div>
      <div class="loading-word">加载中...</div>
    </div>
  </div>
  <script>
    const preloader = {
      endLoading: () =>
      {
        document.body.style.overflow = 'auto';
        document.getElementById('loading-box').classList.add("loaded")
      },
      initLoading: () =>
      {
        document.body.style.overflow = '';
        document.getElementById('loading-box').classList.remove("loaded")
      }
    }
    window.addEventListener('load', () =>
    {
      preloader.endLoading()
    })
    if (true)
    {
      document.addEventListener('pjax:send', () =>
      {
        preloader.initLoading()
      })
      document.addEventListener('pjax:complete', () =>
      {
        preloader.endLoading()
      })
    }

  </script>
  <div id="web_bg"></div>
  <div id="sidebar">
    <div id="menu-mask"></div>
    <div id="sidebar-menus">
      <div class="avatar-img is-center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://i.328888.xyz/2023/03/19/MJUXa.jpeg" onerror="onerror=null;src='https://i.328888.xyz/2023/03/20/P3kfC.gif'" alt="avatar"></div>
      <div class="sidebar-site-data site-data is-center"><a href="/archives/">
          <div class="headline">
            <hanla></hanla>文章<hanla></hanla>
          </div>
          <div class="length-num">119</div>
        </a><a href="/tags/">
          <div class="headline">
            <hanla></hanla>标签<hanla></hanla>
          </div>
          <div class="length-num">21</div>
        </a><a href="/categories/">
          <div class="headline">
            <hanla></hanla>分类<hanla></hanla>
          </div>
          <div class="length-num">13</div>
        </a></div>
      <hr>
      <div class="menus_items">
        <div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div>
        <div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div>
        <div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div>
        <div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div>
        <div class="menus_item"><a class="site-page" href="/Timeline/"><i class="fa-fw fab fa-docker"></i><span> 日志</span></a></div>
        <div class="menus_item"><a class="site-page" href="/Java-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/"><i class="fa-fw fas fa-link"></i><span> 学习路线</span></a></div>
        <div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于<hanla></hanla></span></a></div>
      </div>
    </div>
  </div>
  <div class="post" id="body-wrap">
    <header class="post-bg" id="page-header" style="background-image: url('https://i.328888.xyz/2023/04/01/i2p4AN.jpeg')">
      <nav id="nav"><span id="blog-info"><a href="/" title="coder-itl"><span class="site-name">coder-itl</span></a></span>
        <div id="menus">
          <div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div>
          <div class="menus_items">
            <div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div>
            <div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div>
            <div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div>
            <div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div>
            <div class="menus_item"><a class="site-page" href="/Timeline/"><i class="fa-fw fab fa-docker"></i><span> 日志</span></a></div>
            <div class="menus_item"><a class="site-page" href="/Java-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/"><i class="fa-fw fas fa-link"></i><span> 学习路线</span></a></div>
            <div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于<hanla></hanla></span></a></div>
          </div>
          <div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div>
        </div>
      </nav>
      <div id="post-info">
        <h1 class="post-title">SpringCloud</h1>
        <div id="post-meta">
          <div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">
                <hanla></hanla>发表于<hanla></hanla>
              </span><time class="post-meta-date-created" datetime="2022-11-30T08:39:03.000Z" title="发表于 2022-11-30 16:39:03">2022-11-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于<hanla></hanla></span><time class="post-meta-date-updated" datetime="2023-06-22T11:51:59.478Z" title="更新于 2023-06-22 19:51:59">2023-06-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div>
          <div class="meta-secondline"><span class="post-meta-separator">|</span><span id="" data-flag-title="SpringCloud"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div>
        </div>
      </div>
    </header>
    <main class="layout" id="content-inner">
      <div id="post"><div class="top-img" style="background-image: url('https://i.328888.xyz/2023/04/01/i2p4AN.jpeg');"></div>
        <article class="post-content" id="article-container">
          <meta name="referrer" content="no-referrer">
          <h3 id="SpringCloud-全家桶"><a href="#SpringCloud-全家桶" class="headerlink" title="SpringCloud-全家桶"></a>SpringCloud-全家桶</h3>
          <h4 id="微服务架构的概念以及优势"><a href="#微服务架构的概念以及优势" class="headerlink" title="微服务架构的概念以及优势"></a>微服务架构的概念以及优势</h4>
          <h5 id="什么是微服务"><a href="#什么是微服务" class="headerlink" title="什么是微服务"></a>什么是微服务</h5>
          <ul>
            <li>官方定义: 微服务就是由一系列围绕自己业务开发的微小服务构成，他们独立部署运行在自己的进程里,<hanla></hanla>基于分布式的管理</li>
            <li>通俗定义: 微服务是一种架构，这种架构是将单个的整体应用程序分割成更小的项目关联的独立的服务。一个服务通常实现一组独立的特性或功能,<hanla></hanla>包含自己的业务逻辑和适配器。各个微服务之间的关联通过暴露<hanla></hanla><code>api</code>
              <hanla></hanla>来实现。这些独立的微服务不需要部署在同一个虚拟机，同一个系统和同一个应用服务器中
            </li>
          </ul>
          <h5 id="单体应用架构优缺点"><a href="#单体应用架构优缺点" class="headerlink" title="单体应用架构优缺点"></a>单体应用架构优缺点</h5>
          <ul>
            <li>优点: 单一架构模式在项目初期很小的时候开发方便,<hanla></hanla>测试方便,<hanla></hanla>部署方便，运行良好</li>
            <li>缺点: 应用随着时间的推进，加入的功能越来越多，最终会变得巨大，一个项目中很有可能数百万行的代码，互相之间繁琐的<hanla></hanla><code>jar</code>
              <hanla></hanla>包。久而久之，开发的效率低，代码维护困难。还有一个如果想整体应用采用新的技术，新的框架或者语言，那是不可能的，任意模块的漏洞或者错误都会影响整个应用，降低系统的可靠性
            </li>
          </ul>
          <h5 id="微服务加入的优缺点"><a href="#微服务加入的优缺点" class="headerlink" title="微服务加入的优缺点"></a>微服务加入的优缺点</h5>
          <ul>
            <li>优点: 将服务拆分成多个单一职责的小的服务，进行单独部署，服务之间通过网络进行通信，每个服务应该有自己单独的管理团队，高度自治，服务各自有各自单独的职责，服务之间松耦合，避免因一个模块的问题导致服务崩溃</li>
            <li>缺点<ol>
                <li>开发人员需要处理分布式的复杂性</li>
                <li>多服务运维难度，随着服务的增加，运维的压力也在增大</li>
                <li>服务治理和服务监控是关键</li>
              </ol>
            </li>
          </ul>
          <h4 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h4>
          <h5 id="什么是-SpringCloud"><a href="#什么是-SpringCloud" class="headerlink" title="什么是 SpringCloud"></a>
            <hanla></hanla>什么是 SpringCloud
          </h5>
          <ul>
            <li>
              <p>官网</p>
              <figure class="highlight properties">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment"># https://spring.io/projects/spring-cloud</span></span><br><span class="line"><span class="attr">Spring</span> <span class="string">Cloud provides tools for developers to quickly build some of the common patterns in distributed systems (e.g. configuration management, service discovery, circuit breakers, intelligent routing, micro-proxy, control bus, one-time tokens, global locks, leadership election, distributed sessions, cluster state). Coordination of distributed systems leads to boiler plate patterns, and using Spring Cloud developers can quickly stand up services and applications that implement those patterns. They will work well in any distributed environment, including the developer’s own laptop, bare metal data centres, and managed platforms such as Cloud Foundry.</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <blockquote>
                <p><code>springcloud</code>
                  <hanla></hanla>为开发人员提供了分布式系统中快速构建一些通用模式的工具<hanla></hanla>(例如: 配置管理、服务发现、断路器、微代理、控制总线)。分布式系统的协调导致了锅炉版模式。使用<hanla></hanla><code>springcloud</code>
                  <hanla></hanla>开发人员可以快速地建立实现这些模式的服务和应用程序
                </p>
              </blockquote>
            </li>
            <li>
              <p>通俗理解</p>
              <blockquote>
                <p><code>springcloud</code>
                  <hanla></hanla>是一个涵盖多个子项目的开发工具集，集合了众多的开源框架，他利用了<hanla></hanla><code>Spring Boot</code>
                  <hanla></hanla>开发的便利性实现了很多功能，如服务注册，服务注册发现，负载均衡等。<code>SpringCloud</code>
                  <hanla></hanla>在整合过程中主要是针对<hanla></hanla><code>Neflilx</code>
                  <hanla></hanla>开源组件的封装,<code>SpringCloud</code>
                  <hanla></hanla>的出现真正的简化了分布式架构的开发。<code>Netflix</code>
                  <hanla></hanla>是美国的一个在线视频网站,<hanla></hanla>微服务业的翘楚，它是公认的大规模生产微服务的杰出实践者，<code>Netflix</code>
                  <hanla></hanla>的开源组件已经在它的大规模分布环境中经过多年的生产实践验证，因此<hanla></hanla><code>SpringCloud</code>
                  <hanla></hanla>中很多组件都是基于<hanla></hanla><code>Netflix</code>
                </p>
              </blockquote>
            </li>
          </ul>
          <h4 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h4>
          <ul>
            <li>
              <p>版本映射</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://spring.io/projects/spring-cloud#overview">https://spring.io/projects/spring-cloud#overview</a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0dfcd73cac7347a88999fa42a7f62273.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
          </ul>
          <h4 id="IDEA-模拟集群实现"><a href="#IDEA-模拟集群实现" class="headerlink" title="IDEA-模拟集群实现"></a>IDEA-模拟集群实现</h4>
          <ul>
            <li>
              <p>集群配置</p>
              <table>
                <thead>
                  <tr>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3e86848145db45c49351e14e11af7431.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>配置修改</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><code>-Dserver.port=8082</code></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0beb8c3ddbc14d9293fd3ea3efc7c9e6.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
          </ul>
          <h4 id="SpringCloud-环境搭建"><a href="#SpringCloud-环境搭建" class="headerlink" title="SpringCloud-环境搭建"></a>SpringCloud-环境搭建</h4>
          <h5 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h5>
          <ul>
            <li>
              <p><code>java</code>
                <hanla></hanla>环境
              </p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><code>jdk:1.8</code></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/71c07c08185f4bdda4d0c5b5e6201cc2.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>创建父项目<hanla></hanla>(基于<hanla></hanla><code>springboot</code>
                <hanla></hanla>初始化器构建)
              </p>
              <table>
                <thead>
                  <tr>
                    <th align="center">父工程</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bb051da455774f90b27d5528bc214670.png"></td>
                  </tr>
                </tbody>
              </table>
              <figure class="highlight xml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment">&lt;!-- 父项目的 pom.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>eureka-server<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  修改打包方式 pom --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>blr-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.cloud-version</span>&gt;</span>2021.0.3<span class="tag">&lt;/<span class="name">spring.cloud-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- spring cloud --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.cloud-version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p><code>dependencyManagement</code>
                <hanla></hanla>和<hanla></hanla><code>dependencies</code>
              </p>
              <div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i>
                <ul>
                  <li>
                    <p><code>maven</code>
                      <hanla></hanla>使用<hanla></hanla><code>dependencyManagement</code>
                      <hanla></hanla>元素来提供了一种管理依赖版本号的方式,<hanla></hanla>通常会在一个组织者的最顶层的父<hanla></hanla><code>pom</code>
                      <hanla></hanla>中看到<hanla></hanla><code>dependencyManagement</code>
                      <hanla></hanla>元素
                    </p>
                  </li>
                  <li>
                    <p>使用<hanla></hanla><code>pom.xml</code>
                      <hanla></hanla>中的<hanla></hanla><code>dependencyManagement</code>
                      <hanla></hanla>元素能让所有在子项目中引用一个依赖而不需<code>显示的列出版本号</code>,<code>maven</code>
                      <hanla></hanla>会沿着父子层次向上走,<hanla></hanla>直到找到一个拥有<hanla></hanla><code>dependencyManagement</code>
                      <hanla></hanla>元素的项目,<hanla></hanla>然后他就会使用这个<hanla></hanla><code>dependencyManagement</code>
                      <hanla></hanla>元素中指定的版本号
                    </p>
                  </li>
                  <li>
                    <p>这样做的好处就是: 如果有多个子项目都引用同一样的依赖,<hanla></hanla>则可以避免在每个使用的子项目里都声明一个版本号,<hanla></hanla>这样当想升级或切换到另一个版本时,<hanla></hanla>只需在顶层父容器里更新,<hanla></hanla>而不需要一个一个子项目的修改,<hanla></hanla>另外如果某个子项目需要另外的一个版本,<hanla></hanla>只需要声明<hanla></hanla><code>version</code>
                      <hanla></hanla>就可以了
                    </p>
                  </li>
                  <li>
                    <p><code>dependencyManagement</code>
                      <hanla></hanla>里<code>只是声明依赖,<hanla></hanla>并不实现引入</code>，因此子项目需要显示的声明需要使用的依赖，如果子项目中指定了版本号,<hanla></hanla>那么就会使用子项目中指定的<hanla></hanla><code>jar</code>
                      <hanla></hanla>版本
                    </p>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
          <h5 id="服务远程调用"><a href="#服务远程调用" class="headerlink" title="服务远程调用"></a>服务远程调用</h5>
          <ul>
            <li>
              <p>创建父项目</p>
              <figure class="highlight xml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>user-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>order-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Hoxton.SR10<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- springCloud --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring-cloud.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment"><!-- mysql<hanla></hanla>驱动 --></span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${mysql.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${mybatis.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>创建<hanla></hanla><code>order-service</code>
                <hanla></hanla>子模块
              </p>
              <ul>
                <li>
                  <p>修改<hanla></hanla><code>xml</code></p>
                  <figure class="highlight xml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建实体类</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建<hanla></hanla><code>mapper</code></p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select("select * from tb_order where id = #{id}")</span></span><br><span class="line">    Order <span class="title function_">findById</span><span class="params">(Long id)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建<hanla></hanla><code>service</code></p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> {</span><br><span class="line">        <span class="comment">// 1.<hanla></hanla>查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="comment">// 4.<hanla></hanla>返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建控制器</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("order")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> {</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("{orderId}")</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderByUserId</span><span class="params">(<span class="meta">@PathVariable("orderId")</span> Long orderId)</span> {</span><br><span class="line">        <span class="comment">// 根据<hanla></hanla>id<hanla></hanla>查询订单并返回</span></span><br><span class="line">        <span class="keyword">return</span> orderService.queryOrderById(orderId);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>配置</p>
                  <figure class="highlight yml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/cloud_order?useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.example.user.pojo</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.example:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">MM-dd</span> <span class="string">HH:mm:ss:SSS</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><code>sql</code>
                    <hanla></hanla>脚本
                  </p>
                  <figure class="highlight sql">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">-- 创建数据库<hanla></hanla></span></span><br><span class="line"><span class="keyword">create</span> database cloud_order;</span><br><span class="line"><span class="comment">-- 创建表与测试数据<hanla></hanla></span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_order` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">'订单<hanla></hanla>id'</span>,</span><br><span class="line">  `user_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'用户<hanla></hanla>id'</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'商品名称'</span>,</span><br><span class="line">  `price` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'商品价格'</span>,</span><br><span class="line">  `num` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'商品数量'</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `username` (`name`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">109</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 ROW_FORMAT<span class="operator">=</span>COMPACT</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">101</span>, <span class="number">1</span>, <span class="string">'Apple 苹果 iPhone 12 '</span>, <span class="number">699900</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">102</span>, <span class="number">2</span>, <span class="string">'雅迪 yadea 新国标电动车'</span>, <span class="number">209900</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">103</span>, <span class="number">3</span>, <span class="string">'骆驼（CAMEL）休闲运动鞋女'</span>, <span class="number">43900</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">104</span>, <span class="number">4</span>, <span class="string">'小米<hanla></hanla>10 双模<hanla></hanla>5G 骁龙<hanla></hanla>865'</span>, <span class="number">359900</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">105</span>, <span class="number">5</span>, <span class="string">'OPPO Reno3 Pro 双模<hanla></hanla>5G 视频双防抖'</span>, <span class="number">299900</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">106</span>, <span class="number">6</span>, <span class="string">'美的（Midea) 新能效 冷静星<hanla></hanla>II '</span>, <span class="number">544900</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">107</span>, <span class="number">2</span>, <span class="string">'西昊<hanla></hanla>/SIHOO 人体工学电脑椅子'</span>, <span class="number">79900</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_order <span class="keyword">VALUES</span> (<span class="number">108</span>, <span class="number">3</span>, <span class="string">'梵班（FAMDBANN）休闲男鞋'</span>, <span class="number">31900</span>, <span class="number">1</span>);</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
              </ul>
            </li>
            <li>
              <p>创建<hanla></hanla><code>user-service</code>
                <hanla></hanla>子模块
              </p>
              <ul>
                <li>
                  <p>修改<hanla></hanla><code>pom.xml</code></p>
                  <figure class="highlight xml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建实体类</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建<hanla></hanla><code>mapper</code></p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> {  </span><br><span class="line">    <span class="meta">@Select("select * from tb_user where id = #{id}")</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@Param("id")</span> Long id)</span>;</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建<hanla></hanla><code>service</code></p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(Long id)</span> {</span><br><span class="line">        <span class="keyword">return</span> userMapper.findById(id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建控制器</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 路径： /user/110</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户<hanla></hanla>id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/{id}")</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> {</span><br><span class="line">        <span class="keyword">return</span> userService.queryById(id);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建配置</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">server:</span><br><span class="line">  port: <span class="number">8081</span></span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql:<span class="comment">//localhost:3306/cloud_user?useSSL=false</span></span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">mybatis:</span><br><span class="line">  type-aliases-<span class="keyword">package</span>: com.example.user.pojo</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-<span class="keyword">case</span>: <span class="literal">true</span></span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    com.example: debug</span><br><span class="line">  pattern:</span><br><span class="line">    dateformat: MM-dd HH:mm:ss:SSS</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建<hanla></hanla><code>sql</code>
                    <hanla></hanla>脚本
                  </p>
                  <figure class="highlight sql">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">-- 创建数据库<hanla></hanla></span></span><br><span class="line"><span class="keyword">create</span> database cloud_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表与测试数据<hanla></hanla></span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_user`</span><br><span class="line">(</span><br><span class="line">    `id`       <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `username` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'收件人'</span>,</span><br><span class="line">    `address`  <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'地址'</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY `username` (`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  AUTO_INCREMENT <span class="operator">=</span> <span class="number">109</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb3</span><br><span class="line">  ROW_FORMAT <span class="operator">=</span> COMPACT</span><br><span class="line">  </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_user  <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'柳岩'</span>, <span class="string">'湖南省衡阳市'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_user  <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">'文二狗'</span>, <span class="string">'陕西省西安市'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_user  <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">'华沉鱼'</span>, <span class="string">'湖北省十堰市'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_user  <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">'张必沉'</span>, <span class="string">'天津市'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_user  <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="string">'郑爽爽'</span>, <span class="string">'辽宁省沈阳市大东区'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_user  <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">'范兵兵'</span>, <span class="string">'山东省青岛市'</span>);</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
              </ul>
            </li>
            <li>
              <p>启动访问测试</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><code>order</code></th>
                    <th align="center">user</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f6517e1fc9104d6d830a71373a801b41.png"></td>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7c048a1ad4ae40988eb4234a63d0cf6f.png"></td>
                  </tr>
                </tbody>
              </table>
              <ul>
                <li>
                  <p>需求: 根据订单<hanla></hanla><code>id</code>
                    <hanla></hanla>查询订单功能的同时,<hanla></hanla>把订单所属的用户信息一起返回
                  </p>
                  <ul>
                    <li>
                      <p>修改一: 在<hanla></hanla><code>order-service</code>
                        <hanla></hanla>中注册<hanla></hanla><code>RestTemplate</code>
                      </p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="comment">// order-service 启动类下注册 </span></span><br><span class="line"><span class="meta">@MapperScan("com.example.order.mapper")</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建 RestTemplate 并注入 spring 容器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>修改二: 修改<hanla></hanla><code>order-service</code>
                        <hanla></hanla>的控制器
                      </p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> {</span><br><span class="line">        <span class="comment">// 1.<hanla></hanla>查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="comment">/******************************************/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">"http://localhost:8081/user/"</span> + order.getUserId();</span><br><span class="line">        <span class="comment">// 发起远程调用</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br><span class="line">        <span class="comment">// 封装 user 到 order</span></span><br><span class="line">        order.setUser(user);</span><br><span class="line">        <span class="comment">/******************************************/</span></span><br><span class="line">        <span class="comment">// 4.<hanla></hanla>返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                      <table>
                        <thead>
                          <tr>
                            <th align="center">实现服务远程调用</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/53d738c6668243918931512b490ebcd6.png"></td>
                          </tr>
                        </tbody>
                      </table>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
          <h5 id="服务注册中心介绍"><a href="#服务注册中心介绍" class="headerlink" title="服务注册中心介绍"></a>服务注册中心介绍</h5>
          <ul>
            <li>
              <p>远程调用的问题</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">问题原因</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/4156195fd1d64f51bb98519df69c6b7c.png"></td>
                  </tr>
                </tbody>
              </table>
              <blockquote>
                <p>在远程调用过程中,<hanla></hanla>如果书写硬编码则在使用时是很不方便的，如果服务出现集群，那么如何抉择地址呢？在此种问题下，服务注册中心出现，解决上述的问题</p>
              </blockquote>
            </li>
            <li>
              <p>什么是服务注册中心</p>
              <blockquote>
                <p>所谓服务注册中心就是在整个的微服务架构中单独提出一个服务，这个服务不完成系统的任何业务功能，仅仅用来完成对整个服务系统的服务注册和服务发现，以及对服务健康状态的监控和管理功能</p>
              </blockquote>
              <table>
                <thead>
                  <tr>
                    <th align="center">无服务注册中心</th>
                    <th align="center">服务注册中心</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/29b2786f1fc3422182438327d31f8a2f.png"></td>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a226daec0be148e887b15b2eaa79c546.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>服务注册中心</p>
              <ol>
                <li>可以对所有的微服务的信息进行存储，如服务的名称、<code>IP</code>、端口等</li>
                <li>可以在进行服务调用时通过服务发现查询可用的微服务列表及网络地址进行服务调用</li>
                <li>可以对所有的微服务进行心跳检测，如发现某实例长时间无法访问，就会从服务注册表移除该实例</li>
              </ol>
            </li>
          </ul>
          <h5 id="服务注册中心组件"><a href="#服务注册中心组件" class="headerlink" title="服务注册中心组件"></a>服务注册中心组件<hanla></hanla>
          </h5>
          <h6 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h6>
          <ul>
            <li>
              <p>作用</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">作用介绍</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/00ebb1d0f7974d8e9e8971cd3e191975.png"></td>
                    <td></td>
                  </tr>
                </tbody>
              </table>
              <blockquote>
                <p>不论是服务消费者还是服务提供者,<hanla></hanla>统称<hanla></hanla><code>client</code>,<hanla></hanla>首先作为客户端<hanla></hanla>(<code>client</code>),<code>client</code>
                  <hanla></hanla>会注册服务信息到<hanla></hanla><code>Eureka-Server(注册中心)</code>,<hanla></hanla>通过服务拉取,<hanla></hanla>获取信息,<hanla></hanla>在通过远程调用,<hanla></hanla>选择一个进行调用
                </p>
              </blockquote>
            </li>
            <li>
              <p>创建<hanla></hanla><code>Eureka-Server</code>
                <hanla></hanla>模块
              </p>
              <figure class="highlight xml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment"><!-- Eureka-Server<hanla></hanla>的 pom.xml --></span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 继承父项目 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>blr-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring-web --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- eureka-server --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <ul>
                <li>
                  <p>配置</p>
                  <figure class="highlight yml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment"># Eureka-Server 的 application.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span> <span class="comment"># 执行服务端口号<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">EUREKA-SERVER</span> <span class="comment"># 指定服务名称 唯一标识<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eureka 服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># false<hanla></hanla>表示不在注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># false 表示自己端就是注册中心,<hanla></hanla>我的职责就是维护服务实例,<hanla></hanla>并不需要去检索服务</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 设置与 Eureka server 交互的地址查询服务和注册服务都需要依赖这个地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://${eureka.instance.hostname}:${server.port}/eureka/</span></span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>启动类添加注解</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.eureka.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> coder-itl</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span> <span class="comment">// 开启当前应用是一个服务注册中心<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaServer</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(EurekaServer.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>启动后在浏览器访问:<code>http://localhost:8761/</code></p>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">需要的关注信息</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b1fc4d4ba9534f75910dc25d06c4a30f.png"></td>
                      </tr>
                    </tbody>
                  </table>
                </li>
              </ul>
            </li>
            <li>
              <p>创建<hanla></hanla><code>Eureka-Client</code>
                <hanla></hanla>模块，这个模块是一个功能应用
              </p>
              <figure class="highlight xml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>blr-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <ul>
                <li>
                  <p>配置</p>
                  <figure class="highlight yml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8762</span> <span class="comment"># 自定义启动端口<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">EUREKACLIENT</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment"># 表示是否将自己注册进 EurekaServer 默认为 true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># 是否从 EurekaServer 抓取已有的注册信息,<hanla></hanla>默认为 true,<hanla></hanla>单节点无所谓,<hanla></hanla>集群必须设置为 true 才能配合 ribbon 使用负载均衡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 设置与 Eureka server 交互的地址查询服务和注册服务都需要依赖这个地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>启动类添加注解</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaClientApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(EurekaClientApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>启动顺序为:<code>server-&gt;client</code></p>
                </li>
                <li>
                  <p>启动</p>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">在注册中心查看到已成功注册</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b7fb195c49c846b9a254f76851a5ccf6.png"></td>
                      </tr>
                    </tbody>
                  </table>
                </li>
              </ul>
            </li>
            <li>
              <p>自我保护机制</p>
              <blockquote>
                <p><code>EurekaClient</code>
                  <hanla></hanla>会通过心跳的方式去和<hanla></hanla><code>EurekaServer</code>
                  <hanla></hanla>进行连接<hanla></hanla>(<code>默认 30s EurekaClient</code>
                  <hanla></hanla>会发送一次心跳请求，如果超过了<hanla></hanla><code>90s</code>
                  <hanla></hanla>还没有发送心跳信息的话,<code>EurekaServer</code>
                  <hanla></hanla>就认为你宕机了,<hanla></hanla>将当前<hanla></hanla><code>EurekaClient</code>
                  <hanla></hanla>从注册表中移除)
                </p>
              </blockquote>
              <figure class="highlight yml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment"># EurekaServer</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span> </span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">30</span> <span class="comment"># 心跳的间隔</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">90</span> <span class="comment"># 多久没发送,<hanla></hanla>就认为你宕机了<hanla></hanla></span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <figure class="highlight yml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment"># EurekaClient</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">registry-fetch-interval-seconds:</span> <span class="number">30</span> <span class="comment"># 默认 每隔多久去更新一下本地的注册表缓存信息</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <ul>
                <li>
                  <p><code>Eureka</code>
                    <hanla></hanla>的自我保护机制,<hanla></hanla>统计<hanla></hanla><code>15</code>
                    <hanla></hanla>分钟内,<hanla></hanla>如果一个服务的心跳发送比例低于<hanla></hanla><code>85%</code>,<code>EurekaServer</code>
                    <hanla></hanla>就会开启自我保护机制
                  </p>
                  <ul>
                    <li>
                      <p>不会从<hanla></hanla><code>EurekaServer</code>
                        <hanla></hanla>中去除长时间没有收到的心跳的服务
                      </p>
                    </li>
                    <li>
                      <p><code>EurekaServer</code>
                        <hanla></hanla>还是可以正常提供服务的
                      </p>
                    </li>
                    <li>
                      <p>网络比较稳定时,<code>EurekaServer</code>
                        <hanla></hanla>才会开始将自己的信息被其他节点同步过去
                      </p>
                      <figure class="highlight yml">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="comment"># EurekaServer</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">true</span> <span class="comment"># 默认开启自我保护机制</span></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                    </li>
                  </ul>
                </li>
                <li>
                  <p><code>CAP</code>
                    <hanla></hanla>定理
                  </p>
                  <ul>
                    <li><code>C</code>
                      <hanla></hanla>一致性
                    </li>
                    <li><code>A</code>
                      <hanla></hanla>可用性
                    </li>
                    <li><code>P</code>
                      <hanla></hanla>分区容错性
                    </li>
                  </ul>
                  <blockquote>
                    <p> 这三个特性在分布式情况环境下,<hanla></hanla>只能满足<hanla></hanla><code>2<hanla></hanla>个</code>,<hanla></hanla>而且分区容错性在分布式环境下,<hanla></hanla>是必须要满足的,<hanla></hanla>只能在<hanla></hanla><code>AC</code>
                      <hanla></hanla>之间进行权衡
                    </p>
                  </blockquote>
                  <ul>
                    <li>如果先择<hanla></hanla><code>CP</code>: 保证了一致性,<hanla></hanla>可能会造成你系统在一定时间内是不可用的,<hanla></hanla>如果你同步数据的时间比较长,<hanla></hanla>造成的损失大</li>
                    <li><code>Eureka</code>
                      <hanla></hanla>就是一个<hanla></hanla><code>AP</code>
                      <hanla></hanla>的效果,<hanla></hanla>高可用的集群,<code>Eureka</code>
                      <hanla></hanla>集群是无中心的<hanla></hanla>(无<hanla></hanla><code>master</code>)<code>Eureka</code>
                      <hanla></hanla>即便宕机几个也不会影响系统的使用,<hanla></hanla>不需要重新的去推举一个<hanla></hanla><code>master</code>，也会导致一定时间内数据不一致
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <p>集群搭建</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">分析</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/202550563630417ab743b322fcfb7b2c.png"></td>
                  </tr>
                </tbody>
              </table>
              <ul>
                <li>
                  <p><code>EurekaServer</code>
                    <hanla></hanla>集群实现步骤
                  </p>
                  <ul>
                    <li>
                      <p>创建多个<hanla></hanla><code>EurekaServer</code>
                        <hanla></hanla>项目
                      </p>
                      <table>
                        <thead>
                          <tr>
                            <th align="center"><code>idea</code>
                              <hanla></hanla>通过修改端口模拟集群
                            </th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7f9f1a2a7e0044d1ba1783617ad8346e.png"></td>
                          </tr>
                        </tbody>
                      </table>
                    </li>
                    <li>
                      <p>引入<hanla></hanla><code>eureka server</code>
                        <hanla></hanla>依赖
                      </p>
                    </li>
                    <li>
                      <p>配置文件</p>
                      <ul>
                        <li>
                          <p><code>node1</code></p>
                          <figure class="highlight yml">
                            <table>
                              <tbody>
                                <tr>
                                  <td class="gutter">
                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                  </td>
                                  <td class="code">
                                    <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span></span><br><span class="line">  <span class="string">http://localhost:8762/eureka,</span> <span class="string">http://localhost:8763/eureka</span></span><br></pre>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </figure>
                        </li>
                        <li>
                          <p><code>node2</code></p>
                          <figure class="highlight yml">
                            <table>
                              <tbody>
                                <tr>
                                  <td class="gutter">
                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                  </td>
                                  <td class="code">
                                    <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8762</span></span><br><span class="line">  <span class="string">http://localhost:8761/eureka,</span> <span class="string">http://localhost:8763/eureka</span></span><br></pre>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </figure>
                        </li>
                        <li>
                          <p><code>node3</code></p>
                          <figure class="highlight yml">
                            <table>
                              <tbody>
                                <tr>
                                  <td class="gutter">
                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                  </td>
                                  <td class="code">
                                    <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8763</span></span><br><span class="line">  <span class="string">http://localhost:8761/eureka,</span> <span class="string">http://localhost:8762/eureka</span></span><br></pre>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </figure>
                          <table>
                            <thead>
                              <tr>
                                <th align="center">在同一个<hanla></hanla><code>EurekaServer</code>
                                  <hanla></hanla>配置文件中，启动时修改如下
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/185bbabbca40484a98e2c33317625f96.png"></td>
                              </tr>
                            </tbody>
                          </table>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>在每个启动类添加注解<hanla></hanla><code>@EnableEurekaServer</code></p>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <p>将<hanla></hanla><code>user-service</code>
                <hanla></hanla>和<hanla></hanla><code>order-service</code>
                <hanla></hanla>作为客户端加入
              </p>
              <ul>
                <li>
                  <p>添加客户端依赖</p>
                </li>
                <li>
                  <p>添加客户端配置</p>
                </li>
                <li>
                  <p>启动类添加客户端注解</p>
                </li>
                <li>
                  <p>修改<hanla></hanla><code>order-service</code>
                    <hanla></hanla>的远程调用
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">// String url = "http://localhost:8081/user/" + order.getUserId();</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">"http://USERSERVICE/user/"</span> + order.getUserId();</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span> <span class="comment">// 负载均衡配置<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">列表</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7e57d687d7a6497cb03dca5355faeca2.png"></td>
                      </tr>
                    </tbody>
                  </table>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">负载均衡流程</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ac3bf31ec28b404bb96d02f70d36a7e8.png"></td>
                      </tr>
                    </tbody>
                  </table>
                </li>
              </ul>
            </li>
          </ul>
          <h6 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h6>
          <div class="tabs" id="zookeeper">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#zookeeper-1">
                  <hanla></hanla>连通测试
                </button></li>
              <li class="tab"><button type="button" data-href="#zookeeper-2">创建项目</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="zookeeper-1">
                <ul>
                  <li>
                    <p>前往<hanla></hanla><code>Zookper</code>,<hanla></hanla>了解安装与使用</p>
                    <blockquote>
                      <p><a href="https://coderitl.github.io/2022/07/20/15264.html">https://coderitl.github.io/2022/07/20/15264.html</a></p>
                    </blockquote>
                  </li>
                  <li>
                    <p>测试主机到虚拟机网络连通性</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">测试主机到虚拟机网络连通性</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d4401088e71c46b48b15f42f42f92b8f.png" alt="测试主机到虚拟机网络连通性"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="zookeeper-2">
                <ul>
                  <li>
                    <p>创建名为<hanla></hanla><code>cloud-provider-payment8004</code>
                      <hanla></hanla>的子模块
                    </p>
                  </li>
                  <li>
                    <p>修改<hanla></hanla><code>pom.xml</code></p>
                    <figure class="highlight xml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.coderitl.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8004<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--   整合 zookeeper 客户端 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  先排除自带的 zookeeper 3.5.3 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--   在添加新版本 zookeeper --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.coderitl.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${project.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>创建启动类</p>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">// 该注解用于向 consul 或这 zookeeper<hanla></hanla>作为注册中心时注册服务<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8004</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(PaymentMain8004.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>创建<code>配置文件</code></p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># 8004 代表注册到 zookeeper 服务器的支付服务提供者的端口号<hanla></hanla></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务别名-注册 zookeeper 到注册中心名称<hanla></hanla></span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">      <span class="attr">connect-string:</span> <span class="number">192.168</span><span class="number">.247</span><span class="number">.130</span><span class="string">:2181</span> <span class="comment"># 连接<hanla></hanla>zookeeper<hanla></hanla>服务器地址</span></span><br><span class="line">      </span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>创建控制器</p>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="keyword">package</span> com.coderitl.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> {</span><br><span class="line">    <span class="meta">@Value("${server.port}")</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/paymeny/zk")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentzk</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"springCloud with zookeeper: "</span> + serverPort + <span class="string">"\t"</span> + UUID.randomUUID();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>启动测试</p>
                    <ul>
                      <li>
                        <p>版本依赖问题</p>
                        <ul>
                          <li>
                            <p>错误问题</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">错误问题</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3681fd0f222a4358bf3f43187c0b023e.png" alt="错误问题"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>解决方案</p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">&lt;!--   整合 zookeeper 客户端 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  先排除自带的 zookeeper 3.5.3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   在添加新版本 zookeeper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>服务成功注册进<hanla></hanla><code>Zookeeper</code></p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">查看服务是否注册成功</th>
                              <th align="center">访问</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/cf7c0c8b005e42cca4ed4c3653631c02.png" alt="查看服务是否注册成功"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/23c3d47696a646349d71b2438b6f5a9e.png" alt="访问"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>查看<hanla></hanla><code>zookeeper</code>
                          <hanla></hanla>内数据信息
                        </p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">相信信息</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b0219f81cf9f4005ad889f5e78154127.png" alt="相信信息"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>服务启动后生成的节点是临时节点，<code>zookeeper</code>
                      <hanla></hanla>服务器再一定时间内心跳没有回应,<hanla></hanla>会清理该节点
                    </p>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h6 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h6>
          <div class="tabs" id="consul">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#consul-1">
                  <hanla></hanla>特性
                </button></li>
              <li class="tab"><button type="button" data-href="#consul-2">角色</button></li>
              <li class="tab"><button type="button" data-href="#consul-3">安装使用</button></li>
              <li class="tab"><button type="button" data-href="#consul-4">服务提供者</button></li>
              <li class="tab"><button type="button" data-href="#consul-5">服务消费者</button></li>
              <li class="tab"><button type="button" data-href="#consul-6">集群</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="consul-1">
                <ul>
                  <li>
                    <p>特性</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">特性</th>
                          <th align="center">Eureka</th>
                          <th align="center">Nacos</th>
                          <th align="center">Consul</th>
                          <th align="center">Zookeeper</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center">CAP</td>
                          <td align="center"><code>AP</code></td>
                          <td align="center"><code>CP+AP</code></td>
                          <td align="center"><code>CP</code></td>
                          <td align="center"><code>CP</code></td>
                        </tr>
                        <tr>
                          <td align="center">健康检查</td>
                          <td align="center"><code>Client Beat</code></td>
                          <td align="center"><code>TCP/HTTP/MYSQL/Client Beat</code></td>
                          <td align="center"><code>TCP/HTTP/gPRC/CMD</code></td>
                          <td align="center"><code>Keep Alive</code></td>
                        </tr>
                        <tr>
                          <td align="center">雪崩保护</td>
                          <td align="center">有</td>
                          <td align="center">有</td>
                          <td align="center">无</td>
                          <td align="center">无</td>
                        </tr>
                        <tr>
                          <td align="center">自动注销实例</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">不支持</td>
                          <td align="center">支持</td>
                        </tr>
                        <tr>
                          <td align="center">访问协议</td>
                          <td align="center"><code>HTTP</code></td>
                          <td align="center"><code>HTTP/DNS</code></td>
                          <td align="center"><code>TTP/DNS</code></td>
                          <td align="center"><code>TCP</code></td>
                        </tr>
                        <tr>
                          <td align="center">监听支持</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                        </tr>
                        <tr>
                          <td align="center">多数据中心</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">不支持</td>
                        </tr>
                        <tr>
                          <td align="center">跨注册中心同步</td>
                          <td align="center">不支持</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">不支持</td>
                        </tr>
                        <tr>
                          <td align="center">SpringCloud<hanla></hanla>集成</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                          <td align="center">支持</td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="consul-2">
                <ul>
                  <li>
                    <p><code>Consul</code> 角色</p>
                    <ul>
                      <li><code>client</code>：客户端,<hanla></hanla>无状态,<hanla></hanla>将<hanla></hanla><code>HTTP</code>
                        <hanla></hanla>和<hanla></hanla><code>DNS</code>
                        <hanla></hanla>接口请求转发给局域网内的服务端集群
                      </li>
                      <li><code>server</code>：服务端,<hanla></hanla>保存配置信息,<hanla></hanla>高可用集群,<hanla></hanla>每个数据中心的<hanla></hanla><code>server</code>
                        <hanla></hanla>数量推荐为<hanla></hanla><code>3</code>
                        <hanla></hanla>个或者<hanla></hanla><code>5</code>
                        <hanla></hanla>个
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>工作原理</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">工作原理</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5864e85fe4f6467a99e6b96d74e92b1e.png" alt="工作原理"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="consul-3">
                <ul>
                  <li>
                    <p>官网</p>
                    <blockquote>
                      <p>官网： <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.consul.io/">https://www.consul.io/</a></p>
                      <p>中文社区：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.springcloud.cc/spring-cloud-consul.html">https://www.springcloud.cc/spring-cloud-consul.html</a></p>
                    </blockquote>
                  </li>
                  <li>
                    <p>下载</p>
                    <p><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/60181dde23334436bf629de87a8ee7f0.png" alt="下载"></p>
                  </li>
                  <li>
                    <p>两个下载的内容都是<hanla></hanla><code>consul.exe</code></p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">选择<hanla></hanla><code>amd64</code></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/4f213a1424184e2ea3464fb585924de7.png" alt="选择amd64"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>单节点</p>
                    <blockquote>
                      <p><code>cd</code>
                        <hanla></hanla>到对应目录<hanla></hanla><code>consul.exe</code>，使用<hanla></hanla><code>cmd</code>
                        <hanla></hanla>启动<hanla></hanla><code>Consul</code>
                      </p>
                    </blockquote>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># 启动参数说明: -dev 表示开发模式运行 -server<hanla></hanla>表示服务器模式运行<hanla></hanla></span></span><br><span class="line"><span class="string">consul</span> <span class="string">agent</span> <span class="string">-dev</span> <span class="string">-client=0.0.0.0</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">当前目录下<hanla></hanla><code>cmd</code></th>
                          <th align="center">启动<hanla></hanla><code>consul</code></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/157a4ed5d0b94e2a902c10ee33516a3e.png" alt="当前目录下cmd"></td>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c075bc3492984bcfaa1b713c67e9bd9b.png" alt="启动consul"></td>
                        </tr>
                      </tbody>
                    </table>
                    <blockquote>
                      <p>为了方便启动,<hanla></hanla>也可以在<hanla></hanla><code>consul.exe</code>
                        <hanla></hanla>同级目录下创建一个脚本来启动
                      </p>
                    </blockquote>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="string">consul</span> <span class="string">agent</span> <span class="string">-dev</span> <span class="string">-client=0.0.0.0</span></span><br><span class="line"><span class="string">pause</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">创建启动脚本文件</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5febbf02d4ac4cf6acee8539c63aa81e.png" alt="创建启动脚本文件"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>访问</p>
                    <blockquote>
                      <p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:8500/">http://localhost:8500/</a></p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">访问测试是否启动成功</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/53e4f49221444f79943564939087c2ac.png" alt="访问测试"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="consul-4">
                <ul>
                  <li>
                    <p>创建子<hanla></hanla><code>model=&gt; cloud-providerconsul-payment8006</code></p>
                  </li>
                  <li>
                    <p>创建配置文件</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">${spring.application.name}</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>修改<hanla></hanla><code>pom.xml</code></p>
                    <figure class="highlight xml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-discovery --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.coderitl.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${project.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>主启动</p>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8006</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(PaymentMain8006.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>控制器</p>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${server.port}")</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/payment/consul")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentConsul</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SpringCloud with consul: "</span> + serverPort + <span class="string">"\t"</span> + UUID.randomUUID();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>结果页面</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">成功入驻</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/21ae8277cec74a07a35436208284af3f.png" alt="成功入驻"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>访问<hanla></hanla><code>localhost:8006/payment/consul</code></p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">访问测试</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a4c1741fd050466cb5cce0f04e5a793a.png" alt="访问测试"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="consul-5">
                <ul>
                  <li>
                    <p>创建子<hanla></hanla><code>model=&gt; cloud-consumerconsul-order80</code></p>
                  </li>
                  <li>
                    <p>修改<hanla></hanla><code>pom.xml</code></p>
                    <figure class="highlight xml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-discovery --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.coderitl.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>创建配置文件</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-consumer-order</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">${spring.application.name}</span></span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>主启动</p>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsulMain80</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(OrderConsulMain80.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>控制器</p>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsulController</span> {</span><br><span class="line">    <span class="comment">// 服务中心的服务名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">"http://consul-provider-payment"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/payment/consul")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL + <span class="string">"/payment/consul"</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>结果页面</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">服务消费者注册进<hanla></hanla><code>Consul</code></th>
                          <th align="center">访问<hanla></hanla><code>80</code></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3e4c02fb4ae64fcc80a68fda7a9f8324.png" alt="服务消费者注册进Consul"></td>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2ecb7029233a43a7983eb2e57889417d.png" alt="访问80"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="consul-6">
                <p>…</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h6 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h6>
          <div class="tabs" id="nacos">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#nacos-1">
                  <hanla></hanla>安装与启动
                </button></li>
              <li class="tab"><button type="button" data-href="#nacos-2">服务注册到<hanla></hanla>Nacos</button></li>
              <li class="tab"><button type="button" data-href="#nacos-3">Nacos<hanla></hanla>环境隔离<hanla></hanla></button></li>
              <li class="tab"><button type="button" data-href="#nacos-4">Nacos<hanla></hanla>细节</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="nacos-1">
                <ul>
                  <li>
                    <p>安装与启动 </p>
                    <blockquote>
                      <p><a href="https://coderitl.github.io/2022/07/22/63979.html">https://coderitl.github.io/2022/07/22/63979.html</a></p>
                    </blockquote>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="nacos-2">
                <ul>
                  <li>
                    <p>服务注册到<hanla></hanla><code>Nacos</code></p>
                    <ul>
                      <li>
                        <p>在<code>父工程</code>中的<hanla></hanla><code>dependencyManagement</code>
                          <hanla></hanla>下添加<hanla></hanla><code>spring-cloud-alibaba</code>
                          <hanla></hanla>的管理依赖
                        </p>
                        <figure class="highlight xml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">&lt;!--  nacos 的管理依赖  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>注释掉<code>服务中</code>原有的<hanla></hanla><code>eureka</code>
                          <hanla></hanla>依赖,<hanla></hanla>添加<hanla></hanla><code>nacos</code>
                          <hanla></hanla>配置，移除<hanla></hanla><code>eureka</code>
                          <hanla></hanla>的配置
                        </p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># <span class="doctag">TODO:</span> 添加关于 Nacos 的配置 =&gt; nacos<hanla></hanla>服务地址</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>添加<hanla></hanla><code>nacos</code>
                          <hanla></hanla>的客户端依赖
                        </p>
                        <figure class="highlight xml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 解决负载均衡 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>结果页面</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">结果页面：服务名称建议小写, 在<hanla></hanla><code>order-service 配置<hanla></hanla>Nacos<hanla></hanla>作为注册中心</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5d4088bfe561492cbf46bc613170dbfe.png" alt="结果页面"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>nacos</code>
                          <hanla></hanla>注册中心细节问题
                        </p>
                        <ul>
                          <li>
                            <p>负载均衡依赖</p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">&lt;!--  2. <span class="doctag">TODO:</span> 添加负载均衡依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">该依赖解决如下错误</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/fe9f05b3d8104b18b759213b0e8f9c1b.png" alt="该依赖解决如下错误"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>远程调用的地址<code>使用小写<hanla></hanla>(主要是通过可视化页面获取)</code></p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 使用服务发现,<hanla></hanla>完成服务拉取 修改访问地址<hanla></hanla>(与<hanla></hanla>Eureka<hanla></hanla>名称区别: 小写)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">"http://user-service8081/user/"</span>;</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>修改<hanla></hanla><code>/user/system32/drivers/etc/hosts</code></p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 添加对应的服务名称 与 127.0.0.1 绑定</span></span><br><span class="line"><span class="comment"># Eg:</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">user-service8081</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">可解决此错误</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5864a886504d4977aad6c732696aa534.png" alt="可解决此错误"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>集群属性</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="comment"># 实现集群配置</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">BJ</span> <span class="comment"># 集群名称<hanla></hanla>(自定义名称,<hanla></hanla>也就是机房位置) 例如: 北京 BJ (同区域集群使用同一名称)</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>调整负载均衡配置</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># user-service8081 名称严格为<hanla></hanla>nacos<hanla></hanla>服务列表中的服务名<hanla></hanla></span></span><br><span class="line"><span class="attr">user-service8081:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment"># 负载均衡规则</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p><code>Nacos</code>
                      <hanla></hanla>负载均衡策略
                    </p>
                    <ul>
                      <li>优先选择同集群服务实例列表</li>
                      <li>本地集群找不到提供者,<hanla></hanla>才去其他集群寻找,<hanla></hanla>并且会报警告</li>
                      <li>确定了可用实例列表后,<hanla></hanla>再采用随机负载均衡挑选实例</li>
                    </ul>
                  </li>
                  <li>
                    <p>权重配置</p>
                    <blockquote>
                      <p>服务器设备性能有差异,<hanla></hanla>部分实例所在机器性能较好,<hanla></hanla>另一些比较差,<hanla></hanla>我们希望性能好的机器承担更多的用户请求:</p>
                      <p><code>Nacos</code>
                        <hanla></hanla>提供了权重配置来控制访问频率,<code>
                          <hanla></hanla>权重越大则访问频率越高
                        </code>
                      </p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">配置权重（数字越小,<hanla></hanla>被访问的概率将会降低）</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/17660c4e89fc48049c18b01696e8cdb5.gif#pic_center" alt="配置权重"></td>
                        </tr>
                      </tbody>
                    </table>
                    <ul>
                      <li>实例权重控制<ul>
                          <li><code>nacos</code>
                            <hanla></hanla>控制台可以设置实例的权重值,<code>0-1</code>
                            <hanla></hanla>之间
                          </li>
                          <li>同集群内的多个实例,<hanla></hanla>权重越高被访问的频率越高</li>
                          <li>权重设置为<hanla></hanla><code>0</code>
                            <hanla></hanla>则完全不会被访问
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="nacos-3">
                <ul>
                  <li>
                    <p>环境隔离: <code>namespace</code></p>
                    <blockquote>
                      <p><code>Nacos</code>
                        <hanla></hanla>中服务存储和数据存储的最外层都是一个名为<hanla></hanla><code>namespace</code>
                        <hanla></hanla>的东西,<hanla></hanla>用来做最外层隔离
                      </p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center"><code>namespace</code></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f6d9d5e061d5440a9b0762db7b4c13df.png" alt="namespace"></td>
                        </tr>
                      </tbody>
                    </table>
                    <ul>
                      <li>
                        <p>新建命名空间</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">新建命名空间</th>
                              <th align="center">新建命名空间</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/9eb8f1c11c854fa4b2948b78afd7578e.png" alt="新建命名空间"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f2a3901bb38b4545901a979c409a0cd5.png" alt="新建命名空间"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>ID</code>
                          <hanla></hanla>很重要
                        </p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">重要<hanla></hanla><code>ID</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ed6e94fa037d486cadaeb7e9077fc0a2.png" alt="重要"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>添加<hanla></hanla><code>namespace</code></p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># order-service application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">cloud:</span></span><br><span class="line">     <span class="attr">nacos:</span></span><br><span class="line">       <span class="attr">discovery:</span></span><br><span class="line">		 <span class="attr">namespace:</span> <span class="number">9527</span> <span class="comment"># 命名空间填 创建命名空间时的 id【默认可以通过 UUID 自动生成】</span></span><br><span class="line">		 </span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">配置完成命名空间</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/14c9e7c8ef314a0da8d38d217f8e1725.png" alt="配置完成命名空间"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>总结<hanla></hanla><code>Nacos</code>
                          <hanla></hanla>环境隔离
                        </p>
                        <ul>
                          <li><code>namespace</code>
                            <hanla></hanla>用来做环境隔离
                          </li>
                          <li>每个<hanla></hanla><code>namespace</code>
                            <hanla></hanla>都有唯一<hanla></hanla><code>id</code>
                          </li>
                          <li>不同的<hanla></hanla><code>namespace</code>
                            <hanla></hanla>下的服务不可见
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="nacos-4">
                <ul>
                  <li>
                    <p>临时实例</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">临时实例</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/429e46a13cec4ba78c37bb8f94f75b5a.png" alt="临时实例"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>临时实例<code>采用心跳检测</code></p>
                  </li>
                  <li>
                    <p>非临时实例</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">非临时实例<hanla></hanla>(<code>Nacos<hanla></hanla>会主动询问是否健康</code>)</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/28ab4bebcf304c1888bfcc8c4bb7246a.png" alt="非临时实例"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>临时实例和非临时实例配置</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">         <span class="attr">ephemeral:</span> <span class="literal">false</span> <span class="comment"># 设置为非临时实例</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p><code>Eureka</code>
                      <hanla></hanla>和<hanla></hanla><code>Nacos</code>
                      <hanla></hanla>区别
                    </p>
                    <ul>
                      <li>共同点<ul>
                          <li>都支持服务注册和服务拉取</li>
                          <li>都支持服务提供者心跳方式做健康检测</li>
                        </ul>
                      </li>
                      <li>区别<ul>
                          <li><code>Nacos</code>
                            <hanla></hanla>支持服务端主动检测提供者状态: 临时实例采用心跳模式,<hanla></hanla>非临时实例采用主动检测模式
                          </li>
                          <li>临时实例心跳不正常会被剔除,<hanla></hanla>非临时实例则不会被剔除</li>
                          <li><code>Nacos</code>
                            <hanla></hanla>支持服务列表变更的消息推送模式,<hanla></hanla>服务列表更新更及时
                          </li>
                          <li><code>Nacos</code>
                            <hanla></hanla>集群默认采用<hanla></hanla><code>AP</code>
                            <hanla></hanla>方式,<hanla></hanla>当集群中存在非临时实例时,<hanla></hanla>采用<hanla></hanla><code>CP</code>
                            <hanla></hanla>模式,<code>Eureka</code>
                            <hanla></hanla>采用<hanla></hanla><code>AP</code>
                            <hanla></hanla>模式
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h5 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h5>
          <div class="tabs" id="ribbon">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#ribbon-1">
                  <hanla></hanla>简介
                </button></li>
              <li class="tab"><button type="button" data-href="#ribbon-2">负载均衡</button></li>
              <li class="tab"><button type="button" data-href="#ribbon-3">替换负载均衡策略<hanla></hanla></button></li>
              <li class="tab"><button type="button" data-href="#ribbon-4">Ribbon<hanla></hanla>饥饿加载</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="ribbon-1">
                <ul>
                  <li>
                    <p>简介</p>
                    <blockquote>
                      <p><code>SpringCloudRibbon</code>
                        <hanla></hanla>是基于<hanla></hanla><code>netflix Ribbon</code>
                        <hanla></hanla>实现的一套<code>客户端</code>负载均衡的工具
                      </p>
                      <p>简单地说,<code>Ribbon</code>
                        <hanla></hanla>是<hanla></hanla><code>Netflix</code>
                        <hanla></hanla>发布的开源项目,<hanla></hanla>主要的功能是提供<code>客户端的软件负载均衡算法和服务调用</code>,<code>Ribbon</code>
                        <hanla></hanla>客户端组件提供的一系列完善的配置项如何连接超时的,<hanla></hanla>重试等，简单地说,<hanla></hanla>就是在配制文件中列出<hanla></hanla><code>Load Balancer(简称<hanla></hanla>LB)</code>
                        <hanla></hanla>后面所有的机器,<code>Ribbon</code>
                        <hanla></hanla>会自动地帮助你基于某种规则<hanla></hanla>(如简单轮询,<hanla></hanla>随机连接等)<hanla></hanla>去连接这些机器,<hanla></hanla>我们很容易使用<hanla></hanla><code>Ribbon</code>
                        <hanla></hanla>实现自定义的负载均衡算法
                      </p>
                    </blockquote>
                  </li>
                  <li>
                    <p><code>LB</code>
                      <hanla></hanla>负载均衡<hanla></hanla>(<code>Load Balance</code>)<hanla></hanla>是什么
                    </p>
                    <blockquote>
                      <p>简单地说就是将用户的请求平摊的分配到多个服务上,<hanla></hanla>从而达到系统的<hanla></hanla><code>HA</code>（高可用）</p>
                      <p>常见的负载均衡有软件<hanla></hanla><code>Nginx,LVS，硬件 F5<hanla></hanla>等</code></p>
                    </blockquote>
                  </li>
                  <li>
                    <p><code>Ribbon</code>
                      <hanla></hanla>本地负载均衡客户端<hanla></hanla><code>VS Nginx</code>
                      <hanla></hanla>服务端负载均衡的区别
                    </p>
                    <blockquote>
                      <p><code>Nginx</code>
                        <hanla></hanla>是服务器负载均衡,<hanla></hanla>客户端所有请求都会交给<hanla></hanla><code>nginx</code>，然后由<hanla></hanla><code>nginx</code>
                        <hanla></hanla>实现转发请求,<hanla></hanla>即<code>负载均衡</code>是由服务端实现的
                      </p>
                      <p><code>Ribbon</code>
                        <hanla></hanla>本地负载均衡,<hanla></hanla>在调用微服务接口的时候,<hanla></hanla>会在注册中心上获取注册信息服务列表之后缓存到<hanla></hanla><code>JVM</code>
                        <hanla></hanla>本地,<hanla></hanla>从而实现<hanla></hanla><code>RPC</code>
                        <hanla></hanla>远程服务调用技术
                      </p>
                    </blockquote>
                  </li>
                  <li>
                    <p>使用</p>
                    <ul>
                      <li>
                        <p>依赖问题</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">新版<hanla></hanla><code>Eureka</code>
                                <hanla></hanla>已经引入<hanla></hanla><code>Ribbon</code>
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/9fdd475484494f33b14c4dbee5ddcd6a.png" alt="新版Eureka已经引入Ribbon"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>Ribbion </code>的负载均衡和<hanla></hanla><code>Rest</code>
                          <hanla></hanla>调用
                        </p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 返回对象响应体中数据转换成的对象,<hanla></hanla>基本可以理解为 JSON (restTemplate.getForObject)</span></span><br><span class="line"><span class="meta">@GetMapping("/get/{id}")</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> {</span><br><span class="line">    log.info(<span class="string">"OrderController id: {}"</span>, id);</span><br><span class="line">    <span class="comment">// 写操作: postForObject</span></span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">"/payment/get/"</span> + id, CommonResult.class);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 返回对象为 ResponseEntity<hanla></hanla>对象,<hanla></hanla>包含响应中的一些重要信息,<hanla></hanla>必须响应头,<hanla></hanla>响应状态码 响应体等</span></span><br><span class="line">    <span class="meta">@GetMapping("/getForEntity/{id}")</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment2</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> {</span><br><span class="line">        log.info(<span class="string">"OrderController id: {}"</span>, id);</span><br><span class="line">        ResponseEntity&lt;CommonResult&gt; entity = restTemplate.getForEntity(PAYMENT_URL + <span class="string">"/payment/get/"</span> + id, CommonResult.class);</span><br><span class="line">        <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) {</span><br><span class="line">            <span class="keyword">return</span> entity.getBody();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">"操作失败"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">// restTemplate.postForEntity(PAYMENT_URL + "/payment/get/" + id, CommonResult.class).getBody();</span></span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p><code>Ribbon</code>
                          <hanla></hanla>核心组件<hanla></hanla><code>IRule</code>
                        </p>
                        <blockquote>
                          <p><code>IRule</code>：根据特定算法中从服务列表中选取一个要访问的服务</p>
                        </blockquote>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// IRule 是一个接口 作用范围: 全体服务<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IRule</span> {</span><br><span class="line">    Server <span class="title function_">choose</span><span class="params">(Object var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setLoadBalancer</span><span class="params">(ILoadBalancer var1)</span>;</span><br><span class="line"></span><br><span class="line">    ILoadBalancer <span class="title function_">getLoadBalancer</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">关系图</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c13dc52423a34fa086e452c19ea4f9af.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p><code>7<hanla></hanla>种负载均衡方式</code></p>
                    <ul>
                      <li><code>com.netflix.loadbalancer.RoundRobinRule</code>
                        <hanla></hanla>轮询
                      </li>
                      <li><code>com.netflix.loadbalancer.RandomRule</code>
                        <hanla></hanla>随机
                      </li>
                      <li><code>com.netflix.loadbalancer.RetryRule</code>
                        <hanla></hanla>先按照<code>轮询</code>的策略获取服务,<hanla></hanla>如果获取服务失败则在指定时间内会进行重试,<hanla></hanla>获取可用的服务
                      </li>
                      <li><code>WeightedResponseTimeRule</code>
                        <hanla></hanla>对<code>轮询</code>的扩展,<hanla></hanla>响应速度越快的实例选择权重越大,<hanla></hanla>越容易被选择
                      </li>
                      <li><code>BestAvailableRule</code>
                        <hanla></hanla>会先过滤掉由于多次访问故障而处于断路跳闸状态的服务,<hanla></hanla>然后选择一个并发最下的服务
                      </li>
                      <li><code>AvailabiltiyFilteringgRule</code>
                        <hanla></hanla>先过滤掉故障实例,<hanla></hanla>在选择并发较小的实例
                      </li>
                      <li><code>ZoneAvoidanceRule</code>:<hanla></hanla>默认规则,<hanla></hanla>复合判断<hanla></hanla><code>server</code>
                        <hanla></hanla>所在区域的性能和<hanla></hanla><code>server</code>
                        <hanla></hanla>的可用性选择服务器
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="ribbon-2">
                <ul>
                  <li>
                    <p>负载均衡流程</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">负载均衡流程</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ecffeae2c588450683e87a7ef5248cb6.png" alt="负载均衡流程"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>负载均衡原理</p>
                    <blockquote>
                      <p>负载均衡算法: <code>rest 接口第几次请求数</code> % <code>服务器集群总数量</code> = <code>实际调用服务器位置的下标</code>,<hanla></hanla>每次服务器重启后<hanla></hanla><code>rest</code>
                        <hanla></hanla>接口计数从<hanla></hanla><code>1</code>
                        <hanla></hanla>开始
                      </p>
                    </blockquote>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">List&lt;ServiceInstance&gt; instances = discoryClient.getInstances(<span class="string">"CLOUD-PAYMENT-SERVICE"</span>);</span><br><span class="line"></span><br><span class="line">如:</span><br><span class="line">	List[<span class="number">0</span>] instances = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8001</span></span><br><span class="line">    List[<span class="number">1</span>] instances = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span></span><br><span class="line">        </span><br><span class="line"><span class="number">8001</span> + <span class="number">8002</span> =&gt; 组合为集群,<hanla></hanla>他们共计 <span class="number">2</span> 台机器,<hanla></hanla>集群总数为 <span class="number">2</span> 按照轮询算法原理:</span><br><span class="line">    当总请求数为 <span class="number">1</span> 时: <span class="number">1</span> % <span class="number">2</span> = <span class="number">1</span> 对应下标位置为 <span class="number">1</span>,<hanla></hanla>则获取服务器地址为: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span></span><br><span class="line">    当总请求数为 <span class="number">2</span> 时: <span class="number">2</span> % <span class="number">2</span> = <span class="number">0</span> 对应下标位置为 <span class="number">0</span>,<hanla></hanla>则获取服务器地址为: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8001</span></span><br><span class="line">    当总请求数为 <span class="number">3</span> 时: <span class="number">3</span> % <span class="number">2</span> = <span class="number">1</span> 对应下标位置为 <span class="number">1</span>,<hanla></hanla>则获取服务器地址为: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span></span><br><span class="line">    当总请求数为 <span class="number">4</span> 时: <span class="number">4</span> % <span class="number">2</span> = <span class="number">0</span> 对应下标位置为 <span class="number">0</span>,<hanla></hanla>则获取服务器地址为: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8001</span></span><br><span class="line">        ....</span><br><span class="line">    </span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="ribbon-3">
                <ul>
                  <li>
                    <p>如何替换<hanla></hanla>(<code>全局替换</code>)</p>
                    <ul>
                      <li>
                        <p>配置细节</p>
                        <blockquote>
                          <p>官方文档明确给出警告:</p>
                          <p>​ 这个自定义配置类不能放在<hanla></hanla><code>@ComponentScan</code>
                            <hanla></hanla>所扫描的当前包下以及子包下，否则我们自定义的这个配置类就会被所有的<hanla></hanla><code>Ribbon</code>
                            <hanla></hanla>客户端所共享,<hanla></hanla>达不到特殊定制化的目的了，也就是在启动类<hanla></hanla>(<code>@SpringBootApplication</code>
                            <hanla></hanla>复合注解,<hanla></hanla>内部有<hanla></hanla><code>ComponenScan</code>)<hanla></hanla>的父包外
                          </p>
                        </blockquote>
                      </li>
                      <li>
                        <p>新建包<hanla></hanla><code>package com.coderitl.myrule;</code></p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySelfRule</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 定义为随机<hanla></hanla>(其他的同理 new XX) 作用范围: 局部服务生效</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>主启动添加注解</p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="comment">// 新添加<hanla></hanla></span></span><br><span class="line"><span class="meta">@RibbonClient(name = "CLOUD-PAYMENT-SERVICE", configuration = MySelfRule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(OrderMain80.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>访问<hanla></hanla><code>http://localhost/consumer/payment/get/1</code>
                          <hanla></hanla>端口就变为随机的
                        </p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">随机验证</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/675bae64a1554e6eb4e425b3f49af522.gif#pic_center" alt="随机验证"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>基于某个配置文件替换</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># 单独定格书写<hanla></hanla></span></span><br><span class="line"><span class="attr">userservice:</span> <span class="comment"># 是一个名为 userservice 的服务 -&gt;<hanla></hanla>服务名称</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">  	<span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span> <span class="comment"># 负载均衡规则</span></span><br><span class="line">  	</span><br><span class="line"><span class="comment"># 日志配置<hanla></hanla></span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.coderitl:</span> <span class="string">debug</span> <span class="comment"># 指定包 debug 级别</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dataformat:</span> <span class="string">MM-dd</span> <span class="string">HH:mm:ss:SSS</span>   </span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>两种方式的区别</p>
                    <ul>
                      <li>代码方式: 配置灵活，但修改时需要重新打包发布</li>
                      <li>配置方式: 直观、方便、无需重新打包发布，但是无法做全局配置</li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="ribbon-4">
                <ul>
                  <li>
                    <p>饥饿加载</p>
                    <blockquote>
                      <p><code>Ribbon</code>
                        <hanla></hanla>默认是采用懒加载，即第一次访问时才会创建<hanla></hanla><code>LoadBalanceClient</code>，请求时间会很长,<hanla></hanla>而饥饿加载则会在项目启动时创建,<hanla></hanla>降低第一次访问的耗时，配置如下:
                      </p>
                    </blockquote>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 开启饥饿加载</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="string">userservice</span> <span class="comment"># 指定对 userservice 这个服务饥饿加载</span></span><br><span class="line">    </span><br><span class="line"> <span class="comment"># 多个服务配置方式</span></span><br><span class="line"> <span class="attr">clients:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">a</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">b</span></span><br><span class="line">   </span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h5 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h5>
          <div class="tabs" id="nacosconfig">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#nacosconfig-1">统一配置管理</button></li>
              <li class="tab"><button type="button" data-href="#nacosconfig-2">配置热更新</button></li>
              <li class="tab"><button type="button" data-href="#nacosconfig-3">配置共享</button></li>
              <li class="tab"><button type="button" data-href="#nacosconfig-4">搭建集群</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="nacosconfig-1">
                <ul>
                  <li>
                    <p><code>Nacos</code>
                      <hanla></hanla>配置管理
                    </p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center"><code>Nacos</code>
                            <hanla></hanla>配置管理
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/30e0370e099f4235b0cdcb4a0c6e7e3f.png" alt="Nacos配置管理"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>新增配置文件</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">新增配置文件</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/49ccd12aba2f4b65bebabd9f5b017c9d.png" alt="新增配置文件"></td>
                        </tr>
                      </tbody>
                    </table>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">创建流程</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3631e4bacfc9470897a119e01acd26f6.png" alt="创建流程"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>配置文件加载流程</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">未加入<hanla></hanla><code>nacos</code>
                            <hanla></hanla>前
                          </th>
                          <th align="center">读取<hanla></hanla><code>nacos</code>
                            <hanla></hanla>配置文件
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/8cb0354259a34349a3c49385d5f324bf.png" alt="未加入nacos前"></td>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/26190636f5a64c228da727b003e7c60d.png" alt="读取nacos配置文件"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>配置统一管理步骤</p>
                    <ul>
                      <li>
                        <p>添加依赖</p>
                        <figure class="highlight xml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">&lt;!-- nacos 配置管理依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>在<hanla></hanla><code>userservice</code>
                          <hanla></hanla>中的<hanla></hanla><code>resource</code>
                          <hanla></hanla>目录下创建一个<hanla></hanla><code>bootstrap.yml</code>
                          <hanla></hanla>文件,<hanla></hanla>这个文件是引导文件,<hanla></hanla>优先级高于<hanla></hanla><code>application.yml</code>
                        </p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span> 2. 新建 bootstrap.yml 文件<hanla></hanla></span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span> <span class="comment"># 服务名称【大小写与服务名一致】</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 开发环境 这里是 dev</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacos 地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">文件分析</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0d010c3a45b642b1a86a80388543b535.png" alt="文件分析"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>删除主配置文件中重复配置</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">删除主配置文件中重复配置</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/529684f723ec4feb937754172156cd0e.png" alt="删除主配置文件中重复配置"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>读取<hanla></hanla><code>userservice-dev.yaml</code>
                          <hanla></hanla>配置文件中的属性
                        </p>
                        <figure class="highlight xml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">&lt;!-- 补充一个依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  <span class="doctag">TODO:</span> 新版本 nacos 用于加载 bootstrap.yml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">无此依赖出现如下问题<hanla></hanla>(新版<hanla></hanla><code>nacos</code>)</th>
                              <th align="center">添加后</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d4ec273549a84b56b3f1bcadd6a0e891.png" alt="无此依赖出现如下问题"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5044e18770234e5da5ba815f4e33647c.png" alt="添加后"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># userservice-dev.yaml</span></span><br><span class="line"><span class="attr">pattern:</span></span><br><span class="line">  <span class="attr">dataformat:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 5. 添加访问配置文件的控制器<hanla></hanla></span></span><br><span class="line"><span class="meta">@GetMapping("/now")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDataformat</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dataformat));</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">读取<hanla></hanla><code>userservice.yml</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/1f07b6ca950a42e8a9a93cf33aca8af0.png" alt="读取userservice.yml"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="nacosconfig-2">
                <ul>
                  <li>
                    <p>方式一：在<hanla></hanla><code>@Value</code>
                      <hanla></hanla>注入的变量所在类添加注解<hanla></hanla><code>@RefreshScope</code>
                    </p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">实现热更新<hanla></hanla>=&gt;<code>dataformat 更改为 dateformat</code></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/815a3a20cf69431b999b6ed53abe2eb8.png" alt="实现热更新"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>方式二: 使用<hanla></hanla><code>@ConfigurationProperties</code>
                      <hanla></hanla>注解<hanla></hanla>(推荐)
                    </p>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment">//  配置类<hanla></hanla></span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "pattern")</span> <span class="comment">// 前缀 + dateformat =&gt; 组成完整字段<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> {</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 注意匹配 nacos 定于的属性名,<hanla></hanla>切勿写错</span></span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 7. 热加载方式二: 使用配置类<hanla></hanla></span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PatternProperties patternProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 5. 添加访问配置文件的控制器<hanla></hanla></span></span><br><span class="line"><span class="meta">@GetMapping("/now")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDataformat</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(patternProperties.getDateformat()));</span><br><span class="line">}</span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="nacosconfig-3">
                <ul>
                  <li>
                    <p>多环境共享</p>
                    <blockquote>
                      <p>不是所有的配置都适合放到配置中心，维护起来比较麻烦；建议将一些关键参数，需要<code>运行时调整的参数</code>放到 <code>nacos </code>配置中心，<code>一般都是自定义配置</code>。</p>
                    </blockquote>
                    <ul>
                      <li>
                        <p>微服务启动会从<hanla></hanla><code>nacos</code>
                          <hanla></hanla>读取多个配置文件
                        </p>
                        <ul>
                          <li><code>[spring.application.name]-[spring.profiles.active].yaml =&gt; userservice-dev.yaml</code></li>
                          <li><code>[spring.application.name].yaml =&gt; userservice.yaml</code></li>
                        </ul>
                        <blockquote>
                          <p>无论<hanla></hanla><code>profile</code>
                            <hanla></hanla>如何变化,<code>[spring.application.name].yaml</code>
                            <hanla></hanla>这个文件按一定会被加载,<hanla></hanla>因此对环境共享配置可以写入这个文件
                          </p>
                        </blockquote>
                      </li>
                      <li>
                        <p>创建</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">创建<hanla></hanla><code>spring.application=&gt; userservice</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0eaafa8d7ed2424baed8e8c1396c99e5.png" alt="创建"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>创建多环境共享环境<hanla></hanla><code>IDEA =&gt; 端口模拟实现</code></p>
                      </li>
                      <li>
                        <p><code>java</code></p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 在 配置类中添加<hanla></hanla></span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 用于读取多环境配置数据<hanla></hanla></span></span><br><span class="line"><span class="keyword">private</span> String envSharedValue;</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PatternProperties patternProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 8. 配置多环境共享配置读取测试<hanla></hanla></span></span><br><span class="line"><span class="meta">@GetMapping("/prop")</span></span><br><span class="line"><span class="keyword">public</span> PatternProperties <span class="title function_">patternProperties</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> patternProperties;</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>访问测试</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">成功读取多环境共享数据</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d9f9ed0969224329a49ea9fd2cdd8b71.png" alt="成功读取多环境共享数据"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>多种配置的优先级<hanla></hanla>(<code>相同数据读取时显示内容遵循如下规则</code>)</p>
                    <blockquote>
                      <p><code>服务名-profile.yaml(userservice-dev.yaml) &gt; 服务名称.yaml(userservice.yaml) &gt; 本地配置<hanla></hanla>(application.yaml)</code></p>
                    </blockquote>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="nacosconfig-4">
                <ul>
                  <li>
                    <p>集群</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">集群</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a49ff73488a84f8ab8d98741f7de6f1e.png" alt="集群"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>集群步骤</p>
                    <ul>
                      <li>搭建数据库,<hanla></hanla>初始化数据库表结构</li>
                      <li>下载<hanla></hanla><code>nacos</code>
                        <hanla></hanla>安装包
                      </li>
                      <li>配置<hanla></hanla><code>nacos</code></li>
                      <li>启动<hanla></hanla><code>nacos</code>
                        <hanla></hanla>集群
                      </li>
                      <li><code>nginx</code>
                        <hanla></hanla>反向代理
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>起步配置</p>
                    <ol>
                      <li>
                        <p>进入<hanla></hanla><code>nacos</code>
                          <hanla></hanla>的<hanla></hanla><code>conf</code>
                          <hanla></hanla>目录,<hanla></hanla>修改配置文件<hanla></hanla><code>cluster.conf.example</code>，重命名为<hanla></hanla><code>cluster.conf</code>
                        </p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">配置如下信息</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7d3989ba948c441d9bdf3b9fc719d3c1.png" alt="配置如下信息"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>修改<code>\nacos\conf\application.properties</code>
                          <hanla></hanla>文件,<hanla></hanla>添加数据库配置
                        </p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 以下内容被注释,<hanla></hanla>取消注释修改局部信息即可<hanla></hanla></span></span><br><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC # 除了 nacos_config 数据库名称修改外,<hanla></hanla>其他参数请勿修改<hanla></hanla></span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">root</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>在连接的数据库上执行<hanla></hanla><code>sql</code>
                          <hanla></hanla>脚本
                        </p>
                      </li>
                      <li>
                        <p>将<hanla></hanla><code>nacos</code>
                          <hanla></hanla>复制<hanla></hanla><code>3<hanla></hanla>份</code>,<hanla></hanla>再修改<code>各自对应端口号</code>
                        </p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="string">nacos1</span> <span class="string">=&gt;8845</span></span><br><span class="line"><span class="string">nacos2</span> <span class="string">=&gt;8846</span></span><br><span class="line"><span class="string">nacos3</span> <span class="string">=&gt;8847</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">修改各自端口号<hanla></hanla><code>Eg: nacos1\conf\application.properties=&gt; server.port=8845</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d42a9b6631ed4538a7c21535578925cd.png" alt="修改各自端口号"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>然后分别启动三个节点</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">然后分别启动三个节点</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/58120dcdeb9b4d7ea56735f5fc12cd74.gif#pic_center" alt="然后分别启动三个节点"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>Nginx</code>
                          <hanla></hanla>反向代理配置<hanla></hanla>(其他内容为注释,<hanla></hanla>可以选择全部替换,<hanla></hanla>或者只替换<hanla></hanla><code>http<hanla></hanla>节点</code>)
                        </p>
                        <figure class="highlight nginx">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> {</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> {</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">upstream</span> nacos-cluster{</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8845</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8846</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8847</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="section">server</span> {</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="comment"># 配置 nacos</span></span><br><span class="line">         <span class="section">location</span> /nacos {</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://nacos-cluster;</span><br><span class="line">        }</span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html {</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>访问<hanla></hanla><code>localhost/nacos =&gt; 用户名密码: nacos</code></p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">访问测试</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d2c7e90cc65846adb2d312ead383c2d2.png" alt="访问测试"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>nacos</code>
                          <hanla></hanla>配置可以存储在数据库中
                        </p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">数据库查看配置</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c2fa79e60e7940408956bff7efa2adb2.png" alt="数据库查看配置"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ol>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h5 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h5>
          <div class="tabs" id="openfeign">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#openfeign-1">
                  <hanla></hanla>理论
                </button></li>
              <li class="tab"><button type="button" data-href="#openfeign-2">使用步骤</button></li>
              <li class="tab"><button type="button" data-href="#openfeign-3">自定义配置</button></li>
              <li class="tab"><button type="button" data-href="#openfeign-4">性能优化</button></li>
              <li class="tab"><button type="button" data-href="#openfeign-5">最佳实战</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="openfeign-1">
                <ul>
                  <li>
                    <p>是什么</p>
                    <blockquote>
                      <p><code>Feign</code>
                        <hanla></hanla>是一个声明式<hanla></hanla><code>WebService</code>
                        <hanla></hanla>客户端,<hanla></hanla>使用<hanla></hanla><code>Feign</code>
                        <hanla></hanla>能让编写<hanla></hanla><code>Web Service</code>
                        <hanla></hanla>客户端更加简单.
                      </p>
                      <p>他的使用方法是<code>定义一个服务接口然后再上面添加注解</code>,<code>Feign</code>
                        <hanla></hanla>也支持可插拔式的编码器和解码器,<code>SpringCloud</code>
                        <hanla></hanla>对<hanla></hanla><code>Feign</code>
                        <hanla></hanla>进行了封装,<hanla></hanla>使其支持<hanla></hanla><code>SpringMVC</code>
                        <hanla></hanla>标准注解和<hanla></hanla><code>HttpMessageConverters</code>，<code>Fegin</code>
                        <hanla></hanla>可以与<hanla></hanla><code>Eureka</code>
                        <hanla></hanla>和<hanla></hanla><code>Ribbon</code>
                        <hanla></hanla>组合使用以支持负载均衡
                      </p>
                    </blockquote>
                  </li>
                  <li>
                    <p><code>Feign</code>
                      <hanla></hanla>能干什么
                    </p>
                    <blockquote>
                      <p><code>Feign</code>
                        <hanla></hanla>旨在使编写<hanla></hanla><code>Java Http</code>
                        <hanla></hanla>客户端变得更容易。
                      </p>
                      <p>前面使用<hanla></hanla><code>Ribbon + RestTemplate</code>
                        <hanla></hanla>时,<hanla></hanla>利用<hanla></hanla><code>RestTemplate</code>
                        <hanla></hanla>对<hanla></hanla><code>http</code>
                        <hanla></hanla>请求的封装处理,<hanla></hanla>形成了一套模板化的调用方法,<hanla></hanla>但是在实际开发中,<hanla></hanla>由于对微服务依赖的调用可能不止一处,<code>
                          <hanla></hanla>往往一个接口会被多处调用,<hanla></hanla>所以通常会针对每个微服务自行封装一些客户端类来包装这些以来服务的调用
                        </code>,<hanla></hanla>所以，<code>Fegin</code>
                        <hanla></hanla>在此基础上做了进一步封装,<hanla></hanla>由他来帮助我们定义和实现依赖服务接口的定义,<hanla></hanla>在<hanla></hanla><code>Feign</code>
                        <hanla></hanla>的实现下,<code>
                          <hanla></hanla>我们只需要创建一个接口并使用注解的方式来配置它<hanla></hanla>(以前是 Dao<hanla></hanla>接口上面标注 Mapper<hanla></hanla>注解,<hanla></hanla>现在是一个微服务接口上面标注一个,Feign<hanla></hanla>注解即可)
                        </code>,<hanla></hanla>即可完成对微服务提供方的接口绑定,<hanla></hanla>简化了使用<hanla></hanla><code>SpringCloud Ribbon</code>，自动封装服务调用客户端的开发量
                      </p>
                    </blockquote>
                  </li>
                  <li>
                    <p><code>Feign</code>
                      <hanla></hanla>集成了<hanla></hanla><code>Ribbon</code>
                    </p>
                    <blockquote>
                      <p>利用<hanla></hanla><code>Ribbon</code>
                        <hanla></hanla>维护了<hanla></hanla><code>Payment</code>
                        <hanla></hanla>的服务列表信息,<hanla></hanla>并且通过轮询实现类客户端的负载均衡,<hanla></hanla>而与<hanla></hanla><code>Ribbon</code>
                        <hanla></hanla>不同的是,<hanla></hanla>通过<hanla></hanla><code>feign</code>
                        <hanla></hanla>只需要定义服务绑定接口且以声明式的方法,<hanla></hanla>优雅而简单的实现了服务调用
                      </p>
                    </blockquote>
                  </li>
                  <li>
                    <p><code>Feign</code>
                      <hanla></hanla>与<hanla></hanla><code>openFeign</code>
                      <hanla></hanla>的区别
                    </p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center"><code>Feign</code></th>
                          <th align="center"><code>openFeign</code></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><code>Feign</code>
                            <hanla></hanla>是<hanla></hanla><code>SpringCloud</code>
                            <hanla></hanla>组件中的一个轻量级<hanla></hanla><code>RestFul</code>
                            <hanla></hanla>的<hanla></hanla><code>HTTP</code>
                            <hanla></hanla>服务客户端<hanla></hanla><code>Feign</code>
                            <hanla></hanla>内置了<hanla></hanla><code>Riboon</code>，用来做客户端负载均衡,<hanla></hanla>去调用服务注册中心的服务,<code>Feign</code>
                            <hanla></hanla>的使用方式是:<code>
                              <hanla></hanla>使用<hanla></hanla>Feign
                            </code>
                            <hanla></hanla>的注解定义接口,<hanla></hanla>调用这个接口,<hanla></hanla>就可以调用服务注册中心的服务
                          </td>
                          <td align="center"><code>openfeign</code>
                            <hanla></hanla>是<hanla></hanla><code>SpringCloud</code>
                            <hanla></hanla>在<hanla></hanla><code>Feign</code>
                            <hanla></hanla>的基础上支持了<hanla></hanla><code>SpringMVC</code>
                            <hanla></hanla>的注解,<hanla></hanla>如<hanla></hanla><code>@RequesMapping</code>
                            <hanla></hanla>等，<code>openfeign</code>
                            <hanla></hanla>的<hanla></hanla><code>@FeignClient</code>
                            <hanla></hanla>可以解析<hanla></hanla><code>SpringMVC</code>
                            <hanla></hanla>的<hanla></hanla><code>@RequestMapping</code>
                            <hanla></hanla>注解下的接口,<hanla></hanla>并通过动态代理的方式产生实现类,<hanla></hanla>实现类中做负载均衡并调用其他服务
                          </td>
                        </tr>
                        <tr>
                          <td align="center"><code>&lt;dependency&gt;</code><br>
                            <groupid>org.springframework.cloud</groupid><br>
                            <artfactid>spring-cloud-starter-feign</artfactid><br>
                          </td>
                          <td align="center"><code>&lt;dependency&gt;</code><br>
                            <groupid>org.springframework.cloud</groupid><br>
                            <artfactid>spring-cloud-starter-openfeign</artfactid><br>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="openfeign-2">
                <ul>
                  <li>
                    <p><code>Feign</code>
                      <hanla></hanla>的使用步骤
                    </p>
                    <ul>
                      <li>
                        <p>引入依赖</p>
                        <figure class="highlight xml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">&lt;!-- <span class="doctag">TODO:</span> 1. 添加 openFeign 依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>主启动添加<hanla></hanla><code>@EnableFeignClients</code>
                          <hanla></hanla>注解
                        </p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@MapperScan("com.coderitl.springcloud.mapper")</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>编写<hanla></hanla><code>FeignClient</code>
                          <hanla></hanla>接口
                        </p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 3. 创建远程调用接口 user-service8081=&gt; 服务名称<hanla></hanla>(必须的)</span></span><br><span class="line"><span class="meta">@FeignClient("userservice")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> {</span><br><span class="line">    <span class="comment">// private static final String URL = "http://userservice/user/"+order.getUserId();</span></span><br><span class="line">    <span class="meta">@GetMapping("/user/{id}")</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>使用<hanla></hanla><code>FeignClient</code>
                          <hanla></hanla>中定义的方法代理<hanla></hanla><code>RestTemplate</code>
                        </p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/order")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 4. 删除 RestTemplate</span></span><br><span class="line">    <span class="meta">@GetMapping("/{orderId}")</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderByUserId</span><span class="params">(<span class="meta">@PathVariable("orderId")</span> Long orderId)</span> {</span><br><span class="line">        <span class="comment">// 根据<hanla></hanla>id<hanla></hanla>查询订单并返回</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.queryOrderById(orderId);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 5. 使用 feign 远程调用</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.findById(order.getUserId());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>访问测试</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>feign</code>
                                <hanla></hanla>实现远程调用
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b90021dc4cd64ddcadc8fd4ddbc476be.png" alt="feign实现远程调用"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>feign</code>
                          <hanla></hanla>实现了负载均衡<code>内部集成了 Ribbon</code>
                        </p>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="openfeign-3">
                <ul>
                  <li>
                    <p><code>Feign</code>
                      <hanla></hanla>运行自定义配置来覆盖默认配置,<hanla></hanla>可以修改的配置如下
                    </p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">类型</th>
                          <th align="center">作用</th>
                          <th align="center">说明</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><code>feign。Logger.Level</code></td>
                          <td align="center">修改日志级别</td>
                          <td align="center">包含四种不同的级别<hanla></hanla><code>NONE BASIC HEADERS FULL</code></td>
                        </tr>
                        <tr>
                          <td align="center">feign.codec.Decoder</td>
                          <td align="center">响应结果的解析器</td>
                          <td align="center"><code>HTTP</code>
                            <hanla></hanla>远程调用的结果做解析,<hanla></hanla>例如解析<hanla></hanla><code>json</code>
                            <hanla></hanla>字符串为<hanla></hanla><code>java</code>
                            <hanla></hanla>对象
                          </td>
                        </tr>
                        <tr>
                          <td align="center">feign.codec.Encoder</td>
                          <td align="center">请求参数编码</td>
                          <td align="center">将请求参数编码,<hanla></hanla>便于通过<hanla></hanla><code>http</code>
                            <hanla></hanla>请求发送
                          </td>
                        </tr>
                        <tr>
                          <td align="center">feign.Contract</td>
                          <td align="center">支持的注解格式</td>
                          <td align="center">默认是<hanla></hanla><code>SpringMVC</code>
                            <hanla></hanla>的注解
                          </td>
                        </tr>
                        <tr>
                          <td align="center">feign.Retryer</td>
                          <td align="center">失败的重试机制</td>
                          <td align="center">请求失败的重试机制,<hanla></hanla>默认是没有,<hanla></hanla>不过会使用<hanla></hanla><code>Ribbon</code>
                            <hanla></hanla>的重试
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <blockquote>
                      <p>一般只需要配置日志级别</p>
                    </blockquote>
                  </li>
                  <li>
                    <p>配置日志有两种方式</p>
                    <ul>
                      <li>
                        <p>方式一: 配置文件</p>
                        <ul>
                          <li>
                            <p>全局生效</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span> 实现日志配置的第一种方式<hanla></hanla></span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># 这里是用 default 就是全局配置,<hanla></hanla>如果是写服务名称,<hanla></hanla>则是针对某个微服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment"># 日志级别</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>局部生效</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span> 实现日志配置的第一种方式<hanla></hanla></span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">userservice:</span> <span class="comment"># 这里是用 default 就是全局配置,<hanla></hanla>如果是写服务名称,<hanla></hanla>则是针对某个微服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment"># 日志级别</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>配置方式二： <code>Java</code>
                          <hanla></hanla>代码方式,<hanla></hanla>需要先声明一个<hanla></hanla><code>Bean</code>
                        </p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 创建 Bean 用于配置 feign 的日志<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfiguration</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">level</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.BASIC;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <ul>
                          <li>
                            <p>而后如果是全局配置,<hanla></hanla>则把它放到<hanla></hanla><code>@EnableFeignClients</code>
                              <hanla></hanla>这个注解中<hanla></hanla>(<code>主启动</code>)
                            </p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line">...</span><br><span class="line"><span class="comment">// defaultConfiguration = DefaultFeignConfiguration.class</span></span><br><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfiguration.class)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>如果是局部配置,<hanla></hanla>则把它放在<hanla></hanla><code>@FeignClient</code>
                              <hanla></hanla>这个注解中<hanla></hanla>(<code>定义远程调用处</code>)
                            </p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> configuration = DefaultFeignConfiguration.class</span></span><br><span class="line"><span class="meta">@FeignClient(value = "userservice",configuration = DefaultFeignConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> {</span><br><span class="line">    <span class="comment">// private static final String URL = "http://user-service8081/user/";</span></span><br><span class="line">    <span class="meta">@GetMapping("/user/{id}")</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="openfeign-4">
                <ul>
                  <li>
                    <p><code>Feign</code>
                      <hanla></hanla>底层的客户端实现
                    </p>
                    <ul>
                      <li><code>URLConnection</code>： 默认实现,<hanla></hanla>不支持连接池</li>
                      <li><code>Apache HttpClient</code>
                        <hanla></hanla>支持连接池
                      </li>
                      <li><code>OKHttp</code>
                        <hanla></hanla>支持连接池
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>优化性能主要包括</p>
                    <ul>
                      <li>使用连接池代替默认的<hanla></hanla><code>URLConnection</code></li>
                      <li>日志级别,<hanla></hanla>最好用<hanla></hanla><code>basic | none</code></li>
                    </ul>
                  </li>
                  <li>
                    <p>实现</p>
                    <ul>
                      <li>
                        <p>添加依赖</p>
                        <figure class="highlight xml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">&lt;!--  <span class="doctag">TODO:</span> feign<hanla></hanla>性能优化<hanla></hanla>=&gt;httpclient --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>配置</p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span> 配置连接池<hanla></hanla></span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启 feign 对 httpClient 的支持</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># 最大连接数</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># 每个路径的最大连接数</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="openfeign-5">
                <ul>
                  <li>
                    <p>方式一:</p>
                    <blockquote>
                      <p>通过继承的方式,<hanla></hanla>给消费者的<hanla></hanla><code>FeignClient</code>
                        <hanla></hanla>和提供者的<hanla></hanla><code>Controller</code>
                        <hanla></hanla>定义统一的父接口作为标准
                      </p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">继承</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/6e221236e2e9461c9df76290174ea43d.png" alt="继承"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>方式二<hanla></hanla>(抽取)</p>
                    <blockquote>
                      <p>将<hanla></hanla><code>FeignClient</code>
                        <hanla></hanla>抽取为独立模块,<hanla></hanla>并且把接口有关的<hanla></hanla><code>POJO(实体类)</code>,<hanla></hanla>默认的<hanla></hanla><code>Feign</code>
                        <hanla></hanla>配置都放到这个模块中,<hanla></hanla>提供给所有消费者使用
                      </p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">抽取</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/9c043b4fdd614118bf6982d0f20494fa.png" alt="抽取"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>实现方式二的步骤</p>
                    <ul>
                      <li>首先创建一个<hanla></hanla><code>model</code>，命名为<hanla></hanla><code>feign-api(自定义,<hanla></hanla>无要求名称)</code>,<hanla></hanla>然后引入<hanla></hanla><code>feign</code>
                        <hanla></hanla>的<hanla></hanla><code>starter</code>
                        <hanla></hanla>依赖
                      </li>
                      <li>将<hanla></hanla><code>order-service</code>
                        <hanla></hanla>中编写的<hanla></hanla><code>UserClient,User,DefaultFeignConfiguraton</code>
                        <hanla></hanla>都复制到<hanla></hanla><code>feign-api</code>
                        <hanla></hanla>项目中
                      </li>
                      <li>在<hanla></hanla><code>order-service</code>
                        <hanla></hanla>中引入<hanla></hanla><code>feign-api</code>
                        <hanla></hanla>依赖
                      </li>
                      <li>修改<hanla></hanla><code>order-service</code>
                        <hanla></hanla>中的所有与上述组件有关的<hanla></hanla><code>import</code>
                        <hanla></hanla>部分,<hanla></hanla>改成导入<hanla></hanla><code>feign-api</code>
                        <hanla></hanla>中的包
                      </li>
                      <li>重启测试</li>
                    </ul>
                  </li>
                  <li>
                    <p>当定义的<hanla></hanla><code>FeignClient</code>
                      <hanla></hanla>不在<hanla></hanla><code>SpringBootApplication</code>
                      <hanla></hanla>的扫描包范围时,<hanla></hanla>这些<hanla></hanla><code>FeignClient</code>
                      <hanla></hanla>无法使用,<hanla></hanla>两种解决方案
                    </p>
                    <ul>
                      <li>
                        <p>方式一: 指定<hanla></hanla><code>FeignClient</code>
                          <hanla></hanla>所在包
                        </p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// order-service: com.coderitl.springcloud 下的主启动类<hanla></hanla></span></span><br><span class="line"><span class="comment">// feign-api: com.coderitl.feign 不在 orderservice<hanla></hanla>的主启动扫描包之下<hanla></hanla></span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages="com.coderitl.feign.clients")</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>指定<hanla></hanla><code>FeignClient</code>
                          <hanla></hanla>字节码
                        </p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 推荐 =&gt; 用哪个加载那个<hanla></hanla></span></span><br><span class="line"><span class="meta">@EnableFeignClients(clients={UserClient.class})</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h5 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h5>
          <div class="tabs" id="gateway">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#gateway-1">
                  <hanla></hanla>作用介绍
                </button></li>
              <li class="tab"><button type="button" data-href="#gateway-2">搭建网关</button></li>
              <li class="tab"><button type="button" data-href="#gateway-3">路由断言工厂</button></li>
              <li class="tab"><button type="button" data-href="#gateway-4">路由的过滤器配置</button></li>
              <li class="tab"><button type="button" data-href="#gateway-5">网关的跨域处理</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="gateway-1">
                <ul>
                  <li>
                    <p>引入</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">网关</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0a1c78c3b4a8489284c048e73ec4fd1b.png" alt="网关"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>网关功能</p>
                    <ul>
                      <li>身份认证和权限校验</li>
                      <li>服务路由、负载均衡</li>
                      <li>请求限流</li>
                    </ul>
                  </li>
                  <li>
                    <p><code>SpringCloud</code>
                      <hanla></hanla>中网关的实现有两种
                    </p>
                    <ul>
                      <li><code>gateway</code></li>
                      <li><code>zuul</code></li>
                    </ul>
                    <blockquote>
                      <p><code>Zuul</code>
                        <hanla></hanla>是基于<hanla></hanla><code>Servlet</code>
                        <hanla></hanla>的实现,<hanla></hanla>属于阻塞式编程,<hanla></hanla>而<hanla></hanla><code>SpringCloudGateway</code>
                        <hanla></hanla>则是基于<hanla></hanla><code>Spring5</code>
                        <hanla></hanla>中提供的<hanla></hanla><code>WebFlux</code>，属于响应式编程的实现,<hanla></hanla>具备更好的性能
                      </p>
                    </blockquote>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="gateway-2">
                <ul>
                  <li>
                    <p>创建新的<hanla></hanla><code>model</code>，引入<hanla></hanla><code>SpringCloudGateway</code>
                      <hanla></hanla>的依赖和<hanla></hanla><code>nacos</code>
                      <hanla></hanla>的服务发现依赖
                    </p>
                    <figure class="highlight xml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment">&lt;!-- <span class="doctag">TODO:</span> 1. 添加网关所需依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment"><!--nacos<hanla></hanla>客户端--></span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment"><!-- 如果没有该依赖,<hanla></hanla>会出错<hanla></hanla>(最新版网关使用) --></span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>编写路由配置以及<hanla></hanla><code>nacos</code>
                      <hanla></hanla>地址
                    </p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span> 编写路由以及 nacos 地址<hanla></hanla>(网关也需要注册到注册中心)</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#  nacos 地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span> <span class="comment"># 路由 id,<hanla></hanla>自定义,<hanla></hanla>只要唯一即可</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://order-service8088</span> <span class="comment"># 路由的目标地址 lb:LoadBalanced(负载均衡) 后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/order/**</span> <span class="comment"># 这个是按照路径匹配 只要一 order 开头就符合</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由 id,<hanla></hanla>自定义,<hanla></hanla>只要唯一即可</span></span><br><span class="line">          <span class="comment"># uri： http://127.0.0.1:8081 路由的目标地址 http 就是固定地址</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址 lb:LoadBalanced(负载均衡) 后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 这个是按照路径匹配 只要一 user 开头就符合</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>访问测试</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">通过网关成功访问服务</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/fb6ed5163e0b470891e6807531a48ee7.png" alt="通过网关成功访问服务"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>流程</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">业务成功访问经过流程</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/1885ec41b59c414aaac8ac919a02ee6f.png" alt="业务成功访问经过流程"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="gateway-3">
                <ul>
                  <li>
                    <p>网关路由可以配置的内容包括</p>
                    <ul>
                      <li>路由<hanla></hanla><code>id</code>： 路由唯一标识</li>
                      <li><code>uri</code>： 路由目的地,<hanla></hanla>支持<hanla></hanla><code>lb 和 http</code>
                        <hanla></hanla>两种
                      </li>
                      <li><code>predicatest</code>：路由断言,<hanla></hanla>判断请求是否符合要求,<hanla></hanla>符合则转发到路由目的地</li>
                      <li><code>filters</code>：路由过滤器,<hanla></hanla>处理请求或响应</li>
                    </ul>
                  </li>
                  <li>
                    <p>路由断言工厂</p>
                    <blockquote>
                      <p>我们在配置文件中写的断言规则只是字符串,<hanla></hanla>这些字符串会被<hanla></hanla><code>Predicate Factory</code>
                        <hanla></hanla>读取并处理,<hanla></hanla>转变为路由判断的条件
                      </p>
                    </blockquote>
                    <ul>
                      <li>
                        <p>例如: <code>Path=/user/** </code>是按照路径匹配,<hanla></hanla>这个规则是由<hanla></hanla><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>
                          <hanla></hanla>类来处理的
                        </p>
                      </li>
                      <li>
                        <p>像这样的断言工厂在<hanla></hanla><code>SpringCloudGateway </code>还有<hanla></hanla><code>11</code>
                          <hanla></hanla>个
                        </p>
                        <blockquote>
                          <p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories</a></p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">名称</th>
                              <th align="center">说明</th>
                              <th align="center">实例</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><code>After</code></td>
                              <td align="center">是某个时间点之后的请求</td>
                              <td align="center"><code>- After=2017-01-20T17:42:47.789-07:00[America/Denver]</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Before</code></td>
                              <td align="center">是某个时间点之前的请求</td>
                              <td align="center"><code>- Before=2017-01-20T17:42:47.789-07:00[America/Denver]</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Between</code></td>
                              <td align="center">是某两个时间点之前的请求</td>
                              <td align="center"><code>- Between=2017-01-20T17:42:47.789-07:00[America/Denver], 2017-01-21T17:42:47.789-07:00[America/Denver]</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Cookie</code></td>
                              <td align="center">请求必须包含某些<hanla></hanla><code>cookie</code></td>
                              <td align="center"><code> - Cookie=chocolate, ch.p</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Header</code></td>
                              <td align="center">请求必须包含某些<hanla></hanla><code>header</code></td>
                              <td align="center"><code> - Header=X-Request-Id, \d+</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Host</code></td>
                              <td align="center">请求必须是访问某个<hanla></hanla><code>host(域名)</code></td>
                              <td align="center"><code>- Host=**.somehost.org,**.anotherhost.org</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Method</code></td>
                              <td align="center">请求方式必须是指定方式</td>
                              <td align="center"><code> - Method=GET,POST</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Path</code></td>
                              <td align="center">请求路径必须符合指定规则</td>
                              <td align="center"><code> - Path=/red/{segment},/blue/{segment}</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Query</code></td>
                              <td align="center">请求参数必须包含指定参数</td>
                              <td align="center"><code>- Query=green</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>RemoteAddr</code></td>
                              <td align="center">请求者的<hanla></hanla><code>ip</code>
                                <hanla></hanla>必须是指定范围
                              </td>
                              <td align="center"><code> - RemoteAddr=192.168.1.1/24</code></td>
                            </tr>
                            <tr>
                              <td align="center"><code>Weight</code></td>
                              <td align="center">权重处理</td>
                              <td align="center"><code> - Weight=group1, 2</code></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>总结</p>
                        <ul>
                          <li>
                            <p><code>PredicateFactory</code>
                              <hanla></hanla>的作用是什么
                            </p>
                            <blockquote>
                              <p>读取用户定义的断言条件,<hanla></hanla>对请求做出判断</p>
                            </blockquote>
                          </li>
                          <li>
                            <p><code>Path=/user/**</code>
                              <hanla></hanla>是什么含义
                            </p>
                            <blockquote>
                              <p>路径是以<hanla></hanla><code>/user</code>
                                <hanla></hanla>开头的就认为是符合的
                              </p>
                            </blockquote>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="gateway-4">
                <ul>
                  <li>
                    <p>过滤器</p>
                    <blockquote>
                      <p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory</a></p>
                    </blockquote>
                    <blockquote>
                      <p><code>GatewayFilter</code>
                        <hanla></hanla>是网关中提供的一种过滤器,<hanla></hanla>可以对进入网关的请求和微服务返回的响应做处理
                      </p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">过滤器</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/57414e5c054b454cb85d1f03cfd3aafc.png" alt="过滤器"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>过滤器工厂</p>
                    <blockquote>
                      <p><code>Spring</code>
                        <hanla></hanla>提供了<hanla></hanla><code>31</code>
                        <hanla></hanla>种不同的路由过滤器工厂
                      </p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">名称</th>
                          <th align="center">说明</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><code>AddRequestHeader</code></td>
                          <td align="center">给当前请求添加一个请求头</td>
                        </tr>
                        <tr>
                          <td align="center"><code>RemoveRequestHeader</code></td>
                          <td align="center">移除请求种的一个请求头</td>
                        </tr>
                        <tr>
                          <td align="center"><code>AddResponseHeader</code></td>
                          <td align="center">给响应结果中添加一个响应头</td>
                        </tr>
                        <tr>
                          <td align="center"><code>RemoveResponseHeader</code></td>
                          <td align="center">从响应结果中移除一个响应头</td>
                        </tr>
                        <tr>
                          <td align="center"><code>RequestRateLimiter</code></td>
                          <td align="center">限制请求的流量</td>
                        </tr>
                        <tr>
                          <td align="center"><code>...</code></td>
                          <td align="center"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                  <li>
                    <p>局部过滤器配置</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">filters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">AddRequestHeader=X-Request-red,</span> <span class="string">blue</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>默认配置</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">default-filters:</span> <span class="comment"># 默认过滤器 会对所有的路由请求都生效</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">AddRequestHeader=X-Request-red,</span> <span class="string">blue</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>全局过滤器</p>
                    <blockquote>
                      <p>全局过滤器的作用也是处理一切进入网关的请求和微服务响应,<hanla></hanla>与<hanla></hanla><code>GatewayFilter</code>
                        <hanla></hanla>的作用一样<br>区别在于 <code>GatewayFilter</code> 通过配置定义,<hanla></hanla>处理逻辑是固定的,<hanla></hanla>而 <code>GlobalFilter </code>的逻辑需要自己写代码实现<br>定义方式是实现 <code>GlobalFilter </code>接口
                      </p>
                    </blockquote>
                    <figure class="highlight java">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理当前请求,<hanla></hanla>有必要的话通过<hanla></hanla>{<span class="doctag">@link</span> GatewayFilterChain} 将请求交给下一个过滤器处理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exchange 请求上下文,<hanla></hanla>里面可以获取 Request Response 等信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  chain 用来把请求委托给下一个过滤器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> {<span class="doctag">@code</span> Mono<void>}<hanla></hanla>返回表示当前过滤器业务结束</void></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GlobalFilter</span> {</span><br><span class="line">    Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span>;</span><br><span class="line">}</span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>案例实现</p>
                    <blockquote>
                      <p>需求: 定义全局过滤器,<hanla></hanla>拦截请求,<hanla></hanla>判断请求的参数是否满足下面条件</p>
                    </blockquote>
                    <ul>
                      <li>
                        <p>参数中是否有<hanla></hanla><code>authorization</code></p>
                      </li>
                      <li>
                        <p><code>authorization</code>
                          <hanla></hanla>参数值是否为<hanla></hanla><code>admin</code>
                        </p>
                        <p>如果同时满足则放行,<hanla></hanla>否则拦截</p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 加载顺序由两种实现: 注解 | 实现接口 Ordered (两者选其一) 一定要由顺序<hanla></hanla></span></span><br><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {</span><br><span class="line">        <span class="comment">// 1. 获取请求参数</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        MultiValueMap&lt;String, String&gt; params = request.getQueryParams();</span><br><span class="line">        <span class="comment">// 2. 获取参数中的 authorization 参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">auth</span> <span class="operator">=</span> params.getFirst(<span class="string">"authorization"</span>);</span><br><span class="line">        <span class="comment">// 3. 判断参数值是否等于 admin</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(auth)) {</span><br><span class="line">            <span class="comment">// 4. 是 放行</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 5. 否 拦截</span></span><br><span class="line">        <span class="comment">// 优化体验:</span></span><br><span class="line">        <span class="comment">// 5.1 设置状态码</span></span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="comment">// 5.2 拦截请求</span></span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ordered 方法重写</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">过滤器</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/e3b0b1461a3946ddb62f4a51a5b8acc1.gif#pic_center" alt="过滤器"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>过滤器的执行顺序</p>
                    <blockquote>
                      <p>请求进入网关后会碰到三类过滤器: 当前路由的过滤器,<code>DefaultFilter GlobalFilter</code></p>
                      <p>请求路由后,<hanla></hanla>会将当前路由过滤器和<hanla></hanla><code>DefaultFilter GlobalFilter</code>
                        <hanla></hanla>合并到一个过滤器链<hanla></hanla>(集合)<hanla></hanla>中,<hanla></hanla>排序后依次执行每个过滤器
                      </p>
                    </blockquote>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">过滤器的执行顺序</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0eddffdac2c94df39ea2a427faf5d2b5.png" alt="过滤器的执行顺序"></td>
                        </tr>
                      </tbody>
                    </table>
                    <ul>
                      <li>执行顺序<ul>
                          <li>每一个过滤器都必须指定一个<hanla></hanla><code>int</code>
                            <hanla></hanla>类型的<hanla></hanla><code>order</code>
                            <hanla></hanla>值,<code>order</code>
                            <hanla></hanla>值越小,<hanla></hanla>优先级越高,<hanla></hanla>执行顺序越靠前
                          </li>
                          <li><code>GlobalFilter</code>
                            <hanla></hanla>通过实现<hanla></hanla><code>Ordered</code>
                            <hanla></hanla>接口,<hanla></hanla>或者添加<hanla></hanla><code>@Order</code>
                            <hanla></hanla>注解来指定<hanla></hanla><code>order</code>
                            <hanla></hanla>值
                          </li>
                          <li>路由过滤器和<hanla></hanla><code>defaultFiltert</code>
                            <hanla></hanla>的<hanla></hanla><code>order</code>
                            <hanla></hanla>由<hanla></hanla><code>Spring</code>
                            <hanla></hanla>指定,<hanla></hanla>默认是按照声明顺序从<hanla></hanla><code>1</code>
                            <hanla></hanla>递增<hanla></hanla>(声明也就是书写出现的顺序)
                          </li>
                          <li>当过滤器的<hanla></hanla><code>order</code>
                            <hanla></hanla>值一样时,<hanla></hanla>会按照<hanla></hanla><code>defaultFilter &gt; 路由过滤器链 &gt; GlobalFilter<hanla></hanla>的顺序执行</code>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="gateway-5">
                <ul>
                  <li>
                    <p>跨域问题处理</p>
                    <blockquote>
                      <p>跨域: 域名不一致就是跨域,<hanla></hanla>主要包括</p>
                    </blockquote>
                    <ul>
                      <li>域名不同: <code>www.taobap.com 和 www.taobao.org 等</code></li>
                      <li>域名相同,<hanla></hanla>端口不同: <code>localhost:8080 | localhost:8081</code></li>
                    </ul>
                    <p>跨域问题: 浏览器禁止请求的发起者与服务端发生跨域<hanla></hanla><code>ajax</code>
                      <hanla></hanla>请求,<hanla></hanla>请求被浏览器拦截的问题
                    </p>
                  </li>
                  <li>
                    <p>配置</p>
                    <figure class="highlight yml">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span> 编写路由以及 nacos 地址<hanla></hanla>(网关也需要注册到注册中心)</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#  nacos 地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span> <span class="comment"># 路由 id,<hanla></hanla>自定义,<hanla></hanla>只要唯一即可</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://order-service8088</span> <span class="comment"># 路由的目标地址 lb:LoadBalanced(负载均衡) 后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/order/**</span> <span class="comment"># 这个是按照路径匹配 只要一 order 开头就符合</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由 id,<hanla></hanla>自定义,<hanla></hanla>只要唯一即可</span></span><br><span class="line">          <span class="comment"># uri： http://127.0.0.1:8081 路由的目标地址 http 就是固定地址</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址 lb:LoadBalanced(负载均衡) 后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 这个是按照路径匹配 只要一 user 开头就符合</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,coder-itl</span> <span class="string">is</span> <span class="string">Student....</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,coder-itl</span> <span class="string">is</span> <span class="string">Teacher....</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># 全局跨域处理</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># 解决 options 请求被拦截问题</span></span><br><span class="line">        <span class="attr">cors-configurations:</span></span><br><span class="line">          <span class="string">'[/**]'</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># 允许那些网站跨域请求</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"http://localhost:8089"</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"http://baidu.com"</span></span><br><span class="line">            <span class="attr">allowedMethods:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"GET"</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"POST"</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"DELETE"</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"PUT"</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"OPTIONS"</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">"*"</span> <span class="comment"># 允许请求中携带的头信息</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># 是否允许携带 cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># 这次跨域检测的有效期，在有效期内直接放行,<hanla></hanla>减轻服务器压力</span></span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h5 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h5>
          <div class="tabs" id="">
            <ul class="nav-tabs">
              <li class="tab active"><button type="button" data-href="#-1">
                  <hanla></hanla>简介
                </button></li>
              <li class="tab"><button type="button" data-href="#-2">安装与卸载</button></li>
              <li class="tab"><button type="button" data-href="#-3">自定义<hanla></hanla>Dockerfile</button></li>
              <li class="tab"><button type="button" data-href="#-4">DockerCompose</button></li>
            </ul>
            <div class="tab-contents">
              <div class="tab-item-content active" id="-1">
                <ul>
                  <li><code>Docker</code>
                    <hanla></hanla>和虚拟机的差异<ul>
                      <li><code>docker</code>
                        <hanla></hanla>是一个系统进程,<hanla></hanla>虚拟机是在操作系统中的操作系统
                      </li>
                      <li><code>docker</code>
                        <hanla></hanla>体积小,<hanla></hanla>启动速度快,<hanla></hanla>性能好,<hanla></hanla>虚拟机体积大,<hanla></hanla>启动速度慢,<hanla></hanla>性能一般
                      </li>
                    </ul>
                  </li>
                  <li>镜像和容器<ul>
                      <li>镜像<hanla></hanla>(<code>Image</code>): <code>Docker</code>
                        <hanla></hanla>将应用程序及器所需的依赖、函数库、环境、配置文件打包在一起,<hanla></hanla>称为镜像
                      </li>
                      <li>容器<hanla></hanla>(<code>Container</code>): 镜像中的应用程序运行后形成的进程就是容器,<hanla></hanla>只是<hanla></hanla><code>Docker</code>
                        <hanla></hanla>会给容器做隔离,<hanla></hanla>对外不可见
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="-2">
                <ul>
                  <li>
                    <p>基于<hanla></hanla><code>Centos7</code>
                      <hanla></hanla>操作
                    </p>
                  </li>
                  <li>
                    <p>卸载<hanla></hanla>(如果之前安装过旧版本的<hanla></hanla><code>Docker</code>)</p>
                    <figure class="highlight properties">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">yum</span> <span class="string">remove -y docker \</span></span><br><span class="line"><span class="string">	docker-client \</span></span><br><span class="line"><span class="string">	docker-client-latest \</span></span><br><span class="line"><span class="string">	docker-common \</span></span><br><span class="line"><span class="string">	docker-latest \</span></span><br><span class="line"><span class="string">	docker-latest-logrotate \</span></span><br><span class="line"><span class="string">	docker-logrotate \</span></span><br><span class="line"><span class="string">	docker-selinux \</span></span><br><span class="line"><span class="string">	docker-engine-selinux \</span></span><br><span class="line"><span class="string">	docker-engine \</span></span><br><span class="line"><span class="string">	docker-ce</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p>安装<hanla></hanla><code>docker</code></p>
                    <ul>
                      <li>
                        <p>安装<hanla></hanla><code>yum</code>
                          <hanla></hanla>工具
                        </p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">yum</span> <span class="string">install -y yum-utils \</span></span><br><span class="line"><span class="string">	device-mapper-persistent-data \</span></span><br><span class="line"><span class="string">	lvm2 --skip-broken</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>更新本地镜像源</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">yum-config-manager</span> <span class="string">\</span></span><br><span class="line"><span class="string">	--add-repo \</span></span><br><span class="line"><span class="string">	https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line">	</span><br><span class="line"><span class="attr">sed</span> <span class="string">-i 's/download.docker.com/mirrors.aliyun.com\/docker-ce/g' /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">yum</span> <span class="string">makecache fast</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>安装<hanla></hanla><code>docker</code></p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># docker-ce 为社区免费版<hanla></hanla></span></span><br><span class="line"><span class="attr">yum</span> <span class="string">install -y docker-ce</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>关闭防火墙</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 关闭<hanla></hanla></span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">stop firewalld</span></span><br><span class="line"><span class="comment"># 禁止开启启动防火墙<hanla></hanla></span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">disable firewalld</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>启动<hanla></hanla><code>docker</code></p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">systemctl</span> <span class="string">start docker</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>检查是否启动</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">systemctl</span> <span class="string">status docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">docker</span> <span class="string">-v</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">启动成功</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/56dd618a3c4649538264ceb168cf0c85.png" alt="启动成功"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>docker</code>
                          <hanla></hanla>相关命令
                        </p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 启动 docker 服务<hanla></hanla></span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">start docker</span></span><br><span class="line"><span class="comment"># 停止 docker 服务<hanla></hanla></span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">stop docker</span></span><br><span class="line"><span class="comment"># 重启 docker 服务<hanla></hanla></span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">restart docker </span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>配置镜像加速</p>
                        <blockquote>
                          <p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
                        </blockquote>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">sudo</span> <span class="string">mkdir -p /etc/docker</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"registry-mirrors"</span>: <span class="string">["https://eyy45bvx.mirror.aliyuncs.com"]</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"><span class="attr">EOF</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">systemctl daemon-reload</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">systemctl restart docker</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p><code>Docker<hanla></hanla>操作</code></p>
                    <ul>
                      <li>
                        <p>基本操作</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">基本操作</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/61d5d1cb56a84c96bfc54d1c3b8b9cfb.png" alt="基本操作"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>利用<hanla></hanla><code>docker save</code>
                          <hanla></hanla>将<hanla></hanla><code>nginx</code>
                          <hanla></hanla>镜像导出磁盘,<hanla></hanla>然后再通过<hanla></hanla><code>load</code>
                          <hanla></hanla>加载回来
                        </p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 导出<hanla></hanla></span></span><br><span class="line"><span class="attr">docker</span> <span class="string">save -o nginx.tar nginx:latest</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">实现</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/de564c4465ad4d35b8aafcbb54bd63af.png" alt="实现"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>删除镜像</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">docker</span> <span class="string">rmi nginx:latest</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>加载镜像</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">docker</span> <span class="string">load  -i nginx.tar</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">加载镜像</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/514925a7859148b5b80e172f86634046.png" alt="加载镜像"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>容器相关操作</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">容器操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/109ce7849280474fb0d2dee8315a1142.png" alt="容器操作"></td>
                        </tr>
                      </tbody>
                    </table>
                    <ul>
                      <li>
                        <p>创建运行一个<hanla></hanla><code>Nginx</code>
                          <hanla></hanla>容器
                        </p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">docker</span> <span class="string">run --name containerName -p 80:80 -d nginx</span></span><br><span class="line"></span><br><span class="line"><span class="attr">docker</span> <span class="string">run: 创建并运行让其</span></span><br><span class="line"><span class="attr">--name</span>: <span class="string">给容器起一个名字</span></span><br><span class="line"><span class="attr">-p</span>: <span class="string">将宿主机端口与容器端口映射,<hanla></hanla>冒号左侧是宿主机端口,<hanla></hanla>右侧是容器端口</span></span><br><span class="line"><span class="attr">-d</span>: <span class="string">后台运行<hanla></hanla></span></span><br><span class="line"><span class="attr">nginx</span>: <span class="string">镜像名称</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <p>数据卷</p>
                    <figure class="highlight properties">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">docker</span> <span class="string">volume [COMMAND]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[COMMAND]</span>:<span class="string"></span></span><br><span class="line"> </span><br><span class="line"> <span class="attr">create</span>: <span class="string">创建一个 volume</span></span><br><span class="line"> <span class="attr">inspect</span>: <span class="string">显示一个或多个 volume 的信息</span></span><br><span class="line"> <span class="attr">ls</span>: <span class="string">列出所有的 volume</span></span><br><span class="line"> <span class="attr">prune</span>: <span class="string">删除未使用的 volume</span></span><br><span class="line"> <span class="attr">rm</span>: <span class="string">删除一个或多个指定的 volume</span></span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">数据卷操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d40c1542767540a9b65a101b667a8bba.png" alt="数据卷操作"></td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="-3">
                <ul>
                  <li>
                    <p>什么是<hanla></hanla><code>DockerFile</code></p>
                    <blockquote>
                      <p><code>Dockerfile</code>
                        <hanla></hanla>就是一个文本文件,<hanla></hanla>其中包含一个个的指令,<hanla></hanla>用指令来说明要执行什么操作来构建镜像,<hanla></hanla>每一个指令都会形成一层<hanla></hanla><code>Layer</code>
                      </p>
                    </blockquote>
                  </li>
                </ul>
                <table>
                  <thead>
                    <tr>
                      <th align="center">指令</th>
                      <th align="center">说明</th>
                      <th>实例</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td align="center"><code>FROM</code></td>
                      <td align="center">指定基础镜像</td>
                      <td><code>FROM centos:7</code></td>
                    </tr>
                    <tr>
                      <td align="center"><code>ENV</code></td>
                      <td align="center">设置环境变量，可在后面指令使用</td>
                      <td><code>ENV key value</code></td>
                    </tr>
                    <tr>
                      <td align="center"><code>COPY</code></td>
                      <td align="center">拷贝本地文件到镜像的指定目录</td>
                      <td><code>COPY ./mysql-5.7.rpm /tmp</code></td>
                    </tr>
                    <tr>
                      <td align="center"><code>RUN</code></td>
                      <td align="center">执行<hanla></hanla><code>Linux</code>
                        <hanla></hanla>的<hanla></hanla><code>shell</code>
                        <hanla></hanla>命令，一般是安装过程的命令
                      </td>
                      <td><code>RUN yum install gcc</code></td>
                    </tr>
                    <tr>
                      <td align="center"><code>EXPOSE</code></td>
                      <td align="center">指定容器运行时监听的端口,<hanla></hanla>是给镜像使用者看的</td>
                      <td><code>EXPOSE 8080</code></td>
                    </tr>
                    <tr>
                      <td align="center"><code>ENTRYPOINT</code></td>
                      <td align="center">镜像中应用的启动命令,<hanla></hanla>容器运行时调用</td>
                      <td><code>ENTRYPOINT java -jar xx.jar</code></td>
                    </tr>
                  </tbody>
                </table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
              <div class="tab-item-content" id="-4">
                <ul>
                  <li>
                    <p><code>DockerCompose </code>是什么</p>
                    <blockquote>
                      <p><code>DockerCompose </code>可以基于<hanla></hanla><code>Componse</code>
                        <hanla></hanla>文件帮助我们快速的部署分布式应用,<hanla></hanla>而无需手动一个个创建和运行容器
                      </p>
                      <p><code>Compose </code>文件是一个文本文件,<hanla></hanla>通过指令定义集群中的每个容器如何运行</p>
                    </blockquote>
                  </li>
                  <li>
                    <p>下载</p>
                    <figure class="highlight properties">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># (github)<hanla></hanla>下载 更换其他版本只需要更换  v2.2.2</span></span><br><span class="line"> <span class="attr">sudo</span> <span class="string">curl -L "https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 高速安装<hanla></hanla></span></span><br><span class="line"><span class="attr">curl</span> <span class="string">-L https://get.daocloud.io/docker/compose/releases/download/v2.4.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span></span><br><span class="line"><span class="comment"># 修改权限</span></span><br><span class="line"> <span class="attr">sudo</span> <span class="string">chmod +x /usr/local/bin/docker-compose</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 创建软连接<hanla></hanla></span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 检测是否安装</span></span><br><span class="line"> <span class="attr">docker-compose</span> <span class="string">--version</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> # 对于 alpine，需要以下依赖包： py-pip，python-dev，libffi-dev，openssl-dev，gcc，libc-dev，和 make。</span></span><br><span class="line"> </span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                  </li>
                  <li>
                    <p><code>Base</code>
                      <hanla></hanla>自动补全命令
                    </p>
                    <figure class="highlight properties">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">curl</span> <span class="string">-L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/comption/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span></span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                    <ul>
                      <li>
                        <p>出错</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">echo</span> <span class="string">"199.232.68.133 raw.githubusercontent.com" &gt;&gt; /etc/hosts</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul>
                  </li>
                </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
              </div>
            </div>
          </div>
          <h5 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h5>
          <ul>
            <li>
              <p>详细使用</p>
              <div class="tabs" id="mq">
                <ul class="nav-tabs">
                  <li class="tab active"><button type="button" data-href="#mq-1">初始</button></li>
                  <li class="tab"><button type="button" data-href="#mq-2">入门<hanla></hanla></button></li>
                  <li class="tab"><button type="button" data-href="#mq-3">AMQP</button></li>
                  <li class="tab"><button type="button" data-href="#mq-4">WorkQueue</button></li>
                  <li class="tab"><button type="button" data-href="#mq-5">FanoutExchange</button></li>
                  <li class="tab"><button type="button" data-href="#mq-6">DirectExchange</button></li>
                  <li class="tab"><button type="button" data-href="#mq-7">TopicExchange</button></li>
                  <li class="tab"><button type="button" data-href="#mq-8">
                      <hanla></hanla>消息转换器
                    </button></li>
                  <li class="tab"><button type="button" data-href="#mq-9">消息可靠性</button></li>
                  <li class="tab"><button type="button" data-href="#mq-10">死信交换机</button></li>
                  <li class="tab"><button type="button" data-href="#mq-11">惰性队列</button></li>
                  <li class="tab"><button type="button" data-href="#mq-12">集群</button></li>
                  <li class="tab"><button type="button" data-href="#mq-13">扩容</button></li>
                </ul>
                <div class="tab-contents">
                  <div class="tab-item-content active" id="mq-1">
                    <ul>
                      <li>
                        <p>同步调用存在的问题</p>
                        <ul>
                          <li>耦合度高</li>
                          <li>性能下降</li>
                          <li>资源浪费</li>
                          <li>级联失败</li>
                        </ul>
                      </li>
                      <li>
                        <p>异步调用</p>
                        <blockquote>
                          <p>异步调用常见实现就是<code>事件驱动</code></p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">事件代理<hanla></hanla><code>Broker</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/dc94d1c0630548678883388cda26637e.png" alt="事件代理Broker"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>异步通信的优点<ul>
                              <li>耦合度低</li>
                              <li>吞吐量提升</li>
                              <li>故障隔离</li>
                              <li>流量削峰</li>
                            </ul>
                          </li>
                          <li>异步通信的缺点<ul>
                              <li>依赖于<hanla></hanla><code>Broker</code>
                                <hanla></hanla>的可靠性,<hanla></hanla>安全性、吞吐能力
                              </li>
                              <li>架构复杂了,<hanla></hanla>业务没有明显的流程线,<hanla></hanla>不好追踪管理</li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>什么是<hanla></hanla><code>MQ</code></p>
                        <blockquote>
                          <p><code>MQ（MessageQueue）</code>，是在消息的传输过程中保存消息的容器。多用于分布式系统之间进 行通信。</p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"></th>
                              <th align="center"><code>RabbitMQ</code></th>
                              <th align="center"><code>ActiveMQ</code></th>
                              <th align="center"><code>RocketMQ</code></th>
                              <th align="center"><code>Kafka</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center">公司<hanla></hanla>/<hanla></hanla>社区</td>
                              <td align="center"><code>Rabbit</code></td>
                              <td align="center"><code>Apache</code></td>
                              <td align="center">阿里</td>
                              <td align="center"><code>Apache</code></td>
                            </tr>
                            <tr>
                              <td align="center">开发语言</td>
                              <td align="center"><code>Erlang</code></td>
                              <td align="center"><code>Java</code></td>
                              <td align="center">高</td>
                              <td align="center"><code>Scala &amp; Java</code></td>
                            </tr>
                            <tr>
                              <td align="center">协议支持</td>
                              <td align="center"><code>AMQP,XMPP,SMTP,STOMP</code></td>
                              <td align="center"><code>OpenWrie,STOMP,REST,XMPP,AMQP</code></td>
                              <td align="center">自定义协议</td>
                              <td align="center">自定义协议</td>
                            </tr>
                            <tr>
                              <td align="center">可用性</td>
                              <td align="center">高</td>
                              <td align="center">高</td>
                              <td align="center">高</td>
                              <td align="center">高</td>
                            </tr>
                            <tr>
                              <td align="center">单机吞吐量</td>
                              <td align="center">一般</td>
                              <td align="center">差</td>
                              <td align="center">高</td>
                              <td align="center">非常高</td>
                            </tr>
                            <tr>
                              <td align="center">消息延迟</td>
                              <td align="center">微秒级</td>
                              <td align="center">毫秒级</td>
                              <td align="center">毫秒级</td>
                              <td align="center">毫秒级以内</td>
                            </tr>
                            <tr>
                              <td align="center">消息可靠性</td>
                              <td align="center">高</td>
                              <td align="center">一般</td>
                              <td align="center">高</td>
                              <td align="center">一般</td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>使用条件</p>
                      </li>
                      <li>
                        <p>生产者不需要从消费者处获得反馈。引入消息队列之前的直接调用，其接口的返回值应该为空，这才让明 明下层的动作还没做，上层却当成动作做完了继续往后走，即所谓异步成为了可能。 </p>
                      </li>
                      <li>
                        <p>容许短暂的不一致性。 </p>
                      </li>
                      <li>
                        <p>确实是用了有效果。即解耦、提速、削峰这些方面的收益，超过加入<hanla></hanla>MQ，管理<hanla></hanla>MQ<hanla></hanla>这些成本。</p>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-2">
                    <ul>
                      <li>
                        <p>离线安装</p>
                        <blockquote>
                          <p><code>rabbitmq:3-management</code>：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://pan.baidu.com/s/1YUkVIyE7URpGfu-ZR2PpDQ?pwd=1234">https://pan.baidu.com/s/1YUkVIyE7URpGfu-ZR2PpDQ?pwd=1234</a> </p>
                        </blockquote>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 后缀名为 tar 的 docker 文件请勿解压<hanla></hanla></span></span><br><span class="line"><span class="string">docker</span> <span class="string">load</span> <span class="string">-i</span> <span class="string">xxx.tar</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>拉取</p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 拉取 rabbitmq:3-management[tag]</span></span><br><span class="line"><span class="string">docker</span> <span class="string">pull</span> <span class="string">rabbitmq:3-management</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">搜索<hanla></hanla><code>rabbitmq</code></th>
                              <th align="center">选择带有<hanla></hanla><code>management，management</code>
                                <hanla></hanla>的带有<hanla></hanla><code>web</code>
                                <hanla></hanla>管理页面
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/4f7c2da8b20f41f683585343d609bd5a.png" alt="搜索rabbitmq"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/be2892eb8d7e4c97a43c8f31ec98793d.png" alt="选择带有manager"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>安装</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">docker</span> <span class="string">run \</span></span><br><span class="line"><span class="string">	-e RABBITMQ_DEFAULT_USER=root \</span></span><br><span class="line"><span class="string">	-e RABBITMQ_DEFAULT_PASS=root \</span></span><br><span class="line"><span class="string">	--name mq \</span></span><br><span class="line"><span class="string">	--hostname mq1 \</span></span><br><span class="line"><span class="string">	-p 15672:15672 \</span></span><br><span class="line"><span class="string">	-p 5672:5672 \</span></span><br><span class="line"><span class="string">	-d \</span></span><br><span class="line"><span class="string">	rabbitmq:3-management</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment"># 参数解释</span></span><br><span class="line"><span class="attr">-p</span> <span class="string">15672:15672 Web<hanla></hanla>界面</span></span><br><span class="line"><span class="attr">-p</span> <span class="string">5672:5672  消息通信</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <ul>
                          <li>
                            <p>通过端口访问</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">通过端口访问</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d4e662e084c14109bf906eacc6910afb.png" alt="通过端口访问"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>概念</p>
                            <ul>
                              <li><code>channel</code>：操作<hanla></hanla><code>MQ</code>
                                <hanla></hanla>的工具
                              </li>
                              <li><code>exchange</code>:<hanla></hanla>路由消息到队列中</li>
                              <li><code>queue</code>： 缓存消息</li>
                              <li><code>virtual host</code>: 虚拟主机,<hanla></hanla>是对<hanla></hanla><code>queue,exchange</code>
                                <hanla></hanla>等资源的逻辑分组
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-3">
                    <ul>
                      <li>
                        <p><code>AMQP</code></p>
                        <blockquote>
                          <p><code>Advanced Message Queving Protocol</code>
                            <hanla></hanla>是用于再应用程序或之间传递业务消息的开放标准,<hanla></hanla>该协议与语言和平台无关,<hanla></hanla>更符合微服务中独立性的要求
                          </p>
                        </blockquote>
                      </li>
                      <li>
                        <p><code>Spring AMQP</code></p>
                        <blockquote>
                          <p><code>Spring AMQP</code>
                            <hanla></hanla>是基于<hanla></hanla><code>AMQP</code>
                            <hanla></hanla>协议定义的一套<hanla></hanla><code>API</code>
                            <hanla></hanla>规范,<hanla></hanla>提供了模块来发送和接受消息,<hanla></hanla>包含两部分,<hanla></hanla>其中<hanla></hanla><code>spring-amqp</code>
                            <hanla></hanla>是基础抽象,<code>spring-rabbit</code>
                            <hanla></hanla>是底层的默认实现
                          </p>
                        </blockquote>
                        <ul>
                          <li>特征<ul>
                              <li>侦听器容器,<hanla></hanla>用于异步处理入站消息</li>
                              <li>用于发送和接受消息的<hanla></hanla><code>RabbitTemplate</code></li>
                              <li><code>RabbitAdmin</code>
                                <hanla></hanla>用于自动声明队列,<hanla></hanla>交换和绑定
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>添加用户</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">添加用户</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/56d73dac884241b6bc7da2452df8a999.png" alt="添加用户"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>添加虚拟环境</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">添加虚拟环境</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/37ccbe287b5744c2b66e79f9a7772a0e.png" alt="添加虚拟环境"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>创建一个队列,<hanla></hanla>名称为<hanla></hanla><code>simple.queue(*)</code></p>
                        <table>
                          <thead>
                            <tr>
                              <th>创建一个队列,<hanla></hanla>名称为<hanla></hanla><code>simple.queue(*)</code></th>
                              <th align="center">删除一个队列</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a700bf34f1e2498e8d339d2d59f8ed26.png" alt="创建一个队列"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/469d27ca314b45658a437d3f6ec68d0b.png" alt="删除一个队列"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>测试</p>
                        <ul>
                          <li>
                            <p>创建聚合工程<hanla></hanla>(<code>父工程: SpringBoot 项目</code>)</p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>创建两个模块（层级代表在谁下创建）</p>
                            <ul>
                              <li>
                                <p><code>publisher 发布消息</code></p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.247</span><span class="number">.130</span> <span class="comment"># 主机名</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <ul>
                                  <li>
                                    <p>创建测试<hanla></hanla>(<code>启动类依然需要创建,<hanla></hanla>由于使用到<hanla></hanla>Configuration</code>)</p>
                                    <figure class="highlight java">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="keyword">package</span> com.example.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleQueue1</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 这个<hanla></hanla>simple<hanla></hanla>必须已存在才可用</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">"simple.queue"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"hello,spring amqp"</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">队列不存在时出现声明错误</th>
                                          <th align="center">显示查看</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7e509e1e71ec4b0aa9b7f9bac23367d1.png"></td>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/19d7cd040fab4190977c8453f34194e8.png"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                  <li>
                                    <p>查看发送的<hanla></hanla><code>message</code></p>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">查看发送的<hanla></hanla><code>message</code></th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/75ec7bc574e8456a8e68e3a755f86beb.png" alt="查看发送的message"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                </ul>
                              </li>
                              <li>
                                <p><code>consumer</code></p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># 和 publish 配置一样 都需要知道 MQ 信息<hanla></hanla></span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 只是一个类<hanla></hanla></span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListerner</span> {</span><br><span class="line">    <span class="meta">@RabbitListener(queues = "simple.queue")</span></span><br><span class="line">    <span class="comment">// 方法参数就是消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> {</span><br><span class="line">        System.out.println(<span class="string">"spring 消费者收到的消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 启动主启动类即可查阅到消息信息<hanla></hanla></span></span><br><span class="line"><span class="comment">// 消息一旦被消费就会从队列删除,RabbitMQ<hanla></hanla>没有消息回溯功能</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">查阅</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/14b51d4370d14c41a004214f023d91d9.png" alt="查阅"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-4">
                    <ul>
                      <li>
                        <p><code>consumer</code>
                          <hanla></hanla>的<hanla></hanla><code>yml</code>
                        </p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.247</span><span class="number">.129</span> <span class="comment"># MQ 主机名</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="comment"># 消费预取限制</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment"># 设置 prefetch 这个值,<hanla></hanla>可以控制预取消息的上限 1:<hanla></hanla>每次只能获取一条,<hanla></hanla>处理完才能获取下一个消息</span></span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p><code>Work Queue</code></p>
                        <blockquote>
                          <p><code>Work Queue</code>
                            <hanla></hanla>工作队列,<hanla></hanla>可以提高消息处理速度,<hanla></hanla>避免队列消息堆积
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>Work Queue</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/180f020025be41619cbf90596ae1686d.png" alt="Work Queue"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>模拟<hanla></hanla><code>Work Queue</code>
                          <hanla></hanla>实现一个队列绑定多个消费者
                        </p>
                        <ul>
                          <li>
                            <p>基本思路</p>
                            <ul>
                              <li>
                                <p>在<hanla></hanla><code>publisher</code>
                                  <hanla></hanla>服务中定义测试方法,<hanla></hanla>每秒产生<hanla></hanla><code>50</code>
                                  <hanla></hanla>条消息,<hanla></hanla>发送到<hanla></hanla><code>simple.queue</code>
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">       <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">"simple.queue"</span>;</span><br><span class="line">       <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"hello,spring amqp"</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++) {</span><br><span class="line">           rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">           Thread.sleep(<span class="number">20</span>);</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>在<hanla></hanla><code>consumer</code>
                                  <hanla></hanla>服务中定义两个消息监听者,<hanla></hanla>都监听<hanla></hanla><code>simple.queue</code>
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="meta">@RabbitListener(queues = "simple.queue")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueueMessage1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    System.out.println(<span class="string">"spring 消费者<hanla></hanla>1<hanla></hanla>收到的消息是 :["</span> + msg + <span class="string">"]"</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = "simple.queue")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueueMessage2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    System.err.println(<span class="string">"spring 消费者<hanla></hanla>2<hanla></hanla>收到的消息是.......... :["</span> + msg + <span class="string">"]"</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>消费者<hanla></hanla><code>1 </code>每秒处理<hanla></hanla><code>50</code>
                                  <hanla></hanla>条消息,<hanla></hanla>消费者<hanla></hanla><code>2</code>
                                  <hanla></hanla>每秒处理<hanla></hanla><code>10</code>
                                  <hanla></hanla>条消息
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">处理结果</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a2f0cb94d193405493efb7b9dd7626a0.png" alt="处理结果"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-5">
                    <ul>
                      <li>
                        <p>发布订阅</p>
                        <blockquote>
                          <p>发布订阅模式之间与之前案例的区别就是允许将同一消息发送给多个消费者,<hanla></hanla>实现方式就是加入了<hanla></hanla><code>exchange（交换机）</code></p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">模型</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/243d6eb4484a46f9a622c6e5d1dc3cdf.png" alt="模型"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p><code>FanoutExchange</code></p>
                            <ul>
                              <li>
                                <p>利用<hanla></hanla><code>SpringAMQP</code>
                                  <hanla></hanla>演示<hanla></hanla><code>FanoutExchange</code>
                                  <hanla></hanla>的使用
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">交换机的使用</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/e83f5befd73d46479205d3dd8c7164f4.png" alt="交换机的使用"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <ul>
                                  <li>
                                    <p>实现思路</p>
                                    <ol>
                                      <li>
                                        <p>在<hanla></hanla><code>consumer</code>
                                          <hanla></hanla>服务中,<hanla></hanla>利用代码声明队列,<hanla></hanla>交换机,<hanla></hanla>并将两者绑定
                                        </p>
                                        <figure class="highlight java">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="comment">// 在 consumer 服务创建一个类,<hanla></hanla>添加 @Configuration 注解,<hanla></hanla>并声明 FanoutExchange、Queue<hanla></hanla>和绑定关系对象 Binding</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> {</span><br><span class="line">    <span class="comment">// 声明 FanoutExchange 交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">"coderitl.fanout"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明第一个队列</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">"fanout.queue1"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 声明第二个队列</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">"fanout.queue2"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定队列 1 和交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 绑定队列 2 和交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p>在<hanla></hanla><code>consumer</code>
                                          <hanla></hanla>服务中,<hanla></hanla>编写两个消费者,<hanla></hanla>分别监听<hanla></hanla><code>fanout.queue1 和 fanout.queue2</code>
                                        </p>
                                        <figure class="highlight java">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="comment">// 消费者<hanla></hanla></span></span><br><span class="line"><span class="meta">@RabbitListener(queues = "fanout.queue1")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> {</span><br><span class="line">    System.out.println(<span class="string">"spring 消费者收到<hanla></hanla>fanout.queue1<hanla></hanla>消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="meta">@RabbitListener(queues = "fanout.queue2")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> {</span><br><span class="line">    System.out.println(<span class="string">"spring 消费者收到<hanla></hanla>fanout.queue2<hanla></hanla>消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">}</span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p>在<hanla></hanla><code>publisher</code>
                                          <hanla></hanla>中编写测试方法,<hanla></hanla>向<hanla></hanla><code>coderitl.fanout</code>
                                          <hanla></hanla>发送消息
                                        </p>
                                        <figure class="highlight java">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendFanoutExchange</span><span class="params">()</span>{</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">"coderitl.fanout"</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"hello every one！"</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName,<span class="string">""</span>,message);</span><br><span class="line">}</span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                    </ol>
                                  </li>
                                  <li>
                                    <p><code>SpringAMQP</code>
                                      <hanla></hanla>提供了声明交换机、队列、绑定关系的<hanla></hanla><code>API</code>
                                    </p>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">绑定关系</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2cbba06cd8f04b559df6d6551a443564.png" alt="绑定关系"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                  <li>
                                    <p>总结</p>
                                    <ul>
                                      <li>交换机的作用是什么<ol>
                                          <li>接受<hanla></hanla><code>publisher</code>
                                            <hanla></hanla>发送的消息
                                          </li>
                                          <li>将消息按照规则路由到与之绑定的队列</li>
                                          <li>不能缓存消息,<hanla></hanla>路由失败,<hanla></hanla>消息丢失</li>
                                          <li><code>FanoutExchange</code>
                                            <hanla></hanla>会将消息路由到每个绑定的队列<hanla></hanla>1
                                          </li>
                                        </ol>
                                      </li>
                                      <li>声明队列、交换机、绑定关系的<hanla></hanla><code>Bean</code>
                                        <hanla></hanla>是什么<ul>
                                          <li><code>Queue</code></li>
                                          <li><code>FanoutExchange</code></li>
                                          <li><code>Binding</code></li>
                                        </ul>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-6">
                    <ul>
                      <li>
                        <p>模型</p>
                        <ul>
                          <li>每一个<hanla></hanla><code>Queue</code>
                            <hanla></hanla>斗鱼接收到的消息根据规则路由到指定的<hanla></hanla><code>Queue</code>，因此称为路由模式<hanla></hanla>(<code>routes</code>)
                          </li>
                          <li>发布者发送消息时,<hanla></hanla>指定消息的<hanla></hanla><code>RoutingKey</code></li>
                          <li><code>Exchange</code>
                            <hanla></hanla>将消息路由到<hanla></hanla><code>BindingKey</code>
                            <hanla></hanla>与消息<hanla></hanla><code>RoutingKey</code>
                          </li>
                          <li><code>Exchange</code>
                            <hanla></hanla>将消息路由到<hanla></hanla><code>BindingKey</code>
                            <hanla></hanla>与消息<hanla></hanla><code>RoutingKey</code>
                            <hanla></hanla>一致的队列
                          </li>
                        </ul>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">模型</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/48d231d16f34469cbf6091395402faaa.png" alt="模型"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>利用<hanla></hanla><code>SpringAMQP</code>
                          <hanla></hanla>演示<hanla></hanla><code>DireExchange</code>
                          <hanla></hanla>的使用
                        </p>
                        <ul>
                          <li>
                            <p>实现思路</p>
                            <ul>
                              <li>
                                <p>利用<hanla></hanla><code>@RabbitListener</code>
                                  <hanla></hanla>声明<hanla></hanla><code>Exchange,Queue,RoutingKey</code>
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="keyword">package</span> com.example.consumer.listen;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListerner</span> {</span><br><span class="line">    <span class="comment">// 消费者</span></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = "direct.queue1"),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = "coderitl.direct",type= ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">            key = {"red", "blue"}</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span> {</span><br><span class="line">        System.out.println(<span class="string">"spring 消费者收到<hanla></hanla>direct.queue1<hanla></hanla>消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 消费者</span></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = "direct.queue2"),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = "coderitl.direct",type= ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">            key = {"yellow", "blue"}</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span> {</span><br><span class="line">        System.out.println(<span class="string">"spring 消费者收到<hanla></hanla>direct.queue2<hanla></hanla>消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>在<hanla></hanla><code>Consumer</code>
                                  <hanla></hanla>服务中,<hanla></hanla>编写两个消费者方法,<hanla></hanla>分别监听<hanla></hanla><code>direct.queue1</code>
                                  <hanla></hanla>和<hanla></hanla><code>direct.queue2</code>
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span> {</span><br><span class="line">    System.out.println(<span class="string">"spring 消费者收到<hanla></hanla>direct.queue1<hanla></hanla>消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">...</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>在<hanla></hanla><code>publisher</code>
                                  <hanla></hanla>中编写测试方法,<hanla></hanla>向<hanla></hanla><code>coderitl.direct</code>
                                  <hanla></hanla>发送消息
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span>{</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">"coderitl.direct"</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"hello blue！"</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName,<span class="string">"blue"</span>,message);</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">查阅,<hanla></hanla>如果结果未出现,<hanla></hanla>清理缓存,<hanla></hanla>重新构建，再次运行</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/fd6e78f76d7d491197b5afc7e2f4abd3.png" alt="查阅"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>总结</p>
                        <ul>
                          <li>描述<hanla></hanla><code>Direct</code>
                            <hanla></hanla>交换机与<hanla></hanla><code>Fanout</code>
                            <hanla></hanla>交换机的差异<ul>
                              <li><code>Fanout</code>
                                <hanla></hanla>交换机将消息路由给每一个与之绑定的队列
                              </li>
                              <li><code>Direct</code>
                                <hanla></hanla>交换机根据<hanla></hanla><code>RoutingKey</code>
                                <hanla></hanla>判断路由给那个队列
                              </li>
                              <li>如果多个队列具有相同的<hanla></hanla><code>RoutingKey</code>,<hanla></hanla>则与<hanla></hanla><code>Fanout</code>
                                <hanla></hanla>功能类似
                              </li>
                            </ul>
                          </li>
                          <li>基于<hanla></hanla><code>@RabbitListener</code>
                            <hanla></hanla>注解声明队列和交换机有那些常见注解<ul>
                              <li><code>@Queue</code></li>
                              <li><code>@Exchange</code></li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-7">
                    <ul>
                      <li>
                        <p><code>Queue</code>
                          <hanla></hanla>与<hanla></hanla><code>Exchange</code>
                          <hanla></hanla>指定<hanla></hanla><code>BindingKey</code>
                          <hanla></hanla>时可以使用通配符
                        </p>
                        <ul>
                          <li><code>#</code>: 代指<hanla></hanla><code>0</code>
                            <hanla></hanla>个或分多个单词
                          </li>
                          <li><code>*</code>:<hanla></hanla>代指一个单词</li>
                        </ul>
                      </li>
                      <li>
                        <p>模型</p>
                      </li>
                      <li>
                        <p>案例</p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 消费者<hanla></hanla></span></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = "topic.queue1"),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = "coderitl.topic", type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = "china.#"</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span> {</span><br><span class="line">    System.out.println(<span class="string">"spring 消费者收到<hanla></hanla>topic.queue1<hanla></hanla>消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者<hanla></hanla></span></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = "topic.queue2"),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = "coderitl.topic", type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = "#.news"</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span> {</span><br><span class="line">    System.out.println(<span class="string">"spring 消费者收到<hanla></hanla>topic.queue2<hanla></hanla>消息是 :["</span> + msg + <span class="string">"]"</span>);</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendTopicExchange</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="comment">// 交换机名称 coderitl.topic</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">"coderitl.topic"</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"Hello coderitl topic！"</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName,<span class="string">"china.news"</span>,message);</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">测试</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/22f70712c1b24da0ab860639d3dd899d.png" alt="测试"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-8">
                    <ul>
                      <li>
                        <p>消息转换器</p>
                        <blockquote>
                          <p><code>Spring</code>
                            <hanla></hanla>对消息对象的处理方式是由<hanla></hanla><code>org.springframework.amqp.support.converter.MessageConverter</code>
                            <hanla></hanla>来处理的,<hanla></hanla>而默认实现是<hanla></hanla><code>SimpleMessageConverter</code>，基于<hanla></hanla><code>JDK</code>
                            <hanla></hanla>的<hanla></hanla><code>ObjectOutputStream</code>
                            <hanla></hanla>完成序列化
                          </p>
                        </blockquote>
                      </li>
                      <li>
                        <p>修改<hanla></hanla><code>MessageConverter</code>,<hanla></hanla>推荐<hanla></hanla><code>JSON</code>
                          <hanla></hanla>方式序列化
                        </p>
                        <ul>
                          <li>
                            <p>实现步骤</p>
                            <ul>
                              <li>
                                <p>在<hanla></hanla><code>publisher</code>
                                  <hanla></hanla>服务引入依赖
                                </p>
                                <figure class="highlight xml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">&lt;!-- 如果引入了 web 的依赖则不需要引入下方依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>在<hanla></hanla><code>publisher</code>
                                  <hanla></hanla>服务声明<hanla></hanla><code>MessageConverter</code>
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>发送</p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendObjectMessage</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    Map&lt;String, Object&gt; message = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    message.put(<span class="string">"name"</span>, <span class="string">"coder-itl"</span>);</span><br><span class="line">    message.put(<span class="string">"age"</span>, <span class="string">"18"</span>);</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend( <span class="string">"object.queue"</span>, message);</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>接受</p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 创建队列<hanla></hanla></span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">objectQueue</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">"object.queue"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 需要配置 转换类型 </span></span><br><span class="line"><span class="meta">@RabbitListener(queues = "object.queue")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenObjectQueue</span><span class="params">(Map&lt;String, Object&gt; msg)</span>{</span><br><span class="line">    System.out.println(<span class="string">"msg = "</span> + msg);</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center"><code>JSON</code>
                                        <hanla></hanla>序列化
                                      </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ec539574578448d1b1cc445ec791a33f.png" alt="JSON序列化"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-9">
                    <ul>
                      <li>
                        <p>消息可靠性</p>
                        <ul>
                          <li>消息从生产者发送到<hanla></hanla><code>exchange</code>，再到<hanla></hanla><code>queue</code>，再到消费者,<hanla></hanla>有哪些导致消息丢失的可能性?<ul>
                              <li>发送时丢失<ul>
                                  <li>生产者发送的消息未送达<hanla></hanla><code>exchange</code></li>
                                  <li>消息到达<hanla></hanla><code>exchange</code>
                                    <hanla></hanla>后未到达<hanla></hanla><code>queue</code>
                                  </li>
                                </ul>
                              </li>
                              <li><code>MQ</code>
                                <hanla></hanla>宕机,<code>queue</code>
                                <hanla></hanla>将消息丢失
                              </li>
                              <li><code>consumer</code>
                                <hanla></hanla>接收到消息后未消费就宕机
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>生产者确认机制</p>
                        <blockquote>
                          <p>RabbitMQ 提供了<hanla></hanla><code>publisher confirm</code>
                            <hanla></hanla>机制来避免发送到<hanla></hanla><code>MQ</code>
                            <hanla></hanla>过程中丢失。消息发送到<hanla></hanla><code>MQ</code>
                            <hanla></hanla>以后,<hanla></hanla>会返回一个结果给发送者,<hanla></hanla>表示消息是否处理成功。结果有两种请求
                          </p>
                        </blockquote>
                        <ul>
                          <li>
                            <p><code>publisher-confirm</code>，发送者确认</p>
                            <ul>
                              <li>消息成功投递到交换机,<hanla></hanla>返回<hanla></hanla><code>ack</code></li>
                              <li>消息未投递到交换机,<hanla></hanla>返回<hanla></hanla><code>nack</code></li>
                            </ul>
                          </li>
                          <li>
                            <p><code>publisher-return</code>，发送者回执</p>
                            <ul>
                              <li>消息投递到交换机了,<hanla></hanla>但是没有路由到队列。返回<hanla></hanla><code>ACK</code>，以及路由失败原因</li>
                            </ul>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">生产者确认机制</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/537cf430cb0e457890667ede2a560051.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <blockquote>
                              <p><strong>注意：</strong>确认机制发送消息时,<hanla></hanla>需要给每个消息设置一个全局唯一<hanla></hanla><code>id</code>，以区分不同消息,<hanla></hanla>避免<hanla></hanla><code>ack</code>
                                <hanla></hanla>冲突
                              </p>
                            </blockquote>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>SpringAMQP</code>
                          <hanla></hanla>消息可靠性的具体实现步骤
                        </p>
                        <ol>
                          <li>
                            <p>在<code>生产者</code>这个微服务的<hanla></hanla><code>application.yml</code>
                              <hanla></hanla>中添加配置
                            </p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 生产者端<hanla></hanla></span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span> <span class="comment"># 主机名</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/amqp</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">mandatory:</span> <span class="literal">true</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li>配置说明<ul>
                                  <li><code>publisher-confirm-type</code>: 开启<hanla></hanla><code>publisher-confirm</code>，这里支持两种类型<ul>
                                      <li><code>simple</code>: 同步等待<hanla></hanla><code>confirm</code>
                                        <hanla></hanla>结果,<hanla></hanla>指导超时
                                      </li>
                                      <li><code>correlated【英 [ˈkɒrəleɪtɪd] 】</code>： 异步回调,<hanla></hanla>定义<hanla></hanla><code>ConfirmCallback</code>，<code>MQ</code>
                                        <hanla></hanla>返回结果时会回调这个<hanla></hanla><code>ConfirmCallback</code>
                                      </li>
                                    </ul>
                                  </li>
                                  <li><code>publisher-returns</code>: 开启<hanla></hanla><code>publisher-return</code>
                                    <hanla></hanla>功能,<hanla></hanla>同样是基于<hanla></hanla><code>callback</code>
                                    <hanla></hanla>机制,<hanla></hanla>不过定义<hanla></hanla><code>ReturnCallback</code>
                                  </li>
                                  <li><code>template.mandatory【英 [ˈmændətəri] 】</code>: 定义消息路由失败时的策略。<code>true</code>，则调用<hanla></hanla><code>ReturnCallback</code>,<code>false</code>: 则直接丢弃消息</li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>每个<hanla></hanla><code>RabbitTemplate</code>
                              <hanla></hanla>只能配置一个<hanla></hanla><code>ReturnCallback</code>,<hanla></hanla>因此需要在项目启动过程中配置
                            </p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">// 生产者处<hanla></hanla></span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">        <span class="comment">// 获取 RabbitTemplate</span></span><br><span class="line">        <span class="type">RabbitTemplate</span> <span class="variable">rabbitTemplate</span> <span class="operator">=</span> applicationContext.getBean(RabbitTemplate.class);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span><hanla></hanla>设置 ReturnCallback? ReturnsCallback</span></span><br><span class="line">        rabbitTemplate.setReturnCallback((message, replyCode, replyText, exchange, routingKey) -&gt; {</span><br><span class="line">            log.info(<span class="string">"消息发送失败,<hanla></hanla>应答码: {},<hanla></hanla>原因:{},<hanla></hanla>交换机:{},<hanla></hanla>路由键:{},<hanla></hanla>消息:{}"</span>, replyCode, replyText, exchange, routingKey, message.toString());</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">// 等同于上述<hanla></hanla></span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">        <span class="comment">// 获取 RabbitTemplate</span></span><br><span class="line">        <span class="type">RabbitTemplate</span> <span class="variable">rabbitTemplate</span> <span class="operator">=</span> applicationContext.getBean(RabbitTemplate.class);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span><hanla></hanla>设置 ReturnCallback(旧)? ReturnsCallback(新)</span></span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback() {</span><br><span class="line">            <span class="meta">@Overripackage</span> com.example.publisher.config;</span><br><span class="line"><span class="comment">// 等同于上述<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ReturnedMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">        <span class="comment">// 获取 RabbitTemplate</span></span><br><span class="line">        <span class="type">RabbitTemplate</span> <span class="variable">rabbitTemplate</span> <span class="operator">=</span> applicationContext.getBean(RabbitTemplate.class);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span><hanla></hanla>设置 ReturnCallback(旧)? ReturnsCallback(新)</span></span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returnedMessage)</span> {</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * public class ReturnedMessage {</span></span><br><span class="line"><span class="comment">                 *     private final Message message;</span></span><br><span class="line"><span class="comment">                 *     private final int replyCode;</span></span><br><span class="line"><span class="comment">                 *     private final String replyText;</span></span><br><span class="line"><span class="comment">                 *     private final String exchange;</span></span><br><span class="line"><span class="comment">                 *     private final String routingKey;</span></span><br><span class="line"><span class="comment">                 *     }</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="comment">// 判断是否是延迟消息</span></span><br><span class="line">                <span class="keyword">if</span> (returnedMessage.getMessage().getMessageProperties().getReceivedDelay() &gt; <span class="number">0</span>) {</span><br><span class="line">                    <span class="comment">// 是一个延迟消息,<hanla></hanla>忽略这个错误提示</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// 记录日志</span></span><br><span class="line">                log.info(<span class="string">"消息发送失败,<hanla></hanla>应答码: {},<hanla></hanla>原因:{},<hanla></hanla>交换机:{},<hanla></hanla>路由键:{},<hanla></hanla>消息:{}"</span>, returnedMessage.getReplyCode(), returnedMessage.getReplyText(), returnedMessage.getExchange(), returnedMessage.getRoutingKey(), returnedMessage.getMessage().toString());</span><br><span class="line">                <span class="comment">// 如果有需要,<hanla></hanla>可以重发消息</span></span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}de</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returnedMessage)</span> {</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * public class ReturnedMessage {</span></span><br><span class="line"><span class="comment">                 *     private final Message message;</span></span><br><span class="line"><span class="comment">                 *     private final int replyCode;</span></span><br><span class="line"><span class="comment">                 *     private final String replyText;</span></span><br><span class="line"><span class="comment">                 *     private final String exchange;</span></span><br><span class="line"><span class="comment">                 *     private final String routingKey;</span></span><br><span class="line"><span class="comment">                 *     }</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                log.info(<span class="string">"消息发送失败,<hanla></hanla>应答码: {},<hanla></hanla>原因:{},<hanla></hanla>交换机:{},<hanla></hanla>路由键:{},<hanla></hanla>消息:{}"</span>, returnedMessage.getReplyCode(), returnedMessage.getReplyText(), returnedMessage.getExchange(), returnedMessage.getRoutingKey(), returnedMessage.getMessage().toString());</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>发送消息,<hanla></hanla>指定消息<hanla></hanla><code>ID</code>，消息<hanla></hanla><code>ConfirmCallback</code></p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PublisherApplicationTests</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 消息体</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"hello,spring amqp!"</span>;</span><br><span class="line">        <span class="comment">// 消息 id,<hanla></hanla>需要封装到 CorrelationData 中</span></span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString());</span><br><span class="line">        <span class="comment">// 添加 callback</span></span><br><span class="line">        correlationData.getFuture().addCallback(result -&gt; {</span><br><span class="line">            <span class="keyword">if</span> (result.isAck()) {</span><br><span class="line">                <span class="comment">// ack 消息成功</span></span><br><span class="line">                log.debug(<span class="string">"消息发送成功,ID:{}"</span>, correlationData.getId());</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// nack 消息失败</span></span><br><span class="line">                log.error(<span class="string">"消息发送失败,ID:{},<hanla></hanla>原因:{}"</span>, correlationData.getId(), result.getReason());</span><br><span class="line">            }</span><br><span class="line">        }, ex -&gt; {</span><br><span class="line">            log.error(<span class="string">"消息发送异常,ID:{},<hanla></hanla>原因:{}"</span>, correlationData.getId(), ex.getMessage());</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"amq.direct"</span>, <span class="string">"simple"</span>, message, correlationData);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ol>
                      </li>
                      <li>
                        <p>消息持久化</p>
                        <blockquote>
                          <p><code>MQ</code>
                            <hanla></hanla>默认是内存存储消息,<hanla></hanla>开启持久化功能可以确保缓存在<hanla></hanla><code>MQ</code>
                            <hanla></hanla>中的消息不丢失
                          </p>
                        </blockquote>
                        <ol>
                          <li>
                            <p>交换机持久化</p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">// 交换机的持久化: 消费者配置中声明<hanla></hanla></span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DirectExchange <span class="title function_">directExchange</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * name: 交换机名称</span></span><br><span class="line"><span class="comment">         * durable: 是否持久化,true: 开启持久化</span></span><br><span class="line"><span class="comment">         * autoDelete: false 是否自动删除,<hanla></hanla>一般是 false</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">"direct.exchange"</span>, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>队列持久化</p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">// 队列的持久化: 消费者配置中声明<hanla></hanla></span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">directQueue</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// 使用 QueueBuilder<hanla></hanla>构建队列,durable 就是持久化的</span></span><br><span class="line">    <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"direct.queue"</span>).build();</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>消息持久化,<code>SpringAMQP</code>
                              <hanla></hanla>中的消息默认是持久化的,<hanla></hanla>可以通过<hanla></hanla><code>MessageProperties</code>
                              <hanla></hanla>中的<hanla></hanla><code>DeliverMode</code>
                              <hanla></hanla>来指定
                            </p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"数据内容...."</span>;</span><br><span class="line">    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> MessageBuilder.withBody(message.getBytes(StandardCharsets.UTF_8)) <span class="comment">// 消息体</span></span><br><span class="line">        .setDeliveryMode(MessageDeliveryMode.PERSISTENT) <span class="comment">// 持久化</span></span><br><span class="line">        .build();</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ol>
                      </li>
                      <li>
                        <p>消费者消息确认</p>
                        <blockquote>
                          <p><code>RabbitMQ</code>
                            <hanla></hanla>支持消费者确认机制,<hanla></hanla>即: 消费者处理消息后可以向<hanla></hanla><code>MQ</code>
                            <hanla></hanla>发送<hanla></hanla><code>ack</code>
                            <hanla></hanla>回执,<code>MQ</code>
                            <hanla></hanla>收到<hanla></hanla><code>ack</code>
                            <hanla></hanla>回执后才会删除该消息,<hanla></hanla>而<hanla></hanla><code>SpringAMQP</code>
                            <hanla></hanla>则允许配置三种确认模式
                          </p>
                        </blockquote>
                        <ol>
                          <li><code>manual</code>: 手动<hanla></hanla><code>ack</code>，需要在业务代码结束后,<hanla></hanla>调用<hanla></hanla><code>api</code>
                            <hanla></hanla>发送<hanla></hanla><code>ack</code>
                          </li>
                          <li><code>auto</code>: 自动<hanla></hanla><code>ack</code>,<hanla></hanla>由<hanla></hanla><code>spring</code>
                            <hanla></hanla>监测<hanla></hanla><code>listener</code>
                            <hanla></hanla>代码是否出现异常,<hanla></hanla>没有异常则返回<hanla></hanla><code>ack</code>,<hanla></hanla>抛出异常则返回<hanla></hanla><code>nack</code>
                          </li>
                          <li><code>none</code>: 关闭<hanla></hanla><code>ack</code>,<code>MQ</code>
                            <hanla></hanla>假定消费者获取消息后会成功处理,<hanla></hanla>因此消息投递后<code>立即被删除</code>
                          </li>
                        </ol>
                        <ul>
                          <li>
                            <p>实现步骤</p>
                            <ol>
                              <li>
                                <p>修改消费者的配置文件,<hanla></hanla>添加如下配置</p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">HH:mm:ss:SSS</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.example:</span> <span class="string">debug</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span> </span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/amqp</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> </span><br><span class="line">      <span class="attr">direct:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>失败重试机制</p>
                                <blockquote>
                                  <p>当消费者出现异常后,<hanla></hanla>消息会不断的<hanla></hanla><code>requeue【重新入队】</code>到队列,<hanla></hanla>在重新发送给消费者,<hanla></hanla>然后再次异常,<hanla></hanla>再次<hanla></hanla><code>requeue</code>,<hanla></hanla>无限循环，导致<hanla></hanla><code>MQ</code>
                                    <hanla></hanla>的消息处理飙升,<hanla></hanla>带来不必要的压力
                                  </p>
                                </blockquote>
                                <blockquote>
                                  <p>我们可以利用<hanla></hanla><code>Spring</code>
                                    <hanla></hanla>的<hanla></hanla><code>retry</code>
                                    <hanla></hanla>机制,<hanla></hanla>在消费者出现异常时利用本地重试,<hanla></hanla>而不是无限制的<hanla></hanla><code>requeue</code>
                                    <hanla></hanla>到<hanla></hanla><code>mq</code>
                                    <hanla></hanla>队列
                                  </p>
                                </blockquote>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># 消费者端<hanla></hanla></span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/amqp</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">retry:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启消费失败重试</span></span><br><span class="line">          <span class="attr">initial-interval:</span> <span class="number">1000</span> <span class="comment"># 初始的失败等待时长为 1s</span></span><br><span class="line">          <span class="attr">multiplier:</span> <span class="number">1</span> <span class="comment"># 下次失败的等待时长倍数,<hanla></hanla>下次等待时长<hanla></hanla>= multiplier * last-interval</span></span><br><span class="line">          <span class="attr">max-attempts:</span> <span class="number">3</span> <span class="comment"># 最大重试次数</span></span><br><span class="line">          <span class="attr">stateless:</span> <span class="literal">true</span> <span class="comment"># <span class="doctag">TODO:</span> true: 无状态,false: 有状态,<hanla></hanla>如果业务中包含事务,<hanla></hanla>这里改为 false</span></span><br><span class="line">      <span class="attr">direct:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">auto</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <figure class="highlight properties">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># https://www.toyaml.com/index.html 在线转换 yml to Properties</span></span><br><span class="line"><span class="attr">logging.pattern.dateformat</span>=<span class="string">HH:mm:ss:SSS</span></span><br><span class="line"><span class="attr">logging.level.com.example</span>=<span class="string">debug</span></span><br><span class="line"><span class="attr">spring.rabbitmq.host</span>=<span class="string">192.168.2.3</span></span><br><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.virtual-host</span>=<span class="string">/amqp</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.rabbitmq.listener.simple.prefetch</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">spring.rabbitmq.listener.simple.retry.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.rabbitmq.listener.simple.retry.initial-interval</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">spring.rabbitmq.listener.simple.retry.multiplier</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">spring.rabbitmq.listener.simple.retry.max-attempts</span>=<span class="string">3</span></span><br><span class="line"><span class="attr">spring.rabbitmq.listener.simple.retry.stateless</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.rabbitmq.listener.direct.acknowledge-mode</span>=<span class="string">auto</span></span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">层级目录</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/8ebdee056942466b9aad21f88a226862.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ol>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>消费者失败消息处理策略</p>
                        <blockquote>
                          <p>在开启重试模式后,<hanla></hanla>重试次数耗尽,<hanla></hanla>如果消息依然失败,<hanla></hanla>则需要有<hanla></hanla><code>messageRecoverer</code>
                            <hanla></hanla>接口处理，它包含三种不同的实现
                          </p>
                        </blockquote>
                        <ul>
                          <li>
                            <p><code>RejectAndDontRequeueRecoverer</code>: 重试耗尽后,<hanla></hanla>直接<hanla></hanla><code>reject</code>,<hanla></hanla>丢弃消息。默认就是这种方式</p>
                          </li>
                          <li>
                            <p><code>immediateRequeueMessageRecoverer</code>: 重试耗尽后,<hanla></hanla>返回<hanla></hanla><code>nack</code>,<hanla></hanla>消息重新入队</p>
                          </li>
                          <li>
                            <p><code>RepublishMessageRecoverer【推荐】</code>: 重试耗尽后,<hanla></hanla>将失败的消息投递到指定的交换机</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">模型</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f58f42f41ba54daaabe72c9571931e6e.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <ul>
                              <li>
                                <p>实现</p>
                                <ol>
                                  <li>
                                    <p>首先，定义接受失败消息的交换机、队列以及绑定关系</p>
                                    <figure class="highlight java">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="comment">// 消费者处<hanla></hanla></span></span><br><span class="line"><span class="keyword">package</span> com.example.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> {</span><br><span class="line">    <span class="comment">/**************************** 成功的交换机与队列以及绑定关系 *************************/</span></span><br><span class="line">    <span class="comment">// 交换机的持久化</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">directExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * name: 交换机名称</span></span><br><span class="line"><span class="comment">         * durable: 是否持久化,true: 开启持久化</span></span><br><span class="line"><span class="comment">         * autoDelete: false 是否自动删除,<hanla></hanla>一般是 false</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">"direct.exchange"</span>, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 队列的持久化</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">directQueue</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 使用 QueueBuilder<hanla></hanla>构建队列,durable 就是持久化的</span></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"direct.queue"</span>).build();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueToExchange</span><span class="params">(Queue directQueue, DirectExchange directExchange)</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue).to(directExchange).with(<span class="string">"simple.test"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/******************** 失败的交换机与队列以及绑定关 ******************************/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">errorDirectExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * name: 交换机名称</span></span><br><span class="line"><span class="comment">         * durable: 是否持久化,true: 开启持久化</span></span><br><span class="line"><span class="comment">         * autoDelete: false 是否自动删除,<hanla></hanla>一般是 false</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">"error.direct.exchange"</span>, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">errorDirectQueue</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 使用 QueueBuilder<hanla></hanla>构建队列,durable 就是持久化的</span></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"error.direct.queue"</span>).build();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueToExchangeError</span><span class="params">(Queue errorDirectQueue, DirectExchange errorDirectExchange)</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(errorDirectQueue).to(errorDirectExchange).with(<span class="string">"error"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                  </li>
                                  <li>
                                    <p>定义<hanla></hanla><code>RepublishMessageRecoverer</code></p>
                                    <figure class="highlight java">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageRecoverer <span class="title function_">messageRecoverer</span><span class="params">(RabbitTemplate rabbitTemplate)</span> {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * rabbitTemplate: 使用 rabbitTemplate 重发</span></span><br><span class="line"><span class="comment">         * errorExchange: 发送的交换机</span></span><br><span class="line"><span class="comment">         * errorRoutingKey: 以键发送</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RepublishMessageRecoverer</span>(rabbitTemplate,<span class="string">"error.direct.exchange"</span>,<span class="string">"error"</span>);</span><br><span class="line">}</span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">查看输出</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0fff593fdf3744caa4546288265cddfe.png"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                </ol>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>总结</p>
                        <blockquote>
                          <p>如可确保<hanla></hanla><code>RabbitMQ</code>
                            <hanla></hanla>消息的可靠性？
                          </p>
                        </blockquote>
                        <ul>
                          <li>开启生产者确认机制,<hanla></hanla>确保生产者的消息能到达队列</li>
                          <li>开启持久化功能,<hanla></hanla>确保消息未消费前在队列中不会丢失</li>
                          <li>开启消费者确认机制为<hanla></hanla><code>auto</code>，由<hanla></hanla><code>spring</code>
                            <hanla></hanla>确认消息处理成功后完成<hanla></hanla><code>ack</code>
                          </li>
                          <li>开启消费者失败重试机制,<hanla></hanla>并设置<hanla></hanla><code>MeessageRecoverer</code>,<hanla></hanla>多次重试失败后将消息投递到异常交换机,<hanla></hanla>交由人工处理</li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-10">
                    <ul>
                      <li>
                        <p>初始死信交换机</p>
                        <blockquote>
                          <p>当一个队列中的消息满足下列情况之一时,<hanla></hanla>可以称之为<code>死信【dead letter】</code></p>
                        </blockquote>
                        <ol>
                          <li>消费者使用<hanla></hanla><code>basic.reject</code>
                            <hanla></hanla>或<hanla></hanla><code>basic.nack</code>
                            <hanla></hanla>声明消费失败,<hanla></hanla>并且消息的<hanla></hanla><code>requeue</code>
                            <hanla></hanla>参数设置为<hanla></hanla><code>false</code>
                          </li>
                          <li>消息是一个过期消息,<hanla></hanla>超时无人消费</li>
                          <li>要投递的队列消息堆积满了,<hanla></hanla>最早的消息可能成为死信</li>
                        </ol>
                        <blockquote>
                          <p>如果该队列配置了<hanla></hanla><code>dead-letter-exchange</code>
                            <hanla></hanla>属性，指定了一个交换机,<hanla></hanla>那么队列中的死信就会投递到这个交换机中,<hanla></hanla>而这个交换机称为<code>死信交换机【Dead Letter Exchange<hanla></hanla>简称 DLX】</code>
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">死信模型</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/83b865c503444a83860584c4b6590ccf.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>TTL</code></p>
                        <blockquote>
                          <p><code>TTL</code>，也就是<hanla></hanla><code>Time-To-Live</code>，如果一个队列中的消息<hanla></hanla><code>TTL</code>
                            <hanla></hanla>结束仍未消费,<hanla></hanla>则会变为死信,<code>TTL</code>
                            <hanla></hanla>超时分为两种情况
                          </p>
                        </blockquote>
                        <ul>
                          <li>消息所在的队列设置了存活时间</li>
                          <li>消息本身设置了存活时间</li>
                        </ul>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">原理</th>
                              <th></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2ce0ff4a72ee49e4bdf53867fe3fad2b.png"></td>
                              <td></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>实现</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">正常队列绑定死信交换机以及死信队列实现</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bfbc95aff1d449f3b17bc1ee66b710a4.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> {</span><br><span class="line">    <span class="comment">// 延迟消息 基于注解方式</span></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = "dl.queue", durable = "true"),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = "dl.direct"),</span></span><br><span class="line"><span class="meta">            key = "dl"</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDlQueue</span><span class="params">(String msg)</span> {</span><br><span class="line">        log.info(<span class="string">"接收到 dl.queue<hanla></hanla>的延迟消息: {}"</span>, msg);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">蓝色框部分实现</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b60b354922ea4972a7723acc94e06cca.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> {</span><br><span class="line">    <span class="comment">/************************** 死信 *********************************/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">ttlExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">"ttl.direct"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">ttlQueue</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"ttl.queue"</span>) <span class="comment">// 指定队列名称并持久化</span></span><br><span class="line">                .ttl(<span class="number">10000</span>) <span class="comment">// 设置队列的超时时间为 10s</span></span><br><span class="line">                .deadLetterExchange(<span class="string">"dl.direct"</span>) <span class="comment">// 指定死信交换机</span></span><br><span class="line">                .deadLetterRoutingKey(<span class="string">"dl"</span>) <span class="comment">// 指定死信 RoutingKey</span></span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">simpleBinding</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(ttlQueue()).to(ttlExchange()).with(<span class="string">"ttl"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>发送消息时,<hanla></hanla>给消息本身设置超时时间</p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">ttl</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"ttl 5s or 10s...................!"</span>;</span><br><span class="line">    <span class="type">Message</span> <span class="variable">build</span> <span class="operator">=</span> MessageBuilder.withBody(message.getBytes(StandardCharsets.UTF_8))</span><br><span class="line">        .setDeliveryMode(MessageDeliveryMode.PERSISTENT) <span class="comment">// 持久化</span></span><br><span class="line">        <span class="comment">// 消息设置过期时间 TTL=5000ms=5s【最终 5s】 &lt; 队列设置的 TTL=10000ms=10s</span></span><br><span class="line">        .setExpiration(<span class="string">"5000"</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"ttl.direct"</span>, <span class="string">"ttl"</span>, build);</span><br><span class="line">    }</span><br><span class="line">    log.info(<span class="string">"消息发送完毕...................."</span>);</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <blockquote>
                          <p>如果消息和队列同时设置了<code>超时时间</code>,<hanla></hanla>则以两者中最小的为准</p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">超时时间</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5689c314648a46889793ad45a95ccefd.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>延迟队列</p>
                        <blockquote>
                          <p>利用<hanla></hanla><code>TTL</code>
                            <hanla></hanla>结合死信交换机,<hanla></hanla>我们实现了消息发出后,<hanla></hanla>消费者延迟收到消息的效果。这种消息模式就称为<code>延迟队列【Delay Queue】</code>模式
                          </p>
                        </blockquote>
                        <ul>
                          <li>
                            <p>重新安装<hanla></hanla><code>rabbitmq</code></p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">run \</span></span><br><span class="line"><span class="string">	-e RABBITMQ_DEFAULT_USER=root \</span></span><br><span class="line"><span class="string">	-e RABBITMQ_DEFAULT_PASS=root \</span></span><br><span class="line"><span class="string">	-v mq-plugins:/plugins \</span></span><br><span class="line"><span class="string">	--name mq \</span></span><br><span class="line"><span class="string">	--hostname mq1 \</span></span><br><span class="line"><span class="string">	-p 15672:15672 \</span></span><br><span class="line"><span class="string">	-p 5672:5672 \</span></span><br><span class="line"><span class="string">	-d \</span></span><br><span class="line"><span class="string">	rabbitmq:3-management</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">当前版本信息</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/214e27e5a1b8449eb8df2a09ea093440.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>容器内部执行虚拟主机添加命令</p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 添加虚拟机<hanla></hanla></span></span><br><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">add_vhost /amqp</span></span><br><span class="line"><span class="comment"># 添加用户 root 密码 root</span></span><br><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">add_user root root</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 分配角色<hanla></hanla></span></span><br><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_user_tags root administrator</span></span><br><span class="line"><span class="comment"># 设置虚拟主机 /amqp 的权限: </span></span><br><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_permissions -p /amqp root ".*" ".*" ".*"</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>延迟队列的使用场景</p>
                            <ul>
                              <li>延迟发送短信</li>
                              <li>用户下单,<hanla></hanla>如果用户在<hanla></hanla><code>15</code>
                                <hanla></hanla>分钟内未支付,<hanla></hanla>则自动取消
                              </li>
                              <li>预约工作会议,<code>20</code>
                                <hanla></hanla>分钟后自动通知所有参会人员
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>延迟队列插件安装</p>
                            <ul>
                              <li>
                                <p>官方的安装指南地址为：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq%EF%BC%8C%E4%B8%8A%E8%BF%B0%E6%96%87%E6%A1%A3%E6%98%AF%E5%9F%BA%E4%BA%8E%60linux%60%E5%8E%9F%E7%94%9F%E5%AE%89%E8%A3%85%60RabbitMQ%60%EF%BC%8C%E7%84%B6%E5%90%8E%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6">https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq，上述文档是基于`linux`原生安装`RabbitMQ`，然后安装插件</a></p>
                              </li>
                              <li>
                                <p>基于<hanla></hanla><code>Docker</code></p>
                                <ul>
                                  <li>
                                    <p><code>RabbitMQ</code>
                                      <hanla></hanla>有一个官方的插件社区，地址为：
                                    </p>
                                    <blockquote>
                                      <p> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.rabbitmq.com/community-plugins.html">https://www.rabbitmq.com/community-plugins.html</a></p>
                                    </blockquote>
                                  </li>
                                  <li>
                                    <p><code>github</code>
                                      <hanla></hanla>下载:
                                    </p>
                                    <blockquote>
                                      <p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/3.9.0">https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/3.9.0</a>, 选择后缀为<hanla></hanla><code>ez</code>
                                        <hanla></hanla>的文件，
                                      </p>
                                      <p><code>This release has no changes except for its metadata that lists [RabbitMQ 3.9.0](https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.9.0) (and future </code>3.9.x<code> releases) as supported.</code></p>
                                    </blockquote>
                                  </li>
                                  <li>
                                    <p>上传插件到数据卷插件目录</p>
                                    <figure class="highlight properties">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="comment"># 查看数据卷位置<hanla></hanla></span></span><br><span class="line"><span class="attr">docker</span> <span class="string">volume inspect mq-plugins</span></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">上传</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b7d4bb9e6abb4da085361f633ee99ea1.png"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                  <li>
                                    <p>安装插件，进入容器内部</p>
                                    <figure class="highlight properties">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="comment"># 进入 mq 容器内部<hanla></hanla></span></span><br><span class="line"><span class="attr">docker</span> <span class="string">exec -it mq bash</span></span><br><span class="line"><span class="comment"># 开启插件<hanla></hanla></span></span><br><span class="line"><span class="attr">rabbitmq-plugins</span> <span class="string">enable rabbitmq_delayed_message_exchange</span></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">结果如下</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0777821dc5c04a8c8bd81e2362ccf822.png"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                  <li>
                                    <p>页面使用插件</p>
                                    <blockquote>
                                      <p><code>DelayExchange</code>
                                        <hanla></hanla>插件的原理是对官方原生的<hanla></hanla><code>Exchange</code>
                                        <hanla></hanla>做了功能升级
                                      </p>
                                    </blockquote>
                                    <ul>
                                      <li>
                                        <p>将<hanla></hanla><code>DelayExchange</code>
                                          <hanla></hanla>接收到的消息暂存在内存中<hanla></hanla>(<code>官方的 Exchange</code>
                                          <hanla></hanla>是无法存储消息的)
                                        </p>
                                      </li>
                                      <li>
                                        <p>在<hanla></hanla><code>DelayExchange</code>
                                          <hanla></hanla>中计时,<hanla></hanla>超时后才投递消息到队列中
                                        </p>
                                      </li>
                                      <li>
                                        <p>使用</p>
                                        <blockquote>
                                          <p>在<hanla></hanla><code>RabbitMQ</code>
                                            <hanla></hanla>的管理平台创建一个<hanla></hanla><code>DelayExchange</code>
                                          </p>
                                        </blockquote>
                                        <table>
                                          <thead>
                                            <tr>
                                              <th align="center">创建<hanla></hanla><code>DelayExchange</code></th>
                                            </tr>
                                          </thead>
                                          <tbody>
                                            <tr>
                                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/57e387f9571a4dd1bd0be58e99ac51f4.png"></td>
                                            </tr>
                                          </tbody>
                                        </table>
                                        <blockquote>
                                          <p>消息的延迟时间需要在发送消息的时候指定</p>
                                        </blockquote>
                                        <table>
                                          <thead>
                                            <tr>
                                              <th align="center">指定</th>
                                            </tr>
                                          </thead>
                                          <tbody>
                                            <tr>
                                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0528a297e554404b818b6d199f81f942.png"></td>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p><code>SpringAMQP</code>
                              <hanla></hanla>使用延迟队列插件
                            </p>
                            <blockquote>
                              <p><code>DelayExchange</code>
                                <hanla></hanla>的本质还是官方的三种交换机,<hanla></hanla>只是添加了延迟队列.<hanla></hanla>因此使用时只需要声明一个交换机,<hanla></hanla>交换机的类型可以是任意的,<hanla></hanla>然后设定<hanla></hanla><code>delayed</code>
                                <hanla></hanla>属性为<hanla></hanla><code>true</code>
                                <hanla></hanla>即可
                              </p>
                            </blockquote>
                            <ul>
                              <li>
                                <p>基于注解声明</p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 消费者处: 基于注解声明 【推荐使用注解声明延迟队列】</span></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = "delay.queue", durable = "true"),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = "delay.direct", delayed = "true"),</span></span><br><span class="line"><span class="meta">    key = "delay"</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDelayedQueue</span><span class="params">(String msg)</span> {</span><br><span class="line">    log.info(<span class="string">"接收到了 delay.queue 的延迟消息: {}"</span>, msg);</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>基于<hanla></hanla><code>Bean</code></p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 消费者处<hanla></hanla></span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">delayedExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">"delay.direct"</span>) <span class="comment">// 指定交换机类型和名称</span></span><br><span class="line">                .delayed() <span class="comment">// 设置 delay 属性为 true</span></span><br><span class="line">                .durable(<span class="literal">true</span>) <span class="comment">// 持久化</span></span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">"delay.queue"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">delayedBinding</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayedQueue()).to(delayedExchange()).with(<span class="string">"delay"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>然后我们向这个<hanla></hanla><code>delay</code>
                                  <hanla></hanla>为<hanla></hanla><code>true</code>
                                  <hanla></hanla>的交换机中发送消息,<hanla></hanla>一定要给消息添加一个<hanla></hanla><code>header:x-delay</code>
                                  <hanla></hanla>值为延迟的时间,<hanla></hanla>单位为<hanla></hanla><code>ms</code>
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 生产者发送消息<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">ttl_plugins</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"ttl plugins...................!"</span>;</span><br><span class="line">    <span class="type">Message</span> <span class="variable">build</span> <span class="operator">=</span> MessageBuilder.withBody(message.getBytes(StandardCharsets.UTF_8))</span><br><span class="line">        .setHeader(<span class="string">"x-delay"</span>, <span class="number">1000</span>)</span><br><span class="line">        .setDeliveryMode(MessageDeliveryMode.PERSISTENT) <span class="comment">// 持久化</span></span><br><span class="line">        .build();</span><br><span class="line">    <span class="comment">// 消息 id,<hanla></hanla>需要封装到 CorrelationData 中</span></span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString());</span><br><span class="line">    <span class="comment">// 添加 callback</span></span><br><span class="line">    correlationData.getFuture().addCallback(result -&gt; {</span><br><span class="line">        <span class="keyword">if</span> (result.isAck()) {</span><br><span class="line">            <span class="comment">// ack 消息成功</span></span><br><span class="line">            log.debug(<span class="string">"消息发送成功,ID: {}"</span>, correlationData.getId());</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// nack 消息失败</span></span><br><span class="line">            log.error(<span class="string">"消息发送失败,ID: {},<hanla></hanla>原因: {}"</span>, correlationData.getId(), result.getReason());</span><br><span class="line">        }</span><br><span class="line">    }, ex -&gt; {</span><br><span class="line">        log.error(<span class="string">"消息发送异常,ID: {},<hanla></hanla>原因: {}"</span>, correlationData.getId(), ex.getMessage());</span><br><span class="line">    });</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"delay.direct"</span>, <span class="string">"delay"</span>, build, correlationData);</span><br><span class="line">    }</span><br><span class="line">    log.debug(<span class="string">"消息发送完毕...................."</span>);</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>修改配置</p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="keyword">package</span> com.example.publisher.config;</span><br><span class="line"><span class="comment">// 等同于上述<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ReturnedMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">        <span class="comment">// 获取 RabbitTemplate</span></span><br><span class="line">        <span class="type">RabbitTemplate</span> <span class="variable">rabbitTemplate</span> <span class="operator">=</span> applicationContext.getBean(RabbitTemplate.class);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span><hanla></hanla>设置 ReturnCallback(旧)? ReturnsCallback(新)</span></span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returnedMessage)</span> {</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * public class ReturnedMessage {</span></span><br><span class="line"><span class="comment">                 *     private final Message message;</span></span><br><span class="line"><span class="comment">                 *     private final int replyCode;</span></span><br><span class="line"><span class="comment">                 *     private final String replyText;</span></span><br><span class="line"><span class="comment">                 *     private final String exchange;</span></span><br><span class="line"><span class="comment">                 *     private final String routingKey;</span></span><br><span class="line"><span class="comment">                 *     }</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> 判断是否是延迟消息</span></span><br><span class="line">                <span class="keyword">if</span> (returnedMessage.getMessage().getMessageProperties().getReceivedDelay() &gt; <span class="number">0</span>) {</span><br><span class="line">                    <span class="comment">// 是一个延迟消息,<hanla></hanla>忽略这个错误提示</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// 记录日志</span></span><br><span class="line">                log.info(<span class="string">"消息发送失败,<hanla></hanla>应答码: {},<hanla></hanla>原因:{},<hanla></hanla>交换机:{},<hanla></hanla>路由键:{},<hanla></hanla>消息:{}"</span>, returnedMessage.getReplyCode(), returnedMessage.getReplyText(), returnedMessage.getExchange(), returnedMessage.getRoutingKey(), returnedMessage.getMessage().toString());</span><br><span class="line">                <span class="comment">// 如果有需要,<hanla></hanla>可以重发消息</span></span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-11">
                    <ul>
                      <li>
                        <p>消息堆积问题</p>
                        <blockquote>
                          <p>当生产者发送消息的速度超过了消费者处理消息的速度,<hanla></hanla>就会导致队列中的消息堆积,<hanla></hanla>直到队列存储消息达到上限。最早接收到的消息,<hanla></hanla>可能就会成为死信,<hanla></hanla>会被丢弃,<hanla></hanla>这就是<code>消息堆积</code>问题</p>
                        </blockquote>
                      </li>
                      <li>
                        <p>解决消息堆积有三种思路</p>
                        <ul>
                          <li>增加更多的消费者,<hanla></hanla>提高消费速度</li>
                          <li>在消费者内开启线程池加快消息处理速度</li>
                          <li>扩大队列容积，提高堆积上限</li>
                        </ul>
                      </li>
                      <li>
                        <p>惰性队列的特征如下</p>
                        <ul>
                          <li>接收到消息后<code>直接存入磁盘而非内存</code></li>
                          <li>消费者要消费消息时才会从磁盘中读取并加载到内存</li>
                          <li>支持数百万条的消息存储</li>
                        </ul>
                      </li>
                      <li>
                        <p>启用惰性队列</p>
                        <ul>
                          <li>
                            <p>设置一个队列为惰性队列，只需要在声明时,<hanla></hanla>指定<hanla></hanla><code>x-queue-mode</code>
                              <hanla></hanla>属性为<hanla></hanla><code>lazy</code>
                              <hanla></hanla>即可
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 可以将一个运行中的队列设置为惰性队列<hanla></hanla></span></span><br><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_policy Lazy "^lazy-queue$" '{"queue-mode":"lazy"}' --apply-to queues</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>用<hanla></hanla><code>SpringAMQP</code>
                              <hanla></hanla>声明惰性队列分两种方式
                            </p>
                            <ul>
                              <li>
                                <p>基于<hanla></hanla><code>@Bean</code></p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 推荐使用<hanla></hanla></span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyModeConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">lazyQueue</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"lazy.queue"</span>)</span><br><span class="line">                .lazy() <span class="comment">// 开启 x-queue-mode 为 lazy</span></span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>基于<code>注解</code></p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> {</span><br><span class="line">    <span class="meta">@RabbitListener(</span></span><br><span class="line"><span class="meta">            queuesToDeclare = @Queue(</span></span><br><span class="line"><span class="meta">                    name = "lazy.queue",</span></span><br><span class="line"><span class="meta">                    durable = "true",</span></span><br><span class="line"><span class="meta">                	// 声明 lazy</span></span><br><span class="line"><span class="meta">                    arguments = @Argument(name = "x-queue-mode", value = "lazy")</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenLazyQueue</span><span class="params">(String msg)</span> {</span><br><span class="line">        log.debug(<span class="string">"接收到 lazy.queue<hanla></hanla>的消息: {}"</span>, msg);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>优缺点</p>
                        <ul>
                          <li>优点<ul>
                              <li>基于磁盘存储,<hanla></hanla>消息上限高</li>
                              <li>没有间歇性的<hanla></hanla><code>page-out</code>，性能比较稳定</li>
                            </ul>
                          </li>
                          <li>缺点<ul>
                              <li>基于磁盘存储,<hanla></hanla>消息时效性会降低</li>
                              <li>性能受限于磁盘的<hanla></hanla><code>IO</code></li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-12">
                    <ul>
                      <li>
                        <p>集群分类</p>
                        <ul>
                          <li>
                            <p>普通集群</p>
                            <blockquote>
                              <p>是一种分布式集群,<hanla></hanla>将队列分散到集群的各个节点,<hanla></hanla>从而提高整个集群的并发能力</p>
                            </blockquote>
                          </li>
                          <li>
                            <p>镜像集群</p>
                            <blockquote>
                              <p>是一种主从集群,<hanla></hanla>普通集群的基础上,<hanla></hanla>添加了主从备份功能,<hanla></hanla>提高集群的数据可用性</p>
                            </blockquote>
                            <blockquote>
                              <p>镜像集群虽然支持主从，但主从同步并不是强一致的,<hanla></hanla>某些情况下可能有数据丢失的风险。因此在<hanla></hanla><code>RabbitMQ</code>
                                <hanla></hanla>的<hanla></hanla><code>3.8</code>
                                <hanla></hanla>版本以后,<hanla></hanla>推出了新的功能:<code>
                                  <hanla></hanla>仲裁队列
                                </code>来代替镜像集群,<hanla></hanla>底层采用<hanla></hanla><code>Raft</code>
                                <hanla></hanla>协议确保主从的数据一致性
                              </p>
                            </blockquote>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>普通集群</p>
                        <blockquote>
                          <p>或者叫标准集群<hanla></hanla>(<code>classic cluster</code>),<hanla></hanla>具备下列特征</p>
                        </blockquote>
                        <ol>
                          <li>
                            <p>会在集群的各个节点间共享部分数据,<hanla></hanla>包括： 交换机、队列元信息。不包含队列中的消息</p>
                          </li>
                          <li>
                            <p>当访问集群某节点时,<hanla></hanla>如果队列不在该节点,<hanla></hanla>会从数据所在节点传递到当前节点并返回</p>
                          </li>
                          <li>
                            <p>队列所在节点宕机,<hanla></hanla>队列中的消息就会丢失</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">传递</th>
                                  <th align="center">宕机消息丢失</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/4f6f2a9e7c424a9fbd422d20bec3a224.png"></td>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/23f3f44070e94e8c8a19ca7e4397bfe4.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <ul>
                              <li>
                                <p>普通集群部署计划</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">计划分配</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c31b6878c58d4d9f965f02335e87d9ea.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <blockquote>
                                  <p>集群中的节点默认都是:<code>rabbit@[hostname]</code>，因此以上三个节点的名称分别为</p>
                                </blockquote>
                                <ul>
                                  <li><code>rabbit@mq1</code></li>
                                  <li><code>rabbit@mq2</code></li>
                                  <li><code>rabbit@mq3</code></li>
                                </ul>
                              </li>
                              <li>
                                <p>获取<hanla></hanla><code>cookie</code></p>
                                <blockquote>
                                  <p><code>RabbitMQ</code>
                                    <hanla></hanla>底层依赖于<hanla></hanla><code>Erlang</code>，而<hanla></hanla><code>Erlang</code>
                                    <hanla></hanla>虚拟机就是一个面向分布式的语言，默认就支持集群模式。集群模式中的每个<hanla></hanla><code>RabbitMQ</code> 节点使用 <code>cookie </code>来确定它们是否被允许相互通信。
                                  </p>
                                </blockquote>
                                <blockquote>
                                  <p>要使两个节点能够通信，它们必须具有相同的共享秘密，称为<hanla></hanla><strong>Erlang cookie</strong>。<code>cookie </code>只是一串最多<hanla></hanla><code>255</code>
                                    <hanla></hanla>个字符的字母数字字符。
                                  </p>
                                </blockquote>
                                <blockquote>
                                  <p>每个集群节点必须具有<strong>相同的 cookie</strong>。实例之间也需要它来相互通信。</p>
                                </blockquote>
                                <ul>
                                  <li>
                                    <p>我们先在之前启动的<hanla></hanla><code>mq</code>
                                      <hanla></hanla>容器中获取一个<hanla></hanla><code>cookie</code>
                                      <hanla></hanla>值，作为集群的<hanla></hanla><code>cookie</code>。执行下面的命令
                                    </p>
                                    <figure class="highlight properties">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="comment"># rabbitmq:3-management[当前版本]|rabbitmq:3.8-management【可更换的版本】</span></span><br><span class="line"><span class="attr">docker</span> <span class="string">exec -it mq cat /var/lib/rabbitmq/.erlang.cookie</span></span><br><span class="line"><span class="comment"># 非固定值<hanla></hanla></span></span><br><span class="line"><span class="attr">QZCXBOTUGFDXGZHUHZBX</span></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">获取<hanla></hanla><code>cookie</code></th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b6bee0454c6746d8bb02fcd6587bd678.png"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                  <li>
                                    <p>接下来，停止并删除当前的<hanla></hanla><code>mq</code>
                                      <hanla></hanla>容器，我们重新搭建集群
                                    </p>
                                    <figure class="highlight properties">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="attr">docker</span> <span class="string">rm -f mq</span></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                  </li>
                                  <li>
                                    <p>准备集群配置</p>
                                    <ul>
                                      <li>
                                        <p>在<hanla></hanla><code>/tmp</code>
                                          <hanla></hanla>目录新建一个配置文件 <code>rabbitmq.conf</code>
                                        </p>
                                        <figure class="highlight properties">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="attr">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 创建文件<hanla></hanla></span></span><br><span class="line"><span class="attr">vim</span> <span class="string">rabbitmq.conf</span></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                        <figure class="highlight properties">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="comment"># 写入内容如下<hanla></hanla></span></span><br><span class="line"><span class="attr">loopback_users.guest</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">listeners.tcp.default</span> = <span class="string">5672</span></span><br><span class="line"><span class="attr">cluster_formation.peer_discovery_backend</span> = <span class="string">rabbit_peer_discovery_classic_config</span></span><br><span class="line"><span class="attr">cluster_formation.classic_config.nodes.1</span> = <span class="string">rabbit@mq1</span></span><br><span class="line"><span class="attr">cluster_formation.classic_config.nodes.2</span> = <span class="string">rabbit@mq2</span></span><br><span class="line"><span class="attr">cluster_formation.classic_config.nodes.3</span> = <span class="string">rabbit@mq3</span></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p>再创建一个文件，记录<hanla></hanla><code>cookie</code></p>
                                        <figure class="highlight properties">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="attr">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 写入<hanla></hanla>cookie</span></span><br><span class="line"><span class="attr">echo</span> <span class="string">"QZCXBOTUGFDXGZHUHZBX" &gt; .erlang.cookie</span></span><br><span class="line"><span class="comment"># 修改<hanla></hanla>cookie<hanla></hanla>文件的权限<hanla></hanla></span></span><br><span class="line"><span class="attr">chmod</span> <span class="string">600 .erlang.cookie</span></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p>准备三个目录<hanla></hanla><code>mq1、mq2、mq3</code></p>
                                        <figure class="highlight properties">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="attr">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 创建目录<hanla></hanla></span></span><br><span class="line"><span class="attr">mkdir</span> <span class="string">mq1 mq2 mq3</span></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p>然后拷贝<hanla></hanla><code>rabbitmq.conf、cookie</code>
                                          <hanla></hanla>文件到<hanla></hanla><code>mq1、mq2、mq3</code>
                                        </p>
                                        <figure class="highlight properties">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="comment"># 进入<hanla></hanla>/tmp</span></span><br><span class="line"><span class="attr">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 拷贝<hanla></hanla></span></span><br><span class="line"><span class="attr">cp</span> <span class="string">rabbitmq.conf mq1</span></span><br><span class="line"><span class="attr">cp</span> <span class="string">rabbitmq.conf mq2</span></span><br><span class="line"><span class="attr">cp</span> <span class="string">rabbitmq.conf mq3</span></span><br><span class="line"><span class="attr">cp</span> <span class="string">.erlang.cookie mq1</span></span><br><span class="line"><span class="attr">cp</span> <span class="string">.erlang.cookie mq2</span></span><br><span class="line"><span class="attr">cp</span> <span class="string">.erlang.cookie mq3</span></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p>启动集群</p>
                                        <ul>
                                          <li>
                                            <p>创建网络</p>
                                            <figure class="highlight properties">
                                              <table>
                                                <tbody>
                                                  <tr>
                                                    <td class="gutter">
                                                      <pre><span class="line">1</span><br></pre>
                                                    </td>
                                                    <td class="code">
                                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">network create mq-net</span></span><br></pre>
                                                    </td>
                                                  </tr>
                                                </tbody>
                                              </table>
                                            </figure>
                                          </li>
                                          <li>
                                            <p><code>node1</code></p>
                                            <figure class="highlight properties">
                                              <table>
                                                <tbody>
                                                  <tr>
                                                    <td class="gutter">
                                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                                    </td>
                                                    <td class="code">
                                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">run -d --net mq-net \</span></span><br><span class="line"><span class="string">-v ${PWD}/mq1/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf \</span></span><br><span class="line"><span class="string">-v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \</span></span><br><span class="line"><span class="string">-e RABBITMQ_DEFAULT_USER=root \</span></span><br><span class="line"><span class="string">-e RABBITMQ_DEFAULT_PASS=root \</span></span><br><span class="line"><span class="string">--name mq1 \</span></span><br><span class="line"><span class="string">--hostname mq1 \</span></span><br><span class="line"><span class="string">-p 8071:5672 \</span></span><br><span class="line"><span class="string">-p 8081:15672 \</span></span><br><span class="line"><span class="string">rabbitmq:3-management</span></span><br><span class="line"><span class="comment"># rabbitmq:3.8-management</span></span><br></pre>
                                                    </td>
                                                  </tr>
                                                </tbody>
                                              </table>
                                            </figure>
                                          </li>
                                          <li>
                                            <p><code>node2</code></p>
                                            <figure class="highlight properties">
                                              <table>
                                                <tbody>
                                                  <tr>
                                                    <td class="gutter">
                                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                                    </td>
                                                    <td class="code">
                                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">run -d --net mq-net \</span></span><br><span class="line"><span class="string">-v ${PWD}/mq2/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf \</span></span><br><span class="line"><span class="string">-v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \</span></span><br><span class="line"><span class="string">-e RABBITMQ_DEFAULT_USER=root \</span></span><br><span class="line"><span class="string">-e RABBITMQ_DEFAULT_PASS=root \</span></span><br><span class="line"><span class="string">--name mq2 \</span></span><br><span class="line"><span class="string">--hostname mq2 \</span></span><br><span class="line"><span class="string">-p 8072:5672 \</span></span><br><span class="line"><span class="string">-p 8082:15672 \</span></span><br><span class="line"><span class="string">rabbitmq:3-management</span></span><br><span class="line"><span class="comment"># rabbitmq:3.8-management</span></span><br></pre>
                                                    </td>
                                                  </tr>
                                                </tbody>
                                              </table>
                                            </figure>
                                          </li>
                                          <li>
                                            <p><code>node3</code></p>
                                            <figure class="highlight properties">
                                              <table>
                                                <tbody>
                                                  <tr>
                                                    <td class="gutter">
                                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                                    </td>
                                                    <td class="code">
                                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">run -d --net mq-net \</span></span><br><span class="line"><span class="string">-v ${PWD}/mq3/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf \</span></span><br><span class="line"><span class="string">-v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \</span></span><br><span class="line"><span class="string">-e RABBITMQ_DEFAULT_USER=root \</span></span><br><span class="line"><span class="string">-e RABBITMQ_DEFAULT_PASS=root \</span></span><br><span class="line"><span class="string">--name mq3 \</span></span><br><span class="line"><span class="string">--hostname mq3 \</span></span><br><span class="line"><span class="string">-p 8073:5672 \</span></span><br><span class="line"><span class="string">-p 8083:15672 \</span></span><br><span class="line"><span class="string">rabbitmq:3-management</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># rabbitmq:3.8-management</span></span><br></pre>
                                                    </td>
                                                  </tr>
                                                </tbody>
                                              </table>
                                            </figure>
                                          </li>
                                          <li>
                                            <p>测试</p>
                                            <ul>
                                              <li>
                                                <p>在<hanla></hanla><code>mq1</code>
                                                  <hanla></hanla>这个节点上添加一个队列
                                                </p>
                                                <table>
                                                  <thead>
                                                    <tr>
                                                      <th align="center">其他节点同时查看到</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                    <tr>
                                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/cb8367a1cfe8444a844313ef1deec7b3.png"></td>
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </li>
                                            </ul>
                                          </li>
                                        </ul>
                                      </li>
                                    </ul>
                                    <blockquote>
                                      <p>在刚刚的案例中，一旦创建队列的<code>主机宕机</code>，队列就会不可用。不具备高可用能力。如果要解决这个问题，必须使用官方提供的镜像集群方案。</p>
                                    </blockquote>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ol>
                      </li>
                      <li>
                        <p>镜像集群：本质是主从模式,<hanla></hanla>具备以下特征</p>
                        <ul>
                          <li>交换机、队列、队列中的消息会在各个<hanla></hanla><code>mq</code>
                            <hanla></hanla>的镜像节点之间同步备份
                          </li>
                          <li>创建队列的节点被称为该队列的<code>主节点</code>，备份到的其他节点叫做该队列的镜像节点</li>
                          <li>一个队列的主节点可能是从另一个队列的镜像节点</li>
                          <li>所有操作都是主节点完成，然后同步给镜像节点</li>
                        </ul>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">互相备份【推荐使用】</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/088f33a10a4646fd9be4bf449dc40a89.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>镜像模式的特征</p>
                            <p>默认情况下，队列只保存在创建该队列的节点上。而镜像模式下，创建队列的节点被称为该队列的<strong>主节点</strong>，队列还会拷贝到集群中的其它节点，也叫做该队列的<strong>镜像</strong>节点。</p>
                            <p>但是，不同队列可以在集群中的任意节点上创建，因此不同队列的主节点可以不同。甚至，<strong>一个队列的主节点可能是另一个队列的镜像节点</strong>。</p>
                            <p>用户发送给队列的一切请求，例如发送消息、消息回执默认都会在主节点完成，如果是从节点接收到请求，也会路由到主节点去完成。<strong>镜像节点仅仅起到备份数据作用</strong>。</p>
                            <p>当主节点接收到消费者的<hanla></hanla>ACK<hanla></hanla>时，所有镜像都会删除节点中的数据。</p>
                            <p>总结如下：</p>
                            <ul>
                              <li>镜像队列结构是一主多从（从就是镜像）</li>
                              <li>所有操作都是主节点完成，然后同步给镜像节点</li>
                              <li>主宕机后，镜像节点会替代成新的主（如果在主从同步完成前，主就已经宕机，可能出现数据丢失）</li>
                              <li>不具备负载均衡功能，因为所有操作都会有主节点完成（但是不同队列，其主节点可以不同，可以利用这个提高吞吐量）</li>
                            </ul>
                          </li>
                          <li>
                            <p>镜像模式的配置</p>
                            <blockquote>
                              <p>镜像模式的配置有<hanla></hanla>3<hanla></hanla>种模式</p>
                            </blockquote>
                            <table>
                              <thead>
                                <tr>
                                  <th align="left">ha-mode</th>
                                  <th align="left">ha-params</th>
                                  <th align="left">效果</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="left">准确模式<hanla></hanla>exactly</td>
                                  <td align="left">队列的副本量<hanla></hanla>count</td>
                                  <td align="left">集群中队列副本（主服务器和镜像服务器之和）的数量。count<hanla></hanla>如果为<hanla></hanla>1<hanla></hanla>意味着单个副本：即队列主节点。count<hanla></hanla>值为<hanla></hanla>2<hanla></hanla>表示<hanla></hanla>2<hanla></hanla>个副本：1<hanla></hanla>个队列主和<hanla></hanla>1<hanla></hanla>个队列镜像。换句话说：count = 镜像数量 + 1。如果群集中的节点数少于<hanla></hanla>count，则该队列将镜像到所有节点。如果有集群总数大于<hanla></hanla>count+1，并且包含镜像的节点出现故障，则将在另一个节点上创建一个新的镜像。</td>
                                </tr>
                                <tr>
                                  <td align="left">all【不推荐使用】</td>
                                  <td align="left">(none)</td>
                                  <td align="left">队列在群集中的所有节点之间进行镜像。队列将镜像到任何新加入的节点。镜像到所有节点将对所有群集节点施加额外的压力，包括网络<hanla></hanla>I / O，磁盘<hanla></hanla>I / O<hanla></hanla>和磁盘空间使用情况。推荐使用<hanla></hanla>exactly，设置副本数为（N / 2 +1）。</td>
                                </tr>
                                <tr>
                                  <td align="left">nodes</td>
                                  <td align="left"><em>node names</em></td>
                                  <td align="left">指定队列创建到哪些节点，如果指定的节点全部不存在，则会出现异常。如果指定的节点在集群中存在，但是暂时不可用，会创建节点到当前客户端连接到的节点。</td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p><code>exactly</code>
                              <hanla></hanla>模式配置
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_policy ha-two "^two\." '{"ha-mode":"exactly","ha-params":2,"ha-sync-mode":"automatic"}'</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li><code>rabbitmqctl set_policy</code>：固定写法</li>
                              <li><code>ha-two</code>：策略名称，自定义</li>
                              <li><code>"^two\."</code>：匹配队列的正则表达式，符合命名规则的队列才生效，这里是任何以<hanla></hanla><code>two.</code>
                                <hanla></hanla>开头的队列名称
                              </li>
                              <li><code>'{"ha-mode":"exactly","ha-params":2,"ha-sync-mode":"automatic"}'</code>: 策略内容<ul>
                                  <li><code>"ha-mode":"exactly"</code>：策略模式，此处是<hanla></hanla>exactly<hanla></hanla>模式，指定副本数量</li>
                                  <li><code>"ha-params":2</code>：策略参数，这里是<hanla></hanla>2，就是副本数量为<hanla></hanla>2，1<hanla></hanla>主<hanla></hanla>1<hanla></hanla>镜像</li>
                                  <li><code>"ha-sync-mode":"automatic"</code>：同步策略，默认是<hanla></hanla>manual，即新加入的镜像节点不会同步旧的消息。如果设置为<hanla></hanla>automatic，则新加入的镜像节点会把主节点中所有消息都同步，会带来额外的网络开销</li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p><code>all</code>
                              <hanla></hanla>模式配置
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_policy ha-all "^all\." '{"ha-mode":"all"}'</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li><code>ha-all</code>：策略名称，自定义</li>
                              <li><code>"^all\."</code>：匹配所有以<hanla></hanla><code>all.</code>
                                <hanla></hanla>开头的队列名
                              </li>
                              <li><code>'{"ha-mode":"all"}'</code>：策略内容<ul>
                                  <li><code>"ha-mode":"all"</code>：策略模式，此处是<hanla></hanla>all<hanla></hanla>模式，即所有节点都会称为镜像节点</li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p><code>nodes</code>
                              <hanla></hanla>模式配置
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_policy ha-nodes "^nodes\." '{"ha-mode":"nodes","ha-params":["rabbit@nodeA", "rabbit@nodeB"]}'</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li><code>rabbitmqctl set_policy</code>：固定写法</li>
                              <li><code>ha-nodes</code>：策略名称，自定义</li>
                              <li><code>"^nodes\."</code>：匹配队列的正则表达式，符合命名规则的队列才生效，这里是任何以<hanla></hanla><code>nodes.</code>
                                <hanla></hanla>开头的队列名称
                              </li>
                              <li><code>'{"ha-mode":"nodes","ha-params":["rabbit@nodeA", "rabbit@nodeB"]}'</code>: 策略内容<ul>
                                  <li><code>"ha-mode":"nodes"</code>：策略模式，此处是<hanla></hanla>nodes<hanla></hanla>模式</li>
                                  <li><code>"ha-params":["rabbit@mq1", "rabbit@mq2"]</code>：策略参数，这里指定副本所在节点名称</li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>配置精确模式<hanla></hanla><code>exactly</code></p>
                        <ul>
                          <li>
                            <p>是在之前的普通模式上配置的</p>
                          </li>
                          <li>
                            <p>进入<hanla></hanla><code>mq1【任意启动的】</code>容器内部执行</p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">exec -it mq1 rabbitmqctl set_policy ha-two "^two\." '{"ha-mode":"exactly","ha-params":2,"ha-sync-mode":"automatic"}'</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th>添加一个<hanla></hanla><code>two.test.queue</code>
                                    <hanla></hanla>队列
                                  </th>
                                  <th align="center">出现镜像节点</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3a221bb144814162ac4a0921bafb0df4.png"></td>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a177b937f97141f085485575ccd03b86.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>仲裁队列</p>
                        <blockquote>
                          <p>仲裁队列是<hanla></hanla><code>3.8</code>
                            <hanla></hanla>版本以后才有的新功能,<hanla></hanla>用来代替镜像队列,<hanla></hanla>具备以下特征
                          </p>
                        </blockquote>
                        <ul>
                          <li>
                            <p>与镜像队列一样，都是主从模式,<hanla></hanla>支持主从数据同步</p>
                          </li>
                          <li>
                            <p>使用非常简单,<hanla></hanla>没有复杂的配置</p>
                          </li>
                          <li>
                            <p>主从同步基于<hanla></hanla><code>Raft</code>
                              <hanla></hanla>协议,<hanla></hanla>强一致
                            </p>
                          </li>
                          <li>
                            <p>搭建</p>
                            <ul>
                              <li>
                                <p>在任意控制台添加一个队列，一定要选择队列类型为<hanla></hanla><code>Quorum</code>
                                  <hanla></hanla>类型。
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">添加队列</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/70f275c759974a349ccae71562ff6722.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <blockquote>
                                  <p>可以看到，仲裁队列的 <code>+ 2</code>
                                    <hanla></hanla>字样。代表这个队列有<hanla></hanla><code>2</code>
                                    <hanla></hanla>个镜像节点。
                                  </p>
                                  <p>因为仲裁队列<code>默认的镜像数为<hanla></hanla>5</code>。如果你的集群有<hanla></hanla><code>7</code>
                                    <hanla></hanla>个节点，那么镜像数肯定是<hanla></hanla><code>5</code>；而我们集群只有<hanla></hanla><code>3</code>
                                    <hanla></hanla>个节点，因此镜像数量就是<hanla></hanla><code>3</code>
                                  </p>
                                </blockquote>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">仲裁集群</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a4fb26be6d7341eba280b8ca5314c033.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p><code>SpringAMQP</code>
                                  <hanla></hanla>创建仲裁队列
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuorunQueueConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">quorumQueue</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder</span><br><span class="line">                .durable(<span class="string">"quorum.queue"</span>) <span class="comment">// 持久化</span></span><br><span class="line">                .quorum() <span class="comment">// 仲裁队列</span></span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p><code>yaml</code>
                                  <hanla></hanla>配置
                                </p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">addresses:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span><span class="string">:8071,192.168.2.3:8072,192.168.2.3:8073</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="mq-13">
                    <ul>
                      <li>
                        <p>扩容</p>
                        <ul>
                          <li>
                            <p>启动一个新的<hanla></hanla>MQ<hanla></hanla>容器</p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">run -d --net mq-net \</span></span><br><span class="line"><span class="string">    -v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \</span></span><br><span class="line"><span class="string">    -e RABBITMQ_DEFAULT_USER=itcast \</span></span><br><span class="line"><span class="string">    -e RABBITMQ_DEFAULT_PASS=123321 \</span></span><br><span class="line"><span class="string">    --name mq4 \</span></span><br><span class="line"><span class="string">    --hostname mq5 \</span></span><br><span class="line"><span class="string">    -p 8074:15672 \</span></span><br><span class="line"><span class="string">    -p 8084:15672 \</span></span><br><span class="line"><span class="string">    rabbitmq:3-management</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>进入容器控制台</p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">exec -it mq4 bash</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>停止<hanla></hanla><code>mq</code>
                              <hanla></hanla>进程
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">stop_app</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>重置<hanla></hanla><code>RabbitMQ</code>
                              <hanla></hanla>中的数据
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">reset</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>加入<hanla></hanla><code>mq1</code></p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">join_cluster rabbit@mq1</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>再次启动<hanla></hanla><code>mq</code>
                              <hanla></hanla>进程
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">start_app</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>增加仲裁队列副本</p>
                        <ul>
                          <li>
                            <p>我们先查看下<hanla></hanla><code>quorum.queue</code>
                              <hanla></hanla>这个队列目前的副本情况，进入<hanla></hanla><code>mq1</code>
                              <hanla></hanla>容器
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">exec -it mq1 bash</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rabbitmq-queues</span> <span class="string">quorum_status "quorum.queue"</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li>
                                <p>现在，我们让<hanla></hanla><code>mq4</code>
                                  <hanla></hanla>也加入进来
                                </p>
                                <figure class="highlight properties">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="attr">rabbitmq-queues</span> <span class="string">add_member "quorum.queue" "rabbit@mq4"</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
          <h5 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h5>
          <ul>
            <li>
              <p>详细使用</p>
              <div class="tabs" id="分布式搜索">
                <ul class="nav-tabs">
                  <li class="tab active"><button type="button" data-href="#分布式搜索-1">elasticsearch</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-2">
                      <hanla></hanla>安装
                    </button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-3">索引库操作</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-4">文档操作</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-5">索引库</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-6">文档库</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-7">分布式搜索</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-8">搜索结果处理<hanla></hanla></button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-9">RestClient<hanla></hanla>查询文档</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-10">案例</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-11">聚合<hanla></hanla></button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-12">ES<hanla></hanla>集群</button></li>
                  <li class="tab"><button type="button" data-href="#分布式搜索-13">故障转移</button></li>
                </ul>
                <div class="tab-contents">
                  <div class="tab-item-content active" id="分布式搜索-1">
                    <ul>
                      <li>
                        <p>倒排索引</p>
                        <ul>
                          <li>文档: 每条数据就是一个文档</li>
                          <li>词条: 文档按照语义分成的词语</li>
                        </ul>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">词条不能重复</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a146dea6c72c42c3aba022665b078c4c.png" alt="词条不能重复"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>搜索过程</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">搜索过程</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b6c8ac9b3520461a9a461d85cc2d96a4.png" alt="搜索过程"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>ES</code>
                          <hanla></hanla>的一些概念
                        </p>
                        <ul>
                          <li>
                            <p>什么是正向索引</p>
                            <blockquote>
                              <p>基于文档<hanla></hanla><code>id</code>
                                <hanla></hanla>创建索引,<hanla></hanla>查询词条时必须先找到文档,<hanla></hanla>而后判断是否是包含词条
                              </p>
                            </blockquote>
                          </li>
                          <li>
                            <p>什么是倒排索引</p>
                            <blockquote>
                              <p>对文档内容分词,<hanla></hanla>对词条创建索引,<hanla></hanla>并记录所在文档的信息,<hanla></hanla>查询时现根据词条查询到文档<hanla></hanla><code>id</code>,<hanla></hanla>而后获取到文档</p>
                            </blockquote>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>索引</p>
                        <blockquote>
                          <p>相同类型的文档的集合</p>
                          <p>索引的映射<hanla></hanla>(<code>mapping</code>):<hanla></hanla>索引章文档的字段约束信息,<hanla></hanla>类似表的结构约束</p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">索引</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/6889e790b21e429dba634d1386dd6361.png" alt="索引"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>概念对比</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>MYSQL</code></th>
                              <th align="center"><code>Elasticsearch</code></th>
                              <th align="center">说明</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><code>Table</code></td>
                              <td align="center"><code>Index</code></td>
                              <td align="center">索引<hanla></hanla><code>Index</code>,<hanla></hanla>就是文档集合,<hanla></hanla>类似数据库的表</td>
                            </tr>
                            <tr>
                              <td align="center"><code>Row</code></td>
                              <td align="center"><code>Document</code></td>
                              <td align="center">文档,<hanla></hanla>就是一条条数据，类似数据库中的行,<hanla></hanla>文档都是<hanla></hanla><code>JSON</code>
                                <hanla></hanla>格式
                              </td>
                            </tr>
                            <tr>
                              <td align="center"><code>Column</code></td>
                              <td align="center"><code>Field</code></td>
                              <td align="center">字段,<hanla></hanla>就是<hanla></hanla><code>JSON</code>
                                <hanla></hanla>文档中的字段,<hanla></hanla>类似数据库中的列
                              </td>
                            </tr>
                            <tr>
                              <td align="center"><code>Schema</code></td>
                              <td align="center"><code>Mapping</code></td>
                              <td align="center"><code>Mapping(映射)</code>
                                <hanla></hanla>是索引中文档的约束,<hanla></hanla>例如字段类型约束，类似数据库的表结构
                              </td>
                            </tr>
                            <tr>
                              <td align="center"><code>SQL</code></td>
                              <td align="center"><code>DSL</code></td>
                              <td align="center"><code>DSL</code>
                                <hanla></hanla>是<hanla></hanla><code>elasticsearch</code>
                                <hanla></hanla>提供的<hanla></hanla><code>JSON</code>
                                <hanla></hanla>风格的请求语句,<hanla></hanla>用来操作<hanla></hanla><code>elasticsearch</code>
                                <hanla></hanla>实现<hanla></hanla><code>CRUD</code>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>架构</p>
                        <blockquote>
                          <p><code>MYSQL</code>:<hanla></hanla>擅长事务类型操作,<hanla></hanla>可以确保数据的安全和一致性</p>
                          <p><code>Elasticsearch</code>：擅长海量数据的搜索、分析、计算</p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>MYSQL</code>
                                <hanla></hanla>与<hanla></hanla><code>Elasticsearch</code>
                                <hanla></hanla>互补
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/fdaf822d7d9f49f0bb30e259ee36a742.png" alt="MYSQL与Elasticsearch互补"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-2">
                    <ul>
                      <li>
                        <p>获取文件</p>
                        <blockquote>
                          <p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://pan.baidu.com/s/1gLwmrZFi3U5gX32eZaGaHw?pwd=1234">https://pan.baidu.com/s/1gLwmrZFi3U5gX32eZaGaHw?pwd=1234</a> </p>
                        </blockquote>
                      </li>
                      <li>
                        <p>离线安装文件说明</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">离线安装文件说明<hanla></hanla><code>ik<hanla></hanla>需要放在数据卷插件目录 _data/ 中</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f882198da35e44e4b506def934b69295.png" alt="离线安装文件说明"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>安装流程</p>
                        <ul>
                          <li>
                            <p>部署单点<hanla></hanla><code>ES</code></p>
                            <blockquote>
                              <p>因为我们还需要部署<hanla></hanla><code>kibana</code>
                                <hanla></hanla>容器，因此需要让<hanla></hanla><code>es</code>
                                <hanla></hanla>和<hanla></hanla><code>kibana</code>
                                <hanla></hanla>容器关联,<hanla></hanla>这里先创建一个网络
                              </p>
                            </blockquote>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">network create es-net</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>如果上传到虚拟机中,<hanla></hanla>之后运行命令加载即可<hanla></hanla>(<code>kibana</code>
                              <hanla></hanla>同样操作)
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">load -i es.tar</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>拉取镜像</p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># -v 也可以指定自己的绝对路径<hanla></hanla></span></span><br><span class="line"><span class="attr">docker</span> <span class="string">run -d \</span></span><br><span class="line"><span class="string">    --name es \</span></span><br><span class="line"><span class="string">    -e "ES_JAVA_OPTS=-Xms512m -Xmx512m"  \</span></span><br><span class="line"><span class="string">    -e "discovery.type=single-node" \</span></span><br><span class="line"><span class="string">    -v es-data:/usr/share/elasticsearch/data \</span></span><br><span class="line"><span class="string">    -v es-plugins:/usr/share/elasticsearch/plugins \</span></span><br><span class="line"><span class="string">    --privileged=true \</span></span><br><span class="line"><span class="string">    --network  es-net \</span></span><br><span class="line"><span class="string">    -p 9200:9200 \</span></span><br><span class="line"><span class="string">    -p 9300:9300 \</span></span><br><span class="line"><span class="string">    --restart=always \</span></span><br><span class="line"><span class="string">    elasticsearch:7.12.1</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">  # 9200 提供 http 使用</span></span><br><span class="line"><span class="comment">  # 9300 内部调用</span></span><br><span class="line"><span class="comment">  # 高配置</span></span><br><span class="line">  <span class="attr">docker</span> <span class="string">run -d \</span></span><br><span class="line"><span class="string">    --name es \</span></span><br><span class="line"><span class="string">    -e "ES_JAVA_OPTS=-Xms1g -Xmx1g"  \</span></span><br><span class="line"><span class="string">    -e "discovery.type=single-node" \</span></span><br><span class="line"><span class="string">    -v es-data:/usr/share/elasticsearch/data \</span></span><br><span class="line"><span class="string">    -v es-plugins:/usr/share/elasticsearch/plugins \</span></span><br><span class="line"><span class="string">    --privileged=true \</span></span><br><span class="line"><span class="string">    --network  es-net \</span></span><br><span class="line"><span class="string">    -p 9200:9200 \</span></span><br><span class="line"><span class="string">    -p 9300:9300 \</span></span><br><span class="line"><span class="string">    --restart=always \</span></span><br><span class="line"><span class="string">    elasticsearch:7.12.1</span></span><br><span class="line">    </span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li>
                                <p>查看数据卷位置</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center"><code> docker volume inspect es-plugins</code></th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/e2c8043dcc6f4826aeb831081a95cbbf.png" alt="查看数据卷位置"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p>访问测试</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">访问测试，出现如下<hanla></hanla><code>json</code>
                                        <hanla></hanla>则为正确安装
                                      </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0c8708461592493f949e3a67f972dac0.png" alt="访问测试"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>kibana</code>
                          <hanla></hanla>安装
                        </p>
                        <ul>
                          <li>
                            <p>安装启动</p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker</span> <span class="string">run -d \</span></span><br><span class="line"><span class="string">    --name kibana \</span></span><br><span class="line"><span class="string">    -e ELASTICSEARCH_HOSTS=http://es:9200 \</span></span><br><span class="line"><span class="string">    --network=es-net \</span></span><br><span class="line"><span class="string">    --privileged=true \</span></span><br><span class="line"><span class="string">    -p 5601:5601 \</span></span><br><span class="line"><span class="string">    --restart=always \</span></span><br><span class="line"><span class="string">    kibana:7.12.1</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li>
                                <p>访问测试</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">访问测试: <a target="_blank" rel="external nofollow noopener noreferrer" href="http://192.168.247.129:5601/app/dev_tools#/console">http://192.168.247.129:5601/app/dev_tools#/console</a>, 点击<hanla></hanla><code>Explore on my own</code></th>
                                      <th align="center"><code>Dev Tools</code></th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5f67872a5b0f457fbc20e77194d33594.png"></td>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ea8db4a8cc8f40cdb03531afc8e5c006.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p><code>Dev Tools</code></p>
                                <blockquote>
                                  <p>这个界面中可以编写<hanla></hanla><code>DSL</code>
                                    <hanla></hanla>来操作<hanla></hanla><code>elasticsearch</code>,<hanla></hanla>并且对<hanla></hanla><code>DSL</code>
                                    <hanla></hanla>语句有自动补全功能
                                  </p>
                                </blockquote>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center"><code>Dev Tools</code></th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5d954923bbd34115aa4dc292c3d20c59.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>ik</code>
                          <hanla></hanla>离线安装
                        </p>
                        <ul>
                          <li>
                            <p>上传文件到<hanla></hanla><code>es-plugins<hanla></hanla>数据卷的<hanla></hanla>_data</code>
                              <hanla></hanla>目录下
                            </p>
                            <blockquote>
                              <p>下载: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://ghproxy.com/https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip">https://ghproxy.com/https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip</a></p>
                            </blockquote>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 下载<hanla></hanla></span></span><br><span class="line"><span class="attr">wget</span> <span class="string">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 解压 zip 文件使用<hanla></hanla></span></span><br><span class="line"><span class="attr">yum</span> <span class="string">install -y unzip</span></span><br><span class="line"><span class="comment"># 解压到指定目录 -d 指定目录 </span></span><br><span class="line"><span class="attr">unzip</span>  <span class="string">elasticsearch-analysis-ik-7.12.1.zip -d ik</span></span><br><span class="line"><span class="comment"># 删除压缩包<hanla></hanla></span></span><br><span class="line"><span class="attr">rm</span> <span class="string">-rf elasticsearch-analysis-ik-7.12.1.zip </span></span><br><span class="line"><span class="comment"># 重启 es</span></span><br><span class="line"><span class="attr">docker</span> <span class="string">restart es</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 查看日志<hanla></hanla></span></span><br><span class="line"><span class="attr">docker</span> <span class="string">logs -f es</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">下载</th>
                                  <th align="center"><code>测试<hanla></hanla>ik</code></th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/09ece5c1a67e467ab0dbb78c61e0d427.png"></td>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/8aa1313fa33c4f9dbe1f439bf6a83470.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p><code>IK</code>
                              <hanla></hanla>分词器包含两种模式
                            </p>
                            <ul>
                              <li><code>ik_smart</code>:<hanla></hanla>最少切分</li>
                              <li><code>ik_max_word</code>:<hanla></hanla>最细切分</li>
                            </ul>
                          </li>
                          <li>
                            <p><code>IK</code>
                              <hanla></hanla>分词器-扩展词库
                            </p>
                            <blockquote>
                              <p>要扩展<hanla></hanla><code>ik</code>
                                <hanla></hanla>分词器的词库,<hanla></hanla>只需要修改一个<hanla></hanla><code>ik</code>
                                <hanla></hanla>分词器目录中的<hanla></hanla><code>config</code>
                                <hanla></hanla>目录中的<hanla></hanla><code>IKAnalyzer.cfg.xml</code>
                                <hanla></hanla>文件
                              </p>
                            </blockquote>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">properties</span> <span class="keyword">SYSTEM</span> <span class="string">"http://java.sun.com/dtd/properties.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer 扩展配置<hanla></hanla><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_dict"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_stopwords"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;entry key="remote_ext_dict"&gt;words_location&lt;/entry&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修改如下 --&gt;</span></span><br><span class="line"><span class="comment"><!--用户可以在这里配置自己的扩展字典  此 ext.dic 文件在 ikAnalyzer.cfg.xml<hanla></hanla>同级目录下<hanla></hanla>(不存在则手动创建) --></span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_dict"</span>&gt;</span>ext.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_stopwords"</span>&gt;</span>stopword.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修改后需要重启 es  --&gt;</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">使用</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b52f4cf6d9c4444598b2bf4825c46789.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>总结</p>
                        <ul>
                          <li>分词器的作用是什么<ul>
                              <li>创建倒排索引时对文档分词</li>
                              <li>用户搜索时,<hanla></hanla>对输入的内容分词</li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-3">
                    <ul>
                      <li>
                        <p><code>Mapping</code>
                          <hanla></hanla>是对索引库中文档的约束,<hanla></hanla>常见的<hanla></hanla><code>mapping</code>
                          <hanla></hanla>属性包括
                        </p>
                        <ul>
                          <li>
                            <p><code>type</code>
                              <hanla></hanla>字段数据类型,<hanla></hanla>常见的简单类型有
                            </p>
                            <ul>
                              <li>
                                <p>字符串<hanla></hanla><code>text(可分词文本),keyword(精确值，例如:ip<hanla></hanla>地址)</code></p>
                              </li>
                              <li>
                                <p>数值<hanla></hanla><code>long,Integer,short,byte,double,float</code></p>
                              </li>
                              <li>
                                <p>布尔：<code>boolean</code></p>
                              </li>
                              <li>
                                <p>日期<hanla></hanla><code>date</code></p>
                              </li>
                              <li>
                                <p>对象<hanla></hanla><code>object</code></p>
                                <figure class="highlight properties">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="attr">{</span></span><br><span class="line">    <span class="attr">"age"</span>: <span class="string">18, </span></span><br><span class="line">    <span class="attr">"weight"</span>: <span class="string">56.55, </span></span><br><span class="line">    <span class="attr">"isMarried"</span>: <span class="string">false, </span></span><br><span class="line">    <span class="attr">"email"</span>: <span class="string">"zy@qq.com", </span></span><br><span class="line">    <span class="attr">"score"</span>: <span class="string">[1,2,3], </span></span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"firstName"</span>: <span class="string">"coder", </span></span><br><span class="line">        <span class="attr">"lastName"</span>: <span class="string">"itl"</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p><code>index</code>:<hanla></hanla>是否创建索引,<hanla></hanla>默认为<hanla></hanla><code>true</code></p>
                          </li>
                          <li>
                            <p><code>analyzer</code>:<hanla></hanla>使用哪种分词器</p>
                          </li>
                          <li>
                            <p><code>properties</code>:<hanla></hanla>该字段的子字段</p>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>创建索引库</p>
                        <blockquote>
                          <p><code>ES</code>
                            <hanla></hanla>中通过<hanla></hanla><code>Restful</code>
                            <hanla></hanla>请求操作索引库,<hanla></hanla>文档,<hanla></hanla>请求内容用<hanla></hanla><code>DSL</code>
                            <hanla></hanla>语句来表示,<hanla></hanla>创建索引库和<hanla></hanla><code>mapping</code>
                            <hanla></hanla>的<hanla></hanla><code>DSL</code>
                            <hanla></hanla>语句如下
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">实例</th>
                              <th></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bc0c424cbdd844b8a7af1d1d4c9154e8.png" alt="实例"></td>
                              <td></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>查看索引库</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/<hanla></hanla>索引库名</span></span><br><span class="line"><span class="comment"># 示例<hanla></hanla></span></span><br><span class="line"><span class="attr">GET</span> <span class="string">/coderitl</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>删除索引库</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">DELETE</span> <span class="string">/<hanla></hanla>索引库名</span></span><br><span class="line"><span class="comment"># 示例<hanla></hanla></span></span><br><span class="line"><span class="attr">DELETE</span> <span class="string">/coderitl</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>修改索引库</p>
                        <blockquote>
                          <p><code>禁止修改</code></p>
                          <p>索引库和<hanla></hanla><code>mapping</code>
                            <hanla></hanla>一旦创建无法修改,<hanla></hanla>但是可以添加新的字段,
                          </p>
                        </blockquote>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">PUT</span> <span class="string">/<hanla></hanla>索引库名<hanla></hanla>/_mapping</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">    <span class="attr">"properties"</span>:<span class="string">{</span></span><br><span class="line">        <span class="attr">"新字段名"</span>:<span class="string">{</span></span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"integer"</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-4">
                    <ul>
                      <li>
                        <p>语法</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">POST</span> <span class="string">/<hanla></hanla>索引库名<hanla></hanla>/_doc/<hanla></hanla>文档<hanla></hanla>id</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">    <span class="attr">"字段<hanla></hanla>1"</span>: <span class="string">"值<hanla></hanla>1", </span></span><br><span class="line">    <span class="attr">"字段<hanla></hanla>2"</span>: <span class="string">"值<hanla></hanla>2", </span></span><br><span class="line">    <span class="attr">"字段<hanla></hanla>3"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"子属性<hanla></hanla>1"</span>: <span class="string">"值<hanla></hanla>3", </span></span><br><span class="line">        <span class="attr">"子属性<hanla></hanla>2"</span>: <span class="string">"值<hanla></hanla>4"</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>新增文档</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 新增文档 POST /coderitl/_doc/(固定格式)      1(id)</span></span><br><span class="line"><span class="attr">POST</span> <span class="string">/coderitl/_doc/1</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"info"</span>:<span class="string">"程序员",</span></span><br><span class="line">  <span class="attr">"email"</span>:<span class="string">"lx@qq.com",</span></span><br><span class="line">  <span class="attr">"name"</span>:<span class="string">{</span></span><br><span class="line">    <span class="attr">"firstName"</span>:<span class="string">"信",</span></span><br><span class="line">    <span class="attr">"lastName"</span>:<span class="string">"李"</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">新增文档</th>
                              <th align="center">数组类型<hanla></hanla>(非数组,<hanla></hanla>是多值添加)</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f228b66f98c84accba2c3fb0c3e5474a.png"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/72313a2b73644ef28e7c2fd2617e226a.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>查询文档</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/coderitl/_doc/1</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>删除文档</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">DELETE</span> <span class="string">/coderitl/_doc/1</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>修改文档</p>
                        <ul>
                          <li>
                            <p>全量修改:<code>
                                <hanla></hanla>会删除旧文档,<hanla></hanla>添加新文档
                              </code></p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">//</span> <span class="string">修改指的是: 全量修改<hanla></hanla>(所有字段)</span></span><br><span class="line"><span class="attr">PUT</span> <span class="string">/<hanla></hanla>索引库名<hanla></hanla>/_doc/<hanla></hanla>文档<hanla></hanla>id</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">    <span class="attr">"字段<hanla></hanla>1"</span>: <span class="string">"值<hanla></hanla>1",</span></span><br><span class="line">    <span class="attr">"字段<hanla></hanla>2"</span>: <span class="string">"值<hanla></hanla>2",</span></span><br><span class="line">    <span class="attr">//</span> <span class="string">...</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">全量修改时是所有的字段需要全部出现,<hanla></hanla>不修改的只需要不改动<code>全量: 会删除旧文档,<hanla></hanla>添加新文档</code></th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f4b5c630970d441aa64dad803167e50a.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>局部修改</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">局部修改</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c2addf54590747e1a92cce9aae1e56c1.png" alt="局部修改"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-5">
                    <ul>
                      <li>
                        <p><code>hotel</code></p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>hotel</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/094120c9d5424d9aa997ad18511331ca.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>对应<hanla></hanla><code>mapping</code></p>
                            <blockquote>
                              <p><code>mapping</code>
                                <hanla></hanla>要考虑的问题: <code>字段名,<hanla></hanla>数据类型,<hanla></hanla>是否参数搜索,<hanla></hanla>是否分词,<hanla></hanla>如果分词,<hanla></hanla>分词器是什么</code>
                              </p>
                            </blockquote>
                          </li>
                          <li>
                            <p><code>ES</code>
                              <hanla></hanla>中支持两种地理坐标数据类型
                            </p>
                            <ul>
                              <li><code>geo_point</code>:<hanla></hanla>由纬度<hanla></hanla><code>latitude</code>
                                <hanla></hanla>和经度<hanla></hanla><code>longitude</code>
                                <hanla></hanla>确定的一个点<hanla></hanla><code>32.64832,475.48432432</code>
                              </li>
                              <li><code>geo_shape</code>:<hanla></hanla>有多个<hanla></hanla><code>geo_point</code>
                                <hanla></hanla>组成的复杂几何图形,<hanla></hanla>例如一条直线
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>字段拷贝</p>
                            <blockquote>
                              <p>字段拷贝可以使用<hanla></hanla><code>copy_to</code>
                                <hanla></hanla>属性将当前字段拷贝到指定字段
                              </p>
                            </blockquote>
                            <figure class="highlight json">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">"all"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"text"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"analyzer"</span><span class="punctuation">:</span><span class="string">"ik_max_word"</span></span><br><span class="line"><span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"brand"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">     <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"keyword"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"copy_to"</span><span class="punctuation">:</span><span class="string">"all"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p><code>DSL</code>
                              <hanla></hanla>创建索引库
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">PUT</span> <span class="string">/hotel</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"mappings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"properties"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text",</span></span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"ik_max_word",</span></span><br><span class="line">        <span class="attr">"copy_to"</span>: <span class="string">"all"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"address"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"index"</span>: <span class="string">false</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"price"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"integer"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"score"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"integer"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"brand"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"copy_to"</span>: <span class="string">"all"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"city"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"startName"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"business"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"copy_to"</span>: <span class="string">"all"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"location"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"geo_point"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"pic"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"index"</span>: <span class="string">false</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"all"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text",</span></span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>批量查询</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>什么是<hanla></hanla><code>RestClient</code></p>
                        <blockquote>
                          <p><code>ES</code>
                            <hanla></hanla>官方提供了各种不同语言的客户端,<hanla></hanla>用来操作<hanla></hanla><code>ES</code>，这些客户端的本质就是组装<hanla></hanla><code>DSL</code>
                            <hanla></hanla>语句,<hanla></hanla>通过<hanla></hanla><code>http</code>
                            <hanla></hanla>请求发送给<hanla></hanla><code>ES</code>
                          </p>
                        </blockquote>
                      </li>
                      <li>
                        <p><code>RestClient</code>
                          <hanla></hanla>操作索引库
                        </p>
                        <ol>
                          <li>
                            <p>引入<hanla></hanla><code>es</code>
                              <hanla></hanla>的<hanla></hanla><code>RestHighLevelClient</code>
                              <hanla></hanla>依赖
                            </p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>因为<hanla></hanla><code>SpringBoot</code>
                              <hanla></hanla>默认的<hanla></hanla><code>ES</code>
                              <hanla></hanla>版本是<hanla></hanla><code>7.6.2</code>，所以需要覆盖默认的<hanla></hanla><code>ES</code>
                              <hanla></hanla>版本与安装的客户端一致
                            </p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.12.1<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>在测试类中初始化<hanla></hanla><code>RestHighClient</code></p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HotelIndexTest</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="comment">// 1.<hanla></hanla>准备<hanla></hanla>Request      PUT /hotel</span></span><br><span class="line">        <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">        <span class="comment">// 2.<hanla></hanla>准备请求参数</span></span><br><span class="line">        request.source(MAPPING_TEMPLATE, XContentType.JSON);</span><br><span class="line">        <span class="comment">// 3.<hanla></hanla>发送请求</span></span><br><span class="line">        client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testExistsIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="comment">// 1.<hanla></hanla>准备<hanla></hanla>Request</span></span><br><span class="line">        <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">        <span class="comment">// 3.<hanla></hanla>发送请求</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isExists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        System.out.println(isExists ? <span class="string">"存在"</span> : <span class="string">"不存在"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="comment">// 1.<hanla></hanla>准备<hanla></hanla>Request</span></span><br><span class="line">        <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">        <span class="comment">// 3.<hanla></hanla>发送请求</span></span><br><span class="line">        client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> {</span><br><span class="line">        client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">"http://192.168.150.101:9200"</span>)</span><br><span class="line">        ));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        client.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">// MAPPING_TEMPLATE</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelIndexConstants</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MAPPING_TEMPLATE</span> <span class="operator">=</span> <span class="string">"{\n"</span> +</span><br><span class="line">            <span class="string">"  \"mappings\": {\n"</span> +</span><br><span class="line">            <span class="string">"    \"properties\": {\n"</span> +</span><br><span class="line">            <span class="string">"      \"id\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"keyword\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"name\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"text\",\n"</span> +</span><br><span class="line">            <span class="string">"        \"analyzer\": \"ik_max_word\",\n"</span> +</span><br><span class="line">            <span class="string">"        \"copy_to\": \"all\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"address\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"keyword\",\n"</span> +</span><br><span class="line">            <span class="string">"        \"index\": false\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"price\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"integer\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"score\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"integer\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"brand\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"keyword\",\n"</span> +</span><br><span class="line">            <span class="string">"        \"copy_to\": \"all\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"city\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"keyword\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"starName\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"keyword\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"business\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"keyword\",\n"</span> +</span><br><span class="line">            <span class="string">"        \"copy_to\": \"all\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"pic\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"keyword\",\n"</span> +</span><br><span class="line">            <span class="string">"        \"index\": false\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"location\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"geo_point\"\n"</span> +</span><br><span class="line">            <span class="string">"      },\n"</span> +</span><br><span class="line">            <span class="string">"      \"all\": {\n"</span> +</span><br><span class="line">            <span class="string">"        \"type\": \"text\",\n"</span> +</span><br><span class="line">            <span class="string">"        \"analyzer\": \"ik_max_word\"\n"</span> +</span><br><span class="line">            <span class="string">"      }\n"</span> +</span><br><span class="line">            <span class="string">"    }\n"</span> +</span><br><span class="line">            <span class="string">"  }\n"</span> +</span><br><span class="line">            <span class="string">"}"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>操作索引库</p>
                            <ul>
                              <li>
                                <p>创建索引库</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">创建索引库</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/9eb263b0ae8d4357bfed321ec40cf2d6.png" alt="分析"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p>删除索引库</p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 删除索引库<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>判断索引库是否存在</p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 判断索引库是否存在<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">isExistsIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(<span class="string">"exists = "</span> + exists);</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ul>
                          </li>
                        </ol>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-6">
                    <ul>
                      <li>
                        <p>新增文档</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">新增文档</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/456486442f874292b29f67fc7d3b6ca4.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="keyword">package</span> com.coderitl.es.hotel;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDocument</span> {</span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HotelService hotelService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="comment">// 根据 id 查询酒店数据</span></span><br><span class="line">        <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> hotelService.getById(<span class="number">61083L</span>);</span><br><span class="line">        <span class="comment">// 转换为文档类型</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. request</span></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">"hotel"</span>).id(hotel.getId().toString());</span><br><span class="line">        <span class="comment">// 2. 准备 json(JackSon 序列化)</span></span><br><span class="line">        request.source(JSON.toJSONString(hotelDoc), XContentType.JSON);</span><br><span class="line">        <span class="comment">// 3. 发送请求</span></span><br><span class="line">        client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">this</span>.client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                <span class="comment">// 集群使用逗号分隔 =&gt; HttpHost.create</span></span><br><span class="line">                HttpHost.create(<span class="string">"http://192.168.247.129:9200"</span>)</span><br><span class="line">        ));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="built_in">this</span>.client.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 根据文档创建的实体类<hanla></hanla></span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDoc</span> {</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> String business;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line">	</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HotelDoc</span><span class="params">(Hotel hotel)</span> {</span><br><span class="line">        <span class="built_in">this</span>.id = hotel.getId();</span><br><span class="line">        <span class="built_in">this</span>.name = hotel.getName();</span><br><span class="line">        <span class="built_in">this</span>.address = hotel.getAddress();</span><br><span class="line">        <span class="built_in">this</span>.price = hotel.getPrice();</span><br><span class="line">        <span class="built_in">this</span>.score = hotel.getScore();</span><br><span class="line">        <span class="built_in">this</span>.brand = hotel.getBrand();</span><br><span class="line">        <span class="built_in">this</span>.city = hotel.getCity();</span><br><span class="line">        <span class="built_in">this</span>.starName = hotel.getStarName();</span><br><span class="line">        <span class="built_in">this</span>.business = hotel.getBusiness();</span><br><span class="line">        <span class="comment">// 转换为文档类型</span></span><br><span class="line">        <span class="built_in">this</span>.location = hotel.getLatitude() + <span class="string">", "</span> + hotel.getLongitude();</span><br><span class="line">        <span class="built_in">this</span>.pic = hotel.getPic();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>查询文档</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">查询文档</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/29a4c7dbfd3a496a92bdcf7c4bf4ade6.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 查询文档库<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 数据库对象</span></span><br><span class="line">    <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> hotelService.getById(ID_INFO);</span><br><span class="line">    <span class="comment">// 将数据库对象转换为 hotelDoc</span></span><br><span class="line">    <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">    <span class="comment">// 1. 创建 request  对象</span></span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">"hotel"</span>, ID_INFO.toString());</span><br><span class="line">    <span class="comment">// 2. 发送请求 得到结果</span></span><br><span class="line">    <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3. 解析结果</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> response.getSourceAsString();</span><br><span class="line">    <span class="comment">// JSON 反序列化</span></span><br><span class="line">    <span class="type">HotelDoc</span> <span class="variable">jsonHotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">    System.out.println(jsonHotelDoc);</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>更新文档</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">更新文档</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b149e4e6c435481fadf149745dbfe476.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 更新文档库: 局部更新<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateLocalDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">UpdateRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">"hotel"</span>, ID_INFO.toString());</span><br><span class="line">    <span class="comment">// 2. 准备请求参数<hanla></hanla>(更新的字段)</span></span><br><span class="line">    request.doc(</span><br><span class="line">        <span class="string">"price"</span>, <span class="string">"100000"</span>, <span class="comment">// 第一个键值对</span></span><br><span class="line">        <span class="string">"starName"</span>, <span class="string">"六钻"</span> <span class="comment">// 第二个键值对 以逗号分割键值对</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 3. 发送请求</span></span><br><span class="line">    client.update(request, RequestOptions.DEFAULT);</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>删除文档库</p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">"hotel"</span>, ID_INFO.toString());</span><br><span class="line">    client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>利用<hanla></hanla><code>JavaRestClient</code>
                          <hanla></hanla>批量导入酒店数据到<hanla></hanla><code>ES</code>
                        </p>
                        <ul>
                          <li>
                            <p>需求: 批量查询酒店数据,<hanla></hanla>然后导入到索引库</p>
                          </li>
                          <li>
                            <p>思路</p>
                            <ol>
                              <li>
                                <p>利用<hanla></hanla><code>mybatis-plus</code>
                                  <hanla></hanla>查询酒店数据
                                </p>
                              </li>
                              <li>
                                <p>将查询到的数据转换为文档类型数据</p>
                              </li>
                              <li>
                                <p>利用<hanla></hanla><code>JavaRestClient</code>
                                  <hanla></hanla>中的<hanla></hanla><code>Bulk</code>
                                  <hanla></hanla>批处理,<hanla></hanla>实现批量新增文档
                                </p>
                                <figure class="highlight java">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment">// 批量加入索引库<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBulkDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 批量查询</span></span><br><span class="line">    List&lt;Hotel&gt; hotelList = hotelService.list();</span><br><span class="line">    <span class="comment">// 创建 request</span></span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    <span class="comment">// 准备参数,<hanla></hanla>添加多个新增的 Request</span></span><br><span class="line">    <span class="keyword">for</span> (Hotel hotel : hotelList) {</span><br><span class="line">        <span class="comment">// 转换为 hotelDoc</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">        <span class="comment">// 创建新增文档的 Request<hanla></hanla>对象</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">"hotel"</span>)</span><br><span class="line">                    .id(hotelDoc.getId().toString())</span><br><span class="line">                    .source(JSON.toJSONString(hotelDoc), XContentType.JSON)</span><br><span class="line">                   );</span><br><span class="line">    }</span><br><span class="line">    client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ol>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-7">
                    <ul>
                      <li>
                        <p><code>DSL Query</code>
                          <hanla></hanla>分类
                        </p>
                        <ul>
                          <li>
                            <p>查询所有: 查询出所有数据,<hanla></hanla>一般测试用,<code>Eg: match_all</code></p>
                          </li>
                          <li>
                            <p>全文检索<hanla></hanla>(<code>full text</code>)<hanla></hanla>查询: 利用分词器对用户输入内容分词,<hanla></hanla>然后去倒排索引库中匹配</p>
                            <ul>
                              <li>
                                <p><code>match_query</code></p>
                              </li>
                              <li>
                                <p><code>multi_match_query</code></p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center"><code>match_all</code></th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/222f30568fd742cdbb49fbaa53b61b20.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <figure class="highlight properties">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># 查询所有<hanla></hanla></span></span><br><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"match_all"</span>: <span class="string">{}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <ul>
                                  <li>
                                    <p>全文检索</p>
                                    <ul>
                                      <li>
                                        <p><code>match</code>
                                          <hanla></hanla>查询: 全文检索查询的一种,<hanla></hanla>会对用户输入内容分词,<hanla></hanla>然后去倒排索引库检索
                                        </p>
                                        <figure class="highlight properties">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="comment"># 语法<hanla></hanla></span></span><br><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"match"</span>: <span class="string">{</span></span><br><span class="line"><span class="comment">    # 查询字段类型为 text 类型的</span></span><br><span class="line">      <span class="attr">"FIELD"</span>: <span class="string">"TEXT"</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 示例<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"match"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"all"</span>: <span class="string">"如家"</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p><code>mullti_match</code>:<hanla></hanla>与<hanla></hanla><code>match</code>
                                          <hanla></hanla>查询类似,<hanla></hanla>只不过允许同时查询多个字段
                                        </p>
                                        <figure class="highlight properties">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"multi_match"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"query"</span>: <span class="string">"外滩",</span></span><br><span class="line">      <span class="attr">"fields"</span>: <span class="string">["brand","name"]</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>精确查询: 根据精确词条值查询数据,<hanla></hanla>一般是查找<hanla></hanla><code>keyword、数值、日期、boolean</code>
                              <hanla></hanla>等类型字段,<code>
                                <hanla></hanla>不会
                              </code>对所有条件分词
                            </p>
                            <ul>
                              <li>
                                <p><code>ids</code>: 根据<hanla></hanla><code>id</code>
                                  <hanla></hanla>精确匹配
                                </p>
                              </li>
                              <li>
                                <p><code>range</code>:<hanla></hanla>根据值的范围查询</p>
                                <figure class="highlight properties">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"range"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"price"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"gte"</span>: <span class="string">2000,</span></span><br><span class="line">        <span class="attr">"lte"</span>: <span class="string">10000</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p><code>term</code>
                                  <hanla></hanla>根据词条<code>精确值</code>查询
                                </p>
                                <figure class="highlight properties">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"term"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"city"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"value"</span>: <span class="string">"上海" # 精确内容</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>地理<hanla></hanla>(<code>geo</code>)<hanla></hanla>查询:<hanla></hanla>根据经纬度查询</p>
                            <ul>
                              <li>
                                <p><code>geo_distance</code>：查询到指定中心点小于某个距离值的所有文档<hanla></hanla>(<code>附近功能</code>)</p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"geo_distance":</span> {</span><br><span class="line">      <span class="string">"distance"</span><span class="string">:"2km"</span>,</span><br><span class="line">      <span class="string">"location"</span><span class="string">:"31.21</span>,<span class="number">121.5</span><span class="string">"</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center"><code>geo_distance</code></th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3aa866664592437288a9e9d17992386f.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p><code>geo_bounding_box</code>:<hanla></hanla>查询<hanla></hanla><code>geo_point</code>
                                  <hanla></hanla>值落在某个矩形范围的所有文档
                                </p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"geo_bounding_box":</span> {</span><br><span class="line">      <span class="attr">"location":</span> {</span><br><span class="line">        <span class="attr">"top_left":</span> {</span><br><span class="line">          <span class="string">"lat"</span><span class="string">:"31.1"</span>,</span><br><span class="line">          <span class="string">"lon"</span><span class="string">:"121.5"</span></span><br><span class="line">        },</span><br><span class="line">        <span class="attr">"bottom_right":</span> {</span><br><span class="line">          <span class="string">"lat"</span><span class="string">:"30.9"</span>,</span><br><span class="line">          <span class="string">"lon"</span><span class="string">:"121.7"</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    </span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">矩形内的点就是结果</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/8874beda6cd7434dba4b2a3c98f21df6.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>复合<hanla></hanla>(<code>compound</code>)<hanla></hanla>查询:<hanla></hanla>复合查询可以将上述查询条件组合起来,<hanla></hanla>合并查询条件</p>
                            <ul>
                              <li>
                                <p><code>bool</code></p>
                                <ul>
                                  <li><code>must</code>:<hanla></hanla>必须匹配每个子查询,<hanla></hanla>类似<code>与</code></li>
                                  <li><code>should</code>:<hanla></hanla>选择性匹配子查询,<hanla></hanla>类似<code>或</code></li>
                                  <li><code>must_not</code>：必须不匹配,<hanla></hanla>不参与算分,<hanla></hanla>类似<code>非</code></li>
                                  <li><code>filter</code>:<code>
                                      <hanla></hanla>必须匹配
                                    </code>,<hanla></hanla>不参与算分</li>
                                </ul>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># bool 基本使用<hanla></hanla></span></span><br><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"bool":</span> {</span><br><span class="line">      <span class="attr">"must":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"term":</span> {</span><br><span class="line">            <span class="attr">"city":</span> {</span><br><span class="line">              <span class="attr">"value":</span> <span class="string">"上海"</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"should":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"term":</span> {</span><br><span class="line">            <span class="attr">"brand":</span> {</span><br><span class="line">              <span class="attr">"value":</span> <span class="string">"华美达"</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"must_not":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"range":</span> {</span><br><span class="line">            <span class="attr">"price":</span> {</span><br><span class="line">              <span class="attr">"lte":</span> <span class="number">500</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"filter":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"range":</span> {</span><br><span class="line">            <span class="attr">"score":</span> {</span><br><span class="line">              <span class="attr">"gte":</span> <span class="number">45</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p><code>function_score</code>:<hanla></hanla>算分函数查询,<hanla></hanla>可以控制文档相关性算分,<hanla></hanla>控制文档排名,<hanla></hanla>例如<code>百度竞价</code></p>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>相关性打分算法</p>
                            <ul>
                              <li>
                                <p><code>TF-IDF</code>:<hanla></hanla>在<hanla></hanla><code>elasticsearch5.0</code>
                                  <hanla></hanla>之前,<hanla></hanla>会随着词频增加而越来越大
                                </p>
                              </li>
                              <li>
                                <p><code>BM25</code>:<hanla></hanla>在<hanla></hanla><code>elasticsearch5.0</code>
                                  <hanla></hanla>之后,<hanla></hanla>会随着词频增加而增大,<hanla></hanla>但增长曲线会趋于水平
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">打分算法</th>
                                      <th align="center"><code>BM25</code>
                                        <hanla></hanla>平滑（默认使用）
                                      </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/eb62e11b8ee54b33b8c3f527aa51148d.png" alt="打分算法"></td>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/662edd82535a48dbab42ec3f0908ed1b.png" alt="BM25"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">影响打分算法</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/fbe9e90967234b61999849d8cf00e52e.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p>案例</p>
                                <blockquote>
                                  <p>给<code>如家</code>这个品牌的酒店排名靠前一些</p>
                                </blockquote>
                                <ul>
                                  <li>
                                    <p><code>function_score</code>
                                      <hanla></hanla>需要的三要素
                                    </p>
                                    <ol>
                                      <li>
                                        <p>那些文档需要算分加权<hanla></hanla><code>=&gt; 品牌为如家的酒店</code></p>
                                      </li>
                                      <li>
                                        <p>算分函数是什么<code> =&gt; weight<hanla></hanla>就可以</code></p>
                                      </li>
                                      <li>
                                        <p>加权模式是什么<hanla></hanla><code>=&gt;<hanla></hanla>求和</code></p>
                                        <figure class="highlight yml">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"function_score":</span> {</span><br><span class="line">      <span class="attr">"query":</span> {</span><br><span class="line">        <span class="attr">"match":</span> {</span><br><span class="line">          <span class="attr">"all":</span> <span class="string">"外滩"</span></span><br><span class="line">        }</span><br><span class="line">      },</span><br><span class="line">      <span class="attr">"functions":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"filter":</span> {</span><br><span class="line">            <span class="attr">"term":</span> {</span><br><span class="line">              <span class="attr">"brand":</span> <span class="string">"如家"</span></span><br><span class="line">            }</span><br><span class="line">          },</span><br><span class="line">          <span class="attr">"weight":</span> <span class="number">10</span></span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"boost_mode":</span> <span class="string">"sum"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                    </ol>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>需求：搜索名字包含<code>如家</code>,<hanla></hanla>价格不高于<hanla></hanla><code>400</code>，在坐标<hanla></hanla><code>31.21,121,5</code>
                          <hanla></hanla>周围<hanla></hanla><code>10km</code>
                          <hanla></hanla>范围内的酒店
                        </p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"bool":</span> {</span><br><span class="line">      <span class="attr">"must":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"match":</span> {</span><br><span class="line">            <span class="attr">"name":</span> <span class="string">"如家"</span></span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"must_not":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"range":</span> {</span><br><span class="line">            <span class="attr">"price":</span> {</span><br><span class="line">              <span class="attr">"gte":</span> <span class="number">400</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"filter":</span> [</span><br><span class="line">        {</span><br><span class="line">          <span class="attr">"geo_distance":</span> {</span><br><span class="line">            <span class="attr">"distance":</span> <span class="string">"10km"</span>,</span><br><span class="line">            <span class="attr">"location":</span> {</span><br><span class="line">              <span class="attr">"lat":</span> <span class="number">31.21</span>,</span><br><span class="line">              <span class="attr">"lon":</span> <span class="number">121.5</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-8">
                    <blockquote>
                      <p><code>elasticsearch</code>
                        <hanla></hanla>支持对搜索<code>结果排序</code>,<hanla></hanla>默认是根据相关度算分<hanla></hanla><code>_score</code>
                        <hanla></hanla>来排序,<hanla></hanla>可以排序的字段类型有<hanla></hanla><code>keyword、数值、地理坐标、日期类型等</code>
                      </p>
                    </blockquote>
                    <ul>
                      <li>
                        <p>语法</p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"match_all":</span> {}</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"sort":</span> [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"FIELD":</span> {</span><br><span class="line">        <span class="attr">"order":</span> <span class="string">"desc"</span> <span class="string">//</span> <span class="string">排序字段和排序方式:</span> <span class="string">ASC</span>,<span class="string">DESC</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">地理坐标<hanla></hanla></span></span><br><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"match_all":</span> {}</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"sort":</span> [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"_geo_distance":</span> {</span><br><span class="line">        <span class="attr">"FIELD":</span> <span class="string">"纬度,<hanla></hanla>经度"</span>,</span><br><span class="line">        <span class="attr">"order":</span> <span class="string">"asc"</span>,</span><br><span class="line">        <span class="attr">"unit":</span> <span class="string">"km"</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>案例</p>
                        <blockquote>
                          <p>对酒店数据按照用户评价降序排序,<hanla></hanla>评价相同的按照价格升序排序</p>
                          <p>评价是<hanla></hanla><code>score</code>
                            <hanla></hanla>字段,<hanla></hanla>价格是<hanla></hanla><code>price</code>
                            <hanla></hanla>字段,<hanla></hanla>按照顺序添加两个排序规则
                          </p>
                        </blockquote>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"match_all":</span> {}</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"sort":</span> [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"score":</span> {</span><br><span class="line">        <span class="attr">"order":</span> <span class="string">"desc"</span></span><br><span class="line">      },</span><br><span class="line">      <span class="attr">"price":</span> <span class="string">"asc"</span> <span class="string">//</span> <span class="string">简写形式</span></span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>案例</p>
                        <blockquote>
                          <p>实现对酒店数据按照到你的位置坐标的距离升序排序</p>
                        </blockquote>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"match_all":</span> {}</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"sort":</span> [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"_geo_distance":</span> {</span><br><span class="line">        <span class="attr">"location":</span> <span class="string">"21,13"</span>, <span class="string">//</span> <span class="string">简写形式</span></span><br><span class="line">        <span class="attr">"order":</span> <span class="string">"asc"</span>,</span><br><span class="line">        <span class="attr">"unit":</span> <span class="string">"km"</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>结果分页</p>
                        <blockquote>
                          <p><code>elasticsearch</code>
                            <hanla></hanla>默认情况下只返回<hanla></hanla><code>top10</code>
                            <hanla></hanla>的数据,<hanla></hanla>而如果要查询更多的数据就需要修改分页参数了
                          </p>
                          <p><code>elasticsearch</code>
                            <hanla></hanla>中通过修改<hanla></hanla><code>from、size</code>
                            <hanla></hanla>参数来控制要返回的分页结果
                          </p>
                        </blockquote>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"match_all":</span> {}</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"from":</span> <span class="number">100</span>, <span class="string">//</span> <span class="string">分页开始的位置</span>,<span class="string"><hanla></hanla>默认为</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">"size":</span> <span class="number">1</span>, <span class="string">//</span> <span class="string">期望获取的文档总数</span></span><br><span class="line">  <span class="attr">"sort":</span> [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"price":</span> {</span><br><span class="line">        <span class="attr">"order":</span> <span class="string">"asc"</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">(深度分页)<hanla></hanla>这种分页方式不利于集群,(因为获取了 <code>from:100,zise:1 =&gt;<hanla></hanla>总共获取了<hanla></hanla>101<hanla></hanla>条数据,<hanla></hanla>截取了 1 条数据</code> )</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/af31e6b16332463c87dc79866e893cdb.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>深度分页带来的问题</p>
                        <ol>
                          <li>
                            <p>首先在每个数据分片上都排序并查询前<hanla></hanla><code>1000</code>
                              <hanla></hanla>条文档
                            </p>
                          </li>
                          <li>
                            <p>然后将所有节点的结果聚合,<hanla></hanla>在内存中重新排序选出前<hanla></hanla><code>1000</code>
                              <hanla></hanla>条文档
                            </p>
                          </li>
                          <li>
                            <p>最后从这<hanla></hanla><code>1000</code>
                              <hanla></hanla>条中,<hanla></hanla>选取从<hanla></hanla><code>990</code>
                              <hanla></hanla>开始的<hanla></hanla><code>10</code>
                              <hanla></hanla>条文档
                            </p>
                            <blockquote>
                              <p>如果搜索页过深,<hanla></hanla>或者结果集<hanla></hanla><code>from+size</code>
                                <hanla></hanla>越大,<hanla></hanla>对内存和<hanla></hanla><code>CPU</code>
                                <hanla></hanla>的消耗也越高,<hanla></hanla>因此<hanla></hanla><code>ES</code>
                                <hanla></hanla>设定结果集查询的上限是<hanla></hanla><code>10000</code>
                              </p>
                            </blockquote>
                          </li>
                        </ol>
                      </li>
                      <li>
                        <p>深度分页解决方案</p>
                        <ul>
                          <li><code>search after</code>:<hanla></hanla>分页时需要排序,<hanla></hanla>原理是从上一次的排序值开始,<hanla></hanla>查询下一页数据<code>官方推荐</code></li>
                          <li><code>scroll</code>：原理将排序数据形成的快照,<hanla></hanla>保存在内存<code>官方已经不推荐</code></li>
                        </ul>
                      </li>
                      <li>
                        <p>总结</p>
                        <ul>
                          <li><code>from+size</code>
                            <ul>
                              <li>优点: 支持随机翻页</li>
                              <li>缺点: 深度分页问题,<hanla></hanla>默认查询上限是<hanla></hanla><code>10000</code></li>
                              <li>场景: 百度、京东、谷歌、淘宝这样的随机翻页搜索</li>
                            </ul>
                          </li>
                          <li><code>after search</code>
                            <ul>
                              <li>优点: 没有查询上限<hanla></hanla>(单次查询的<hanla></hanla><code>size</code>
                                <hanla></hanla>不超过<hanla></hanla><code>10000</code>)
                              </li>
                              <li>缺点: 只能向后逐页查询,<hanla></hanla>不支持随机翻页</li>
                              <li>场景: 没有随即翻页需求的搜索，例如手机向下滚动翻页</li>
                            </ul>
                          </li>
                          <li><code>scroll</code>
                            <ul>
                              <li>优点: 没有查询上限<hanla></hanla>(单次查询的<hanla></hanla><code>size</code>
                                <hanla></hanla>不超过<hanla></hanla><code>10000</code>)
                              </li>
                              <li>缺点: 会有额外内存消耗,<hanla></hanla>并且搜索结果是<code>非实时的</code></li>
                              <li>场景: 海量数据的获取和转义,<hanla></hanla>从<hanla></hanla><code>ES7.1</code>
                                <hanla></hanla>开始不推荐使用,<hanla></hanla>建议使用<hanla></hanla><code>after search</code>
                                <hanla></hanla>方案
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>结果高亮</p>
                        <blockquote>
                          <p>高亮:<hanla></hanla>就是在搜索结果中把搜索关键字突出显示</p>
                        </blockquote>
                        <ul>
                          <li>
                            <p>原理</p>
                            <ul>
                              <li>将搜索结果中的关键字用标签标记出来</li>
                              <li>在页面中给标签添加<hanla></hanla><code>css</code>
                                <hanla></hanla>样式
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>语法</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"query":</span> {</span><br><span class="line">    <span class="attr">"match":</span> {</span><br><span class="line">      <span class="attr">"FIELD":</span> <span class="string">"TEXT"</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"highlight":</span> {</span><br><span class="line">    <span class="attr">"fields":</span> { <span class="string">//</span> <span class="string">指定要高亮的字段</span></span><br><span class="line">      <span class="string">"FIELD"</span>{</span><br><span class="line">        <span class="string">"pre_tags"</span><span class="string">:"&lt;em&gt;"</span>, <span class="string">//</span> <span class="string">用来标记高亮字段的前置标签</span></span><br><span class="line">        <span class="string">"post_tags"</span><span class="string">:"&lt;/em&gt;"</span>, <span class="string">//</span> <span class="string">用来标记高亮字段的后置标签，</span></span><br><span class="line">        <span class="attr">"require_field_match":</span> <span class="string">"false"</span> <span class="string">//</span> <span class="string">默认情况下</span>,<span class="string">ES<hanla></hanla>的搜索字段必须与高亮字段一致</span>,<span class="literal">false</span><span class="string"><hanla></hanla>为可以不一致</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>搜索结果处理整体语法</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">搜索结果处理整体语法</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/475fac08db834b60b33b4b1985718dd4.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-9">
                    <ul>
                      <li>
                        <p><code>match_all</code></p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>match_all</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/16700cb5795a4ae3b03787ad4e54957a.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 准备 DSL</span></span><br><span class="line">    request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 结果对象</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    handleResponse(response);</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 结果解析抽取<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> {</span><br><span class="line">    <span class="comment">// 4. 解析响应</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1 获取总条数</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">"共搜索到: "</span> + total);</span><br><span class="line">    <span class="comment">// 4.2 文档数组</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3 遍历</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) {</span><br><span class="line">        <span class="comment">// 获取文档 source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        System.out.println(<span class="string">"hotelDoc = "</span> + hotelDoc);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <ul>
                          <li>
                            <p>解析<hanla></hanla><code>response</code></p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">解析<hanla></hanla><code>response</code> 一 一获取对应的值</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0e831d404e334553ab2714da540cbfd3.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>match</code></p>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 准备 DSL</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">"all"</span>,<span class="string">"如家"</span>));</span><br><span class="line">    <span class="comment">// 结果对象</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    </span><br><span class="line">    handleResponse(response);</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>精确查询</p>
                        <ul>
                          <li>
                            <p><code>term</code></p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testTerm</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 准备 DSL</span></span><br><span class="line">    request.source().query(QueryBuilders.termQuery(<span class="string">"city"</span>, <span class="string">"上海"</span>));</span><br><span class="line">    <span class="comment">// 结果对象</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    handleResponse(response);</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p><code>range</code></p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testRange</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 准备 DSL</span></span><br><span class="line">    request.source().query(QueryBuilders.rangeQuery(<span class="string">"price"</span>).gte(<span class="number">100</span>).lte(<span class="number">150</span>));</span><br><span class="line">    <span class="comment">// 结果对象</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    handleResponse(response);</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>复合查询</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">复合查询</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/366dfbac31dd46fda8a3aa0aab6279ef.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">testBool</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">       <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">       <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">       <span class="comment">// 准备 DSL</span></span><br><span class="line">       <span class="comment">// 准备 BoolQuery</span></span><br><span class="line">       <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">       <span class="comment">// 添加 term</span></span><br><span class="line">       boolQuery.must(QueryBuilders.termQuery(<span class="string">"city"</span>,<span class="string">"上海"</span>));</span><br><span class="line">       request.source().query(boolQuery);</span><br><span class="line">       <span class="comment">// 结果对象</span></span><br><span class="line">       <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">       handleResponse(response);</span><br><span class="line">   }</span><br><span class="line">    </span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>排序和分页</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">搜索结果的排序和分页是与<hanla></hanla><code>query</code>
                                <hanla></hanla>同级的参数
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/53acd978a06b4e388a2726c0410f1352.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPageAndSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 2. 准备 DSL</span></span><br><span class="line">    <span class="comment">// 2.1 准备 query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchAllQuery())</span><br><span class="line">        <span class="comment">// 可以链式调用 也可以通过  request.source().sort("price", SortOrder.ASC); 等获取</span></span><br><span class="line">        .sort(<span class="string">"price"</span>, SortOrder.ASC)</span><br><span class="line">        .from((page - <span class="number">1</span>) * size)</span><br><span class="line">        .size(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 结果对象</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    handleResponse(response);</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>高亮显示</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">高亮显示</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bfd6010a6c654571be381f91cf70cea7.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHighLight</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 2. 准备 DSL</span></span><br><span class="line">    <span class="comment">// 2.1 准备 query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">"all"</span>, <span class="string">"如家"</span>));</span><br><span class="line">    <span class="comment">// 高亮</span></span><br><span class="line">    request.source().highlighter(<span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>().field(<span class="string">"name"</span>).requireFieldMatch(<span class="literal">false</span>));</span><br><span class="line">    <span class="comment">// 结果对象</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    handleResponse(response);</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">高亮显示处理<code>高亮: highlight</code>
                                <hanla></hanla>部分的内容
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b989b820fad647e0a04d360a133e15d1.png" alt="高亮显示处理"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 完整高亮处理<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHighLight</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request 对象</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 2. 准备 DSL</span></span><br><span class="line">    <span class="comment">// 2.1 准备 query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">"all"</span>, <span class="string">"如家"</span>));</span><br><span class="line">    <span class="comment">// 高亮</span></span><br><span class="line">    request.source().highlighter(<span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>().field(<span class="string">"name"</span>).requireFieldMatch(<span class="literal">false</span>));</span><br><span class="line">    <span class="comment">// 结果对象</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    handleResponse(response);</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 结果解析抽取<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> {</span><br><span class="line">    <span class="comment">// 4. 解析响应</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1 获取总条数</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">"共搜索到: "</span> + total);</span><br><span class="line">    <span class="comment">// 4.2 文档数组</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3 遍历</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) {</span><br><span class="line">        <span class="comment">// 获取文档 source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        <span class="comment">// 获取高亮结果</span></span><br><span class="line">        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(highlightFields)) {</span><br><span class="line">            <span class="comment">// 获取高亮值</span></span><br><span class="line">            <span class="type">HighlightField</span> <span class="variable">highlightField</span> <span class="operator">=</span> highlightFields.get(<span class="string">"name"</span>);</span><br><span class="line">            <span class="keyword">if</span> (highlightField != <span class="literal">null</span>) {</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> highlightField.getFragments()[<span class="number">0</span>].string();</span><br><span class="line">                <span class="comment">// 覆盖高亮结果</span></span><br><span class="line">                hotelDoc.setName(name);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"hotelDoc = "</span> + hotelDoc);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">实现高亮</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/67eda0c06a754df99815ba2179855f11.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-10">
                    <ul>
                      <li>
                        <p>步骤</p>
                        <ol>
                          <li>
                            <p>定义实体类,<hanla></hanla>接受前端请求</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">将搜索、分页、排序方式等封装到实体类</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/4d3d0a483a514a919c8934ab2691a3fa.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> {</span><br><span class="line">    <span class="comment">// 搜索框的关键字</span></span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="comment">// 当前页</span></span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="comment">// 偏移量</span></span><br><span class="line">    <span class="keyword">private</span> Integer size;</span><br><span class="line">    <span class="comment">// 排序方式</span></span><br><span class="line">    <span class="keyword">private</span> String sortBy;</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>定义<hanla></hanla><code>controller</code>
                              <hanla></hanla>接口,<hanla></hanla>接受页面请求,<hanla></hanla>调用<hanla></hanla><code>search</code>
                              <hanla></hanla>方法
                            </p>
                            <ul>
                              <li>
                                <p>请求方式<hanla></hanla><code>POST</code></p>
                              </li>
                              <li>
                                <p>请求路径<hanla></hanla><code>/hotel/list</code></p>
                              </li>
                              <li>
                                <p>请求参数: 对象，类型为<hanla></hanla><code>RequestParams</code></p>
                              </li>
                              <li>
                                <p>返回值: <code>PageResult</code>，包含两个属性</p>
                                <ol>
                                  <li>
                                    <p>总条数<hanla></hanla><code>Long total</code></p>
                                  </li>
                                  <li>
                                    <p>酒店数据<hanla></hanla><code>List&lt;HotelDoc&gt; hotels</code></p>
                                    <figure class="highlight java">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> {</span><br><span class="line">    Long total;</span><br><span class="line">    List&lt;HotelDoc&gt; hotels;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">(Long total, List&lt;HotelDoc&gt; hotels)</span> {</span><br><span class="line">        <span class="built_in">this</span>.total = total;</span><br><span class="line">        <span class="built_in">this</span>.hotels = hotels;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                  </li>
                                </ol>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>定义<code>接口中的<hanla></hanla>search<hanla></hanla>方法</code>,<hanla></hanla>利用<hanla></hanla><code>match</code>
                              <hanla></hanla>查询实现根据关键字搜索酒店信息
                            </p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;HotelMapper, Hotel&gt; <span class="keyword">implements</span> <span class="title class_">IHotelService</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams requestParams)</span> {</span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// 1. 准备 Resuest</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">            <span class="comment">// 2. 准备 DSL</span></span><br><span class="line">            <span class="comment">/****************************/</span></span><br><span class="line">            <span class="comment">// 2.1 准备 query</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> requestParams.getKey();</span><br><span class="line">            <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">""</span>.equals(key)) {</span><br><span class="line">                <span class="comment">// 前端未传递 key</span></span><br><span class="line">                request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                request.source().query(QueryBuilders.matchQuery(<span class="string">"all"</span>, key));</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// 2.2 分页</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> requestParams.getPage();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> requestParams.getSize();</span><br><span class="line">            request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line">            <span class="comment">/****************************/</span></span><br><span class="line">            <span class="comment">// 3. 发送请求,<hanla></hanla>得到响应</span></span><br><span class="line">            response = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 4. 解析响应</span></span><br><span class="line">        <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 解析响应</span></span><br><span class="line">    <span class="keyword">private</span> PageResult <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> {</span><br><span class="line">        <span class="comment">// 解析响应</span></span><br><span class="line">        <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">        <span class="comment">// 获取总条数</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">        <span class="comment">// 文档数组</span></span><br><span class="line">        SearchHit[] hits = searchHits.getHits();</span><br><span class="line">        List&lt;HotelDoc&gt; hotels = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hits) {</span><br><span class="line">            <span class="comment">// 获取文档 source</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">            <span class="comment">// 反序列化</span></span><br><span class="line">            <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">            hotels.add(hotelDoc);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 封装返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, hotels);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ol>
                      </li>
                      <li>
                        <p>距离排序</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">距离排序</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3712bea29348460db545f0dc29a2d383.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>广告置顶</p>
                        <blockquote>
                          <p>我们需要给置顶的酒店文档<hanla></hanla><code>HotelDoc</code>
                            <hanla></hanla>加一个标记,<hanla></hanla>然后利用<hanla></hanla><code>function score</code>
                            <hanla></hanla>给带有标记的文档增加权重
                          </p>
                        </blockquote>
                        <ul>
                          <li>
                            <p>实现步骤分析</p>
                            <ol>
                              <li>
                                <p>给<hanla></hanla><code>HotelDoc</code>
                                  <hanla></hanla>类添加一个<hanla></hanla><code>isAD</code>
                                  <hanla></hanla>字段,<code>Boolean</code>
                                  <hanla></hanla>类型
                                </p>
                              </li>
                              <li>
                                <p>挑选几个酒店，给他的文档数据添加<hanla></hanla><code>isAD</code>
                                  <hanla></hanla>字段,<hanla></hanla>值为<hanla></hanla><code>true</code>
                                </p>
                                <figure class="highlight properties">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># 更新 文档<hanla></hanla>id=38665 添加字段 isAD=true</span></span><br><span class="line"><span class="attr">POST</span> <span class="string">/hotel/_doc/38665</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"doc"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"isAD"</span>: <span class="string">true</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>修改<hanla></hanla><code>search</code>
                                  <hanla></hanla>方法,<hanla></hanla>添加<hanla></hanla><code>function score</code>
                                  <hanla></hanla>功能,<hanla></hanla>给<hanla></hanla><code>isAD</code>
                                  <hanla></hanla>值为<hanla></hanla><code>true</code>
                                  <hanla></hanla>的酒店增加权重
                                </p>
                              </li>
                            </ol>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center"><code>Function score</code>
                                    <hanla></hanla>查询可以控制文档的相关性算分
                                  </th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ae5e3c7bca2448d9802a476939e76ac5.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-11">
                    <ul>
                      <li>
                        <p>聚合的分类<hanla></hanla>(对数据类型有限制:<code>keyword、数值、日期、boolean<hanla></hanla>等</code>)</p>
                        <blockquote>
                          <p>聚合: 可以实现对文档数据的统计、分析、运算</p>
                        </blockquote>
                        <ul>
                          <li>常见聚合有三类:<ol>
                              <li>桶<hanla></hanla>(<code>*Bucket</code>)<hanla></hanla>聚合：用来对文档做分组<ul>
                                  <li><code>TermAggregation</code>：按照文档字段值分组</li>
                                  <li><code>Date Histogram</code>:<hanla></hanla>按照日期阶梯分组,<hanla></hanla>例如一周一组,<hanla></hanla>或者一月一组等等</li>
                                </ul>
                              </li>
                              <li>度量<hanla></hanla>(<code>*Metric</code>)<hanla></hanla>聚合：用以计算一些值,<hanla></hanla>比如: 最大值,<hanla></hanla>最小值，平均值等<ul>
                                  <li><code>AVG</code></li>
                                  <li><code>MAX</code></li>
                                  <li><code>MIN</code></li>
                                  <li><code>Stats</code>
                                    <hanla></hanla>同时求<hanla></hanla><code>max,min,avg,sum<hanla></hanla>等</code>
                                  </li>
                                </ul>
                              </li>
                              <li>管道<hanla></hanla>(<code>pipeline</code>)<hanla></hanla>聚合:<hanla></hanla>其他聚合的结果为基础做聚合</li>
                            </ol>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>DSL</code>
                          <hanla></hanla>实现<hanla></hanla><code>Bucket</code>
                          <hanla></hanla>聚合
                        </p>
                        <blockquote>
                          <p>统计所有数据中的酒店品牌有几种,<hanla></hanla>此时可以根据酒店品牌的名称做聚合,<hanla></hanla>类型为<hanla></hanla><code>term</code></p>
                        </blockquote>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"size"</span>: <span class="string">0, // 设置 size 为 0,<hanla></hanla>结果中不包含文档,<hanla></hanla>只包含聚合结果</span></span><br><span class="line">  <span class="attr">"aggs"</span>: <span class="string">{ // 定义聚合</span></span><br><span class="line">    <span class="attr">"brandArr"</span>: <span class="string">{ // 给聚合起个名称</span></span><br><span class="line">      <span class="attr">"terms"</span>: <span class="string">{ // 聚合的类型,<hanla></hanla>按照品牌值聚合,<hanla></hanla>所以选择 term</span></span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"brand", // 参与聚合的字段</span></span><br><span class="line">        <span class="attr">"size"</span>: <span class="string">20 // 希望获取的聚合结果数量</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <blockquote>
                          <p> 默认情况下,<code>Bucket</code>
                            <hanla></hanla>聚合会统计<hanla></hanla><code>Bucket</code>
                            <hanla></hanla>内的文档数量,<hanla></hanla>记为<hanla></hanla><code>_count</code>
                            <hanla></hanla>并且按照<hanla></hanla><code>_count</code>
                            <hanla></hanla>降序排序，我们可以修正结果排序方式
                          </p>
                        </blockquote>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"size"</span>: <span class="string">0, // 设置 size 为 0,<hanla></hanla>结果中不包含文档,<hanla></hanla>只包含聚合结果</span></span><br><span class="line">  <span class="attr">"aggs"</span>: <span class="string">{ // 定义聚合</span></span><br><span class="line">    <span class="attr">"brandArr"</span>: <span class="string">{ // 给聚合起个名称</span></span><br><span class="line">      <span class="attr">"terms"</span>: <span class="string">{ // 聚合的类型,<hanla></hanla>按照品牌值聚合,<hanla></hanla>所以选择 term</span></span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"brand", // 参与聚合的字段</span></span><br><span class="line">        <span class="attr">"order"</span>:<span class="string">{</span></span><br><span class="line">        	<span class="attr">"_count"</span>: <span class="string">"asc" // 按照<hanla></hanla>_count<hanla></hanla>升序排序</span></span><br><span class="line">        <span class="attr">},</span></span><br><span class="line">        <span class="attr">"size"</span>: <span class="string">20 // 希望获取的聚合结果数量</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <blockquote>
                          <p>默认情况下,<code>Bucket</code>
                            <hanla></hanla>聚合是对索引库的所有文档做聚合,<hanla></hanla>我们可以限定要聚合的文档范围,<hanla></hanla>只要添加<hanla></hanla><code>query</code>
                            <hanla></hanla>条件即可
                          </p>
                        </blockquote>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line"><span class="attr">//</span> <span class="string">添加聚合条件</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"range"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"price"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"gte"</span>: <span class="string">150,</span></span><br><span class="line">        <span class="attr">"lte"</span>: <span class="string">200</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">},</span> <span class="string"></span></span><br><span class="line">  <span class="attr">"size"</span>: <span class="string">0, // 设置 size 为 0,<hanla></hanla>结果中不包含文档,<hanla></hanla>只包含聚合结果</span></span><br><span class="line">  <span class="attr">"aggs"</span>: <span class="string">{ // 定义聚合</span></span><br><span class="line">    <span class="attr">"brandArr"</span>: <span class="string">{ // 给聚合起个名称</span></span><br><span class="line">      <span class="attr">"terms"</span>: <span class="string">{ // 聚合的类型,<hanla></hanla>按照品牌值聚合,<hanla></hanla>所以选择 term</span></span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"brand", // 参与聚合的字段</span></span><br><span class="line">        <span class="attr">"order"</span>:<span class="string">{</span></span><br><span class="line">        	<span class="attr">"_count"</span>: <span class="string">"asc" // 按照<hanla></hanla>_count<hanla></hanla>升序排序</span></span><br><span class="line">        <span class="attr">},</span></span><br><span class="line">        <span class="attr">"size"</span>: <span class="string">20 // 希望获取的聚合结果数量</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p><code>DSL</code>
                          <hanla></hanla>实现<hanla></hanla><code>Metrices</code>
                          <hanla></hanla>聚合
                        </p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">GET</span> <span class="string">/hotel/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"range"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"price"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"gte"</span>: <span class="string">150,</span></span><br><span class="line">        <span class="attr">"lte"</span>: <span class="string">200</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">},</span></span><br><span class="line">  <span class="attr">"size"</span>: <span class="string">0,</span></span><br><span class="line">  <span class="attr">"aggs"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"brandArr"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"terms"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"brand",</span></span><br><span class="line">        <span class="attr">"order"</span>: <span class="string">{</span></span><br><span class="line">          <span class="attr">"_count"</span>: <span class="string">"asc"</span></span><br><span class="line">        <span class="attr">},</span></span><br><span class="line">        <span class="attr">"size"</span>: <span class="string">20</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"aggs"</span>: <span class="string">{ // 是 brands 聚合的子聚合,<hanla></hanla>也就是分组后对每组分别计算</span></span><br><span class="line">        <span class="attr">"score_stats"</span>: <span class="string">{ // 聚合名称</span></span><br><span class="line">          <span class="attr">"stats"</span>: <span class="string">{ // 聚合类型,<hanla></hanla>这里是 stats 可以计算 min,max,avg 等</span></span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"score" // 聚合字段,<hanla></hanla>这里是 score</span></span><br><span class="line">          <span class="attr">}</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p><code>JavaRestAPI</code>
                          <hanla></hanla>实现聚合
                        </p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">对比分析</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bee2194b0bb64b25a9002cff84110f6c.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 测试聚合<hanla></hanla></span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBuckets</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 2. 准备 DSL</span></span><br><span class="line">    <span class="comment">// 2.1 设置 size 只看聚合</span></span><br><span class="line">    request.source().size(<span class="number">0</span>);</span><br><span class="line">    request.source().aggregation(</span><br><span class="line">        AggregationBuilders</span><br><span class="line">        <span class="comment">// 聚合名称</span></span><br><span class="line">        .terms(<span class="string">"brandAgg"</span>)</span><br><span class="line">        <span class="comment">// 期望获取文档数量</span></span><br><span class="line">        .size(<span class="number">10</span>)</span><br><span class="line">        <span class="comment">// 聚合字段</span></span><br><span class="line">        .field(<span class="string">"brand"</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 3. 发出请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4. 解析结果</span></span><br><span class="line">    System.out.println(<span class="string">"response = "</span> + response);</span><br><span class="line">    <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> response.getAggregations();</span><br><span class="line">    <span class="comment">// 4.1 根据聚合名称获取聚合结果<hanla></hanla>(自动生成的对象并非所要结果)</span></span><br><span class="line">    <span class="type">Terms</span> <span class="variable">brandTerms</span> <span class="operator">=</span> aggregations.get(<span class="string">"brandAgg"</span>);</span><br><span class="line">    <span class="comment">// 4.2 获取 buckets</span></span><br><span class="line">    List&lt;? <span class="keyword">extends</span> <span class="title class_">Terms</span>.Bucket&gt; buckets = brandTerms.getBuckets();</span><br><span class="line">    <span class="comment">// 4.3 遍历</span></span><br><span class="line">    <span class="keyword">for</span> (Terms.Bucket bucket : buckets) {</span><br><span class="line">        <span class="comment">// 4.4 获取 key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> bucket.getKeyAsString();</span><br><span class="line">        System.out.println(key);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">聚合结果获取分析</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bcfb066ab9ad43568a3f7974173642e5.png" alt="聚合结果获取分析"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>自动补全</p>
                        <blockquote>
                          <p>拼音分词器: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/medcl/elasticsearch-analysis-pinyin">https://github.com/medcl/elasticsearch-analysis-pinyin</a></p>
                        </blockquote>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 测试分词器<hanla></hanla></span></span><br><span class="line"><span class="attr">POST</span> <span class="string">/_analyze</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"text"</span>: <span class="string">[</span></span><br><span class="line">    <span class="attr">"如家酒店还不错"</span></span><br><span class="line">  <span class="attr">],</span></span><br><span class="line">  <span class="attr">"analyzer"</span>: <span class="string">"pinyin"</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <ul>
                          <li>
                            <p>自定义分词器<hanla></hanla>(<code>elasticsearch</code>
                              <hanla></hanla>中分词器的组成包含如下三部分)
                            </p>
                            <ol>
                              <li><code>character filters</code>:<hanla></hanla>在<hanla></hanla><code>tokenizer</code>
                                <hanla></hanla>之前对文本进行处理,<hanla></hanla>例如删除字符、替换字符
                              </li>
                              <li><code>tokenizer</code>:<hanla></hanla>将文本按照一定的规则切割成词条,<hanla></hanla>例如<hanla></hanla><code>keyword</code>
                                <hanla></hanla>就是部分此，还有<hanla></hanla><code>id_smart</code>
                              </li>
                              <li><code>tokenizer filter</code>
                                <hanla></hanla>将<hanla></hanla><code>tokenizer</code>
                                <hanla></hanla>输出的词条做进一步处理,<hanla></hanla>例如大小写转换,<hanla></hanla>同义词处理,<hanla></hanla>拼音处理等
                              </li>
                            </ol>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">分析</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2d7792f3708643fbad6413f5c0b82d68.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 自定义配置<hanla></hanla>(创建库) 未添加 搜索分词器<hanla></hanla></span></span><br><span class="line"><span class="attr">PUT</span> <span class="string">/test</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"settings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"analysis"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"analyzer"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"my_analyzer"</span>: <span class="string">{</span></span><br><span class="line">          <span class="attr">"tokenizer"</span>: <span class="string">"ik_max_word",</span></span><br><span class="line">          <span class="attr">"filter"</span>: <span class="string">"py"</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"filter"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"py"</span>: <span class="string">{</span></span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"pinyin",</span></span><br><span class="line">          <span class="attr">"keep_full_pinyin"</span>: <span class="string">false,</span></span><br><span class="line">          <span class="attr">"keep_joined_full_pinyin"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"keep_original"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"limit_first_letter_length"</span>: <span class="string">16,</span></span><br><span class="line">          <span class="attr">"remove_duplicated_term"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"none_chinese_pinyin_tokenize"</span>: <span class="string">false</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">},</span></span><br><span class="line">  <span class="attr">"mappings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"properties"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text",</span></span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"my_analyzer"</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 使用<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">POST</span> <span class="string">/test/_analyze</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"text"</span>: <span class="string">["如家酒店真不错"],</span></span><br><span class="line">  <span class="attr">"analyzer"</span>: <span class="string">"my_analyzer"</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">测试使用</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7c08d20f70f149ebb3a0e170af75f3b9.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>搜索时出先问题</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">同义词</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/cc2288e56c93472e920e91fa1ce7abfd.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <blockquote>
                              <p>解决上述问题: 拼音分词器适合在创建倒排索引的时候使用,<hanla></hanla>但不能在搜索的时候使用</p>
                            </blockquote>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 创建文档时指定创建分词器和搜索分词器<hanla></hanla></span></span><br><span class="line"><span class="attr">PUT</span> <span class="string">/test</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"settings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"analysis"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"analyzer"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"my_analyzer"</span>: <span class="string">{ // 自定义分词器名称</span></span><br><span class="line">          <span class="attr">"tokenizer"</span>: <span class="string">"ik_max_word", // </span></span><br><span class="line">          <span class="attr">"filter"</span>: <span class="string">"py"</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"filter"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">//</span> <span class="string">规则: 在 github readme 文档有对应使用方法 </span></span><br><span class="line">        <span class="attr">"py"</span>: <span class="string">{</span></span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"pinyin",</span></span><br><span class="line">          <span class="attr">"keep_full_pinyin"</span>: <span class="string">false,</span></span><br><span class="line">          <span class="attr">"keep_joined_full_pinyin"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"keep_original"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"limit_first_letter_length"</span>: <span class="string">16,</span></span><br><span class="line">          <span class="attr">"remove_duplicated_term"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"none_chinese_pinyin_tokenize"</span>: <span class="string">false</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">},</span></span><br><span class="line">  <span class="attr">"mappings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"properties"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text",</span></span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"my_analyzer", // 创建倒排索引使用的分词器</span></span><br><span class="line">         <span class="attr">"search_analyzer"</span>: <span class="string">"ik_smart" // 搜索时使用的分词器</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>自动补全</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 创建索引库<hanla></hanla></span></span><br><span class="line"><span class="attr">PUT</span> <span class="string">coderitl</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"mappings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"properties"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"title"</span>:<span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"completion"</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 实例数据<hanla></hanla></span></span><br><span class="line"><span class="attr">POST</span> <span class="string">coderitl/_doc</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"title"</span>:<span class="string">["Sony","WH=1000XM3","9001","0090010"]</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"></span><br><span class="line"><span class="attr">POST</span> <span class="string">coderitl/_doc</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"title"</span>:<span class="string">["SK-IT","PITERA","BBCS","DDES"]</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">POST</span> <span class="string">coderitl/_doc</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"title"</span>:<span class="string">["Nintendo","switch","AAFG","YYDS"]</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 自动补全查询语法<hanla></hanla></span></span><br><span class="line"><span class="attr">GET</span> <span class="string">/coderitl/_search</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"suggest"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"title_suggest"</span>: <span class="string">{ // title_suggest 自定义名称</span></span><br><span class="line">      <span class="attr">"text"</span>: <span class="string">"so", // 查询关键字 </span></span><br><span class="line">      <span class="attr">"completion"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"title", // 补全查询的字段</span></span><br><span class="line">        <span class="attr">"skip_duplicates"</span>: <span class="string">true, // 跳过重复的</span></span><br><span class="line">        <span class="attr">"size"</span>: <span class="string">10 // 获取前 10 条数据</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <ul>
                          <li>
                            <p>修改<hanla></hanla><code>hotel</code></p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">PUT</span> <span class="string">/hotel</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">  <span class="attr">"settings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"analysis"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"analyzer"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"text_analyzer"</span>: <span class="string">{</span></span><br><span class="line">          <span class="attr">"tokenizer"</span>: <span class="string">"ik_max_word",</span></span><br><span class="line">          <span class="attr">"filter"</span>: <span class="string">"py"</span></span><br><span class="line">        <span class="attr">},</span></span><br><span class="line">        <span class="attr">"completion_analyzer"</span>: <span class="string">{</span></span><br><span class="line">          <span class="attr">"tokenizer"</span>: <span class="string">"keyword",</span></span><br><span class="line">          <span class="attr">"filter"</span>: <span class="string">"py"</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"filter"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"py"</span>: <span class="string">{</span></span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"pinyin",</span></span><br><span class="line">          <span class="attr">"keep_full_pinyin"</span>: <span class="string">false,</span></span><br><span class="line">          <span class="attr">"keep_joined_full_pinyin"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"keep_original"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"limit_first_letter_length"</span>: <span class="string">16,</span></span><br><span class="line">          <span class="attr">"remove_duplicated_term"</span>: <span class="string">true,</span></span><br><span class="line">          <span class="attr">"none_chinese_pinyin_tokenize"</span>: <span class="string">false</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">},</span></span><br><span class="line">  <span class="attr">"mappings"</span>: <span class="string">{</span></span><br><span class="line">    <span class="attr">"properties"</span>: <span class="string">{</span></span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text",</span></span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"text_analyzer",</span></span><br><span class="line">        <span class="attr">"search_analyzer"</span>: <span class="string">"ik_smart",</span></span><br><span class="line">        <span class="attr">"copy_to"</span>: <span class="string">"all"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"address"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"index"</span>: <span class="string">false</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"price"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"integer"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"score"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"integer"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"brand"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"copy_to"</span>: <span class="string">"all"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"city"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"startName"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"business"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"copy_to"</span>: <span class="string">"all"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"location"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"geo_point"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"pic"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"keyword",</span></span><br><span class="line">        <span class="attr">"index"</span>: <span class="string">false</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"all"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text",</span></span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"text_analyzer",</span></span><br><span class="line">        <span class="attr">"search_analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">      <span class="attr">},</span></span><br><span class="line">      <span class="attr">"suggestion"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"completion",</span></span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"completion_analyzer"</span></span><br><span class="line">      <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line">  <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">//</span> <span class="string">数据库对应字段 List&lt;String&gt; suggestion</span></span><br><span class="line"><span class="attr">"suggestion"</span>: <span class="string">{</span></span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"completion",</span></span><br><span class="line">  <span class="attr">"analyzer"</span>: <span class="string">"completion_analyzer"</span></span><br><span class="line"><span class="attr">}</span></span><br><span class="line"><span class="attr">//</span> <span class="string">那些数据库字段做自动补全<hanla></hanla></span></span><br><span class="line"></span><br><span class="line"><span class="attr">//</span> <span class="string">构造实现字段赋值<hanla></hanla></span></span><br><span class="line"><span class="attr">this.suggestion</span> = <span class="string">Arrays.asList(this.brand,this.business)</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">对自动补全完善</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/6b83989860cd4e888b62d4182ea0d108.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>JavaApi</code>
                          <hanla></hanla>实现自动补全
                        </p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>JavaApi</code>
                                <hanla></hanla>实现自动补全
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c3212942b7ee450cae18b683d1e5b9e9.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight java">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment">// 测试自动补全 API</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSuggest</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">// 1. 准备 request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">"hotel"</span>);</span><br><span class="line">    <span class="comment">// 准备 DSL</span></span><br><span class="line">    request</span><br><span class="line">        .source()</span><br><span class="line">        .suggest(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">SuggestBuilder</span>()</span><br><span class="line">                <span class="comment">// 自定义名称: suggestions</span></span><br><span class="line">                .addSuggestion(</span><br><span class="line">                    <span class="string">"suggestions"</span>,</span><br><span class="line">                    <span class="comment">// 参与自动补全的字段: suggestion</span></span><br><span class="line">                    SuggestBuilders.completionSuggestion(<span class="string">"suggestion"</span>)</span><br><span class="line">                        <span class="comment">// 搜索关键字</span></span><br><span class="line">                        .prefix(<span class="string">"sd"</span>)</span><br><span class="line">                        <span class="comment">// 跳过重复的</span></span><br><span class="line">                        .skipDuplicates(<span class="literal">true</span>)</span><br><span class="line">                        <span class="comment">// 期望显示的数据量</span></span><br><span class="line">                        .size(<span class="number">10</span>)));</span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4. 解析结果</span></span><br><span class="line">    <span class="type">Suggest</span> <span class="variable">suggest</span> <span class="operator">=</span> response.getSuggest();</span><br><span class="line">    <span class="comment">// 4.1 根据不全查询名称 获取补全结果  Suggest.Suggestion&lt;? extends Suggest.Suggestion.Entry&lt;? extends</span></span><br><span class="line">    <span class="comment">// Suggest.Suggestion.Entry.Option&gt;&gt; == CompletionSuggestion</span></span><br><span class="line">    <span class="type">CompletionSuggestion</span> <span class="variable">suggestions</span> <span class="operator">=</span> suggest.getSuggestion(<span class="string">"suggestions"</span>);</span><br><span class="line">    <span class="comment">// 4.2 获取 options</span></span><br><span class="line">    List&lt;CompletionSuggestion.Entry.Option&gt; options = suggestions.getOptions();</span><br><span class="line">    <span class="comment">// 4.3 遍历</span></span><br><span class="line">    <span class="keyword">for</span> (CompletionSuggestion.Entry.Option option : options) {</span><br><span class="line">      <span class="comment">// 获取 text</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> option.getText().toString();</span><br><span class="line">      System.out.println(text);</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">结果解析</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b842d5aa16d1417f8a0de0011c2aac0b.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>数据同步</p>
                        <ul>
                          <li>
                            <p>数据同步问题分析</p>
                            <blockquote>
                              <p><code>elasticsearch</code>
                                <hanla></hanla>中的酒店数据来自于<hanla></hanla><code>mysql</code>,<hanla></hanla>因此<hanla></hanla><code>mysql</code>
                                <hanla></hanla>数据发生改变时,<code>elasticsearch</code>
                                <hanla></hanla>也必须跟着改变,<hanla></hanla>这个就是<hanla></hanla><code>elasticsearch</code>
                                <hanla></hanla>与<hanla></hanla><code>mysql</code>
                                <hanla></hanla>之间的<code>数据同步</code>
                              </p>
                            </blockquote>
                          </li>
                          <li>
                            <p>数据同步的三种方式</p>
                            <ol>
                              <li>
                                <p>同步调用</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">同步调用</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/92f6ed6a9fed4396a9f167da04170cc7.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <ul>
                                  <li>优点: 实现简单,<hanla></hanla>粗暴</li>
                                  <li>缺点: 业务耦合度高</li>
                                </ul>
                              </li>
                              <li>
                                <p>异步通知<hanla></hanla>(<code>推荐</code>)</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">异步通知</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/052fc76f6915448daac9df23848cf4fc.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <ul>
                                  <li>优点: 低耦合,<hanla></hanla>实现难度一般</li>
                                  <li>缺点: 依赖<hanla></hanla><code>mq</code>
                                    <hanla></hanla>的可靠性
                                  </li>
                                </ul>
                              </li>
                              <li>
                                <p>监听<hanla></hanla><code>binlog</code></p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">监听<hanla></hanla><code>binlog</code></th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/707e23da257b4f37861cd8ab2e659230.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ol>
                            <ul>
                              <li>优点: 完全解除服务间耦合</li>
                              <li>缺点: 开启<hanla></hanla><code>binlog</code>
                                <hanla></hanla>增加数据库负担,<hanla></hanla>实现复杂度高
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>案例实现数据同步</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">数据同步实现</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c17fcfb6c03c43d492425a7cd1855f23.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-12">
                    <ul>
                      <li>
                        <p>问题</p>
                        <ul>
                          <li>
                            <p>海量数据存储问题: 将索引库从逻辑上拆分为<hanla></hanla><code>N</code>
                              <hanla></hanla>个分片,<hanla></hanla>存储到多个节点
                            </p>
                          </li>
                          <li>
                            <p>单点故障问题: 将分片数据在不同节点备份</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">实现</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/47fe752932d7478991e7d3b0293caf5f.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>搭建集群</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">集群所需环境容量大小<hanla></hanla>(运行内存<hanla></hanla><code>4G+</code>，否则过于卡顿,<hanla></hanla>无法操作)</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d1ed6aa25d3f46f88aba16993d0c672a.png" alt="集群所需环境容量大小"></td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 创建网络<hanla></hanla></span></span><br><span class="line"><span class="attr">docker</span> <span class="string">network create elastic</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <ul>
                          <li>
                            <p><code>es</code>
                              <hanla></hanla>运行需要修改一些<hanla></hanla><code>linux</code>
                              <hanla></hanla>系统权限,<hanla></hanla>修改<hanla></hanla><code>/etc/sysctl.conf</code>
                            </p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 编辑<hanla></hanla></span></span><br><span class="line"><span class="attr">vim</span> <span class="string">/etc/sysctl.conf</span></span><br><span class="line"><span class="comment"># 添加如下<hanla></hanla></span></span><br><span class="line"><span class="attr">vm.max_map_count</span>=<span class="string">262144</span></span><br><span class="line"><span class="comment"># 保存退出后使其生效</span></span><br><span class="line"> <span class="attr">sysctl</span> <span class="string">-p</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p><code>docker-compose.yml</code></p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.13.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es01</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ="Asia/Shanghai"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.master=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.data=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http.cors.enabled=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http.cors.allow-origin=*</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/es/data/data01:/usr/share/elasticsearch/data</span> <span class="comment"># 数据文件</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/es/logs/logs01:/usr/share/elasticsearch/logs</span> <span class="comment"># 日志文件</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">  <span class="attr">es02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.13.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es02</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ="Asia/Shanghai"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.master=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.data=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http.cors.enabled=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http.cors.allow-origin=*</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/es/data/data02:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/es/logs/logs02:/usr/share/elasticsearch/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9201</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9301</span><span class="string">:9300</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">  <span class="attr">es03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.13.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es03</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ="Asia/Shanghai"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.master=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.data=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http.cors.enabled=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http.cors.allow-origin=*</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/es/data/data03:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/es/logs/logs03:/usr/share/elasticsearch/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9202</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9302</span><span class="string">:9300</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/kibana/kibana:7.13.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">I18N_LOCALE=zh-CN</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"5601:5601"</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es01:vm01</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es03</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cerebro:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">lmenezes/cerebro:0.9.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">cerebro</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"19000:9000"</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es01:vm01</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-Dhosts.0.host=http://vm01:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">data01:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data02:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data03:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">elastic:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>构建</p>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">docker-compose</span> <span class="string">up -d</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">构建安装集群</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2e6a70c679024f039a9bbf8652ee759d.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>访问<hanla></hanla><code>5601 出现 Kibana server is not ready yes</code></p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 获取 es01 的容器 ip </span></span><br><span class="line"><span class="attr">docker</span> <span class="string">inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' c6  # c6 是 es01 的容器<hanla></hanla>id</span></span><br><span class="line"><span class="comment"># 复制获取的的 ip </span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                      <li>
                        <p>进入<hanla></hanla><code>kibana</code>
                          <hanla></hanla>容器内部
                        </p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 进入 kibana</span></span><br><span class="line"><span class="attr">docker</span> <span class="string">exec -it kibana bash</span></span><br><span class="line"><span class="comment"># 进入 config</span></span><br><span class="line"><span class="attr">cd</span> <span class="string">config</span></span><br><span class="line"><span class="comment"># 修改该配置文件,<hanla></hanla>根据下图实现<hanla></hanla></span></span><br><span class="line"><span class="attr">vim</span> <span class="string">kibana.yml</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 修改完毕后重启<hanla></hanla></span></span><br><span class="line"><span class="attr">docker-compose</span> <span class="string">restart kibana</span></span><br><span class="line"></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">修改如下</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/9fc2989f4d3b4a64921330779e9046e7.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>集群状态监控</p>
                        <blockquote>
                          <p><code>github</code>
                            <hanla></hanla>地址: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/lmenezes/cerebro">https://github.com/lmenezes/cerebro</a>
                          </p>
                          <p>下载链接: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/lmenezes/cerebro/releases/download/v0.9.4/cerebro-0.9.4.zip">https://github.com/lmenezes/cerebro/releases/download/v0.9.4/cerebro-0.9.4.zip</a> (<code>windows<hanla></hanla>可使用</code>)</p>
                        </blockquote>
                      </li>
                      <li>
                        <p>集群访问测试</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">集群访问测试</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ce5f0a8aa0424b07b8cbe078c8e316e3.png" style="zoom:67%;"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>创建索引库</p>
                        <figure class="highlight properties">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">PUT</span> <span class="string">/coderitl</span></span><br><span class="line"><span class="attr">{</span></span><br><span class="line">    <span class="attr">"settings"</span>:<span class="string">{</span></span><br><span class="line">        <span class="attr">"number_of_shards"</span>: <span class="string">3, // 分片数量</span></span><br><span class="line">        <span class="attr">"number_of_replicas"</span>:<span class="string">1 // 副本数量</span></span><br><span class="line">    <span class="attr">},</span></span><br><span class="line">    <span class="attr">"mappings"</span>:<span class="string">{</span></span><br><span class="line">        <span class="attr">"properties"</span>:<span class="string">{</span></span><br><span class="line">            <span class="attr">//</span> <span class="string">mapping 映射定义</span></span><br><span class="line">        <span class="attr">}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th><code>DSL</code>
                                <hanla></hanla>创建
                              </th>
                              <th align="center"><code>cerebro</code>
                                <hanla></hanla>创建索引库
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/31938f65a7174a2e859edd333b78e877.png"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/8dd2ab29feba498ba812a4da165fa3fc.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>集群节点职责划分</p>
                        <table>
                          <thead>
                            <tr>
                              <th>节点类型</th>
                              <th align="center">配置参数</th>
                              <th align="center">默认值</th>
                              <th align="center">节点职责</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><code>master eligible</code></td>
                              <td align="center"><code>node.master</code></td>
                              <td align="center"><code>true</code></td>
                              <td align="center">备选主节点: 主节点可以管理和记录集群状态,<hanla></hanla>决定分片在那个节点,<hanla></hanla>处理创建和删除索引库的请求</td>
                            </tr>
                            <tr>
                              <td><code>data</code></td>
                              <td align="center"><code>node.data</code></td>
                              <td align="center"><code>true</code></td>
                              <td align="center">数据节点:<hanla></hanla>存储数据、搜索、聚合、<code>CRUD</code></td>
                            </tr>
                            <tr>
                              <td><code>ingest</code></td>
                              <td align="center"><code>node.ingest</code></td>
                              <td align="center"><code>true</code></td>
                              <td align="center">数据存储之前的预处理</td>
                            </tr>
                            <tr>
                              <td><code>coordonating</code></td>
                              <td align="center">上面<hanla></hanla><code>3</code>
                                <hanla></hanla>个参数都为<hanla></hanla><code>false</code>，则为<hanla></hanla><code>coordonating</code>
                                <hanla></hanla>节点
                              </td>
                              <td align="center">无</td>
                              <td align="center">路由请求到其他节点合并其他节点处理的结果,<hanla></hanla>返回给用户</td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p><code>ES</code>
                          <hanla></hanla>集群的脑裂
                        </p>
                        <blockquote>
                          <p>默认情况下,<hanla></hanla>每个节点都是<hanla></hanla><code>master eligible</code>
                            <hanla></hanla>节点,<hanla></hanla>因此一旦<hanla></hanla><code>master</code>
                            <hanla></hanla>节点宕机,<hanla></hanla>其他候选节点会选举一个成为主节点,<hanla></hanla>当主节点与其他节点网络故障时,<hanla></hanla>可能发生脑裂问题
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">脑裂产生的原因</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a0f157aaf4954038bc8561faca3ebb95.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <blockquote>
                          <p>为了避免脑裂,<hanla></hanla>需要要求候选票超过<hanla></hanla><code>(eligible<hanla></hanla>节点数量 + 1) / 2 </code>才能当选为主,<hanla></hanla>因此<hanla></hanla><code>eligible</code>
                            <hanla></hanla>节点数量最好是奇数,<hanla></hanla>对应配置项是<hanla></hanla><code>discovery.zen.minmum_master_nodes</code>
                            <hanla></hanla>在<hanla></hanla><code>es7.0</code>
                            <hanla></hanla>以后,<hanla></hanla>已经成为默认配置,<hanla></hanla>因此一般不会发生脑裂,
                          </p>
                        </blockquote>
                      </li>
                      <li>
                        <p><code>ES</code>
                          <hanla></hanla>集群的分布式存储
                        </p>
                        <blockquote>
                          <p>当新增文档时,<hanla></hanla>应该保存到不同的分片,<hanla></hanla>保证数据均衡,<hanla></hanla>主要通过<hanla></hanla><code>hash</code>
                            <hanla></hanla>算法来计算文档应该存储到那个分片
                          </p>
                        </blockquote>
                        <ul>
                          <li>
                            <p>添加数据</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">添加数据（<code>9200</code>）</th>
                                  <th align="center">获取数据<hanla></hanla>(<code>9201</code>)</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/85975180bd4248e289d16b154fe88e4c.png"></td>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d74b55fd6f5b4e1bbb6253d4538ccc83.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">{</span></span><br><span class="line">    <span class="attr">"explain"</span>:<span class="string">true, // 获取来自那个分片信息</span></span><br><span class="line">    <span class="attr">"query"</span>: <span class="string">{</span></span><br><span class="line">        <span class="attr">"match_all"</span>: <span class="string">{}</span></span><br><span class="line">    <span class="attr">}</span></span><br><span class="line"><span class="attr">}</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">数据成功的存储在不同分片上</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/db3d50f29dd54d5fb38ca5fdfc75d0a8.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <figure class="highlight properties">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># hash 算法<hanla></hanla></span></span><br><span class="line"><span class="attr">shard</span> = <span class="string">hash(_routing) % number_of_shards</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li>
                                <p><code>_routing</code>: 默认是文档的<hanla></hanla><code>id</code></p>
                              </li>
                              <li>
                                <p>算法与分片数量有关,<hanla></hanla>因此索引库一旦创建,<hanla></hanla>分片数量不能修改</p>
                              </li>
                              <li>
                                <p>新增文档流程</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">新增文档流程</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/97ff1897c6f44bc4afc6728951df1b8b.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>分布式查询</p>
                            <ul>
                              <li>
                                <p><code>scatter phase</code>:<hanla></hanla>分散阶段,<code>coordinating node</code>
                                  <hanla></hanla>会把请求分发到每一个分片
                                </p>
                              </li>
                              <li>
                                <p><code>gather phase</code>：聚集阶段,<code>coordinating node</code>
                                  <hanla></hanla>汇总<hanla></hanla><code>data node</code>
                                  <hanla></hanla>的搜索结果,<hanla></hanla>并处理为最终结果集返回给用户
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">先分发,<hanla></hanla>后汇总，在返回给用户</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/8813f666e14b44b88a4e40c6b186a36d.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="分布式搜索-13">
                    <ul>
                      <li>
                        <p>问题引出</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">停止一个主机</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/440d02efa3484244ac9a4c0906d26efc.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>故障转移</p>
                        <blockquote>
                          <p>集群的<hanla></hanla><code>master</code>
                            <hanla></hanla>节点会监控集群中的节点状态,<hanla></hanla>如果发现有节点宕机,<hanla></hanla>会立即将宕机节点的分片数据转移到其他节点，确保数据安全,<hanla></hanla>这个叫做<code>故障转移</code>
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">分片备份自动转移</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a9848605061543adbfaf74548141c979.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
          <h5 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h5>
          <ul>
            <li>
              <p>详细使用</p>
              <div class="tabs" id="sentinel">
                <ul class="nav-tabs">
                  <li class="tab active"><button type="button" data-href="#sentinel-1">简介</button></li>
                  <li class="tab"><button type="button" data-href="#sentinel-2">安装</button></li>
                  <li class="tab"><button type="button" data-href="#sentinel-3">微服务整合</button></li>
                  <li class="tab"><button type="button" data-href="#sentinel-4">授权规则</button></li>
                  <li class="tab"><button type="button" data-href="#sentinel-5">规则持久化</button></li>
                </ul>
                <div class="tab-contents">
                  <div class="tab-item-content active" id="sentinel-1">
                    <ul>
                      <li>
                        <p>雪崩问题</p>
                        <blockquote>
                          <p>微服务调用链路中的某个服务故障，引起整个链路中的所有微服务都不可用,<hanla></hanla>这就是雪崩</p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">雪崩问题</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b1e99d2c01924161bd566c7e0d2853a5.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>解决雪崩问题的常见方式有四种</p>
                            <ul>
                              <li>
                                <p>超时处理: 设定超时时间,<hanla></hanla>请求超过一定时间没有响应就返回错误信息,<hanla></hanla>不会无休止等待（只能缓解）</p>
                              </li>
                              <li>
                                <p>船壁模式: 限定每个业务能使用的线程数,<hanla></hanla>避免耗尽整个<hanla></hanla><code>tomcat</code>
                                  <hanla></hanla>的资源,<hanla></hanla>因此也叫线程隔离
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">船壁模式</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/1abc8cddd9604746817570a811740775.png" alt="在这里插入图片描述"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p>熔断降级: 由熔断器统计业务执行的异常比例,<hanla></hanla>如果超出阈值则会<code>熔断</code>该业务,<hanla></hanla>拦截访问该业务的一切请求</p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">熔断降级</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ddfca93250eb4b239175e3b3f25ecd7a.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                              <li>
                                <p>流量控制: 限制业务访问的<hanla></hanla><code>QPS</code>，避免服务因流量的突增而故障（<code>可以实现预防，其他三个是避免<hanla></hanla>(已经发生雪崩,<hanla></hanla>阻止传递)</code>）</p>
                                <blockquote>
                                  <p><code>QPS</code>:<hanla></hanla>每秒钟处理的请求数量</p>
                                </blockquote>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>服务保护技术对比</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>**</code></th>
                              <th align="center"><code>Sentinel</code></th>
                              <th align="center"><code>Hystrix（已停止维护）</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><code>隔离级别</code></td>
                              <td align="center">信号量隔离</td>
                              <td align="center">线程池隔离<hanla></hanla>/<hanla></hanla>信号量隔离</td>
                            </tr>
                            <tr>
                              <td align="center"><code>熔断降级策略</code></td>
                              <td align="center">基于慢调用比例或异常比例</td>
                              <td align="center">基于失败比率</td>
                            </tr>
                            <tr>
                              <td align="center">实时指标实现</td>
                              <td align="center">滑动窗口</td>
                              <td align="center">滑动窗口<hanla></hanla>(基于<hanla></hanla><code>RxJava</code>)</td>
                            </tr>
                            <tr>
                              <td align="center">规则配置</td>
                              <td align="center">支持多种数据源</td>
                              <td align="center">支持多种数据源</td>
                            </tr>
                            <tr>
                              <td align="center">扩展性</td>
                              <td align="center">多个扩展性</td>
                              <td align="center">插件的形式</td>
                            </tr>
                            <tr>
                              <td align="center">基于注解的支持</td>
                              <td align="center">支持</td>
                              <td align="center">支持</td>
                            </tr>
                            <tr>
                              <td align="center"><code>限流</code></td>
                              <td align="center">基于<hanla></hanla><code>QPS</code>，支持基于调用关系的限流</td>
                              <td align="center">优先支持</td>
                            </tr>
                            <tr>
                              <td align="center"><code>流量整形</code></td>
                              <td align="center">支持慢启动,<hanla></hanla>匀速排队模式</td>
                              <td align="center">不支持</td>
                            </tr>
                            <tr>
                              <td align="center">系统自适应保护</td>
                              <td align="center">支持</td>
                              <td align="center">不支持</td>
                            </tr>
                            <tr>
                              <td align="center"><code>控制台</code></td>
                              <td align="center">开箱即用,<hanla></hanla>可规则配置,<hanla></hanla>查看秒级监控,<hanla></hanla>机器发现等</td>
                              <td align="center">不完善</td>
                            </tr>
                            <tr>
                              <td align="center">常见框架的适配</td>
                              <td align="center"><code>Servlet、Spring Cloud、Dubbo、gPRC<hanla></hanla>等</code></td>
                              <td align="center"><code>Servlet、Spring Cloud、Netflix</code></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="sentinel-2">
                    <ul>
                      <li>
                        <p>安装</p>
                        <blockquote>
                          <p>文档: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://sentinelguard.io/zh-cn/">https://sentinelguard.io/zh-cn/</a></p>
                          <p><code>github</code>: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></p>
                          <p><code>jar</code>
                            <hanla></hanla>下载链接: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/alibaba/Sentinel/releases/download/1.8.4/sentinel-dashboard-1.8.4.jar">https://github.com/alibaba/Sentinel/releases/download/1.8.4/sentinel-dashboard-1.8.4.jar</a>
                          </p>
                        </blockquote>
                      </li>
                      <li>
                        <p>下载<hanla></hanla><code>jar</code>
                          <hanla></hanla>文件
                        </p>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 在文件位置执行<hanla></hanla></span></span><br><span class="line"><span class="string">java</span> <span class="string">-jar</span> <span class="string">sentinel-dashboard-1.8.4.jar</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">执行</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/1b2f7d9ab54f4c90913c935a88cbaf8f.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>访问</p>
                        <blockquote>
                          <p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:8080/#/login">http://localhost:8080/#/login</a></p>
                          <p>用户名和密码: <code>sentinel</code></p>
                        </blockquote>
                      </li>
                      <li>
                        <p>修改配置</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">配置项</th>
                              <th align="center">默认值</th>
                              <th align="center">说明</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><code>server.port</code></td>
                              <td align="center"><code>8080</code></td>
                              <td align="center">服务端口</td>
                            </tr>
                            <tr>
                              <td align="center"><code>sentinel.dashboard.auth.username</code></td>
                              <td align="center"><code>sentinel</code></td>
                              <td align="center">默认用户名</td>
                            </tr>
                            <tr>
                              <td align="center"><code>sentinel.dashboard.auth.password</code></td>
                              <td align="center"><code>sentinel</code></td>
                              <td align="center">默认密码</td>
                            </tr>
                          </tbody>
                        </table>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 修改<hanla></hanla></span></span><br><span class="line"><span class="string">java</span> <span class="string">-jar</span> <span class="string">sentinel-dashboard-1.8.4.jar</span> <span class="string">-Dserver.port=10010</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="sentinel-3">
                    <ul>
                      <li>
                        <p>在<hanla></hanla><code>order-service</code>
                          <hanla></hanla>中整合<hanla></hanla><code>sentinel</code>
                          <hanla></hanla>并且连接<hanla></hanla><code>sentinel</code>
                          <hanla></hanla>的控制台
                        </p>
                        <ol>
                          <li>
                            <p>引入<hanla></hanla><code>sentinel</code>
                              <hanla></hanla>依赖
                            </p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">&lt;!--   <span class="doctag">TODO:</span> 整合 sentinel --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>配置</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>访问微服务的任意端点<hanla></hanla>(<code>接口 controller</code>),<hanla></hanla>触发<hanla></hanla><code>sentinel</code>
                              <hanla></hanla>监控
                            </p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">查看</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5416f4229aff4834b456a57574455d30.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ol>
                      </li>
                      <li>
                        <p>簇点链路</p>
                        <blockquote>
                          <p><code>簇点链路</code>：就是项目内的调用链路,<hanla></hanla>链路中<code>被监控</code>的每个接口就是一个资源，默认情况下<hanla></hanla><code>sentinel</code>
                            <hanla></hanla>会监控<hanla></hanla><code>SpringMVC</code>
                            <hanla></hanla>的每一个端点<hanla></hanla>(<code>接口</code>),<hanla></hanla>因此<hanla></hanla><code>SpringMVC</code>
                            <hanla></hanla>的每一个端点就是调用链路中的一个资源
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">簇点链路</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5ff56cd954604bc88f418540856c47d9.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>流控</p>
                        <blockquote>
                          <p>单机阈值: 其含义局势限制<hanla></hanla><code>/order/{orderId}</code>
                            <hanla></hanla>这个资源的单机<hanla></hanla><code>QPS</code>
                            <hanla></hanla>为<hanla></hanla><code>100(通过压力测试获取)</code>，超出的请求会被拦截报错
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ce0eb8d8e70648b18296ad11a0f4d405.png" style="zoom: 80%;"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>流控模式</p>
                            <ul>
                              <li>
                                <p>直连: 统计当前资源的请求,<hanla></hanla>触发阈值时对当前资源直接限流,<hanla></hanla>也就是默认的模式</p>
                              </li>
                              <li>
                                <p>关联: 统计与当前资源相关的另一个资源,<hanla></hanla>触发阈值时,<hanla></hanla>对当前资源限流</p>
                                <blockquote>
                                  <p>使用场景: 比如用户支付时需要修改订单状态,<hanla></hanla>同时用户要查询订单,<hanla></hanla>查询和修改操作会争抢数据库锁,<hanla></hanla>产生竞争,<hanla></hanla>业务需求时有限支付和更新订单的业务,<hanla></hanla>因此当修改订单业务触发阈值时,<hanla></hanla>需要对订单业务限流</p>
                                </blockquote>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">配置过程</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/35c06d4b5d604ce5baa68feb7a32ead2.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                                <ul>
                                  <li>
                                    <p>配置流控规则:<hanla></hanla>当<hanla></hanla><code>/order/update</code>
                                      <hanla></hanla>资源被访问的<hanla></hanla><code>QPS</code>
                                      <hanla></hanla>超过<hanla></hanla><code>5</code>
                                      <hanla></hanla>时,<hanla></hanla>对<hanla></hanla><code>/order/query</code>
                                      <hanla></hanla>请求限流
                                    </p>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">对谁限流加给谁</th>
                                          <th align="center">对<hanla></hanla><code>query</code>
                                            <hanla></hanla>限流
                                          </th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/df767255e1324a3596b2891b15475579.png">shishi</td>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/98b4efa1b83947df998bd6870d5bb9b7.png"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                  <li>
                                    <p>满足如下条件使用关联模式</p>
                                    <ul>
                                      <li>两个有竞争关系的资源</li>
                                      <li>一个优先级较高，一个优先级较低</li>
                                    </ul>
                                  </li>
                                </ul>
                              </li>
                              <li>
                                <p>链路: 统计从指定链路访问到本资源的请求时,<hanla></hanla>对指定链路限流</p>
                                <ul>
                                  <li>
                                    <p>两条请求链路</p>
                                    <ul>
                                      <li><code>/test1 =&gt; /common</code></li>
                                      <li><code>/test2 =&gt; /common</code></li>
                                    </ul>
                                  </li>
                                  <li>
                                    <p>案例</p>
                                    <blockquote>
                                      <p>需求: 有查询订单和创建订单业务,<hanla></hanla>两者都需要查询到商品,<hanla></hanla>针对从查询订单进入到查询商品的请求统计,<hanla></hanla>并设置限流</p>
                                    </blockquote>
                                  </li>
                                  <li>
                                    <p>步骤</p>
                                    <ol>
                                      <li>
                                        <p>在<hanla></hanla><code>OrderService</code>
                                          <hanla></hanla>中添加一个<hanla></hanla><code>queryGoods</code>
                                          <hanla></hanla>方法,<hanla></hanla>不用实现业务
                                        </p>
                                      </li>
                                      <li>
                                        <p>在<hanla></hanla><code>OrderController</code>
                                          <hanla></hanla>中,<hanla></hanla>改造<hanla></hanla><code>/order/query</code>
                                          <hanla></hanla>端点,<hanla></hanla>调用<hanla></hanla><code>OrderService</code>
                                          <hanla></hanla>中的<hanla></hanla><code>queryGoods</code>
                                        </p>
                                      </li>
                                      <li>
                                        <p>在<hanla></hanla><code>OrderController</code>
                                          <hanla></hanla>中添加一个<hanla></hanla><code>/orrder/save</code>
                                          <hanla></hanla>的端点,<hanla></hanla>调用<hanla></hanla><code>OrderService</code>
                                          <hanla></hanla>的<hanla></hanla><code>queryGoods</code>
                                          <hanla></hanla>方法
                                        </p>
                                      </li>
                                      <li>
                                        <p>给<hanla></hanla><code>queryGoods</code>
                                          <hanla></hanla>设置限流规则,<hanla></hanla>从<hanla></hanla><code>/order/query</code>
                                          <hanla></hanla>进入<hanla></hanla><code>queryGoods</code>
                                          <hanla></hanla>的方法限制<hanla></hanla><code>QPS</code>
                                          <hanla></hanla>必须小于<hanla></hanla><code>2</code>
                                        </p>
                                        <table>
                                          <thead>
                                            <tr>
                                              <th align="center">配置案例</th>
                                            </tr>
                                          </thead>
                                          <tbody>
                                            <tr>
                                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a39e0fc854c24fcf9bf64469188f03cc.png"></td>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </li>
                                    </ol>
                                  </li>
                                  <li>
                                    <p>配置链路</p>
                                    <ul>
                                      <li>
                                        <p><code>sentinel</code>
                                          <hanla></hanla>默认只标记<hanla></hanla><code>Controller</code>
                                          <hanla></hanla>中的方法为资源,<hanla></hanla>如果要标记其他方法
                                        </p>
                                        <figure class="highlight java">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="meta">@SentinelResource("goods")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">queryGoods</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"queryGoods<hanla></hanla>被调用............."</span>;</span><br><span class="line">}</span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                      <li>
                                        <p><code>Sentinel</code>
                                          <hanla></hanla>默认会将<hanla></hanla><code>Controller</code>
                                          <hanla></hanla>中的方法做<hanla></hanla><code>context</code>
                                          <hanla></hanla>整合,<hanla></hanla>导致链路模式的流控失效
                                        </p>
                                        <figure class="highlight yml">
                                          <table>
                                            <tbody>
                                              <tr>
                                                <td class="gutter">
                                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                  <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span> <span class="comment"># 关闭 context 整合</span></span><br></pre>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </figure>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>流控效果</p>
                        <blockquote>
                          <p>流控效果是指请求达到流控阈值时应该采取的措施</p>
                        </blockquote>
                        <ul>
                          <li>
                            <p>快速失败：达到阈值后,<hanla></hanla>新的请求会被立即拒绝并抛出<hanla></hanla><code>FlowException</code>
                              <hanla></hanla>异常，是默认的处理方式
                            </p>
                          </li>
                          <li>
                            <p><code>warn up</code>：预热模式,<hanla></hanla>对超出阈值的请求同样是拒绝并抛出异常.<hanla></hanla>但这种模式阈值会动态变化,<hanla></hanla>从一个较小的值逐渐增加到最大阈值</p>
                            <blockquote>
                              <p>是应对服务冷启动的一种方案,<hanla></hanla>请求阈值初始值是<hanla></hanla><code>threshold /(除号) coldFactory</code>，持续指定时长后,<hanla></hanla>逐渐提高到<hanla></hanla><code>threshold</code>
                                <hanla></hanla>值，而<hanla></hanla><code>coldFactory</code>
                                <hanla></hanla>的默认值是<hanla></hanla><code>3</code>
                              </p>
                              <p><code>Eg: 设置<hanla></hanla>QPS<hanla></hanla>的 threshold 为 10</code>,<hanla></hanla>预热时间<hanla></hanla><code>5s</code>,<hanla></hanla>那么初始阈值就是<hanla></hanla><code>10/3</code>，也就是<hanla></hanla><code>3</code>,<hanla></hanla>然后再<hanla></hanla><code>5s</code>
                                <hanla></hanla>后逐渐增长到<hanla></hanla><code>10</code>
                              </p>
                            </blockquote>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">增长趋势</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b10053c1acfc4bfbb5d8e046a131e42c.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">配置</th>
                                  <th align="center">实时监控</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/51eeae207a9a48539bb723170630f2b4.png"></td>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/509cbae9482c453ab54eaf32b6934078.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>排队等待: 让所有的请求按照先后次序排队执行,<hanla></hanla>两个请求的间隔不能小于指定时长</p>
                            <blockquote>
                              <p>当请求超过<hanla></hanla><code>QPS</code>
                                <hanla></hanla>阈值时,<hanla></hanla>快速失败和<hanla></hanla><code>warn up</code>
                                <hanla></hanla>会拒绝新的请求并抛出异常,<hanla></hanla>而排队等待则是让所有请求进入一个队列中,<hanla></hanla>然后按照阈值允许的时间间隔内依次执行,<hanla></hanla>后来的请求必须等待前面执行完成,<hanla></hanla>如果请求预期的等待时间超出最大时长,<hanla></hanla>则会被拒绝
                              </p>
                              <p><code>Eg: QPS=5</code>，意味着每<hanla></hanla><code>200ms</code>
                                <hanla></hanla>处理一个队列中的请求,<code>timeout=2000</code>
                                <hanla></hanla>意味着预期等待超过<hanla></hanla><code>2000ms</code>
                                <hanla></hanla>的请求会被拒绝并抛出异常
                              </p>
                            </blockquote>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">过程</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/02127b5173384faf8ca6e0adc6dea120.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>热点参数限流</p>
                        <blockquote>
                          <p>之前的限流是统计访问某个资源的所有请求,<hanla></hanla>判断是否超过<hanla></hanla><code>QPS</code>
                            <hanla></hanla>阈值,<hanla></hanla>而热点参数限流是分别统计<code>参数值相同</code>的请求，判断是否超过<hanla></hanla><code>QPS</code>
                            <hanla></hanla>阈值
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">热点参数限流</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/091fc39837fb4cc09f97001f1ee1f9ba.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>配置位置</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">热点参数配置位置</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2bdad8e6f72341ca9ec40144c286fd6b.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>重要参数解析</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">参数解析</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/406cf533fec043228d56c5f607aeb1d1.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>高级选项参数</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">高级选项参数</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/f2383457589b483dba49a1d802efc508.png" alt="在这里插入图片描述"></td>
                                </tr>
                              </tbody>
                            </table>
                            <ul>
                              <li>如果参数值是<hanla></hanla><code>100</code>，则每<hanla></hanla><code>1s</code>
                                <hanla></hanla>允许的<hanla></hanla><code>QPS</code>
                                <hanla></hanla>为<hanla></hanla><code>10</code>
                              </li>
                              <li>如果参数值是<hanla></hanla><code>101</code>，则每<hanla></hanla><code>1s</code>
                                <hanla></hanla>允许的<hanla></hanla><code>QPS</code>
                                <hanla></hanla>为<hanla></hanla><code>15</code>
                              </li>
                            </ul>
                            <blockquote>
                              <p>热点参数限流对默认的<hanla></hanla><code>SpringMVC</code>
                                <hanla></hanla>资源无效,<hanla></hanla>需要通过<hanla></hanla><code>@SentinelResource</code>
                                <hanla></hanla>注解
                              </p>
                            </blockquote>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="sentinel-4">
                    <ul>
                      <li>
                        <p>授权规则 </p>
                        <blockquote>
                          <p>授权规则 可以对调用方的来源总控制,<hanla></hanla>有白名单和黑名单两种方式</p>
                        </blockquote>
                        <ul>
                          <li>白名单: 来源<hanla></hanla>(<code>origin</code>)<hanla></hanla>在白名单内的调用者允许访问</li>
                          <li>黑名单: 来源<hanla></hanla>(<code>origin</code>)<hanla></hanla>在黑名单内的调用者不允许访问</li>
                        </ul>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">配置</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/837dd06c7fd34b8aa3631f394716e7d5.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>授权规则配置步骤</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">配置授权规则</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ef7386c8c6ab4ffc9060a27f5f12797c.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>在<hanla></hanla><code>gateway</code>
                              <hanla></hanla>服务中,<hanla></hanla>利用网关的过了不起添加名为<hanla></hanla><code>gateway</code>
                              <hanla></hanla>的<hanla></hanla><code>origin</code>
                              <hanla></hanla>头
                            </p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=origin,gateway</span> <span class="comment"># 添加名为 origin 的请求头,<hanla></hanla>值为: gateway</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>从<hanla></hanla><code>request</code>
                              <hanla></hanla>获取一个名为<hanla></hanla><code>origin</code>
                              <hanla></hanla>的请求头,<hanla></hanla>作为<hanla></hanla><code>origin</code>
                              <hanla></hanla>的值
                            </p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="keyword">package</span> com.coderitl.springcloud.sentinel;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeaderOriginParset</span> <span class="keyword">implements</span> <span class="title class_">RequestOriginParser</span> {</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">parseOrigin</span><span class="params">(HttpServletRequest request)</span> {</span><br><span class="line">    <span class="comment">// 1. 获取请求头</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">origin</span> <span class="operator">=</span> request.getHeader(<span class="string">"origin"</span>);</span><br><span class="line">    <span class="comment">// 2. 非空判断</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(origin)) {</span><br><span class="line">      origin = <span class="string">"blank"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> origin;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">添加配置</th>
                                  <th align="center">限制访问来源</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b2c15fe95da54f05a186e1cb51616cba.png"></td>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/acf1dc50085e4e0887d4c78341428f36.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>自定义异常结果</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">异常</th>
                                  <th align="center">说明</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><code>FlowException</code></td>
                                  <td align="center">限流异常</td>
                                </tr>
                                <tr>
                                  <td align="center"><code>ParamFlowException</code></td>
                                  <td align="center">热点参数限流异常</td>
                                </tr>
                                <tr>
                                  <td align="center"><code>DegradeException</code></td>
                                  <td align="center">降级异常</td>
                                </tr>
                                <tr>
                                  <td align="center"><code>AuthorityException</code></td>
                                  <td align="center">授权规则异常</td>
                                </tr>
                                <tr>
                                  <td align="center"><code>SystemBlockException</code></td>
                                  <td align="center">系统规则异常</td>
                                </tr>
                              </tbody>
                            </table>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="keyword">package</span> com.coderitl.springcloud.handler;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SentinelBlockHandler</span> <span class="keyword">implements</span> <span class="title class_">BlockExceptionHandler</span> {</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(</span></span><br><span class="line"><span class="params">      HttpServletRequest httpServletRequest,</span></span><br><span class="line"><span class="params">      HttpServletResponse httpServletResponse,</span></span><br><span class="line"><span class="params">      BlockException e)</span></span><br><span class="line">      <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"未知异常"</span>;</span><br><span class="line">    <span class="comment">// 限流状态码都是 429</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> <span class="number">429</span>;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FlowException) {</span><br><span class="line">      msg = <span class="string">"请求被限流了........."</span>;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> DegradeException) {</span><br><span class="line">      msg = <span class="string">"请求被降级了........."</span>;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ParamFlowException) {</span><br><span class="line">      msg = <span class="string">"热点参数限流........."</span>;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> AuthorityException) {</span><br><span class="line">      msg = <span class="string">"请求没有权限!"</span>;</span><br><span class="line">      <span class="comment">// 权限 401</span></span><br><span class="line">      status = <span class="number">401</span>;</span><br><span class="line">    }</span><br><span class="line">    httpServletResponse.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">    httpServletResponse.setStatus(status);</span><br><span class="line">    httpServletResponse</span><br><span class="line">        .getWriter()</span><br><span class="line">        .println(<span class="string">"{\"message\":\""</span> + msg + <span class="string">"\",\"status\":"</span> + status + <span class="string">"}"</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">优化显示</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/e85c4b57440d449b9b0fd7b98d87ffb6.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="sentinel-5">
                    <ul>
                      <li>
                        <p>规则持久化模式<hanla></hanla>(<code>3<hanla></hanla>种</code>)</p>
                        <ul>
                          <li>
                            <p>规则管理模式-<code>pull</code>
                              <hanla></hanla>模式
                            </p>
                            <blockquote>
                              <p><code>pull</code>
                                <hanla></hanla>模式:<hanla></hanla>控制台将配置的规则推送到<hanla></hanla><code>Sentinel</code>
                                <hanla></hanla>客户端，而客户端会将配置规则保存在本地文件或数据库中，以后会定时去本地文件或数据库中查询,<hanla></hanla>更新本地规则
                              </p>
                            </blockquote>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">缺点:<hanla></hanla>存在时效性</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3e74e50cd9cb4e8490f4ce4e60f0fb57.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>规则管理模式-<code>push</code>
                              <hanla></hanla>模式
                            </p>
                            <blockquote>
                              <p><code>push</code>
                                <hanla></hanla>模式:<hanla></hanla>控制台将配置规则推送到远程配置中心,<hanla></hanla>例如<hanla></hanla><code>Nacos</code>，<code>Sentinel</code>
                                <hanla></hanla>客户端监听<hanla></hanla><code>Nacos</code>，获取配置变更的推送消息,<hanla></hanla>完成本地配置更新|
                              </p>
                            </blockquote>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">推荐</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3789d34fe38f48beaf5ec07d3951c9df.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>原始方式<hanla></hanla>(重启失效)</p>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>Sentinel</code>
                          <hanla></hanla>规则持久化
                        </p>
                        <ol>
                          <li>
                            <p>引入依赖</p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">&lt;!-- 在 order-service 中引入 sentinel 监听 nacos 的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>配置<hanla></hanla><code>nacos</code>
                              <hanla></hanla>地址
                            </p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 在 order-service 中的 application.yml 文件配置 nacos 地址以及监听的配置信息<hanla></hanla></span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">      <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">          <span class="attr">datasource:</span></span><br><span class="line">            <span class="attr">flow:</span></span><br><span class="line">              <span class="attr">nacos:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos 地址</span></span><br><span class="line">                <span class="attr">dataId:</span> <span class="string">orderservice-flow-rules</span></span><br><span class="line">                <span class="attr">groupId:</span> <span class="string">SENTINEL_GROUP</span></span><br><span class="line">                <span class="attr">ruleType:</span> <span class="string">flow</span> <span class="comment"># 还可以是 degrade authority param-flow</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                        </ol>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
          <h5 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h5>
          <ul>
            <li>
              <p>详细使用</p>
              <div class="tabs" id="redis-持久化">
                <ul class="nav-tabs">
                  <li class="tab active"><button type="button" data-href="#redis-持久化-1">Redis-持久化<hanla></hanla></button></li>
                  <li class="tab"><button type="button" data-href="#redis-持久化-2">Redis<hanla></hanla>集群<hanla></hanla></button></li>
                  <li class="tab"><button type="button" data-href="#redis-持久化-3">Redis<hanla></hanla>分片集群</button></li>
                </ul>
                <div class="tab-contents">
                  <div class="tab-item-content active" id="redis-持久化-1">
                    <ul>
                      <li>
                        <p>持久化</p>
                        <ul>
                          <li>
                            <p><code>RDB</code></p>
                            <blockquote>
                              <p>全称是<hanla></hanla><code>Redis Database Backup file(Redis<hanla></hanla>数据备份文件)</code>,<hanla></hanla>也被叫做<hanla></hanla><code>Redis</code>
                                <hanla></hanla>数据快照。简单来说就是把内存中的所有数据都记录到磁盘中,<hanla></hanla>当<hanla></hanla><code>Redis</code>
                                <hanla></hanla>实例故障重启后,<hanla></hanla>从磁盘读取快照文件,<hanla></hanla>恢复数据
                              </p>
                              <p>快照文件称为<hanla></hanla><code>RDB</code>
                                <hanla></hanla>文件,<hanla></hanla>默认是保存在当前运行目录
                              </p>
                            </blockquote>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">：6379&gt;</span>  <span class="string">save</span> <span class="comment"># 由 Redis 主进程来执行 RDB,<hanla></hanla>会阻塞所有命令<hanla></hanla></span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">：6379&gt;</span> <span class="string">bgsave</span> <span class="comment"># 开启子进程执行 RDB,<hanla></hanla>避免主进程收到影响</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis 停机时会执行一次 RDB</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">触发机制</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/36124aac51044ed19ceec2500b446e79.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p><code>bgsave</code></p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center"><code>bgsave</code>
                                    <hanla></hanla>流程
                                  </th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c7a63486711c43278d18bda1ee50f809.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <ul>
                              <li>基本流程<ol>
                                  <li><code>fork</code>
                                    <hanla></hanla>主进程得到一个子进程,<hanla></hanla>共享内存空间
                                  </li>
                                  <li>子进程读取内存数据并写入新的<hanla></hanla><code>RDB</code>
                                    <hanla></hanla>文件
                                  </li>
                                  <li>用新<hanla></hanla><code>RDB</code>
                                    <hanla></hanla>文件替换旧的<hanla></hanla><code>RDB</code>
                                    <hanla></hanla>文件
                                  </li>
                                </ol>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>AOF</code>
                          <hanla></hanla>持久化
                        </p>
                        <blockquote>
                          <p><code>AOF</code>
                            <hanla></hanla>全称为<hanla></hanla><code>Append Oble File（追加文件）</code>,<code>Redis</code>
                            <hanla></hanla>处理的每一个写命令都会记录在<hanla></hanla><code>AOF</code>
                            <hanla></hanla>文件,<hanla></hanla>可以看作是命令日志文件
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>AOF</code>（存储了命令,<hanla></hanla>执行命令恢复到原始数据）</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a26125201071467b88c21ac984612e7f.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <blockquote>
                          <p><code>AOF</code>
                            <hanla></hanla>默认是关闭的,<hanla></hanla>需要修改<hanla></hanla><code>redis.conf</code>
                            <hanla></hanla>配置文件来开启<hanla></hanla><code>AOF</code>
                          </p>
                        </blockquote>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># 禁用 RDB</span></span><br><span class="line"><span class="string">save</span> <span class="string">""</span></span><br><span class="line"><span class="comment"># 是否开启 AOF 功能 默认是 no</span></span><br><span class="line"><span class="string">appendonly</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># AOF 文件的名称<hanla></hanla></span></span><br><span class="line"><span class="string">appendfilename</span> <span class="string">"appendonly.aof"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AOF 的命令记录的频率也可以通过 redis.conf 文件来配置 </span></span><br><span class="line"><span class="comment"># 表示没执行一次写命令 立即记录到 AOF 文件<hanla></hanla></span></span><br><span class="line"><span class="string">appendfsync</span> <span class="string">always</span></span><br><span class="line"><span class="comment"># 写命令执行完先放入 AOF 缓冲区,<hanla></hanla>然后表示每隔 1s 将缓冲区数据写到 AOF 文件,<hanla></hanla>是默认方案<hanla></hanla></span></span><br><span class="line"><span class="string">appendfsync</span> <span class="string">everysec</span></span><br><span class="line"><span class="comment"># 写命令执行完先放入 AOF 缓冲区,<hanla></hanla>由操作系统决定何时将缓冲区内容写回磁盘<hanla></hanla></span></span><br><span class="line"><span class="string">appendfsync</span> <span class="literal">no</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <table>
                          <thead>
                            <tr>
                              <th>配置项</th>
                              <th>刷盘时机</th>
                              <th>优点</th>
                              <th>缺点</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><code>always</code></td>
                              <td>同步刷盘</td>
                              <td>可靠性高，几乎不丢数据</td>
                              <td>性能影响大</td>
                            </tr>
                            <tr>
                              <td><code>everysec</code></td>
                              <td>每秒刷盘</td>
                              <td>性能适中</td>
                              <td>最多丢失<hanla></hanla><code>1s</code>
                                <hanla></hanla>数据
                              </td>
                            </tr>
                            <tr>
                              <td><code>no</code></td>
                              <td>操作系统控制</td>
                              <td>性能最好</td>
                              <td>可靠性差,<hanla></hanla>可能丢失大量数据</td>
                            </tr>
                          </tbody>
                        </table>
                        <blockquote>
                          <p>因为是记录命令,<code>AOF</code>
                            <hanla></hanla>文件会比<hanla></hanla><code>RDB</code>
                            <hanla></hanla>文件大得多,<hanla></hanla>而且<hanla></hanla><code>AOF</code>
                            <hanla></hanla>会记录对同一个<hanla></hanla><code>key</code>
                            <hanla></hanla>的多次操作,<hanla></hanla>但只有最后一次写操作才有意义,<hanla></hanla>铜鼓执行<hanla></hanla><code>bgrewriteaof</code>
                            <hanla></hanla>命令,<hanla></hanla>可以让<hanla></hanla><code>AOF</code>
                            <hanla></hanla>文件执行重写功能,<hanla></hanla>用最少的命令达到相同效果
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">执行重写<hanla></hanla><code>bgrewriteaof(redis 命令行执行)</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a92d71ebbe484f639d26c611947803f3.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <blockquote>
                          <p><code>Redis</code>
                            <hanla></hanla>也会在触发阈值时自动去重写<hanla></hanla><code>AOF</code>
                            <hanla></hanla>文件,<hanla></hanla>阈值也可以在<hanla></hanla><code>redis.conf</code>
                            <hanla></hanla>中配置
                          </p>
                        </blockquote>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="comment"># AOF 文件比上次文件 增长超过多少百分比则触发重写<hanla></hanla></span></span><br><span class="line"><span class="string">auto-aof-rewrite-percentage</span> <span class="number">100</span></span><br><span class="line"><span class="comment"># AOF 文件体积最小多大以上才可以触发重写<hanla></hanla></span></span><br><span class="line"><span class="string">auto-aof-rewrite-min-size</span> <span class="string">64mb</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                        <ul>
                          <li>
                            <p><code>RDB</code>
                              <hanla></hanla>与<hanla></hanla><code>AOF</code>
                              <hanla></hanla>对比
                            </p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center"></th>
                                  <th align="center"><code>RDB</code></th>
                                  <th align="center"><code>AOF</code></th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center">持久化方式</td>
                                  <td align="center">定时对整个内存做快照</td>
                                  <td align="center">记录每一次执行的命令</td>
                                </tr>
                                <tr>
                                  <td align="center">数据完整性</td>
                                  <td align="center">不完整，两次备份之间会丢失</td>
                                  <td align="center">相对完整,<hanla></hanla>取决于刷盘策略</td>
                                </tr>
                                <tr>
                                  <td align="center">文件大小</td>
                                  <td align="center">会有压缩,<hanla></hanla>文件体积小</td>
                                  <td align="center">记录命令，文件体积很大</td>
                                </tr>
                                <tr>
                                  <td align="center">宕机恢复速度</td>
                                  <td align="center">很快</td>
                                  <td align="center">慢</td>
                                </tr>
                                <tr>
                                  <td align="center">数据恢复优先级</td>
                                  <td align="center">低，因为数据完整性不如<hanla></hanla><code>AOF</code></td>
                                  <td align="center">高,<hanla></hanla>因为数据完整性更高</td>
                                </tr>
                                <tr>
                                  <td align="center">系统资源占用</td>
                                  <td align="center">高,<hanla></hanla>大量<hanla></hanla><code>CPU</code>
                                    <hanla></hanla>和内存消耗
                                  </td>
                                  <td align="center">低，主要是磁盘<hanla></hanla><code>IO</code>
                                    <hanla></hanla>资源但<hanla></hanla><code>AOF</code>
                                    <hanla></hanla>重写时会占用大量<hanla></hanla><code>CPU</code>
                                    <hanla></hanla>和内存资源
                                  </td>
                                </tr>
                                <tr>
                                  <td align="center">使用场景</td>
                                  <td align="center">可以容忍数分钟的数据丢失,<hanla></hanla>追求更快的启动速度</td>
                                  <td align="center">对数据安全性要求较高常见</td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="redis-持久化-2">
                    <ul>
                      <li>
                        <p>搭建集群</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">一主二从</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/65fa31b4a23a438aacb92c2fffc4ed27.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>配置文件</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 进入 tmp 目录<hanla></hanla></span></span><br><span class="line"><span class="string">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 创建目录<hanla></hanla></span></span><br><span class="line"><span class="string">mkdir</span> <span class="number">7001  </span><span class="number">7002 </span><span class="number">7003</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝配置文件<hanla></hanla>(一键考培 参数 1 是数字 `一` )</span></span><br><span class="line"><span class="string">echo</span> <span class="number">7001 </span><span class="number">7002 </span><span class="number">7003</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-t</span> <span class="string">-n</span> <span class="number">1</span> <span class="string">cp</span> <span class="string">redis-6.2.4/redis.conf</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>修改每个实例的端口、工作目录</p>
                            <blockquote>
                              <p>修改每个文件夹内的配置文件,<hanla></hanla>将端口分别修改为<hanla></hanla><code>7001,7002,7003</code>，将<hanla></hanla><code>rdb</code>
                                <hanla></hanla>文件保存位置都修改自己所在目录
                              </p>
                            </blockquote>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">-e</span> <span class="string">'s/6379/7001/g'</span> <span class="string">-e</span> <span class="string">'s/dir .\//dir \/tmp\/7001\//g'</span> <span class="number">7001</span><span class="string">/redis.conf</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">-e</span> <span class="string">'s/6379/7002/g'</span> <span class="string">-e</span> <span class="string">'s/dir .\//dir \/tmp\/7002\//g'</span> <span class="number">7002</span><span class="string">/redis.conf</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">-e</span> <span class="string">'s/6379/7003/g'</span> <span class="string">-e</span> <span class="string">'s/dir .\//dir \/tmp\/7003\//g'</span> <span class="number">7003</span><span class="string">/redis.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>修改每个实例的声明<hanla></hanla><code>IP</code></p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 虚拟机本身有多个 ip 为了避免将来混乱 我们需要在 redis.conf 文件中指定每一个实例的绑定 ip 信息</span></span><br><span class="line"><span class="comment"># redis 实例的声明 IP</span></span><br><span class="line"><span class="string">replica-announce-ip</span> </span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment">#  逐一修改 1a:<hanla></hanla>数字 1 a:<hanla></hanla>追加模式 (1a：第一行后追加)</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">'1a replica-announce-ip 43.142.80.9'</span> <span class="number">7001</span><span class="string">/redis.conf</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">'1a replica-announce-ip 43.142.80.9'</span> <span class="number">7002</span><span class="string">/redis.conf</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">'1a replica-announce-ip 43.142.80.9'</span> <span class="number">7003</span><span class="string">/redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一键修改<hanla></hanla></span></span><br><span class="line"><span class="string">printf</span> <span class="string">'%s\n'</span> <span class="number">7001 </span><span class="number">7002 </span><span class="number">7003</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-I{}</span> <span class="string">-t</span> <span class="string">sed</span> <span class="string">-i</span> <span class="string">'1a replica-announce-ip 43.142.80.9'</span> {}<span class="string">/redis.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>启动三个窗口实例方便查看日志</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">同时启动服务: <code>tmp/ redis-server 700x/redis.conf</code></th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/e1504661f7ba4a0f804344b600d15097.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>开启主从关系</p>
                        <ul>
                          <li>
                            <p>有临时和永久两种模式</p>
                            <ul>
                              <li>
                                <p>修改配置文件<hanla></hanla>(<code>永久生效</code>)</p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># 在 redis.conf 中添加一行配置 replicaof | slaveof(5.0<hanla></hanla>以前)<hanla></hanla>命令<hanla></hanla></span></span><br><span class="line"><span class="string">slaveof</span> <span class="string">&lt;masterip&gt;</span> <span class="string">&lt;masterport&gt;</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                              </li>
                              <li>
                                <p>使用<hanla></hanla><code>redis-cli</code>
                                  <hanla></hanla>客户端连接到<hanla></hanla><code>redis</code>
                                  <hanla></hanla>服务,<hanla></hanla>执行<hanla></hanla><code>slaveof</code>
                                  <hanla></hanla>命令<hanla></hanla>(<code>重启后生效</code>)
                                </p>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="string">slaveof</span>  <span class="string">&lt;masterip&gt;</span> <span class="string">&lt;masterport&gt;</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <figure class="highlight yml">
                                  <table>
                                    <tbody>
                                      <tr>
                                        <td class="gutter">
                                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                        </td>
                                        <td class="code">
                                          <pre><span class="line"><span class="comment"># 前提条件所有主机配置如下内容<hanla></hanla>(否则集群失败)</span></span><br><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">注释</span> <span class="string">bind</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">protected-mode</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接测试 登录 7002 | 7003</span></span><br><span class="line"><span class="string">redis-cli</span> <span class="string">-p</span> <span class="number">7002</span></span><br><span class="line"><span class="comment"># 执行 slaveof =&gt; 7002 | 7003 成为 7001 的 slaveof(从机)</span></span><br><span class="line"><span class="string">slaveof</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span> <span class="number">7001</span></span><br></pre>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </figure>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">成功搭建集群环境（<code>命令: info replication 查看信息</code>）</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/824cfb52383a4cc6ba77420b049abebf.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>数据同步原理</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">数据同步原理（第一次是全量同步）</th>
                              <th align="center">后续同步使用<hanla></hanla><code>replid</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c4f0ac4ffebd4273ae742eec7792f5db.png"></td>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a566d0e2d6b54e65b1a11dc5f4c8ed66.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p><code>master</code>
                              <hanla></hanla>如何判断<hanla></hanla><code>slave</code>
                              <hanla></hanla>是不是第一次来同步数据?
                            </p>
                            <ul>
                              <li><code>Replication Id</code>:<hanla></hanla>简称<hanla></hanla><code>replid</code>
                                <hanla></hanla>是数据集的标记,<code>id</code>
                                <hanla></hanla>一致则说明是同一数据集，每一个<hanla></hanla><code>master</code>
                                <hanla></hanla>都有唯一的<hanla></hanla><code>reolid</code>，<code>slave</code>
                                <hanla></hanla>则会继承<hanla></hanla><code>master</code>
                                <hanla></hanla>节点的<hanla></hanla><code>replid</code>
                              </li>
                              <li><code>offset</code>
                                <hanla></hanla>偏移量,<hanla></hanla>随着记录在<hanla></hanla><code>repl_baklog</code>
                                <hanla></hanla>中的数据增多而逐渐增大,<code>slave</code>
                                <hanla></hanla>完成同步时也会记录当前同步的<hanla></hanla><code>offset</code>，如果<hanla></hanla><code>slave</code>
                                <hanla></hanla>的<hanla></hanla><code>offset</code>
                                <hanla></hanla>小于<hanla></hanla><code>master</code>
                                <hanla></hanla>的<hanla></hanla><code>offset</code>，说明<hanla></hanla><code>slave</code>
                                <hanla></hanla>数据落后于<hanla></hanla><code>master</code>，需要更新
                              </li>
                            </ul>
                            <blockquote>
                              <p>因此<hanla></hanla><code>slave</code>
                                <hanla></hanla>做数据同步,<hanla></hanla>必须向<hanla></hanla><code>master</code>
                                <hanla></hanla>声明自己的<hanla></hanla><code>replication Id</code>
                                <hanla></hanla>和<hanla></hanla><code>offset</code>，<code>master</code>
                                <hanla></hanla>才可以判断到底需要同步那些数据
                              </p>
                            </blockquote>
                          </li>
                          <li>
                            <p>增量同步<hanla></hanla>(<code>slave</code>
                              <hanla></hanla>重启后同步)
                            </p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">增量同步</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/8e5208eaecdf44468fd65c487e88cf95.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <blockquote>
                              <p><code>repl_baklog</code>
                                <hanla></hanla>大小有上限,<hanla></hanla>写满后会覆盖最早的数据,<hanla></hanla>如果<hanla></hanla><code>slave</code>
                                <hanla></hanla>断开时间过久,<hanla></hanla>导致尚未备份的数据被覆盖,<hanla></hanla>则无法基于<hanla></hanla><code>log</code>
                                <hanla></hanla>做增量同步,<hanla></hanla>只能再次全量同步
                              </p>
                            </blockquote>
                          </li>
                          <li>
                            <p>优化<hanla></hanla><code>Redis</code>
                              <hanla></hanla>主从集群
                            </p>
                            <ul>
                              <li>
                                <p>在<hanla></hanla><code>master</code>
                                  <hanla></hanla>中配置<hanla></hanla><code>repl-diskless-sync yes</code>
                                  <hanla></hanla>启用无磁盘复制,<hanla></hanla>避免全量同步是的<code>磁盘 IO</code>
                                </p>
                              </li>
                              <li>
                                <p><code>Redis</code>
                                  <hanla></hanla>单节点上的内存占用不要太大,<hanla></hanla>减少<hanla></hanla><code>RDB</code>
                                  <hanla></hanla>导致的过多磁盘<hanla></hanla><code>IO</code>
                                </p>
                              </li>
                              <li>
                                <p>适当提高<hanla></hanla><code>repl_baklog</code>
                                  <hanla></hanla>的大小,<hanla></hanla>发现<hanla></hanla><code>slave</code>
                                  <hanla></hanla>宕机时尽快实现故障恢复,<hanla></hanla>尽可能避免全量同步
                                </p>
                              </li>
                              <li>
                                <p>限制一个<hanla></hanla><code>master</code>
                                  <hanla></hanla>上的<hanla></hanla><code>slave</code>
                                  <hanla></hanla>节点数量,<hanla></hanla>如果实在是太多<hanla></hanla><code>slave</code>,<hanla></hanla>则可以采用<code>主-从-从</code>链式结构,<hanla></hanla>减少<hanla></hanla><code>master</code>
                                  <hanla></hanla>压力
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center"><code>主-从-从</code>链式</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/9ee42d6043e54b0c8bd0eb5604f21dd0.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>总结</p>
                            <ul>
                              <li>简述全量同步和增量同步的区别<ul>
                                  <li>全量同步: <code>master</code>
                                    <hanla></hanla>将完整的内存数据生成<hanla></hanla><code>RDB</code>，发送<hanla></hanla><code>RDB</code>
                                    <hanla></hanla>到<hanla></hanla><code>slave</code>，后续命令则记录在<hanla></hanla><code>repl_baklog</code>，逐个发送给<hanla></hanla><code>slave</code>
                                  </li>
                                  <li>增量同步: <code>slave</code>
                                    <hanla></hanla>提交自己的<hanla></hanla><code>offset</code>
                                    <hanla></hanla>到<hanla></hanla><code>master</code>，<code>master</code>
                                    <hanla></hanla>获取<hanla></hanla><code>repl_baklog</code>
                                    <hanla></hanla>中从<hanla></hanla><code>offset</code>
                                    <hanla></hanla>之后的命令给<hanla></hanla><code>slave</code>
                                  </li>
                                </ul>
                              </li>
                              <li>什么时候执行全量同步<ul>
                                  <li><code>slave</code>
                                    <hanla></hanla>节点第一次连接<hanla></hanla><code>master</code>
                                    <hanla></hanla>节点时
                                  </li>
                                  <li><code>slave</code>
                                    <hanla></hanla>节点断开时间太久,<code>repl_baklog</code>
                                    <hanla></hanla>中的<hanla></hanla><code>offset</code>
                                    <hanla></hanla>已经被覆盖时
                                  </li>
                                </ul>
                              </li>
                              <li>什么时候执行增量同步<ul>
                                  <li><code>slave</code>
                                    <hanla></hanla>节点断开又恢复,<hanla></hanla>并且在<hanla></hanla><code>repl_baklog</code>
                                    <hanla></hanla>中能找到<hanla></hanla><code>offset</code>
                                    <hanla></hanla>时
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>哨兵作用</p>
                        <blockquote>
                          <p><code>Redis</code>
                            <hanla></hanla>提供了哨兵<hanla></hanla><code>Sentinel</code>
                            <hanla></hanla>机制来实现主从集群的自动故障恢复
                          </p>
                        </blockquote>
                        <ul>
                          <li>
                            <p>监控:<code>Sentinel</code>
                              <hanla></hanla>会不断检查你的<hanla></hanla><code>master</code>
                              <hanla></hanla>和<hanla></hanla><code>slave</code>
                              <hanla></hanla>是否按预期工作
                            </p>
                          </li>
                          <li>
                            <p>自动故障恢复：如果<hanla></hanla><code>master</code>
                              <hanla></hanla>故障,<code>Sentinel</code>
                              <hanla></hanla>会将一个<hanla></hanla><code>slave</code>
                              <hanla></hanla>提升为<hanla></hanla><code>master</code>，当故障实例恢复后也已新的<hanla></hanla><code>master</code>
                              <hanla></hanla>为主
                            </p>
                          </li>
                          <li>
                            <p>通知：<code>Sentinel</code>
                              <hanla></hanla>充当<hanla></hanla><code>Redis</code>
                              <hanla></hanla>客户端的服务发现来源,<hanla></hanla>当集群发生故障转移时,<hanla></hanla>会将最新信息推送给<hanla></hanla><code>Redis</code>
                              <hanla></hanla>的客户端
                            </p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">哨兵</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/6f2dcd35c11e4dbfb3bfd289f65c073c.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>服务状态监控</p>
                            <blockquote>
                              <p><code>Sentinel</code>
                                <hanla></hanla>基于心跳机制检测服务状态,<hanla></hanla>每隔<hanla></hanla><code>1s</code>
                                <hanla></hanla>向集群的每个实例发送<hanla></hanla><code>ping</code>
                                <hanla></hanla>命令
                              </p>
                            </blockquote>
                            <ul>
                              <li>主观下线: 如果某<hanla></hanla><code>sentinel</code>
                                <hanla></hanla>节点发现某实例未在规定时间响应,<hanla></hanla>则认为该实例<code>主观下线</code>
                              </li>
                              <li>客观下线: 若超过指定数量<hanla></hanla>(<code>quorum</code>)<hanla></hanla>的<hanla></hanla><code>Sentinel</code>
                                <hanla></hanla>都认为该实例主观下线,<hanla></hanla>则该实例客观下线,<code>quorum</code>
                                <hanla></hanla>值最好超过<hanla></hanla><code>sentinel</code>
                                <hanla></hanla>实例数量的一半
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>选举新的<hanla></hanla><code>master</code></p>
                            <blockquote>
                              <p>一旦发现<hanla></hanla><code>master</code>
                                <hanla></hanla>故障,<code>Sentinel</code>
                                <hanla></hanla>需要在<hanla></hanla><code>slave</code>
                                <hanla></hanla>中选择一个作为新的<hanla></hanla><code>master</code>，选择依据如下:
                              </p>
                            </blockquote>
                            <ol>
                              <li>首先会判断<hanla></hanla><code>slave</code>
                                <hanla></hanla>节点与<hanla></hanla><code>master</code>
                                <hanla></hanla>节点断开时间长短,<hanla></hanla>如果超过指定值<hanla></hanla>(<code>down-after-milliseconds * 10</code>)<hanla></hanla>则会排除该<hanla></hanla><code>slave</code>
                                <hanla></hanla>节点
                              </li>
                              <li>然后判断<hanla></hanla><code>slave</code>
                                <hanla></hanla>节点的<hanla></hanla><code>slave-prioity</code>
                                <hanla></hanla>值,<hanla></hanla>越小优先级越高,<hanla></hanla>如果是<hanla></hanla><code>0</code>
                                <hanla></hanla>则永不参与选举
                              </li>
                              <li>如果<hanla></hanla><code>slave-prority</code>
                                <hanla></hanla>一样,<hanla></hanla>则判断<hanla></hanla><code>slave</code>
                                <hanla></hanla>节点的<hanla></hanla><code>offset</code>
                                <hanla></hanla>值,<hanla></hanla>越大说明数据越新,<hanla></hanla>优先级越高
                              </li>
                              <li>最后是判断<hanla></hanla><code>slave</code>
                                <hanla></hanla>节点的运行<hanla></hanla><code>id</code>
                                <hanla></hanla>大小,<hanla></hanla>越小优先级越高
                              </li>
                            </ol>
                          </li>
                          <li>
                            <p>如何实现故障转移</p>
                            <blockquote>
                              <p>当选中了其中一个<hanla></hanla><code>slave</code>
                                <hanla></hanla>为新的<hanla></hanla><code>master</code>
                                <hanla></hanla>后
                              </p>
                            </blockquote>
                            <ol>
                              <li>
                                <p><code>Sentinel</code>
                                  <hanla></hanla>给备选的<hanla></hanla><code>slave</code>
                                  <hanla></hanla>节点发送<hanla></hanla><code>slaveof no one</code>
                                  <hanla></hanla>命令,<hanla></hanla>让该节点成为<hanla></hanla><code>master</code>
                                </p>
                              </li>
                              <li>
                                <p><code>Sentinel</code>
                                  <hanla></hanla>给所有其他<hanla></hanla><code>slave</code>
                                  <hanla></hanla>发送<hanla></hanla><code>slaveof ip poort</code>
                                  <hanla></hanla>命令,<hanla></hanla>让这些<hanla></hanla><code>slave</code>
                                  <hanla></hanla>成为新<hanla></hanla><code>master</code>
                                  <hanla></hanla>的从节点,<hanla></hanla>开始新的<hanla></hanla><code>master</code>
                                  <hanla></hanla>上同步数据
                                </p>
                              </li>
                              <li>
                                <p>最后,<code>Sentinel</code>
                                  <hanla></hanla>将故障节点标记为<hanla></hanla><code>slave</code>，当故障节点恢复后会自动成为新的<hanla></hanla><code>master</code>
                                  <hanla></hanla>的<hanla></hanla><code>slave</code>
                                  <hanla></hanla>节点
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">故障转移</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/5be0c5f0db5e434eb9e0bd17cbe6e3b2.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ol>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>哨兵集群搭建</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">哨兵集群搭建图</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ae437d3fa57d4968a1191e9b275d3691.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <ul>
                          <li>
                            <p>创建目录</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 创建文件夹<hanla></hanla></span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">s1</span> <span class="string">s2</span> <span class="string">s3</span></span><br><span class="line"><span class="comment"># 创建配置文件<hanla></hanla></span></span><br><span class="line"><span class="string">cd</span> <span class="string">s1/</span></span><br><span class="line"></span><br><span class="line"><span class="string">vim</span> <span class="string">sentinel.conf</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># sentinel.conf 文件内容 3<hanla></hanla>份</span></span><br><span class="line"><span class="comment"># 是当前 sentinel 实例的端口<hanla></hanla></span></span><br><span class="line"><span class="string">port</span> <span class="number">27001</span> </span><br><span class="line"><span class="string">sentinel</span> <span class="string">announce-ip</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span>  </span><br><span class="line"><span class="comment"># 指定主节点信息<hanla></hanla></span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">monitor</span> <span class="string">mymaster</span>  <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span>  <span class="number">7001 </span><span class="number">2</span>  </span><br><span class="line"><span class="string">sentinel</span> <span class="string">down-after-milliseconds</span> <span class="string">mymaster</span> <span class="number">5000</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">failover-timeout</span> <span class="string">mymaster</span> <span class="number">60000</span></span><br><span class="line"><span class="string">dir</span> <span class="string">"/tmp/s1"</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li>解读<ul>
                                  <li><code>mymaster</code>:<hanla></hanla>主节点名称,<hanla></hanla>自定义</li>
                                  <li><code> 43.142.80.9 7001</code>:<hanla></hanla>主节点的 <code>ip</code>
                                    <hanla></hanla>和端口
                                  </li>
                                  <li><code>2</code>
                                    <hanla></hanla>选举<hanla></hanla><code>master</code>
                                    <hanla></hanla>时的<hanla></hanla><code>quorum</code>
                                    <hanla></hanla>值
                                  </li>
                                </ul>
                              </li>
                            </ul>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 方式一: 逐个拷贝<hanla></hanla></span></span><br><span class="line"><span class="string">cp</span> <span class="string">s1/sentinel.conf</span> <span class="string">s2</span></span><br><span class="line"><span class="string">cp</span> <span class="string">s1/sentinel.conf</span> <span class="string">s3</span></span><br><span class="line"><span class="comment"># 方式二: 管道组合命令 一键拷贝<hanla></hanla></span></span><br><span class="line"><span class="string">echo</span> <span class="string">s2</span> <span class="string">s3</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-t</span> <span class="string">-n</span> <span class="number">1</span> <span class="string">cp</span> <span class="string">s1/sentinel.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 修改 s2、s3 两个文件夹内的配置文件,<hanla></hanla>将端口分别修改为 27002 、27003</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">-e</span> <span class="string">'s/27001/27002/g'</span> <span class="string">-e</span> <span class="string">'s/s1/s2/g'</span> <span class="string">s2/sentinel.conf</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">-e</span> <span class="string">'s/27001/27003/g'</span> <span class="string">-e</span> <span class="string">'s/s1/s3/g'</span> <span class="string">s3/sentinel.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">流程信息</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/6da5b25fa2b84f788fff095ae531768d.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>启动<hanla></hanla><code>3<hanla></hanla>个 redis</code>
                              <hanla></hanla>实例查看
                            </p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 第 1 个<hanla></hanla></span></span><br><span class="line"><span class="string">redis-sentinel</span> <span class="string">s1/sentinel.conf</span></span><br><span class="line"><span class="comment"># 第 2 个<hanla></hanla></span></span><br><span class="line"><span class="string">redis-sentinel</span> <span class="string">s2/sentinel.conf</span></span><br><span class="line"><span class="comment"># 第 3 个<hanla></hanla></span></span><br><span class="line"><span class="string">redis-sentinel</span> <span class="string">s3/sentinel.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center"><code>redis-sentinel</code>
                                    <hanla></hanla>成功集群
                                  </th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bf2f049c219145d1857c9a3cd277a810.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>RedisTemplate</code>
                          <hanla></hanla>的哨兵模式
                        </p>
                        <ul>
                          <li>
                            <p>引入依赖</p>
                            <figure class="highlight xml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>修改配置</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io.lettuce.core:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">MM-dd</span> <span class="string">HH:mm:ss:SSS</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">master:</span> <span class="string">mymaster</span> <span class="comment"># 指定 master 名称</span></span><br><span class="line">      <span class="attr">nodes:</span> <span class="comment"># 指定 redis-sentinel 集群信息</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:27001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:27002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:27003</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>控制器</p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloRedisController</span> {</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/get/{key}")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hi</span><span class="params">(<span class="meta">@PathVariable</span> String key)</span> {</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/set/{key}/{value}")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hi</span><span class="params">(<span class="meta">@PathVariable</span> String key, <span class="meta">@PathVariable</span> String value)</span> {</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success add key"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>配置主从读写分离</p>
                            <figure class="highlight java">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="keyword">package</span> com.coderitl.springcloud.redis.conf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisBeanConf</span> {</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> LettuceClientConfigurationBuilderCustomizer <span class="title function_">clientConfigurationBuilderCustomizer</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> clientConfigurationBuilder -&gt;</span><br><span class="line">        clientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <blockquote>
                              <p>这里的<hanla></hanla><code>ReadFrom</code>
                                <hanla></hanla>是配置<hanla></hanla><code>Redis</code>
                                <hanla></hanla>的读取策略,<hanla></hanla>是一个<code>枚举</code>,<hanla></hanla>包括如下选择
                              </p>
                            </blockquote>
                            <ul>
                              <li><code>MASTER</code>: 从主节点读取</li>
                              <li><code>MASTER_PREFFERRED</code>: 优先从<hanla></hanla><code>master</code>
                                <hanla></hanla>节点读取,<code>master</code>
                                <hanla></hanla>不可用才读取<hanla></hanla><code>replica</code>
                              </li>
                              <li><code>REPLICA</code>
                                <hanla></hanla>从<hanla></hanla><code>slave（replica）节点读取</code>
                              </li>
                              <li><code>REPLICA_PREFERRED</code>
                                <hanla></hanla>优先从<hanla></hanla><code>slave（replica）</code>节点读取,<hanla></hanla>所有的<hanla></hanla><code>slave</code>
                                <hanla></hanla>都不可用才读取<hanla></hanla><code>master</code>
                              </li>
                            </ul>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">成功获取<hanla></hanla><code>Redis</code>
                                    <hanla></hanla>数据
                                  </th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ca771c7280a04ebcb7ea9244dd85d7ea.png"></td>
                                </tr>
                              </tbody>
                            </table>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">连接日志信息</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7c481838ae284b489ea6cd55e08ebed2.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                  <div class="tab-item-content" id="redis-持久化-3">
                    <ul>
                      <li>
                        <p>结构</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">结构图</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a9984329a56247ab992416d62fcf4486.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>分片集群结构</p>
                        <blockquote>
                          <p>主从和哨兵可以解决高可用,<hanla></hanla>高并发读的问题,<hanla></hanla>但是依然有两个问题没有解决</p>
                        </blockquote>
                        <ul>
                          <li>海量数据存储问题</li>
                          <li>高并发写问题</li>
                        </ul>
                        <blockquote>
                          <p>使用分片集群可以解决上述问题,<hanla></hanla>分片集群特征:</p>
                        </blockquote>
                        <ul>
                          <li>集群中有多个<hanla></hanla><code>master</code>，每个<hanla></hanla><code>master</code>
                            <hanla></hanla>保存不同数据
                          </li>
                          <li>每个<hanla></hanla><code>master</code>
                            <hanla></hanla>都可以由多个<hanla></hanla><code>slave</code>
                            <hanla></hanla>节点
                          </li>
                          <li><code>master</code>
                            <hanla></hanla>之间通过<hanla></hanla><code>ping</code>
                            <hanla></hanla>检测彼此健康状态
                          </li>
                          <li>客户端请求可以访问集群任意节点,<hanla></hanla>最终都会被转发到正确节点</li>
                        </ul>
                      </li>
                      <li>
                        <p>搭建分片集群</p>
                        <ul>
                          <li>
                            <p>结构图</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center"><code>3<hanla></hanla>主<hanla></hanla>3<hanla></hanla>从</code></th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ef8ec4666dd24ef5a3bc6ddc42acef59.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p><code>ip</code>
                              <hanla></hanla>分配
                            </p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center"><code>IP</code></th>
                                  <th align="center"><code>PORT</code></th>
                                  <th align="center">角色</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><code>43.142.80.9</code></td>
                                  <td align="center"><code>7001</code></td>
                                  <td align="center"><code>master</code></td>
                                </tr>
                                <tr>
                                  <td align="center"><code>43.142.80.9</code></td>
                                  <td align="center"><code>7002</code></td>
                                  <td align="center"><code>master</code></td>
                                </tr>
                                <tr>
                                  <td align="center"><code>43.142.80.9</code></td>
                                  <td align="center"><code>7003</code></td>
                                  <td align="center"><code>master</code></td>
                                </tr>
                                <tr>
                                  <td align="center"><code>43.142.80.9</code></td>
                                  <td align="center"><code>8001</code></td>
                                  <td align="center"><code>slave</code></td>
                                </tr>
                                <tr>
                                  <td align="center"><code>43.142.80.9</code></td>
                                  <td align="center"><code>8002</code></td>
                                  <td align="center"><code>slave</code></td>
                                </tr>
                                <tr>
                                  <td align="center"><code>43.142.80.9</code></td>
                                  <td align="center"><code>8003</code></td>
                                  <td align="center"><code>slave</code></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>准备实例和配置</p>
                            <blockquote>
                              <p>删除之前的<hanla></hanla><code>7001,7002,7003</code>
                                <hanla></hanla>的目录,<hanla></hanla>重新创建<hanla></hanla><code>7001,7002,7003,8001,8002,8003</code>
                                <hanla></hanla>目录
                              </p>
                            </blockquote>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># tmp</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 创建目录<hanla></hanla></span></span><br><span class="line"><span class="string">mkdir</span> <span class="number">7001 </span><span class="number">7002 </span><span class="number">7003 </span><span class="number">8001 </span><span class="number">8002 </span><span class="number">8003</span></span><br><span class="line"></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>在<hanla></hanla><code>/tmp</code>
                              <hanla></hanla>下准备一个新的<hanla></hanla><code>redis.conf</code>
                              <hanla></hanla>文件
                            </p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">port</span> <span class="number">6379</span></span><br><span class="line"><span class="comment"># 开启集群功能<hanla></hanla></span></span><br><span class="line"><span class="string">cluster-enabled</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># 集群的配置文件名称 不需要我们创建,<hanla></hanla>由 redis 自己维护<hanla></hanla></span></span><br><span class="line"><span class="string">cluster-config-file</span> <span class="string">/tmp/6379/nodes.conf</span></span><br><span class="line"><span class="comment"># 节点心跳失败的超时时间<hanla></hanla></span></span><br><span class="line"><span class="string">cluster-node-timeout</span> <span class="number">5000</span></span><br><span class="line"><span class="comment"># 持久化文件存放目录<hanla></hanla></span></span><br><span class="line"><span class="string">dir</span> <span class="string">/tmp/6379</span></span><br><span class="line"><span class="comment"># 绑定地址<hanla></hanla></span></span><br><span class="line"><span class="string">bind</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># 让 redis 后台运行<hanla></hanla></span></span><br><span class="line"><span class="string">daemonize</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># 注册的实例 ip</span></span><br><span class="line"><span class="string">replica-announce-ip</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span></span><br><span class="line"><span class="comment"># 保护模式<hanla></hanla></span></span><br><span class="line"><span class="string">protected-mode</span> <span class="literal">no</span></span><br><span class="line"><span class="comment"># 数据库数量 </span></span><br><span class="line"><span class="string">databases</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># 日志<hanla></hanla></span></span><br><span class="line"><span class="string">logfile</span> <span class="string">/tmp/6379/run.log</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>将这个<hanla></hanla><code>redis.conf</code>
                              <hanla></hanla>文件拷贝到每隔目录下
                            </p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="comment"># 进入 /tmp 目录<hanla></hanla></span></span><br><span class="line"><span class="string">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 执行拷贝<hanla></hanla></span></span><br><span class="line"><span class="string">echo</span> <span class="number">7001 </span><span class="number">7002 </span><span class="number">7003 </span><span class="number">8001 </span><span class="number">8002 </span><span class="number">8003</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-t</span> <span class="string">-n</span> <span class="number">1</span> <span class="string">cp</span> <span class="string">redis.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>修改每个目录下的<hanla></hanla><code>redis.conf</code>，将其中的<hanla></hanla><code>6379</code>
                              <hanla></hanla>修改为与所在目录一致
                            </p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 修改配置文件<hanla></hanla></span></span><br><span class="line"><span class="string">printf</span> <span class="string">'%s\n'</span>  <span class="number">7001 </span><span class="number">7002 </span><span class="number">7003 </span><span class="number">8001 </span><span class="number">8002 </span><span class="number">8003</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-I{}</span> <span class="string">-t</span> <span class="string">sed</span> <span class="string">-i</span> <span class="string">'s/6379/{}/g'</span> {}<span class="string">/redis.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>启动</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">cd</span>  <span class="string">/tmp</span></span><br><span class="line"><span class="comment"># 一键启动所有服务<hanla></hanla></span></span><br><span class="line"><span class="string">printf</span> <span class="string">'%s\n'</span>  <span class="number">7001 </span><span class="number">7002 </span><span class="number">7003 </span><span class="number">8001 </span><span class="number">8002 </span><span class="number">8003</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-I{}</span> <span class="string">-t</span> <span class="string">redis-server</span> {}<span class="string">/redis.conf</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>查看</p>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">集群启动查看</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b90d7609e2814c0887f4fa0609a06820.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>如果需要关闭所有进程,<hanla></hanla>可执行命令</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">ps</span> <span class="string">-ef</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">redis</span> <span class="string">|</span> <span class="string">awk</span> <span class="string">'{print $2}'</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">kill</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推荐关闭方式<hanla></hanla></span></span><br><span class="line"><span class="string">printf</span> <span class="string">'%s\n'</span>  <span class="number">7001 </span><span class="number">7002 </span><span class="number">7003 </span><span class="number">8001 </span><span class="number">8002 </span><span class="number">8003</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-I{}</span> <span class="string">-t</span> <span class="string">redis-cli</span> <span class="string">-p</span> {}  <span class="string">shutdown</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                          </li>
                          <li>
                            <p>创建集群</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">redis-cli</span> <span class="string">--cluster</span> <span class="string">create</span> <span class="string">--cluster-replicas</span> <span class="number">1</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7001</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7002</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7003</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:8001</span>  <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:8002</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:8003</span> </span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <ul>
                              <li>参数说明<ul>
                                  <li><code>redis-cli --cluster | ./redis-trib.rb</code>:<hanla></hanla>代表集群操作命令</li>
                                  <li><code>create</code>: 代表是创建集群</li>
                                  <li><code>--cluster-replicas 1(数字<hanla></hanla>1)</code>: 指定集群中每个<hanla></hanla><code>master</code>
                                    <hanla></hanla>的副本个数为<hanla></hanla><code>1</code>,<hanla></hanla>此时<code>节点总数 ➗ (replicas + 1)</code>
                                    <hanla></hanla>得到的就是<hanla></hanla><code>master</code>
                                    <hanla></hanla>数量,<hanla></hanla>因此节点列表中的前<hanla></hanla><code>n</code>
                                    <hanla></hanla>个就是<hanla></hanla><code>master</code>，其他节点都是<hanla></hanla><code>slave</code>
                                    <hanla></hanla>节点,<hanla></hanla>随机分配到不同<hanla></hanla><code>master</code>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">成功启动集群</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bd93d541c577464facb2ae167d0c6206.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                          <li>
                            <p>查看集群状态</p>
                            <figure class="highlight yml">
                              <table>
                                <tbody>
                                  <tr>
                                    <td class="gutter">
                                      <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                      <pre><span class="line"><span class="string">redis-cli</span> <span class="string">-p</span> <span class="number">7001 </span><span class="string">cluster</span> <span class="string">nodes</span></span><br></pre>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </figure>
                            <table>
                              <thead>
                                <tr>
                                  <th align="center">集群状态</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/9afe0a891f314a0e9f86e1d9bd22fece.png"></td>
                                </tr>
                              </tbody>
                            </table>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>散列插槽</p>
                        <blockquote>
                          <p><code>Redis</code>
                            <hanla></hanla>会把每一个<hanla></hanla><code>master</code>
                            <hanla></hanla>节点映射到<hanla></hanla><code>0~16383</code>
                            <hanla></hanla>个插槽上,<hanla></hanla>查看集群信息时就能看到
                          </p>
                        </blockquote>
                        <blockquote>
                          <p>数据<hanla></hanla><code>key</code>
                            <hanla></hanla>不是与节点绑定,<hanla></hanla>而是与插槽绑定,<code>redis</code>
                            <hanla></hanla>会根据<hanla></hanla><code>key</code>
                            <hanla></hanla>的有效部分计算插槽值，分两种情况
                          </p>
                        </blockquote>
                        <ul>
                          <li><code>key</code>
                            <hanla></hanla>中包含<hanla></hanla><code>{}</code>
                            <hanla></hanla>且<hanla></hanla><code>{}</code>
                            <hanla></hanla>中至少包含一个字符,<code>{}</code>
                            <hanla></hanla>中的部分是有效部分
                          </li>
                          <li><code>key</code>
                            <hanla></hanla>中不包含<hanla></hanla><code>{}</code>,<hanla></hanla>整个<hanla></hanla><code>key</code>
                            <hanla></hanla>都是有效部分
                          </li>
                        </ul>
                        <blockquote>
                          <p>例如: <code>key</code>
                            <hanla></hanla>是<hanla></hanla><code>username</code>,<hanla></hanla>那么根据计算,<hanla></hanla>如果是<hanla></hanla><code>{xxx}username</code>
                            <hanla></hanla>则根据<hanla></hanla><code>xxx</code>
                            <hanla></hanla>计算,<hanla></hanla>计算方式是利用<hanla></hanla><code>CRC16</code>
                            <hanla></hanla>算法得到一个<hanla></hanla><code>hash</code>
                            <hanla></hanla>值,<hanla></hanla>然后对<hanla></hanla><code>16384</code>
                            <hanla></hanla>取余,<hanla></hanla>得到的结果就是<hanla></hanla><code>slot</code>
                            <hanla></hanla>值
                          </p>
                        </blockquote>
                        <table>
                          <thead>
                            <tr>
                              <th align="center"><code>slot(redis-cli -c -p 7001) 参数: -c 至关重要</code></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/12f9f0731fbd41739fd45e64bc1f69ee.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>总结</p>
                        <ul>
                          <li>
                            <p><code>Redis</code>
                              <hanla></hanla>如何判断某个<hanla></hanla><code>key</code>
                              <hanla></hanla>应该在那个实例?
                            </p>
                            <ul>
                              <li>将<hanla></hanla><code>16384</code>
                                <hanla></hanla>个插槽分配到不同的实例
                              </li>
                              <li>根据<hanla></hanla><code>key</code>
                                <hanla></hanla>的有效部分计算哈希值,<hanla></hanla>对<hanla></hanla><code>16384</code>
                                <hanla></hanla>取余
                              </li>
                              <li>余数作为插槽,<hanla></hanla>寻找插槽所在实例即可</li>
                            </ul>
                          </li>
                          <li>
                            <p>如何将同一类数据固定的保存在同一个<hanla></hanla><code>Redis</code>
                              <hanla></hanla>实例
                            </p>
                            <ul>
                              <li>
                                <p>这一类数据使用相同的有效部分,<hanla></hanla>例如<hanla></hanla><code>key</code>
                                  <hanla></hanla>都以<hanla></hanla><code>{typeId}<hanla></hanla>为前缀</code>
                                </p>
                                <table>
                                  <thead>
                                    <tr>
                                      <th align="center">数据固定的保存在同一个<hanla></hanla><code>Redis</code>
                                        <hanla></hanla>实例
                                      </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/e6949864259c42cabd535fb8b897965f.png"></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </li>
                            </ul>
                          </li>
                          <li>
                            <p>集群伸缩</p>
                            <blockquote>
                              <p>向集群中添加一个新的<hanla></hanla><code>master</code>
                                <hanla></hanla>节点,<hanla></hanla>并向其中存储<hanla></hanla><code>num = 10</code>
                              </p>
                            </blockquote>
                            <ul>
                              <li>
                                <p>需求</p>
                                <ul>
                                  <li>
                                    <p>启动一个新的<hanla></hanla><code>redis</code>
                                      <hanla></hanla>实例,<hanla></hanla>端口为<hanla></hanla><code>7004</code>
                                    </p>
                                    <figure class="highlight yml">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="string">mkdir</span> <span class="number">7004</span></span><br><span class="line"><span class="string">cp</span> <span class="string">redis.conf</span> <span class="number">7004</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">'s/6379/7004/g'</span> <span class="number">7004</span><span class="string">/redis.conf</span></span><br><span class="line"><span class="string">redis-server</span> <span class="number">7004</span><span class="string">/redis.conf</span></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                  </li>
                                  <li>
                                    <p>添加<hanla></hanla><code>7004</code>
                                      <hanla></hanla>到之前的集群,<hanla></hanla>并作为一个<hanla></hanla><code>master</code>
                                      <hanla></hanla>节点
                                    </p>
                                    <figure class="highlight yml">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="string">redis-cli</span> <span class="string">--cluster</span> <span class="string">add-node</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7004</span>  <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7001</span></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                  </li>
                                  <li>
                                    <p>给<hanla></hanla><code>7004</code>
                                      <hanla></hanla>节点分配插槽,<hanla></hanla>使得<hanla></hanla><code>num</code>
                                      <hanla></hanla>这个<hanla></hanla><code>key</code>
                                      <hanla></hanla>可以存储到<hanla></hanla><code>7004</code>
                                      <hanla></hanla>实例
                                    </p>
                                    <figure class="highlight yml">
                                      <table>
                                        <tbody>
                                          <tr>
                                            <td class="gutter">
                                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                            </td>
                                            <td class="code">
                                              <pre><span class="line"><span class="comment"># 重新分片<hanla></hanla></span></span><br><span class="line"><span class="string">redis-cli</span> <span class="string">--cluster</span> <span class="string">reshard</span> <span class="string">ip:port</span></span><br></pre>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </figure>
                                    <table>
                                      <thead>
                                        <tr>
                                          <th align="center">分配插槽</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/86bca8a69a3547c89674ffaeb7dede52.png" alt="在这里插入图片描述"></td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p>故障转移</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">故障转移</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/fe04c42d7dcb46a79d9bc90b44a94d6c.png"></td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
                        <p>数据迁移</p>
                        <table>
                          <thead>
                            <tr>
                              <th align="center">数据迁移流程</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/dca293b29e2447d8a67b227b18ed2d96.png"></td>
                            </tr>
                          </tbody>
                        </table>
                        <blockquote>
                          <p>利用<hanla></hanla><code>cluster failover</code>
                            <hanla></hanla>命令可以手动让集群中的某个<hanla></hanla><code>master</code>
                            <hanla></hanla>宕机,<hanla></hanla>切换到执行<hanla></hanla><code>cluster failover</code>
                            <hanla></hanla>命令的这个<hanla></hanla><code>slave</code>
                            <hanla></hanla>节点,<hanla></hanla>实现无感知的数据迁移
                          </p>
                        </blockquote>
                        <ul>
                          <li>手动的<hanla></hanla><code>Failover</code>
                            <hanla></hanla>支持三种不同模式<ul>
                              <li>缺省：默认的流程,<hanla></hanla>如图<hanla></hanla><code>1-6</code>
                                <hanla></hanla>步
                              </li>
                              <li><code>force</code>:<hanla></hanla>省略了对<hanla></hanla><code>offset</code>
                                <hanla></hanla>的一致性校验
                              </li>
                              <li><code>takeover</code>
                                <hanla></hanla>直接执行第<hanla></hanla><code>5</code>
                                <hanla></hanla>步,<hanla></hanla>忽略数据一致性,<hanla></hanla>忽略数据一致性,<hanla></hanla>忽略<hanla></hanla><code>master</code>
                                <hanla></hanla>状态和其他<hanla></hanla><code>master</code>
                                <hanla></hanla>的意见
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <p><code>RedisTemplate</code>
                          <hanla></hanla>访问分片集群
                        </p>
                        <ul>
                          <li>引入<hanla></hanla><code>redis<hanla></hanla>的<hanla></hanla>starter</code>
                            <hanla></hanla>依赖
                          </li>
                          <li>配置分片集群地址</li>
                          <li>配置读写分离</li>
                        </ul>
                        <blockquote>
                          <p>分片集群配置</p>
                        </blockquote>
                        <figure class="highlight yml">
                          <table>
                            <tbody>
                              <tr>
                                <td class="gutter">
                                  <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                                </td>
                                <td class="code">
                                  <pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io.lettuce.core:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">MM-dd</span> <span class="string">HH:mm:ss:SSS</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">cluster:</span></span><br><span class="line">      <span class="attr">nodes:</span> <span class="comment"># 指定分片集群的每一个节点信息</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:7003</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:8001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:8002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">43.142</span><span class="number">.80</span><span class="number">.9</span><span class="string">:8003</span></span><br></pre>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </figure>
                      </li>
                    </ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </article>
        <div class="post-copyright">
          <div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://coderitl.github.io">coder-itl</a></span></div>
          <div class="post-copyright__type"><span class="post-copyright-meta">
              <hanla></hanla>文章链接:
            </span><span class="post-copyright-info"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.nesxc.com/post/hexocc.html">https://www.nesxc.com/post/hexocc.html</a></span></div>
          <div class="post-copyright__notice"><span class="post-copyright-meta">
              <hanla></hanla>版权声明:
            </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external nofollow noopener noreferrer">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://coderitl.github.io" target="_blank">coder-itl</a>！</span></div>
        </div>
        <div class="tag_share">
          <div class="post-meta__tag-list"></div>
          <div class="post_share">
            <div class="social-share" data-image="https://i.328888.xyz/2023/04/01/i2p4AN.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'">
            <script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script>
          </div>
        </div>
        <nav class="pagination-post" id="pagination">
          <div class="prev-post pull-left"><a href="/2022/12/11/3444.html" title="权限通用项目"><img class="cover" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.0.4/re-4.jpg" onerror="onerror=null;src='/null'" alt="cover of previous post">
              <div class="pagination-info">
                <div class="label">上一篇</div>
                <div class="prev_info">权限通用项目</div>
              </div>
            </a></div>
          <div class="next-post pull-right"><a href="/2022/11/15/25763.html" title="SpringMVC-2022"><img class="cover" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.0.5/bg/06.jpg" onerror="onerror=null;src='/null'" alt="cover of next post">
              <div class="pagination-info">
                <div class="label">下一篇<hanla></hanla>
                </div>
                <div class="next_info">SpringMVC-2022</div>
              </div>
            </a></div>
        </nav>
        <hr>
        <div id="post-comment">
          <div class="comment-head">
            <div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论<hanla></hanla></span></div>
          </div>
          <div class="comment-wrap">
            <div>
              <div id="twikoo-wrap"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="aside-content" id="aside-content">
        <div class="card-widget card-info">
          <div class="is-center">
            <div class="avatar-img"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://i.328888.xyz/2023/03/19/MJUXa.jpeg" onerror="this.onerror=null;this.src='https://i.328888.xyz/2023/03/20/P3kfC.gif'" alt="avatar"></div>
            <div class="author-info__name">coder-itl</div>
            <div class="author-info__description">To read without reflecting is like eating without digesting.</div>
          </div>
          <div class="card-info-data site-data is-center"><a href="/archives/">
              <div class="headline">
                <hanla></hanla>文章<hanla></hanla>
              </div>
              <div class="length-num">119</div>
            </a><a href="/tags/">
              <div class="headline">
                <hanla></hanla>标签<hanla></hanla>
              </div>
              <div class="length-num">21</div>
            </a><a href="/categories/">
              <div class="headline">
                <hanla></hanla>分类<hanla></hanla>
              </div>
              <div class="length-num">13</div>
            </a></div><a id="card-info-btn" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a>
        </div>
        <div class="card-widget card-announcement">
          <div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>
              <hanla></hanla>公告
            </span></div>
          <div class="announcement_content">本站所有图片来源于网络,<hanla></hanla>侵权请添加管理员删除【3327511395@qq.com】!</div>
        </div>
        <div class="sticky_layout">
          <div class="card-widget" id="card-toc">
            <div class="item-headline"><i class="fas fa-stream"></i><span>
                <hanla></hanla>目录<hanla></hanla>
              </span><span class="toc-percentage"></span></div>
            <div class="toc-content">
              <ol class="toc">
                <li class="toc-item toc-level-3"><a class="toc-link" href="#SpringCloud-%E5%85%A8%E5%AE%B6%E6%A1%B6"><span class="toc-number">1.</span> <span class="toc-text">SpringCloud-全家桶<hanla></hanla></span></a>
                  <ol class="toc-child">
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%A5%E5%8F%8A%E4%BC%98%E5%8A%BF"><span class="toc-number">1.1.</span> <span class="toc-text">微服务架构的概念以及优势<hanla></hanla></span></a>
                      <ol class="toc-child">
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.1.1.</span> <span class="toc-text">什么是微服务<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">单体应用架构优缺点<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8A%A0%E5%85%A5%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.3.</span> <span class="toc-text">微服务加入的优缺点<hanla></hanla></span></a></li>
                      </ol>
                    </li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#SpringCloud"><span class="toc-number">1.2.</span> <span class="toc-text">SpringCloud</span></a>
                      <ol class="toc-child">
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-SpringCloud"><span class="toc-number">1.2.1.</span> <span class="toc-text">什么是 SpringCloud</span></a></li>
                      </ol>
                    </li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9"><span class="toc-number">1.3.</span> <span class="toc-text">版本选择<hanla></hanla></span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#IDEA-%E6%A8%A1%E6%8B%9F%E9%9B%86%E7%BE%A4%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.</span> <span class="toc-text">IDEA-模拟集群实现<hanla></hanla></span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#SpringCloud-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.5.</span> <span class="toc-text">SpringCloud-环境搭建<hanla></hanla></span></a>
                      <ol class="toc-child">
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.5.1.</span> <span class="toc-text">环境搭建<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">服务远程调用<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.3.</span> <span class="toc-text">服务注册中心介绍<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.5.4.</span> <span class="toc-text">服务注册中心组件<hanla></hanla></span></a>
                          <ol class="toc-child">
                            <li class="toc-item toc-level-6"><a class="toc-link" href="#Eureka"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">Eureka</span></a></li>
                            <li class="toc-item toc-level-6"><a class="toc-link" href="#Zookeeper"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">Zookeeper</span></a></li>
                            <li class="toc-item toc-level-6"><a class="toc-link" href="#Consul"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">Consul</span></a></li>
                            <li class="toc-item toc-level-6"><a class="toc-link" href="#Nacos"><span class="toc-number">1.5.4.4.</span> <span class="toc-text">Nacos</span></a></li>
                          </ol>
                        </li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#Ribbon"><span class="toc-number">1.5.5.</span> <span class="toc-text">Ribbon</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-number">1.5.6.</span> <span class="toc-text">配置管理<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#Feign"><span class="toc-number">1.5.7.</span> <span class="toc-text">Feign</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#Gateway"><span class="toc-number">1.5.8.</span> <span class="toc-text">Gateway</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#Docker"><span class="toc-number">1.5.9.</span> <span class="toc-text">Docker</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#RabbitMQ"><span class="toc-number">1.5.10.</span> <span class="toc-text">RabbitMQ</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#Elasticsearch"><span class="toc-number">1.5.11.</span> <span class="toc-text">Elasticsearch</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#Sentinel"><span class="toc-number">1.5.12.</span> <span class="toc-text">Sentinel</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#Redis"><span class="toc-number">1.5.13.</span> <span class="toc-text">Redis</span></a></li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer id="footer" style="background: transparent">
      <div id="footer-wrap">
        <div class="copyright">©2020 - 2023 By coder-itl</div>
        <div class="framework-info"><span>
            <hanla></hanla>框架
          </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div>
        <div class="footer_custom_text">
          <p><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-orange">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Theme-Buffterfly-blue">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/CDN-jsDeliver-blueviolet">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Source-Github-9cf">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Theme-Matery-ff69b4">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Python-Python-success">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Python-Flask-red"></p>
          <p><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-red?logo=Castorama&amp;logoWidth=18">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?logo=Grunt&amp;logoWidth=18"></p>
        </div>
      </div>
    </footer>
  </div>
  <div id="rightside">
    <div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div>
    <div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div>
  </div>
  <div id="local-search">
    <div class="search-dialog">
      <nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav>
      <div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中<hanla></hanla></span></div>
      <div class="search-wrap">
        <div id="local-search-input">
          <div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div>
        </div>
        <hr>
        <div id="local-search-results"></div>
      </div>
    </div>
    <div id="search-mask"></div>
  </div>
  <div>
    <script src="/js/utils.js"></script>
    <script src="/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script>
    <script src="/js/search/local-search.js"></script>
    <div class="js-pjax">
      <script>
        (() =>
        {
          const init = () =>
          {
            twikoo.init(Object.assign(
            {
              el: '#twikoo-wrap',
              envId: 'https://twikoo-jlw0ln3jv-coderitl.vercel.app/',
              region: 'ap-shanghai',
              onCommentLoaded: function ()
              {
                btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
              }
            }, null))
          }
          const getCount = () =>
          {
            const countELement = document.getElementById('twikoo-count')
            if (!countELement) return
            twikoo.getCommentsCount(
            {
              envId: 'https://twikoo-jlw0ln3jv-coderitl.vercel.app/',
              region: 'ap-shanghai',
              urls: [window.location.pathname],
              includeReply: false
            }).then(function (res)
            {
              countELement.innerText = res[0].count
            }).catch(function (err)
            {
              console.error(err);
            });
          }
          const runFn = () =>
          {
            init()
          }
          const loadTwikoo = () =>
          {
            if (typeof twikoo === 'object')
            {
              setTimeout(runFn, 0)
              return
            }
            getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
          }
          if ('Twikoo' === 'Twikoo' || !false)
          {
            if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
            else loadTwikoo()
          }
          else
          {
            window.loadOtherComment = () =>
            {
              loadTwikoo()
            }
          }
        })()

      </script>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
    <script defer="" src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <script data-pjax="" src="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiper.min.js"></script>
    <script data-pjax="" src="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiperindex.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script>
    <script src="https://www.youxiaohou.com/mactype.user.js"></script>
    <script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script>
    <script>
      let pjaxSelectors = ["head > title", "#config-diff", "#body-wrap", "#rightside-config-hide", "#rightside-config-show", ".js-pjax"]
      var pjax = new Pjax(
      {
        elements: 'a:not([target="_blank"])',
        selectors: pjaxSelectors,
        cacheBust: false,
        analytics: false,
        scrollRestoration: false
      })
      document.addEventListener('pjax:send', function ()
      {
        // removeEventListener scroll 
        window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
        window.scrollCollect && window.removeEventListener('scroll', scrollCollect)
        document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
        if (window.aplayers)
        {
          for (let i = 0; i < window.aplayers.length; i++)
          {
            if (!window.aplayers[i].options.fixed)
            {
              window.aplayers[i].destroy()
            }
          }
        }
        typeof typed === 'object' && typed.destroy()
        //reset readmode
        const $bodyClassList = document.body.classList
        $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
        typeof disqusjs === 'object' && disqusjs.destroy()
      })
      document.addEventListener('pjax:complete', function ()
      {
        window.refreshFn()
        document.querySelectorAll('script[data-pjax]').forEach(item =>
        {
          const newScript = document.createElement('script')
          const content = item.text || item.textContent || item.innerHTML || ""
          Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
          newScript.appendChild(document.createTextNode(content))
          item.parentNode.replaceChild(newScript, item)
        })
        GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()
        typeof chatBtnFn === 'function' && chatBtnFn()
        typeof panguInit === 'function' && panguInit()
        // google analytics
        typeof gtag === 'function' && gtag('config', '',
        {
          'page_path': window.location.pathname
        });
        // baidu analytics
        typeof _hmt === 'object' && _hmt.push(['_trackPageview', window.location.pathname]);
        typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
        // prismjs
        typeof Prism === 'object' && Prism.highlightAll()
      })
      document.addEventListener('pjax:error', (e) =>
      {
        if (e.request.status === 404)
        {
          pjax.loadUrl('/404.html')
        }
      })

    </script>
    <script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  </div><!-- hexo injector body_end start -->
  <script data-pjax="">
    function history_calendar_injector_config()
    {
      var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
      var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span><hanla></hanla>那年今日<hanla></hanla></span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
      console.log('已挂载<hanla></hanla>history_calendar')
      // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用<hanla></hanla>(支持<hanla></hanla>pjax<hanla></hanla>跳转)
      parent_div_git.insertAdjacentHTML("afterbegin", item_html) // 有报错，但不影响使用<hanla></hanla>(支持<hanla></hanla>pjax<hanla></hanla>跳转)
    }
    if (document.getElementsByClassName('sticky_layout')[0] & amp; & amp;
      (location.pathname === 'all' || 'all' === 'all'))
    {
      history_calendar_injector_config()
    } < /div>

  </script>
  <script data-pjax="" src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script>
  <script data-pjax="">
    function butterfly_swiper_injector_config()
    {
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/08/13/15497.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/Access@v1.0/medias/featureimages/7.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-13</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/08/13/15497.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>文件上传下载实战<hanla></hanla></a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/08/13/15497.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/09/04/27324.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/Access@v1.0/medias/featureimages/8.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-09-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/09/04/27324.html&quot;);" href="javascript:void(0);" alt="">Docker<hanla></hanla>安装<hanla></hanla>Oracle</a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/09/04/27324.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/11/30/42622.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://i.328888.xyz/2023/04/01/i2p4AN.jpeg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/11/30/42622.html&quot;);" href="javascript:void(0);" alt="">SpringCloud</a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/11/30/42622.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/12/29/2485.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/Access@v1.0/medias/featureimages/2.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/12/29/2485.html&quot;);" href="javascript:void(0);" alt="">Ubuntu-系统<hanla></hanla></a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/12/29/2485.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
      console.log('已挂载<hanla></hanla>butterfly_swiper')
      parent_div_git.insertAdjacentHTML("afterbegin", item_html)
    }
    var elist = 'undefined'.split(',');
    var cpage = location.pathname;
    var epage = 'all';
    var flag = 0;
    for (var i = 0; i

  </script>
  <script defer="" src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script>
  <script defer="" data-pjax="" src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script>
  <script data-pjax="" src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script>
  <script data-pjax="">
    function gitcalendar_injector_config()
    {
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin", item_html)
      console.log('已挂载<hanla></hanla>gitcalendar')
    }
    if (document.getElementById('recent-posts') && (location.pathname === '/' || '/' === 'all'))
    {
      gitcalendar_injector_config()
      GitCalendarInit("https://python-github-calenda-4cx5gxbnc-coderitl.vercel.app/api?coderitl", ['#e4dfd7', '#f9f4dc', '#f7e8aa', '#f7e8aa', '#f8df72', '#fcd217', '#fcc515', '#f28e16', '#fb8b05', '#d85916', '#f43e06'], 'coderitl')
    }

  </script>
  <script async="" src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end -->
  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script>
  <script>
    L2Dwidget.init(
    {
      "pluginModelPath": "assets/",
      "model":
      {
        "jsonPath": "/live2dw/assets/shizuku.model.json"
      },
      "display":
      {
        "position": "left",
        "width": 150,
        "height": 300
      },
      "mobile":
      {
        "show": false
      },
      "rect":
      {
        "opacity": 0.7
      },
      "log": false,
      "pluginJsPath": "lib/",
      "pluginRootPath": "live2dw/",
      "tagMode": false
    });

  </script>



</body></html>