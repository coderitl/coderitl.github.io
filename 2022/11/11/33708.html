<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>RabbitMQ | coder-itl</title>
  <meta name="author" content="coder-itl">
  <meta name="copyright" content="coder-itl">
  <meta name="format-detection" content="telephone=no">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="MQ 概述 概述 MQ全称Message Queue(消息队列)，是在消息传输过程中保存消息的容器。多用于分布式系统之间进行通信。    消息队列解决的不是存放消息的队列的目的,解决的是通信问题。   小结  MQ,消息队列，存储消息的中间件 分布式系统通信两种方式：直接远程调用和借助第三方完成间接通信 发送方称为生产者，接收方称为消费者   MQ的优势和劣势  优势  应用解耦：提高系统容错">
  <meta property="og:type" content="article">
  <meta property="og:title" content="RabbitMQ">
  <meta property="og:url" content="https://coderitl.github.io/2022/11/11/33708.html">
  <meta property="og:site_name" content="coder-itl">
  <meta property="og:description" content="MQ 概述 概述 MQ全称Message Queue(消息队列)，是在消息传输过程中保存消息的容器。多用于分布式系统之间进行通信。    消息队列解决的不是存放消息的队列的目的,解决的是通信问题。   小结  MQ,消息队列，存储消息的中间件 分布式系统通信两种方式：直接远程调用和借助第三方完成间接通信 发送方称为生产者，接收方称为消费者   MQ的优势和劣势  优势  应用解耦：提高系统容错">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:image" content="https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.10/day321/32.jpg">
  <meta property="article:published_time" content="2022-11-11T11:36:50.000Z">
  <meta property="article:modified_time" content="2023-06-22T11:51:59.474Z">
  <meta property="article:author" content="coder-itl">
  <meta property="article:tag" content="coder-itl,Java,HTML+CSS,Hexo,MYSQL">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.10/day321/32.jpg">
  <link rel="shortcut icon" href="https://img-blog.csdnimg.cn/f44f454681b440f3a8ae5f086d3c07d9.png">
  <link rel="canonical" href="https://coderitl.github.io/2022/11/11/33708.html">
  <link rel="preconnect" href="//cdn.jsdelivr.net">
  <link rel="preconnect" href="//busuanzi.ibruce.info">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'">
  <script>
    const GLOBAL_CONFIG = {
      root: '/',
      algolia: undefined,
      localSearch:
      {
        "path": "/search.xml",
        "preload": false,
        "languages":
        {
          "hits_empty": "找不到您查询的内容：${query}"
        }
      },
      translate: undefined,
      noticeOutdate: undefined,
      highlight:
      {
        "plugin": "highlighjs",
        "highlightCopy": true,
        "highlightLang": false,
        "highlightHeightLimit": false
      },
      copy:
      {
        success: '复制成功',
        error: '复制错误',
        noSupport: '浏览器不支持'
      },
      relativeDate:
      {
        homepage: false,
        post: false
      },
      runtime: '',
      date_suffix:
      {
        just: '刚刚',
        min: '分钟前',
        hour: '小时前',
        day: '天前',
        month: '个月前'
      },
      copyright: undefined,
      lightbox: 'fancybox',
      Snackbar: undefined,
      source:
      {
        justifiedGallery:
        {
          js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
          css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
        }
      },
      isPhotoFigcaption: false,
      islazyload: true,
      isAnchor: false,
      percent:
      {
        toc: true,
        rightside: false,
      }
    }

  </script>
  <script id="config-diff">
    var GLOBAL_CONFIG_SITE = {
      title: 'RabbitMQ',
      isPost: true,
      isHome: false,
      isHighlightShrink: false,
      isToc: true,
      postUpdate: '2023-06-22 19:51:59'
    }

  </script><noscript>
    <style type="text/css">
      #nav
      {
        opacity: 1
      }

      .justified-gallery img
      {
        opacity: 1
      }

      #recent-posts time,
      #post-meta time
      {
        display: inline !important
      }

    </style>
  </noscript>
  <script>
    (win =>
    {
      win.saveToLocal = {
        set: function setWithExpiry(key, value, ttl)
        {
          if (ttl === 0) return
          const now = new Date()
          const expiryDay = ttl * 86400000
          const item = {
            value: value,
            expiry: now.getTime() + expiryDay,
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
        get: function getWithExpiry(key)
        {
          const itemStr = localStorage.getItem(key)
          if (!itemStr)
          {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = new Date()
          if (now.getTime() > item.expiry)
          {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
      win.getScript = url => new Promise((resolve, reject) =>
      {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function ()
        {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(script)
      })
      win.getCSS = url => new Promise((resolve, reject) =>
      {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        link.onload = () => resolve()
        link.onerror = () => reject()
        document.head.appendChild(link)
      })
      win.activateDarkMode = function ()
      {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null)
        {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function ()
      {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null)
        {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
      if (t === 'dark') activateDarkMode()
      else if (t === 'light') activateLightMode()
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined)
      {
        if (asideStatus === 'hide')
        {
          document.documentElement.classList.add('hide-aside')
        }
        else
        {
          document.documentElement.classList.remove('hide-aside')
        }
      }
      const detectApple = () =>
      {
        if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent))
        {
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)

  </script>
  <link rel="stylesheet" href="/css/modify.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.12/css/gitcalendar.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiper.min.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiperstyle.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/animate-css/animate.css@3.7.2/animate.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css" media="defer">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/coderitl/globalfont@v0.0.4/my.css">
  <link rel="stylesheet" href="/css/my.css">
  <meta name="referrer" content="no-referrer"><!-- hexo injector head_end start -->
  <style>
    body hanla:after
    {
      content: ' ';
      display: inline;
      font-family: inherit;
      font-size: 0.45em;
    }

    html code hanla,
    html pre hanla,
    html kbd hanla,
    html samp hanla,
    html ruby hanla,
    html .tag-list-item hanla
    {
      display: none;
    }

    html ol>hanla,
    html ul>hanla
    {
      display: none;
    }

  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css">
  <style>
    #recent-posts>.recent-post-item>.recent-post-info>.article-meta-wrap>.tags:before
    {
      content: "\A";
      white-space: pre;
    }

    #recent-posts>.recent-post-item>.recent-post-info>.article-meta-wrap>.tags>.article-meta__separator
    {
      display: none
    }

  </style>
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'">
  <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'">
  <script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end -->
  <meta name="generator" content="Hexo 5.4.2">
  <link rel="alternate" href="/atom.xml" title="coder-itl" type="application/atom+xml">
</head>

<body>
  <div id="loading-box">
    <div class="loading-left-bg"></div>
    <div class="loading-right-bg"></div>
    <div class="spinner-box">
      <div class="configure-border-1">
        <div class="configure-core"></div>
      </div>
      <div class="configure-border-2">
        <div class="configure-core"></div>
      </div>
      <div class="loading-word">加载中...</div>
    </div>
  </div>
  <script>
    const preloader = {
      endLoading: () =>
      {
        document.body.style.overflow = 'auto';
        document.getElementById('loading-box').classList.add("loaded")
      },
      initLoading: () =>
      {
        document.body.style.overflow = '';
        document.getElementById('loading-box').classList.remove("loaded")
      }
    }
    window.addEventListener('load', () =>
    {
      preloader.endLoading()
    })
    if (true)
    {
      document.addEventListener('pjax:send', () =>
      {
        preloader.initLoading()
      })
      document.addEventListener('pjax:complete', () =>
      {
        preloader.endLoading()
      })
    }

  </script>
  <div id="web_bg"></div>
  <div id="sidebar">
    <div id="menu-mask"></div>
    <div id="sidebar-menus">
      <div class="avatar-img is-center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://i.328888.xyz/2023/03/19/MJUXa.jpeg" onerror="onerror=null;src='https://i.328888.xyz/2023/03/20/P3kfC.gif'" alt="avatar"></div>
      <div class="sidebar-site-data site-data is-center"><a href="/archives/">
          <div class="headline">
            <hanla></hanla>文章<hanla></hanla>
          </div>
          <div class="length-num">119</div>
        </a><a href="/tags/">
          <div class="headline">
            <hanla></hanla>标签<hanla></hanla>
          </div>
          <div class="length-num">21</div>
        </a><a href="/categories/">
          <div class="headline">
            <hanla></hanla>分类<hanla></hanla>
          </div>
          <div class="length-num">13</div>
        </a></div>
      <hr>
      <div class="menus_items">
        <div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div>
        <div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div>
        <div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div>
        <div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div>
        <div class="menus_item"><a class="site-page" href="/Timeline/"><i class="fa-fw fab fa-docker"></i><span> 日志</span></a></div>
        <div class="menus_item"><a class="site-page" href="/Java-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/"><i class="fa-fw fas fa-link"></i><span> 学习路线</span></a></div>
        <div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于<hanla></hanla></span></a></div>
      </div>
    </div>
  </div>
  <div class="post" id="body-wrap">
    <header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.10/day321/32.jpg')">
      <nav id="nav"><span id="blog-info"><a href="/" title="coder-itl"><span class="site-name">coder-itl</span></a></span>
        <div id="menus">
          <div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div>
          <div class="menus_items">
            <div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div>
            <div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div>
            <div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div>
            <div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div>
            <div class="menus_item"><a class="site-page" href="/Timeline/"><i class="fa-fw fab fa-docker"></i><span> 日志</span></a></div>
            <div class="menus_item"><a class="site-page" href="/Java-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/"><i class="fa-fw fas fa-link"></i><span> 学习路线</span></a></div>
            <div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于<hanla></hanla></span></a></div>
          </div>
          <div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div>
        </div>
      </nav>
      <div id="post-info">
        <h1 class="post-title">RabbitMQ</h1>
        <div id="post-meta">
          <div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">
                <hanla></hanla>发表于<hanla></hanla>
              </span><time class="post-meta-date-created" datetime="2022-11-11T11:36:50.000Z" title="发表于 2022-11-11 19:36:50">2022-11-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于<hanla></hanla></span><time class="post-meta-date-updated" datetime="2023-06-22T11:51:59.474Z" title="更新于 2023-06-22 19:51:59">2023-06-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div>
          <div class="meta-secondline"><span class="post-meta-separator">|</span><span id="" data-flag-title="RabbitMQ"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div>
        </div>
      </div>
    </header>
    <main class="layout" id="content-inner">
      <div id="post"><div class="top-img" style="background-image: url('https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.10/day321/32.jpg');"></div>
        <article class="post-content" id="article-container">
          <meta name="referrer" content="no-referrer">
          <h3 id="MQ-概述"><a href="#MQ-概述" class="headerlink" title="MQ 概述"></a>MQ 概述</h3>
          <ul>
            <li>
              <p>概述</p>
              <div class="note icon-padding modern"><i class="note-icon fab fa-cc-visa"></i>
                <p><code>MQ</code>
                  <hanla></hanla>全称<hanla></hanla><code>Message Queue(消息队列)</code>，是在消息传输过程中保存消息的容器。多用于分布式系统之间进行通信。
                </p>
              </div>
              <blockquote>
                <p>消息队列解决的不是存放消息的队列的目的,<hanla></hanla>解决的是通信问题。</p>
              </blockquote>
            </li>
            <li>
              <p>小结</p>
              <ul>
                <li><code>MQ</code>,<hanla></hanla>消息队列，存储消息的中间件</li>
                <li>分布式系统通信两种方式：直接远程调用和借助第三方完成间接通信</li>
                <li>发送方称为<code>生产者</code>，接收方称为<code>消费者</code></li>
              </ul>
            </li>
            <li>
              <p><code>MQ</code>
                <hanla></hanla>的优势和劣势
              </p>
              <ul>
                <li>
                  <p>优势</p>
                  <ol>
                    <li>
                      <p>应用解耦：提高系统容错性和可维护性</p>
                      <table>
                        <thead>
                          <tr>
                            <th align="center">如果库存系统发生错误，订单系统随着产生错误，导致整体容错性降低</th>
                            <th align="center">加入中间件后，具有隔离性，降低耦合度</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2001cbf0cfaf40f292123ca0e7828035.png"></td>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/de1630253c6140a1bdd5bff5ea7b2b3d.png"></td>
                          </tr>
                        </tbody>
                      </table>
                      <div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i>
                        <p>系统的耦合性·越高，容错性就越低，可维护性就越低。</p>
                        <p>使用<hanla></hanla><code>MQ</code>
                          <hanla></hanla>使得应用间解耦，提升容错性和可维护性。
                        </p>
                      </div>
                    </li>
                    <li>
                      <p>异步提速：提升用户体验和系统吞吐量</p>
                      <blockquote>
                        <p>吞吐量: 是指系统在单位时间内处理请求的数量。</p>
                      </blockquote>
                    </li>
                    <li>
                      <p>削峰填谷: 提高系统稳定性</p>
                      <table>
                        <thead>
                          <tr>
                            <th align="center">削峰填谷</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/760e7bb8492541639d858ca78a376f06.png"></td>
                          </tr>
                        </tbody>
                      </table>
                      <blockquote>
                        <p>使用了<hanla></hanla><code>MQ</code>
                          <hanla></hanla>之后,<hanla></hanla>限制消费消息的速度为<hanla></hanla><code>1000</code>，这样一来,<hanla></hanla>高峰期产生的数据势必会被积压在<hanla></hanla><code>MQ</code>
                          <hanla></hanla>中,<hanla></hanla>高峰就被<code>削</code>掉了，但是因为消息积压,<hanla></hanla>在高峰期过后的一段时间内,<hanla></hanla>消费消息的速度还是会维持在<hanla></hanla><code>1000</code>，直到消费完积压的消息,<hanla></hanla>这就叫做<code>填谷</code>
                        </p>
                      </blockquote>
                    </li>
                  </ol>
                </li>
                <li>
                  <p>劣势</p>
                  <ol>
                    <li>
                      <p>系统可用性降低</p>
                      <div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i>
                        <p>系统引入的外部依赖越多，系统稳定性越差。一旦<hanla></hanla><code>MQ</code>
                          <hanla></hanla>宕机，就会对业务造成影响。如何保证<hanla></hanla><code>MQ</code>
                          <hanla></hanla>的高可用?
                        </p>
                      </div>
                    </li>
                    <li>
                      <p>系统复杂度提高</p>
                      <div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i>
                        <p><code>MQ</code>
                          <hanla></hanla>的加入大大增加了系统的复杂度，以前系统间是同步的远程调用，现在是通过<hanla></hanla><code>MQ</code>
                          <hanla></hanla>进行异步调用。如何保证消息没有被重复消费?<hanla></hanla>怎么处理消息丢失情况?<hanla></hanla>如何保证消息传递的顺序性？
                        </p>
                      </div>
                    </li>
                    <li>
                      <p>一致性问题</p>
                      <div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i>
                        <p><code>A</code>
                          <hanla></hanla>系统处理完业务，通过<hanla></hanla><code>MQ</code>
                          <hanla></hanla>给<hanla></hanla><code>B、C、D</code>
                          <hanla></hanla>三个系统发送消息，如果<hanla></hanla><code>B</code>
                          <hanla></hanla>系统,<code>C</code>
                          <hanla></hanla>系统处理成功,<code>D</code>
                          <hanla></hanla>系统处理失败。如何保证消息数据处理的一致性？
                        </p>
                      </div>
                    </li>
                  </ol>
                </li>
              </ul>
            </li>
            <li>
              <p>使用<hanla></hanla><code>MQ</code>
                <hanla></hanla>应满足以下条件
              </p>
              <ol>
                <li>生产者不需要从消费者处获得反馈。引入消息队列之前的直接调用，其接口的<code>返回值应该为空</code>,<hanla></hanla>这才让明明下层的动作还没做，上层却当成功做完了继续往后走，即所谓异步成为了可能</li>
                <li>容许短暂的不一致性</li>
                <li>确实是用了有效果。即解耦、提速、削峰这些方面的收益，超过加入<hanla></hanla><code>MQ</code>，管理<hanla></hanla><code>MQ</code>
                  <hanla></hanla>这些成本。
                </li>
              </ol>
            </li>
          </ul>
          <h3 id="RabbitMQ-简介"><a href="#RabbitMQ-简介" class="headerlink" title="RabbitMQ 简介"></a>RabbitMQ 简介</h3>
          <ul>
            <li><code>AMQP<hanla></hanla>即<hanla></hanla>(Advanced Message Queuing Protocol 高级消息队列协议)</code>,<hanla></hanla>是一个网络协议,<hanla></hanla>是应用层协议的一个开放标准,<hanla></hanla>为面向消息设计的中间件设计。基于此协议的客户端与消息中间件可传递消息,<hanla></hanla>并不受客户端<hanla></hanla>/<hanla></hanla>中间不同产品，不同的开发语言等条件的限制。</li>
          </ul>
          <h3 id="RabbitMQ-安装"><a href="#RabbitMQ-安装" class="headerlink" title="RabbitMQ 安装"></a>RabbitMQ 安装<hanla></hanla>
          </h3>
          <h4 id="Docker-安装-RabbitMQ"><a href="#Docker-安装-RabbitMQ" class="headerlink" title="Docker-安装-RabbitMQ"></a>Docker-安装-RabbitMQ</h4>
          <ul>
            <li>
              <p>建议<hanla></hanla><code>docker</code>
                <hanla></hanla>安装
              </p>
              <figure class="highlight yml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment"># 文件名: docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/rabbitmq:management</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5672</span><span class="string">:5672</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15672</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/var/lib/rabbitmq</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <blockquote>
                <p>在<hanla></hanla><code>yml</code>
                  <hanla></hanla>文件所在目录下执行<hanla></hanla><code>docker-compose up -d</code>
                </p>
              </blockquote>
            </li>
            <li>
              <p>官网</p>
              <blockquote>
                <p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://rabbitmq.com/">https://rabbitmq.com/</a></p>
              </blockquote>
            </li>
          </ul>
          <h4 id="独立安装"><a href="#独立安装" class="headerlink" title="独立安装"></a>独立安装</h4>
          <ul>
            <li>
              <p>下载</p>
              <blockquote>
                <p><code>3.6.5(github)</code>: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/rabbitmq_v3_6_5">https://github.com/rabbitmq/rabbitmq-server/releases/tag/rabbitmq_v3_6_5</a></p>
              </blockquote>
              <table>
                <thead>
                  <tr>
                    <th align="center">下载方式</th>
                    <th align="center">需要匹配<hanla></hanla><code>Erlang</code>
                      <hanla></hanla>版本
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/e15b6fc826014918992953f6cfb97937.png"></td>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/737824e5b93c4d74a81cf4194370e2b3.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>在线安装依赖环境</p>
              <figure class="highlight properties">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">yum</span> <span class="string">install -y build-essential openssl openssl-devel unixODBC unixODBC-devel make gcc gcc-c++ kernel-devel m4 ncurses-devel tk tc xz</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
          </ul>
          <h5 id="安装-Erlang"><a href="#安装-Erlang" class="headerlink" title="安装 Erlang"></a>安装 Erlang</h5>
          <ul>
            <li>
              <p><code>Erlang</code></p>
              <blockquote>
                <p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.rabbitmq.com/which-erlang.html">https://www.rabbitmq.com/which-erlang.html</a></p>
                <p>根据版本信息可以到<hanla></hanla><code>github</code>
                  <hanla></hanla>进行下载
                </p>
              </blockquote>
            </li>
            <li>
              <p>上传文件</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">文件上传</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7050a3661f644110bf65215b5c5ee385.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>安装</p>
              <figure class="highlight properties">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">yum</span> <span class="string">install -y socat</span></span><br><span class="line"><span class="comment"># 安装<hanla></hanla></span></span><br><span class="line"><span class="attr">rpm</span> <span class="string">-ivh erlang-18.3-1.el7.centos.x86_64.rpm</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
          </ul>
          <h5 id="安装-RabbitMQ"><a href="#安装-RabbitMQ" class="headerlink" title="安装 RabbitMQ"></a>安装 RabbitMQ</h5>
          <ul>
            <li>
              <p>安装</p>
              <figure class="highlight properties">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment"># 安装<hanla></hanla></span></span><br><span class="line"><span class="attr">rpm</span> <span class="string">-ivh *.rpm --force --nodeps socat-1.7.3.2-1.1.el7.x86_64.rpm</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 安装<hanla></hanla></span></span><br><span class="line"><span class="attr">rpm</span> <span class="string">-ivh rabbitmq-server-3.6.5-1.noarch.rpm</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <table>
                <thead>
                  <tr>
                    <th align="center">安装与启动</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/81124d5073454dfa98d1df6897a5c81b.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>官网教程文档</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.rabbitmq.com/getstarted.html">https://www.rabbitmq.com/getstarted.html</a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c43586e0061d48a9a46056adaf3b6886.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
          </ul>
          <h3 id="开启管理界面及配置"><a href="#开启管理界面及配置" class="headerlink" title="开启管理界面及配置"></a>开启管理界面及配置</h3>
          <ul>
            <li>
              <p>配置</p>
              <figure class="highlight properties">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment"># 开启管理界面<hanla></hanla></span></span><br><span class="line"><span class="attr">rabbitmq-plugins</span> <span class="string">enable rabbitmq_management</span></span><br><span class="line"><span class="comment"># 修改默认配置信息</span></span><br><span class="line"><span class="comment"># vim /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/ebin/rabbit.app </span></span><br><span class="line"><span class="attr">vim</span> <span class="string">+42 /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/ebin/rabbit.app </span></span><br><span class="line"><span class="comment"># 比如修改密码、配置等等，例如：loopback_users 中的 &lt;&lt;"guest"&gt;&gt;,<hanla></hanla>只保留<hanla></hanla>guest</span></span><br><span class="line"> <span class="attr">{loopback_users,</span> <span class="string">[guest]},</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>新建用户</p>
              <ul>
                <li>
                  <p>查看当前拥有的角色</p>
                  <figure class="highlight properties">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">list_users;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建账号</p>
                  <figure class="highlight properties">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">add_user admin(用户名) admin(密码)</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>设置用户角色</p>
                  <figure class="highlight properties">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_user_tags admin administrator</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>设置用户权限</p>
                  <figure class="highlight properties">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment"># ".*": 配置 </span></span><br><span class="line"><span class="comment"># ".*": 写</span></span><br><span class="line"><span class="comment"># ".*": 读<hanla></hanla></span></span><br><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_permissions -p "/<hanla></hanla>虚拟机名称" admin(用户) ".*" ".*" ".*"</span></span><br><span class="line"><span class="comment"># Eg:</span></span><br><span class="line"><span class="attr">rabbitmqctl</span> <span class="string">set_permissions -p "/" admin(用户) ".*" ".*" ".*"</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
              </ul>
            </li>
            <li>
              <p>重启服务</p>
              <figure class="highlight properties">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">service</span> <span class="string">rabbitmq-server restart</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>访问测试</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><code>default port: 15672</code>，以<hanla></hanla><code>guest/guest</code>
                      <hanla></hanla>登录
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/795c752b8c5e490491b2ca6aadf9e75d.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
          </ul>
          <h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3>
          <ul>
            <li>
              <p>服务</p>
              <figure class="highlight properties">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">service</span> <span class="string">rabbitmq-server start # 启动服务<hanla></hanla></span></span><br><span class="line"><span class="attr">service</span> <span class="string">rabbitmq-server stop # 停止服务<hanla></hanla></span></span><br><span class="line"><span class="attr">service</span> <span class="string">rabbitmq-server restart # 重启服务</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
          </ul>
          <h3 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h3>
          <ul>
            <li>
              <p>添加用户<hanla></hanla>(非必须)</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">添加用户，赋予超级管理员权限</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/637b732be7874696ae18a882da5eceab.png"></td>
                  </tr>
                </tbody>
              </table>
              <ul>
                <li>
                  <p><strong>角色说明</strong>：</p>
                  <ol>
                    <li>
                      <p>超级管理员<hanla></hanla>(<code>administrator</code>): 可登陆管理控制台，可查看所有的信息，并且可以对用户，策略<hanla></hanla>(<code>policy</code>)<hanla></hanla>进行操作。</p>
                    </li>
                    <li>
                      <p>监控者<hanla></hanla>(<code>monitoring</code>): 可登陆管理控制台，同时可以查看<hanla></hanla><code>rabbitmq</code>
                        <hanla></hanla>节点的相关信息<hanla></hanla>(进程数，内存使用情况，磁盘使用情况等)
                      </p>
                    </li>
                    <li>
                      <p>策略制定者<hanla></hanla>(<code>policymaker</code>): 可登陆管理控制台, 同时可以对<hanla></hanla><code>policy</code>
                        <hanla></hanla>进行管理。但无法查看节点的相关信息<hanla></hanla>(上图红框标识的部分)。
                      </p>
                    </li>
                    <li>
                      <p>普通管理者<hanla></hanla>(<code>management</code>): 仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。</p>
                    </li>
                    <li>
                      <p>其他: 无法登陆管理控制台，通常就是普通的生产者和消费者。</p>
                    </li>
                  </ol>
                </li>
              </ul>
            </li>
            <li>
              <p>添加虚拟机</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">添加虚拟机</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7d41165b577f4e998dcc99720811b227.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>添加可操作权限</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">权限</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7d41165b577f4e998dcc99720811b227.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>配置文件配置</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">关于找不见配置文件问题</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b1fba76b291045779460cc638200a44d.png"></td>
                  </tr>
                </tbody>
              </table>
              <ul>
                <li>
                  <p>配置流程</p>
                  <figure class="highlight properties">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment"># 进入默认的安装目录<hanla></hanla></span></span><br><span class="line"><span class="attr">cd</span> <span class="string">/usr/share/doc/rabbitmq-server-3.6.5/</span></span><br><span class="line"><span class="comment"># 复制配置文件到指定目录<hanla></hanla></span></span><br><span class="line"><span class="attr">cp</span> <span class="string">rabbitmq.config.example /etc/rabbitmq/rabbitmq.config</span></span><br><span class="line"><span class="comment"># 重启 rabbitmq 服务<hanla></hanla></span></span><br><span class="line"><span class="attr">service</span> <span class="string">rabbitmq-server restart</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">配置文件放入指定目录</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/25172c2716e24d5f890ef2ffc979fee6.png"></td>
                      </tr>
                    </tbody>
                  </table>
                </li>
              </ul>
            </li>
          </ul>
          <h3 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h3>
          <ul>
            <li><code>Publisher</code>-生产者: 发布消息到<hanla></hanla><code>RabbitMQ</code>
              <hanla></hanla>中的<hanla></hanla><code>Exchange</code>
            </li>
            <li><code>Consumer</code>-消费者: 监听<hanla></hanla><code>RabbitMQ</code>
              <hanla></hanla>中的<hanla></hanla><code>Queue</code>
              <hanla></hanla>中的消息
            </li>
            <li><code>Exchange</code>-交换机: 和生产者建立连接并接受生产者的消息</li>
            <li><code>Queue</code>-队列: <code>Exchange</code>
              <hanla></hanla>会将消息分发到指定的<hanla></hanla><code>Queue</code>,<code>Queue</code>
              <hanla></hanla>和消费者进行交互
            </li>
            <li><code>Routes</code>: 路由: 交换机什么样的策略将消息发布到<hanla></hanla><code>Queue</code></li>
          </ul>
          <h3 id="快速入门-简单模式"><a href="#快速入门-简单模式" class="headerlink" title="快速入门(简单模式)"></a>快速入门<hanla></hanla>(简单模式)</h3>
          <ul>
            <li>
              <p>架构图</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">了解流程</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/47aa3112646e4335b2c6bf6d32c9b71c.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>简单模型</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><code>P: producer(生产者) C: consumer(消费者)</code></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/1883c1139d8c46dcbfbf2777533fe42e.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>需求: 使用简单模式完成消息传递</p>
              <ul>
                <li>步骤<ol>
                    <li>
                      <p>创建工程<hanla></hanla>(生产者、消费者)</p>
                      <ul>
                        <li>
                          <p>创建生产者</p>
                          <ul>
                            <li>
                              <p>添加依赖</p>
                              <figure class="highlight xml">
                                <table>
                                  <tbody>
                                    <tr>
                                      <td class="gutter">
                                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                                      </td>
                                      <td class="code">
                                        <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rabbitmq-producer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.36<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </figure>
                            </li>
                            <li>
                              <p>创建测试</p>
                              <figure class="highlight java">
                                <table>
                                  <tbody>
                                    <tr>
                                      <td class="gutter">
                                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre>
                                      </td>
                                      <td class="code">
                                        <pre><span class="line"><span class="keyword">package</span> com.example.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProducer</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException {</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Producer 实现步骤</span></span><br><span class="line">        <span class="comment">// 1. 创建连接工厂</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// 2. 设置连接参数</span></span><br><span class="line">        <span class="comment">// 设置连接主机,<hanla></hanla>不设置时,<hanla></hanla>默认连接 localhost</span></span><br><span class="line">        factory.setHost(<span class="string">"192.168.247.129"</span>);</span><br><span class="line">        <span class="comment">// 默认<hanla></hanla>Port: 5672</span></span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        <span class="comment">// 设置虚拟机</span></span><br><span class="line">        factory.setVirtualHost(<span class="string">"/coderitl"</span>);</span><br><span class="line">        <span class="comment">/* 用户名和密码默认: guest */</span></span><br><span class="line">        factory.setUsername(<span class="string">"coder-itl"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"coder-itl"</span>);</span><br><span class="line">        <span class="comment">// 3. 创建 Connection</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">        <span class="comment">// 4. 创建 channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 5. 创建队列 Queue</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * String queue: 队列名称</span></span><br><span class="line"><span class="comment">         * boolean durable: 是否持久化，如果是的化,<hanla></hanla>会持久化到自带的数据库中，重启 mq 之后,<hanla></hanla>还在</span></span><br><span class="line"><span class="comment">         * boolean exclusive:</span></span><br><span class="line"><span class="comment">         *  1. 是否独占.<hanla></hanla>只能有一个消费者监听这个队列</span></span><br><span class="line"><span class="comment">         *  2. 当 Connection 关闭时,<hanla></hanla>是否删除队列</span></span><br><span class="line"><span class="comment">         * boolean autoDelete: 是否自动删除。当没有<hanla></hanla>consumer 时,<hanla></hanla>自动删除掉</span></span><br><span class="line"><span class="comment">         * Map&lt;String, Object&gt; arguments: 参数</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 如果没有一个名为 hello_world 的队列,<hanla></hanla>则会自动创建,<hanla></hanla>如果有,<hanla></hanla>则使用已存在的队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(<span class="string">"hello_world"</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 6. 发送消息到 Queue</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="string">"hello rabbitmq................"</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * String exchange: 交换机名称.<hanla></hanla>简单模式下会使用默认的 ""</span></span><br><span class="line"><span class="comment">         * String routingKey: 路由名称</span></span><br><span class="line"><span class="comment">         * AMQP.BasicProperties props: 配置信息</span></span><br><span class="line"><span class="comment">         * byte[] body: 发送的消息数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, <span class="string">"hello_world"</span>, <span class="literal">null</span>, body.getBytes());</span><br><span class="line">        <span class="comment">// 7. 释放资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </figure>
                            </li>
                            <li>
                              <p>关于虚拟主机</p>
                              <blockquote>
                                <p>启动时虚拟主机必须已经创建,<hanla></hanla>否则会出先找不见<hanla></hanla><code>/xxx</code>
                                  <hanla></hanla>虚拟主机错误
                                </p>
                              </blockquote>
                              <table>
                                <thead>
                                  <tr>
                                    <th align="center">需要先行创建虚拟主机</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b9acb06c531d48999d285ec55a3facde.png"></td>
                                  </tr>
                                </tbody>
                              </table>
                            </li>
                            <li>
                              <p>消费者</p>
                              <figure class="highlight java">
                                <table>
                                  <tbody>
                                    <tr>
                                      <td class="gutter">
                                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre>
                                      </td>
                                      <td class="code">
                                        <pre><span class="line"><span class="comment">// 依赖: 消费者和生产者一样<hanla></hanla></span></span><br><span class="line"><span class="keyword">package</span> com.example.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloConsumer</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException {</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Consumer 实现步骤</span></span><br><span class="line">        <span class="comment">// 1. 创建连接工厂</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// 2. 设置连接参数</span></span><br><span class="line">        <span class="comment">// 设置连接主机,<hanla></hanla>不设置时,<hanla></hanla>默认连接 localhost</span></span><br><span class="line">        factory.setHost(<span class="string">"192.168.247.129"</span>);</span><br><span class="line">        <span class="comment">// 默认<hanla></hanla>Port: 5672</span></span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        <span class="comment">// 设置虚拟机</span></span><br><span class="line">        factory.setVirtualHost(<span class="string">"/coderitl"</span>);</span><br><span class="line">        <span class="comment">/* 用户名和密码默认: guest */</span></span><br><span class="line">        factory.setUsername(<span class="string">"coder-itl"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"coder-itl"</span>);</span><br><span class="line">        <span class="comment">// 3. 创建 Connection</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">        <span class="comment">// 4. 创建 channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 5. 创建队列 Queue</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * String queue: 队列名称</span></span><br><span class="line"><span class="comment">         * boolean durable: 是否持久化，如果是的化,<hanla></hanla>会持久化到自带的数据库中，重启 mq 之后,<hanla></hanla>还在</span></span><br><span class="line"><span class="comment">         * boolean exclusive:</span></span><br><span class="line"><span class="comment">         *  1. 是否独占.<hanla></hanla>只能有一个消费者监听这个队列</span></span><br><span class="line"><span class="comment">         *  2. 当 Connection 关闭时,<hanla></hanla>是否删除队列</span></span><br><span class="line"><span class="comment">         * boolean autoDelete: 是否自动删除。当没有<hanla></hanla>consumer 时,<hanla></hanla>自动删除掉</span></span><br><span class="line"><span class="comment">         * Map&lt;String, Object&gt; arguments: 参数</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 如果没有一个名为 hello_world 的队列,<hanla></hanla>则会自动创建,<hanla></hanla>如果有,<hanla></hanla>则使用已存在的队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(<span class="string">"hello_world"</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> com.rabbitmq.client.Consumer;</span></span><br><span class="line">        <span class="comment">// 创建一个 Consumer 对象,<hanla></hanla>指明具体处理消息的程序</span></span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 回调方法: 当收到消息后,<hanla></hanla>会自动执行该方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> consumerTag 标识</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> envelope 获取一些信息,<hanla></hanla>交换机,<hanla></hanla>路由<hanla></hanla>key..</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> properties 配置信息</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> body 发送方的数据</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                System.out.println(<span class="string">"consumerTag: "</span> + consumerTag);</span><br><span class="line">                System.out.println(<span class="string">"Exchange: "</span> + envelope.getExchange());</span><br><span class="line">                System.out.println(<span class="string">"RoutingKey: "</span> + envelope.getRoutingKey());</span><br><span class="line">                System.out.println(<span class="string">"properties: "</span> + properties);</span><br><span class="line">                <span class="comment">// 字节转换为字符串</span></span><br><span class="line">                System.out.println(<span class="string">"properties: "</span> + <span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * String queue: 队列名称</span></span><br><span class="line"><span class="comment">         * boolean autoAck: 是否自动确认</span></span><br><span class="line"><span class="comment">         * Consumer callback: 回调对象</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(<span class="string">"hello_world"</span>, <span class="literal">true</span>, consumer);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 消费者处不能关闭资源<hanla></hanla></span></span><br><span class="line"></span><br></pre>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </figure>
                              <figure class="highlight java">
                                <table>
                                  <tbody>
                                    <tr>
                                      <td class="gutter">
                                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                      </td>
                                      <td class="code">
                                        <pre><span class="line"><span class="comment">// 消息处理的其他方式<hanla></hanla></span></span><br><span class="line"><span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; {</span><br><span class="line">    <span class="comment">// 处理消息</span></span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">};</span><br><span class="line">channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; {</span><br><span class="line">});</span><br></pre>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </figure>
                              <table>
                                <thead>
                                  <tr>
                                    <th align="center">消费者</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d6ae59aa329a4867a6518cae0754679c.png"></td>
                                  </tr>
                                </tbody>
                              </table>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>分别添加依赖</p>
                    </li>
                    <li>
                      <p>编写生产者发送消息</p>
                    </li>
                    <li>
                      <p>编写消费者接受消息</p>
                    </li>
                  </ol>
                </li>
              </ul>
            </li>
          </ul>
          <h3 id="RabbitMQ-工作模式"><a href="#RabbitMQ-工作模式" class="headerlink" title="RabbitMQ 工作模式"></a>RabbitMQ 工作模式<hanla></hanla>
          </h3>
          <h4 id="Work-queues-工作队列模式"><a href="#Work-queues-工作队列模式" class="headerlink" title="Work queues 工作队列模式"></a>Work queues 工作队列模式</h4>
          <ul>
            <li>
              <p>简单队列的问题</p>
              <blockquote>
                <p>当多个消费者消费同一个队列时。这个时候<hanla></hanla><code>rabbitmq</code>
                  <hanla></hanla>的公平调度机制就开启了,<hanla></hanla>于是,<code>
                    <hanla></hanla>无论消费者的消费能力如何,<hanla></hanla>每个消费者都能公平均匀分到相同数量的消息,<hanla></hanla>而不能出现能者多劳的情况。
                  </code>
                </p>
                <p>能者多劳指的是: 假如<code>生产者产生了<hanla></hanla>100<hanla></hanla>个消息</code>,<hanla></hanla>消费者<hanla></hanla><code>1</code>
                  <hanla></hanla>正常启动,<hanla></hanla>消费者<hanla></hanla><code>2</code>
                  <hanla></hanla>在消费的过程中加入沉睡<hanla></hanla><code>300ms</code>,<hanla></hanla>真正的消费完毕是所有消费者消费完生产者的所产生的数据,<hanla></hanla>而没有实现<code>能者多劳（消费者<hanla></hanla>1<hanla></hanla>早早消费完毕，却在等待消费者<hanla></hanla>2<hanla></hanla>进行消费）</code>
                </p>
              </blockquote>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment">// 生产者<hanla></hanla></span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) {</span><br><span class="line">    <span class="comment">// 5. 定义数据消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"I'm hello world rabbitmq module ................: "</span> + i;</span><br><span class="line">    <span class="comment">// 6. 发送消息</span></span><br><span class="line">    channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">    System.out.println(<span class="string">"消息发送完毕.................."</span>);</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment">// 消费者 1</span></span><br><span class="line">channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; {</span><br><span class="line">    <span class="comment">// 处理消息</span></span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">};</span><br><span class="line">channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; {</span><br><span class="line">});</span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment">// 消费者 2</span></span><br><span class="line">channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        Thread.sleep(<span class="number">300L</span>);</span><br><span class="line">        <span class="comment">// 处理消息</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line">channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; {</span><br><span class="line">});</span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>模式说明</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><code>Work queues</code></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/defaa07c687942c1af7465a148e2f776.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p><code>Work queues</code>: 与入门程序的简单模式相比,<hanla></hanla>多了一个或一些消费端,<hanla></hanla>多个消费端共同消费同一个队列中的消息</p>
            </li>
            <li>
              <p>应用场景: 对于<code>任务过重</code>或者<code>任务较多</code>情况使用工作队列可以<code>提高</code>任务的<code>处理速度</code></p>
            </li>
            <li>
              <p>消费记录</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">消费记录<hanla></hanla>(自动<hanla></hanla><code>ack</code>)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b78a017f75534c3eb2ba09be4480775c.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>实现: 在简单模式的基础上,<hanla></hanla>添加一个消费者</p>
            </li>
            <li>
              <p>自动<hanla></hanla><code>ACK</code></p>
              <blockquote>
                <p>不管消费者有没有消费完就马上<hanla></hanla><code>ack</code>
                  <hanla></hanla>给<hanla></hanla><code>broker</code>，此时意味着<hanla></hanla><code>broker</code>
                  <hanla></hanla>会推送下一条消息给消费者
                </p>
              </blockquote>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment">// 消费者 2 在消费地过程中进行了睡眠,<hanla></hanla>由于自动 ack,<hanla></hanla>导致 broker 堆积,<hanla></hanla>消费者 1 的消费能力强,<hanla></hanla>但是消费者<hanla></hanla>2<hanla></hanla>却将整体拉长,<hanla></hanla>导致能力降低<hanla></hanla></span></span><br><span class="line">channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        Thread.sleep(<span class="number">300L</span>);</span><br><span class="line">        <span class="comment">// 处理消息</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line">channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; {</span><br><span class="line">});</span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <table>
                <thead>
                  <tr>
                    <th align="center">消费情况</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/50e7567b1d4f449aaa3888827d63ae43.gif"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>手动<hanla></hanla><code>ACK</code>-解决上述问题</p>
              <blockquote>
                <p>当 <code>broker</code>
                  <hanla></hanla>收到手动的<hanla></hanla><code>ack</code>
                  <hanla></hanla>后,<hanla></hanla>才会推送下一条消息给消费者
                </p>
              </blockquote>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment">// 生产者未发生变化<hanla></hanla></span></span><br><span class="line"><span class="comment">// 消费者 2 的改动<hanla></hanla></span></span><br><span class="line"><span class="keyword">package</span> com.example.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkQueueConsumer2</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"hello_world"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="comment">// 1. 想办法连接上 broker</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(<span class="string">"192.168.2.3"</span>);</span><br><span class="line">        <span class="comment">// 默认项<hanla></hanla>(可以省略)</span></span><br><span class="line">        factory.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"root"</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        <span class="comment">// 设置虚拟主机</span></span><br><span class="line">        factory.setVirtualHost(<span class="string">"/qf-mq"</span>);</span><br><span class="line">        <span class="comment">// 2. 从连接工厂获得连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">        <span class="comment">// 3. 获得 Channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 声明一次只接受一条消息</span></span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 4. 声明队列</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * String queue,  QUEUE_NAME</span></span><br><span class="line"><span class="comment">         * boolean durable, false</span></span><br><span class="line"><span class="comment">         * boolean exclusive, false</span></span><br><span class="line"><span class="comment">         * boolean autoDelete, false</span></span><br><span class="line"><span class="comment">         * Map&lt;String, Object&gt; arguments null</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">300L</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// 处理消息</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 手动 ACK</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * delivery.getEnvelope().getDeliveryTag(): 相当于 id</span></span><br><span class="line"><span class="comment">             * false: 是否批量处理</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">        };</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 将自动 ACK 修改为 手动 ACK</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">false</span>, deliverCallback, consumerTag -&gt; {</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <table>
                <thead>
                  <tr>
                    <th align="center">(消费者<hanla></hanla><code>2</code>)</th>
                    <th align="center">实现能者多劳<hanla></hanla>(消费者 <code>1</code>)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/a3fc9c3fa2b44ce484a22f0bc4fbe740.png"></td>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/283c33becbe949ef9895aa9ddfeaadbc.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
          </ul>
          <h4 id="Pub-x2F-Sub-订阅模式"><a href="#Pub-x2F-Sub-订阅模式" class="headerlink" title="Pub/Sub 订阅模式"></a>Pub/Sub 订阅模式</h4>
          <ul>
            <li>
              <p>模式说明</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">Pub/Sub 订阅模式</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/3c345428d09c4b5f948bb5da16707966.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p><code>P</code>: 生产者，也就是要发送消息的那个程序,<hanla></hanla>但是不再发送到队列中,<hanla></hanla>而是发送给<hanla></hanla><code>X(交换机)</code></p>
            </li>
            <li>
              <p><code>C</code>: 消费者,<hanla></hanla>消息的接收者,<hanla></hanla>会一直等待消息到来</p>
            </li>
            <li>
              <p><code>Queue</code>: 消息队列，接受消息，缓存消息</p>
            </li>
            <li>
              <p><code>Exchange</code>: 交换机<hanla></hanla>(X). 一方面,<hanla></hanla>接受生产者发送的消息。另一方面,<hanla></hanla>知道如何处理消息,<hanla></hanla>例如递交给某个特别队列、递交给所有队列,<hanla></hanla>或是将消息丢弃。到底如何操作,<hanla></hanla>取决于<hanla></hanla><code>Exchange</code>
                <hanla></hanla>的类型。<code>Exchange</code>
                <hanla></hanla>有常见以下三种类型
              </p>
              <ul>
                <li><code>Fanout</code>: 广播,<hanla></hanla>将消息交给所有绑定到交换机的队列</li>
                <li><code>Direct</code>: 定向,<hanla></hanla>把消息交给符合指定<hanla></hanla><code>routing key</code>
                  <hanla></hanla>的队列
                </li>
                <li><code>Topic</code>: 通配符,<hanla></hanla>把消息交给副歌<hanla></hanla><code>routing pattern(路由模式)<hanla></hanla>的队列</code></li>
              </ul>
              <blockquote>
                <p><code>Exchange(交换机)</code>
                  <hanla></hanla>只负责转发消息,<hanla></hanla>不具备存储消息的能力,<hanla></hanla>因此如果没有任何队列与<hanla></hanla><code>Exchange</code>
                  <hanla></hanla>绑定,<hanla></hanla>或者没有符合路由规则的队列,<hanla></hanla>那么消息会丢失
                </p>
              </blockquote>
            </li>
            <li>
              <p>实现: <code>fanout</code>
                <hanla></hanla>类型
              </p>
              <ul>
                <li>
                  <p>工具类</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMQUtils</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String virtualHost;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConnectionFactory factory;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        host = <span class="string">"192.168.2.3"</span>;</span><br><span class="line">        port = <span class="number">5672</span>;</span><br><span class="line">        virtualHost = <span class="string">"/qf-mq"</span>;</span><br><span class="line">        userName = <span class="string">"root"</span>;</span><br><span class="line">        password = <span class="string">"root"</span>;</span><br><span class="line">        factory = <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(host);</span><br><span class="line">        factory.setPort(port);</span><br><span class="line">        factory.setVirtualHost(virtualHost);</span><br><span class="line">        factory.setUsername(userName);</span><br><span class="line">        factory.setPassword(password);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接工厂</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ConnectionFactory <span class="title function_">getConnectionFactory</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="keyword">return</span> factory.newConnection();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><code>fanout</code>
                    <hanla></hanla>类型-生产者
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.pubsub.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PubSubproducer</span> {</span><br><span class="line">    <span class="comment">// fanout: 发布订阅模型</span></span><br><span class="line">    <span class="comment">// 定义交换机名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_FANNOUT_NAME</span> <span class="operator">=</span> <span class="string">"fannout_exchange"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="comment">// 创建通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明交换机  exchangeDeclare(交换机名称,<hanla></hanla>交换机类型)</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_FANNOUT_NAME, <span class="string">"fanout"</span>);</span><br><span class="line">        <span class="comment">// 生产消息,<hanla></hanla>发送给交换机</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"fanout data...: "</span> + i;</span><br><span class="line">            channel.basicPublish(EXCHANGE_FANNOUT_NAME, <span class="string">""</span>, <span class="literal">null</span>, message.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"消息已发送..............."</span>);</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>消费者</p>
                  <ul>
                    <li>
                      <p>消费者<hanla></hanla><code>1</code></p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="keyword">package</span> com.example.pubsub.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PubSubConsumer1</span> {</span><br><span class="line">    <span class="comment">// 定义交换机和队列名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_FANNOUT_NAME</span> <span class="operator">=</span> <span class="string">"fannout_exchange"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_FANNOUT_NAME</span> <span class="operator">=</span> <span class="string">"fannout_queue1"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明队列和交换机</span></span><br><span class="line">        channel.queueDeclare(QUEUE_FANNOUT_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_FANNOUT_NAME, <span class="string">"fanout"</span>);</span><br><span class="line">        <span class="comment">// 将队列绑定到交换机上</span></span><br><span class="line">        channel.queueBind(QUEUE_FANNOUT_NAME, EXCHANGE_FANNOUT_NAME, <span class="string">""</span>);</span><br><span class="line">        <span class="comment">// 创建消费者</span></span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                <span class="comment">// 消息处理 =&gt; 打印</span></span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        <span class="comment">// 消费者监听队列</span></span><br><span class="line">        channel.basicConsume(QUEUE_FANNOUT_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>消费者<hanla></hanla><code>2</code></p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="comment">// 差异<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_FANNOUT_NAME</span> <span class="operator">=</span> <span class="string">"fannout_queue2"</span>;</span><br><span class="line"></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                      <table>
                        <thead>
                          <tr>
                            <th align="center">实现模型</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/eb08fc5c93c3474483922abbe8b06923.png"></td>
                          </tr>
                        </tbody>
                      </table>
                      <table>
                        <thead>
                          <tr>
                            <th align="center">消费者<hanla></hanla><code>1</code></th>
                            <th align="center">消费者<hanla></hanla><code>2</code></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/4731f04ac1804016a3e179e2198d09e6.png"></td>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7f092b48b2bb4f42932196205902062d.png"></td>
                          </tr>
                        </tbody>
                      </table>
                      <blockquote>
                        <p>一份数据,<hanla></hanla>被两个消费者同时消费的实现</p>
                      </blockquote>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
          <h4 id="Routing-路由模式"><a href="#Routing-路由模式" class="headerlink" title="Routing 路由模式"></a>Routing 路由模式</h4>
          <ul>
            <li>
              <p>模式说明</p>
              <table>
                <thead>
                  <tr>
                    <th align="center"><code>Routing</code></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bf4a6bc8a12c4cd98d3e62350249c285.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>说明</p>
              <ul>
                <li>队列与交换机的绑定,<hanla></hanla>不能是任意的绑定了，而是指定一个<hanla></hanla><code>RoutingKey(路由<hanla></hanla>key)</code></li>
                <li>消息的发送方在向<hanla></hanla><code>Exchange</code>
                  <hanla></hanla>发送消息时,<hanla></hanla>也必须指定消息的<hanla></hanla><code>RoutingKey</code>
                </li>
                <li><code>Exchange</code>
                  <hanla></hanla>不在把消息交给每一个绑定的队列,<hanla></hanla>而是根据消息的<hanla></hanla><code>Routing Key</code>
                  <hanla></hanla>进行判断,<hanla></hanla>只有队列的<hanla></hanla><code>RoutingKey</code>
                  <hanla></hanla>与消息的<hanla></hanla><code>RoutingKey</code>
                  <hanla></hanla>完全一致,<hanla></hanla>才会接收到消息
                </li>
              </ul>
            </li>
            <li>
              <p>根据路由规则</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">根据路由规则</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/b03681acc5dd43399bccc74dcbcbcd91.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>实现</p>
              <ul>
                <li>
                  <p>生产者</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.routing.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingKeyProducer</span> {</span><br><span class="line">    <span class="comment">// 定义交换机名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"routing_direct_exchange"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明交换机</span></span><br><span class="line">        channel.exchangeDeclare(ROUTING_EXCHANGE_NAME, <span class="string">"direct"</span>);</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"direct exchange about routingKey is apple..................."</span>;</span><br><span class="line">        channel.basicPublish(ROUTING_EXCHANGE_NAME, <span class="string">"apple"</span>, <span class="literal">null</span>, message.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"消息已发送................"</span>);</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>消费者</p>
                  <ul>
                    <li>
                      <p>消费者<hanla></hanla><code>1</code></p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="keyword">package</span> com.example.routing.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingKeyConsumer1</span> {</span><br><span class="line">    <span class="comment">// 定义交换机名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"routing_direct_exchange"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_QUEUE_NAME_1</span> <span class="operator">=</span> <span class="string">"routing_direct_queue_1"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明交换机和队列</span></span><br><span class="line">        channel.exchangeDeclare(ROUTING_EXCHANGE_NAME, <span class="string">"direct"</span>);</span><br><span class="line">        channel.queueDeclare(ROUTING_QUEUE_NAME_1, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 将队列绑定到交换机</span></span><br><span class="line">        channel.queueBind(ROUTING_QUEUE_NAME_1, ROUTING_EXCHANGE_NAME, <span class="string">"orange"</span>);</span><br><span class="line">        <span class="comment">// 数据消费</span></span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        channel.basicConsume(ROUTING_QUEUE_NAME_1, <span class="literal">true</span>, consumer);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>消费者<hanla></hanla><code>2</code></p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="keyword">package</span> com.example.routing.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingKeyConsumer2</span> {</span><br><span class="line">    <span class="comment">// 定义交换机名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"routing_direct_exchange"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_QUEUE_NAME_1</span> <span class="operator">=</span> <span class="string">"routing_direct_queue_2"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明交换机和队列</span></span><br><span class="line">        channel.exchangeDeclare(ROUTING_EXCHANGE_NAME, <span class="string">"direct"</span>);</span><br><span class="line">        channel.queueDeclare(ROUTING_QUEUE_NAME_1, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 将队列绑定到交换机</span></span><br><span class="line">        channel.queueBind(ROUTING_QUEUE_NAME_1, ROUTING_EXCHANGE_NAME, <span class="string">"apple"</span>);</span><br><span class="line">        <span class="comment">// 数据消费</span></span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        channel.basicConsume(ROUTING_QUEUE_NAME_1, <span class="literal">true</span>, consumer);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                      <table>
                        <thead>
                          <tr>
                            <th align="center">绑定模型</th>
                            <th align="center">输出</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/eef37c3c895b48dfbcb9f68adff2ede7.png"></td>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/2751c9e1fafb4c7384df3edca3f36246.png"></td>
                          </tr>
                        </tbody>
                      </table>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
          <h4 id="Topics-模式"><a href="#Topics-模式" class="headerlink" title="Topics 模式"></a>Topics 模式</h4>
          <ul>
            <li>
              <p>模式说明</p>
              <table>
                <thead>
                  <tr>
                    <th align="center">根据通配符匹配</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/fce2da072fe74a749ffccfe932092a50.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>通配符说明</p>
              <ul>
                <li><code>*</code>: 只能代表一个单词</li>
                <li><code>#</code>:<hanla></hanla>可以是多单词</li>
              </ul>
            </li>
            <li>
              <p>实现</p>
              <ul>
                <li>
                  <p>注意</p>
                  <blockquote>
                    <p><code>通配符</code>出现在<code>消费者</code>的绑定关系处</p>
                    <figure class="highlight properties">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">channel.queueBind(MQContaint.TOPIC_QUEUE,</span> <span class="string">MQContaint.TOPIC_EXCHANGE, "coderitl.#");</span></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                    <p>生产者处：</p>
                    <figure class="highlight properties">
                      <table>
                        <tbody>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="attr">channel.basicPublish(MQContaint.TOPIC_EXCHANGE,</span> <span class="string">"coderitl.jd.order", null,message.getBytes("UTF-8"));</span></span><br><span class="line"></span><br></pre>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </figure>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">绑定后</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/34d4270f246540a789dc86c57fd95002.png"></td>
                        </tr>
                      </tbody>
                    </table>
                  </blockquote>
                </li>
                <li>
                  <p>生产者</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.topics.producers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicsProducer</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"topic_exchange"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明交换机</span></span><br><span class="line">        channel.exchangeDeclare(TOPIC_EXCHANGE_NAME, <span class="string">"topic"</span>);</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"exchange is topic............"</span>;</span><br><span class="line">        channel.basicPublish(TOPIC_EXCHANGE_NAME, <span class="string">"product.order.coderitl"</span>, <span class="literal">null</span>, message.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        System.out.println(<span class="string">"消息已发送................"</span>);</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>消费者</p>
                  <ul>
                    <li>
                      <p>消费者<hanla></hanla><code>1</code></p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="keyword">package</span> com.example.topics.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicsConsumer1</span> {</span><br><span class="line">    <span class="comment">// 声明交换机和队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"topic_exchange"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"topic_queue_1"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_KEY</span> <span class="operator">=</span> <span class="string">"product.*"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        channel.queueDeclare(TOPIC_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.exchangeDeclare(TOPIC_EXCHANGE_NAME, <span class="string">"topic"</span>);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 忘记了什么? =&gt; 绑定关系</span></span><br><span class="line">        channel.queueBind(TOPIC_QUEUE_NAME, TOPIC_EXCHANGE_NAME, ROUTING_KEY);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                System.out.println(<span class="string">"*: "</span> + <span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        channel.basicConsume(TOPIC_QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>消费者<hanla></hanla><code>2</code></p>
                      <figure class="highlight java">
                        <table>
                          <tbody>
                            <tr>
                              <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                              </td>
                              <td class="code">
                                <pre><span class="line"><span class="keyword">package</span> com.example.topics.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.utils.RabbitMQUtils;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicsConsumer2</span> {</span><br><span class="line">    <span class="comment">// 声明交换机和队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"topic_exchange"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"topic_queue_2"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_KEY</span> <span class="operator">=</span> <span class="string">"product.#"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQUtils.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        channel.queueDeclare(TOPIC_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.exchangeDeclare(TOPIC_EXCHANGE_NAME, <span class="string">"topic"</span>);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 忘记了什么? =&gt; 绑定关系</span></span><br><span class="line">        channel.queueBind(TOPIC_QUEUE_NAME, TOPIC_EXCHANGE_NAME, ROUTING_KEY);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                System.out.println(<span class="string">"#: "</span> + <span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        channel.basicConsume(TOPIC_QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </figure>
                      <table>
                        <thead>
                          <tr>
                            <th align="center">绑定关系</th>
                            <th align="center">输出</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d629264252ed493c96a18286119238ec.png"></td>
                            <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d22e40dda88d4a538fe063b9562797a6.png"></td>
                          </tr>
                        </tbody>
                      </table>
                      <blockquote>
                        <p>输出是生产者的<hanla></hanla><code>routing-key</code>
                          <hanla></hanla>导致的结果
                        </p>
                      </blockquote>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
          <h3 id="Spring-整合RabbitMQ"><a href="#Spring-整合RabbitMQ" class="headerlink" title="Spring-整合RabbitMQ"></a>Spring-整合<hanla></hanla>RabbitMQ</h3>
          <ul>
            <li>
              <p>生产者</p>
              <ul>
                <li>
                  <p>创建生产者模块,<hanla></hanla>添加依赖</p>
                  <figure class="highlight xml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-producers<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>在<hanla></hanla><code>resources</code>
                    <hanla></hanla>目录下创建属性配置文件<hanla></hanla><code>rabbitmq.properties</code>
                  </p>
                  <figure class="highlight properties">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attr">rabbitmq.host</span>=<span class="string">192.168.2.3</span></span><br><span class="line"><span class="attr">rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">rabbitmq.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">rabbitmq.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">rabbitmq.virtual-host</span>=<span class="string">/spring-mq</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>创建<hanla></hanla><code>rabbitmq</code>
                    <hanla></hanla>的配置文件<hanla></hanla><code>spring-rabbitmq-producers.xml</code>
                  </p>
                  <figure class="highlight xml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:rabbit</span>=<span class="string">"http://www.springframework.org/schema/rabbit"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/rabbit</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:properties/rabbitmq.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><!-- 定义<hanla></hanla>rabbitmq connectionFactory --></span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> <span class="attr">host</span>=<span class="string">"${rabbitmq.host}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">port</span>=<span class="string">"${rabbitmq.port}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">username</span>=<span class="string">"${rabbitmq.username}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">password</span>=<span class="string">"${rabbitmq.password}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">virtual-host</span>=<span class="string">"${rabbitmq.virtual-host}"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义管理交换机、队列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:admin</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--定义持久化队列，不存在则自动创建；不绑定到交换机则绑定到默认交换机</span></span><br><span class="line"><span class="comment">    默认交换机类型为<hanla></hanla>direct，名字为：""，路由键为队列的名称</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">"spring_queue"</span> <span class="attr">name</span>=<span class="string">"spring_queue"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~广播；所有队列都能收到消息~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">"spring_fanout_queue_1"</span> <span class="attr">name</span>=<span class="string">"spring_fanout_queue_1"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">"spring_fanout_queue_2"</span> <span class="attr">name</span>=<span class="string">"spring_fanout_queue_2"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--定义广播类型交换机；并绑定上述两个队列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:fanout-exchange</span> <span class="attr">id</span>=<span class="string">"spring_fanout_exchange"</span> <span class="attr">name</span>=<span class="string">"spring_fanout_exchange"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">queue</span>=<span class="string">"spring_fanout_queue_1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">queue</span>=<span class="string">"spring_fanout_queue_2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:fanout-exchange</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~通配符；*<hanla></hanla>匹配一个单词，#匹配多个单词 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --></span></span><br><span class="line">    <span class="comment">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">"spring_topic_queue_star"</span> <span class="attr">name</span>=<span class="string">"spring_topic_queue_star"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">"spring_topic_queue_well"</span> <span class="attr">name</span>=<span class="string">"spring_topic_queue_well"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">"spring_topic_queue_well2"</span> <span class="attr">name</span>=<span class="string">"spring_topic_queue_well2"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">id</span>=<span class="string">"spring_topic_exchange"</span> <span class="attr">name</span>=<span class="string">"spring_topic_exchange"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">"coderitl.*"</span> <span class="attr">queue</span>=<span class="string">"spring_topic_queue_star"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">"coderitl.#"</span> <span class="attr">queue</span>=<span class="string">"spring_topic_queue_well"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">"itl.#"</span> <span class="attr">queue</span>=<span class="string">"spring_topic_queue_well2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><!--定义<hanla></hanla>rabbitTemplate<hanla></hanla>对象操作可以在代码中方便发送消息--></span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:template</span> <span class="attr">id</span>=<span class="string">"rabbitTemplate"</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p><code>MQ</code>
                    <hanla></hanla>网页控制台
                  </p>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">创建虚拟机并配置权限</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/c4fcec3948b54ea89af7b06692169d2b.png"></td>
                      </tr>
                    </tbody>
                  </table>
                </li>
                <li>
                  <p>测试</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.producers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = "classpath:spring-rabbitmq-producers.xml")</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducersTest</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">helloWorldTest</span><span class="params">()</span> {</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"spring_queue"</span>, <span class="string">"hell world spring....."</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fanoutTest</span><span class="params">()</span> {</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"spring_fanout_exchange"</span>, <span class="string">""</span>, <span class="string">"fannout spring....."</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">topicTest</span><span class="params">()</span> {</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"spring_topic_exchange"</span>, <span class="string">"coderitl.hehe.haha"</span>, <span class="string">"topic spring haha....."</span>);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"spring_topic_exchange"</span>, <span class="string">"coderitl.hehe"</span>, <span class="string">"topic spring hehe....."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">查看</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/d23bda5139ce4c7388dac6719838c2ac.png"></td>
                      </tr>
                    </tbody>
                  </table>
                </li>
              </ul>
            </li>
            <li>
              <p>消费者</p>
              <ul>
                <li>
                  <p>创建项目,<hanla></hanla>添加相同依赖</p>
                </li>
                <li>
                  <p>创建属性配置文件</p>
                </li>
                <li>
                  <p>创建<hanla></hanla><code>rabbitmq</code>
                    <hanla></hanla>的配置文件<hanla></hanla><code>spring-rabbitmq-consumers.xml</code>
                  </p>
                  <figure class="highlight xml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:rabbit</span>=<span class="string">"http://www.springframework.org/schema/rabbit"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/rabbit</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:properties/rabbitmq.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><!-- 定义<hanla></hanla>rabbitmq connectionFactory --></span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> <span class="attr">host</span>=<span class="string">"${rabbitmq.host}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">port</span>=<span class="string">"${rabbitmq.port}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">username</span>=<span class="string">"${rabbitmq.username}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">password</span>=<span class="string">"${rabbitmq.password}"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">virtual-host</span>=<span class="string">"${rabbitmq.virtual-host}"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"springQueueListener"</span> <span class="attr">class</span>=<span class="string">"com.coderitl.rabbitmq.listener.SpringQueueListener"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fanoutListener1"</span> <span class="attr">class</span>=<span class="string">"com.coderitl.rabbitmq.listener.FanoutListener1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fanoutListener2"</span> <span class="attr">class</span>=<span class="string">"com.coderitl.rabbitmq.listener.FanoutListener2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"topicListenerStar"</span> <span class="attr">class</span>=<span class="string">"com.coderitl.rabbitmq.listener.TopicListenerStar"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"topicListenerWell"</span> <span class="attr">class</span>=<span class="string">"com.coderitl.rabbitmq.listener.TopicListenerWell"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"topicListenerWell2"</span> <span class="attr">class</span>=<span class="string">"com.coderitl.rabbitmq.listener.TopicListenerWell2"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">"springQueueListener"</span> <span class="attr">queue-names</span>=<span class="string">"spring_queue"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">"fanoutListener1"</span> <span class="attr">queue-names</span>=<span class="string">"spring_fanout_queue_1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">"fanoutListener2"</span> <span class="attr">queue-names</span>=<span class="string">"spring_fanout_queue_2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">"topicListenerStar"</span> <span class="attr">queue-names</span>=<span class="string">"spring_topic_queue_star"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">"topicListenerWell"</span> <span class="attr">queue-names</span>=<span class="string">"spring_topic_queue_well"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">"topicListenerWell2"</span> <span class="attr">queue-names</span>=<span class="string">"spring_topic_queue_well2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.coderitl.rabbitmq.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.MessageListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SpringQueueListener 其他类似<hanla></hanla></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringQueueListener</span> <span class="keyword">implements</span> <span class="title class_">MessageListener</span> {</span><br><span class="line">    <span class="comment">// 重写 onMessage </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Message message)</span> {</span><br><span class="line">        <span class="comment">// 获取数据</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>测试</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">// 只需要启动<hanla></hanla></span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = "classpath:spring-rabbitmq-consumers.xml")</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumersTest</span> {</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (flag) {</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
              </ul>
            </li>
          </ul>
          <h3 id="SpringBoot整合-RabbitMQ"><a href="#SpringBoot整合-RabbitMQ" class="headerlink" title="SpringBoot整合 RabbitMQ"></a>SpringBoot<hanla></hanla>整合 RabbitMQ</h3>
          <h4 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>
            <hanla></hanla>发布订阅模式
          </h4>
          <h5 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h5>
          <ul>
            <li>
              <p>创建项目,<hanla></hanla>添加依赖</p>
              <figure class="highlight xml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>创建配置</p>
              <figure class="highlight yml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8079</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/spring-mq</span></span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>创建配置类</p>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRabbitMQProducerConfig</span> {</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 确定实现目标类型<hanla></hanla>(发布订阅模型) 【fanout*,direct,topics】</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"boot_fannout_exchange"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 声明交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">bootExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(EXCHANGE_NAME, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>创建测试,<hanla></hanla>发送数据</p>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BootMqProducerApplicationTests</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">()</span> <span class="keyword">throws</span> UnsupportedEncodingException {</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"我是本次发送的数据.............."</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"boot_fannout_exchange"</span>, <span class="string">""</span>, message.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
          </ul>
          <h5 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h5>
          <ul>
            <li>
              <p>创建消费者项目,<hanla></hanla>添加依赖,<hanla></hanla>和生产者一致</p>
            </li>
            <li>
              <p>创建配置文件,<hanla></hanla>和生产者一致</p>
            </li>
            <li>
              <p>创建配置类</p>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRabbitMQConsumerConfig</span> {</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 确定实现目标类型<hanla></hanla>(发布订阅模型) 【fannout*,direct,topics】</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"boot_fannout_exchange"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"boot_fannout_queue"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 声明交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">bootExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(EXCHANGE_NAME, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 声明队列</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">bootQueue</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 声明绑定关系</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">QueueBindToExchange</span><span class="params">(Queue queue, FanoutExchange fanoutExchange)</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(fanoutExchange);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>数据处理</p>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BootMqConsumers</span> {</span><br><span class="line">    <span class="comment">// 监听队列: 当队列中有消息,<hanla></hanla>则监听器工作,<hanla></hanla>处理接收到的消息</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = "boot_fannout_queue")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Message message)</span> {</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <table>
                <thead>
                  <tr>
                    <th align="center">启动测试</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/31040a8d4c2c49cba842e95d50805ae4.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
          </ul>
          <h4 id="Topics模式"><a href="#Topics模式" class="headerlink" title="Topics模式"></a>Topics<hanla></hanla>模式</h4>
          <h5 id="生产者-1"><a href="#生产者-1" class="headerlink" title="生产者"></a>生产者</h5>
          <ul>
            <li>
              <p>生产者实现步骤</p>
              <ol>
                <li>
                  <p>创建生产者<hanla></hanla><code>SpringBoot</code>
                    <hanla></hanla>工程
                  </p>
                </li>
                <li>
                  <p>引入依赖坐标</p>
                  <figure class="highlight xml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>编写<hanla></hanla><code>yml</code>
                    <hanla></hanla>配置,<hanla></hanla>基本信息配置
                  </p>
                  <figure class="highlight yml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">  	<span class="comment"># ip</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.247</span><span class="number">.129</span></span><br><span class="line">    <span class="comment"># port</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="comment"># user</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">coder-itl</span></span><br><span class="line">    <span class="comment"># password</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">coder-itl</span></span><br><span class="line">    <span class="comment"># VirtualHost</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/coderitl</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>声明交换机</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.TopicExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicModuleProducerConfig</span> {</span><br><span class="line">    <span class="comment">// 交换机</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_EXCHANGE</span> <span class="operator">=</span> <span class="string">"topic_exchange"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">topicExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(TOPIC_EXCHANGE, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>注入<hanla></hanla><code>RabbitTemplate</code>，调用方法,<hanla></hanla>完成消息的发送</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BootMqTopicProducersApplicationTests</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_EXCHANGE</span> <span class="operator">=</span> <span class="string">"topic_exchange"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">()</span> <span class="keyword">throws</span> UnsupportedEncodingException {</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"boot send test data add.............."</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(TOPIC_EXCHANGE, <span class="string">"topic.module"</span>, message.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
              </ol>
            </li>
          </ul>
          <h5 id="消费者-1"><a href="#消费者-1" class="headerlink" title="消费者"></a>消费者</h5>
          <ul>
            <li>
              <p>消费者实现步骤</p>
              <ol>
                <li>
                  <p>创建消费者<hanla></hanla><code>SpringBoot</code>
                    <hanla></hanla>工程
                  </p>
                </li>
                <li>
                  <p>引入<hanla></hanla><code>starter</code></p>
                  <figure class="highlight xml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>编写<hanla></hanla><code>yml</code>
                    <hanla></hanla>配置,<hanla></hanla>进行基本信息配置
                  </p>
                  <figure class="highlight yml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.247</span><span class="number">.129</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">coder-itl</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">coder-itl</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/coderitl</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>声明交换机、队列以及绑定关系</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.config.topic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.TopicExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicModuleConfig</span> {</span><br><span class="line">    <span class="comment">// 声明交换机和队列名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_EXCHANGE</span> <span class="operator">=</span> <span class="string">"topic_exchange"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_QUEUE</span> <span class="operator">=</span> <span class="string">"topic_queue"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_KEY</span> <span class="operator">=</span> <span class="string">"topic.*"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">topicExchange</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(TOPIC_EXCHANGE, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(TOPIC_QUEUE, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将队列绑定搭到交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueToExchange</span><span class="params">(Queue queue, TopicExchange topicExchange)</span> {</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(topicExchange).with(ROUTING_KEY);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>定义监听类,<hanla></hanla>使用<hanla></hanla><code>@RabbitListener</code>
                    <hanla></hanla>注解完成队列监听
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">package</span> com.example.config.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConsumer</span> {</span><br><span class="line">    <span class="comment">// 监听队列: 当队列中有消息,<hanla></hanla>则监听器工作,<hanla></hanla>处理接收到的消息</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = "topic_queue")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Message message)</span> {</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                  <table>
                    <thead>
                      <tr>
                        <th align="center">获取到数据</th>
                        <th align="center">绑定</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bfb811bbf0ae4843bed4197b7dc5368e.png"></td>
                        <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/0c3c2e7b9e214894a62cd800a19f1018.png"></td>
                      </tr>
                    </tbody>
                  </table>
                  <blockquote>
                    <p>关于交换机的绑定可以在生产者处声明，以上大部分在消费者处声明,<hanla></hanla>将模型图看作两部分,<hanla></hanla>如下</p>
                    <table>
                      <thead>
                        <tr>
                          <th align="center">关系划分</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/1383ea48bfb14929b533d98155a35b72.png"></td>
                        </tr>
                      </tbody>
                    </table>
                  </blockquote>
                </li>
              </ol>
            </li>
          </ul>
          <h4 id="手动-ACK-实现"><a href="#手动-ACK-实现" class="headerlink" title="手动 ACK 实现"></a>手动 ACK 实现</h4>
          <ol>
            <li>
              <p>消费端的配置文件中<code>添加</code>如下</p>
              <figure class="highlight yml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8089</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/spring-mq</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span></span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>在消息处理最后进行手动确认</p>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="keyword">package</span> com.example.consumer;</span><br><span class="line"><span class="comment">// Channel: client 包下<hanla></hanla></span></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BootMqConsumers</span> {</span><br><span class="line">    <span class="comment">// 监听队列: 当队列中有消息,<hanla></hanla>则监听器工作,<hanla></hanla>处理接收到的消息</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = "boot_fannout_queue")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        <span class="comment">// 手动 ack 确认: 告知 broker 要签收的消息的 id(DeliveryTag()) false: 本次不批量</span></span><br><span class="line">        channel.basicAck(message.getMessageProperties().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
          </ol>
          <h3 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h3>
          <h4 id="消息的可靠性投递"><a href="#消息的可靠性投递" class="headerlink" title="消息的可靠性投递"></a>消息的可靠性投递</h4>
          <ul>
            <li>
              <p>问题描述</p>
              <div class="note icon-padding modern"><i class="note-icon fab fa-cc-visa"></i>
                <p>在使用<hanla></hanla><code>RabbitMQ</code>
                  <hanla></hanla>的时候,<hanla></hanla>作为消息发送方希望杜绝任何消息丢失或者投递失败场景。<code>RabbitMQ</code>
                  <hanla></hanla>为我们提供了两种方式用来控制消息的可靠性模式
                </p>
                <ul>
                  <li><code>confirm</code>
                    <hanla></hanla>确认模式
                  </li>
                  <li><code>return</code>
                    <hanla></hanla>退回模式
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <p><code>rabbitmq</code>
                <hanla></hanla>整个消息投递的路径
              </p>
              <table>
                <thead>
                  <tr>
                    <th align="center">投递的路径</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/ed177bc475be4448828486ca3e8e9be9.png"></td>
                  </tr>
                </tbody>
              </table>
              <ul>
                <li>
                  <p><code>confirm</code>: 消息从<hanla></hanla><code>producer</code>
                    <hanla></hanla>到<hanla></hanla><code>exchange</code>
                    <hanla></hanla>则会返回一个<hanla></hanla><code>confirmCallback</code>
                  </p>
                </li>
                <li>
                  <p><code>return</code>: 消息从<hanla></hanla><code>exchange</code>
                    <hanla></hanla>到<hanla></hanla><code>queue</code>
                    <hanla></hanla>投递失败则会返回一个<hanla></hanla><code>returnCallback</code>
                  </p>
                  <blockquote>
                    <p>我们将利用这两个<hanla></hanla><code>callback</code>
                      <hanla></hanla>控制消息的可靠性投递
                    </p>
                  </blockquote>
                </li>
              </ul>
            </li>
            <li>
              <p>可靠性投递的三个保障</p>
              <ul>
                <li>生产者把消息准确的投递给交换机<code>【通过 confirm 机制】</code></li>
                <li>交换机准确无误的把消息投递给队列<code>【通过 return 机制】</code></li>
                <li>队列准确无误的把消息推送给消费者<code>【将自动 ack 修改为 手动 ack】</code></li>
              </ul>
            </li>
            <li>
              <p><code>durable</code></p>
              <ul>
                <li>
                  <p><code>durable</code>
                    <hanla></hanla>是持久化
                  </p>
                </li>
                <li>
                  <p>作用</p>
                  <blockquote>
                    <p>当<hanla></hanla><code>rabbitmq</code>
                      <hanla></hanla>重启时,<hanla></hanla>在交换机处设置持久化为<hanla></hanla><code>true</code>
                      <hanla></hanla>时,<code>rabbitmq</code>
                      <hanla></hanla>重启时交换机依然会存在,<code>
                        <hanla></hanla>队列
                      </code>一样
                    </p>
                  </blockquote>
                </li>
              </ul>
            </li>
          </ul>
          <h4 id="Confirm-机制"><a href="#Confirm-机制" class="headerlink" title="Confirm 机制"></a>Confirm 机制</h4>
          <ul>
            <li>
              <p><code>SpringBoot</code>
                <hanla></hanla>中的实现
              </p>
            </li>
            <li>
              <p>修改生产者端的配置文件<hanla></hanla>(<code>①</code>)</p>
              <figure class="highlight yml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/spring-mq</span></span><br><span class="line">    <span class="comment"># 添加如下部分</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <ul>
                <li><code>publisher-confirm-type</code>
                  <hanla></hanla>的取值<ol>
                    <li><code>simple</code>: 简单的执行<hanla></hanla><code>ack</code>
                      <hanla></hanla>的判断,<hanla></hanla>在发布消息成功后使用<hanla></hanla><code>rabbitmTemplate</code>
                      <hanla></hanla>调用<hanla></hanla><code>waitForConfirms</code>
                      <hanla></hanla>或<hanla></hanla><code>waitForConfirmsOrDie</code>
                      <hanla></hanla>方法等待<hanla></hanla><code>broker</code>
                      <hanla></hanla>节点返回发送结果,<hanla></hanla>根据返回结果来判断下一步的逻辑。但是要注意的是当<hanla></hanla><code>waitForConfirmsOrDir</code>
                      <hanla></hanla>方法如果返回<hanla></hanla><code>false</code>
                      <hanla></hanla>则会关闭<hanla></hanla><code>channel</code>
                    </li>
                    <li><code>correlated</code>: 执行<hanla></hanla><code>ack</code>
                      <hanla></hanla>的时候还会携带数据<hanla></hanla>(<code>消息的元数据</code>)
                    </li>
                    <li><code>none</code>: 禁用发布确认模式,<hanla></hanla>默认的</li>
                  </ol>
                </li>
              </ul>
            </li>
            <li>
              <p>编写一个<hanla></hanla><code>ConfirmCallback</code>
                <hanla></hanla>的实现类,<hanla></hanla>并注入到<hanla></hanla><code>rabbitTemplate</code>
              </p>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="keyword">package</span> com.example.confirm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfirmCollback</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 把监听器注入到 RabbitTemplate</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> {</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> correlationData 消息的元数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ack             生产者发送消息到 broker,<hanla></hanla>如果签收成功,<hanla></hanla>返回 True,<hanla></hanla>否则返回 False</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause           当 ack=False<hanla></hanla>时的失败的原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> {</span><br><span class="line">        <span class="comment">// 获取消息的 id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (Objects.nonNull(correlationData)) {</span><br><span class="line">            id = correlationData.getId();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (ack) {</span><br><span class="line">            <span class="comment">// 消息投递成功</span></span><br><span class="line">            System.out.println(<span class="string">"消息投递成功.................: "</span> + id);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// 消息投递失败，后续可以存入到缓存中,<hanla></hanla>通过定时任务,<hanla></hanla>定时重发</span></span><br><span class="line">            System.out.println(<span class="string">"消息投递失败.................: "</span> + cause);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
          </ul>
          <h4 id="return-机制"><a href="#return-机制" class="headerlink" title="return 机制"></a>return 机制</h4>
          <ul>
            <li>
              <p>修改生产者的配置文件</p>
              <figure class="highlight yml">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/coderitl</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br><span class="line">    <span class="comment"># 添加如下部分</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>实现</p>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="keyword">package</span> com.example.confirm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ReturnedMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfirmCollback</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback, RabbitTemplate.ReturnsCallback {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 把监听器注入到 RabbitTemplate</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> {</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="built_in">this</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> correlationData 消息的元数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ack             生产者发送消息到 broker,<hanla></hanla>如果签收成功,<hanla></hanla>返回 True,<hanla></hanla>否则返回 False</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause           当 ack=False<hanla></hanla>时的失败的原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> {</span><br><span class="line">        <span class="comment">// 获取消息的 id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (Objects.nonNull(correlationData)) {</span><br><span class="line">            id = correlationData.getId();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (ack) {</span><br><span class="line">            <span class="comment">// 消息投递成功</span></span><br><span class="line">            System.out.println(<span class="string">"消息投递成功.................: "</span> + id);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// 消息投递失败，后续可以存入到缓存中,<hanla></hanla>通过定时任务,<hanla></hanla>定时重发</span></span><br><span class="line">            System.out.println(<span class="string">"消息投递失败.................: "</span> + cause);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当消息没有传递到队列的时候,<hanla></hanla>回调的方法</span></span><br><span class="line"><span class="comment">     * ReturnedMessage:</span></span><br><span class="line"><span class="comment">     * private final Message message;</span></span><br><span class="line"><span class="comment">     * private final int replyCode;</span></span><br><span class="line"><span class="comment">     * private final String replyText;</span></span><br><span class="line"><span class="comment">     * private final String exchange;</span></span><br><span class="line"><span class="comment">     * private final String routingKey;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnedMessage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returnedMessage)</span> {</span><br><span class="line">        System.out.println(<span class="string">"消息: "</span> + <span class="keyword">new</span> <span class="title class_">String</span>(returnedMessage.getMessage().getBody()) + <span class="string">"没有成功投递到队列 4"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
              <table>
                <thead>
                  <tr>
                    <th align="center">returnCallback</th>
                    <th align="center">错误的<hanla></hanla><code>routingKey</code></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/7b50bfa255e64abab2b76b06b2ccbc5d.png"></td>
                    <td align="center"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/bc6880aa60214bca8869317a14148343.png"></td>
                  </tr>
                </tbody>
              </table>
            </li>
          </ul>
          <h3 id="手动-ack-nack-reject的区别"><a href="#手动-ack-nack-reject的区别" class="headerlink" title="手动 ack,nack,reject的区别"></a>手动 ack,nack,reject<hanla></hanla>的区别</h3>
          <ul>
            <li>
              <p>不做任何的<hanla></hanla><code>ack</code></p>
              <blockquote>
                <p><code>RabbitMQ</code>
                  <hanla></hanla>会把消息标记成<hanla></hanla><code>unacked</code>,<hanla></hanla>此时<hanla></hanla><code>mq</code>
                  <hanla></hanla>是在等待消费者进行<hanla></hanla><code>ack</code>,<hanla></hanla>如果消费者失去了会话,<hanla></hanla>此时消息会重新回到<hanla></hanla><code>ready</code>
                  <hanla></hanla>状态,<hanla></hanla>被其他消费者消费
                </p>
              </blockquote>
            </li>
            <li>
              <p>ack</p>
              <blockquote>
                <p>确认签收，之后消息会从队列中剔除</p>
              </blockquote>
            </li>
            <li>
              <p>reject</p>
              <blockquote>
                <p><code>reject</code>
                  <hanla></hanla>就是拒绝此消息
                </p>
                <p><code>reject</code>
                  <hanla></hanla>一次只支持处理一条消息。消息被拒绝掉值后,<hanla></hanla>并且<hanla></hanla><code>requeue</code>
                  <hanla></hanla>设置成了<hanla></hanla><code>false</code>,<hanla></hanla>将会进入到<code>死信队列</code>中。如果<hanla></hanla><code>requeue</code>
                  <hanla></hanla>设置成<hanla></hanla><code>true</code>，将会重回到<code>队列</code>,<hanla></hanla>但是这种情况很少使用。
                </p>
              </blockquote>
              <figure class="highlight java">
                <table>
                  <tbody>
                    <tr>
                      <td class="gutter">
                        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                      </td>
                      <td class="code">
                        <pre><span class="line"><span class="comment">// Consumer 消费的回调处这几个方法<hanla></hanla></span></span><br><span class="line"><span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">    </span><br><span class="line">    channel.basicNack(参数...);</span><br><span class="line">};</span><br></pre>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </figure>
            </li>
            <li>
              <p>nack</p>
              <blockquote>
                <p><code>nack</code> 和<hanla></hanla><code>reject</code>
                  <hanla></hanla>相同,<hanla></hanla>只是<hanla></hanla><code>nack</code>
                  <hanla></hanla>支持批量处理多条消息
                </p>
              </blockquote>
            </li>
          </ul>
          <h3 id="封装消息的元数据"><a href="#封装消息的元数据" class="headerlink" title="封装消息的元数据"></a>封装消息的元数据</h3>
          <h3 id="保证消息的幂等性消费"><a href="#保证消息的幂等性消费" class="headerlink" title="保证消息的幂等性消费"></a>保证消息的幂等性消费</h3>
          <ul>
            <li>
              <p>什么是幂等性</p>
              <blockquote>
                <p>幂等性: 多次操作造成的结果是一致的。对于非幂等的操作,<hanla></hanla>幂等性如何保证?<code>=&gt;【使用分布式锁】</code></p>
              </blockquote>
              <ul>
                <li>
                  <p>在请求方式中的幂等性的体现</p>
                  <ul>
                    <li><code>get</code>: 多次<hanla></hanla><code>get</code>
                      <hanla></hanla>结果是一致的
                    </li>
                    <li><code>post</code>: 添加,<hanla></hanla>非幂等</li>
                    <li><code>put</code>: 修改: 幂等，根据 <code>id</code>
                      <hanla></hanla>修改
                    </li>
                    <li><code>delete</code>: 根据<hanla></hanla><code>id</code>
                      <hanla></hanla>删除,<hanla></hanla>幂等
                    </li>
                  </ul>
                  <blockquote>
                    <p>对于非幂等的请求，我们在业务里要做幂等性保证</p>
                  </blockquote>
                </li>
              </ul>
            </li>
            <li>
              <p>在消息队列中的幂等性体现</p>
              <blockquote>
                <p>消息队列中，很可能一条消息被冗余部署的多个消费者收到，对于非幂等的操作，比如用户的注册，就需要做幂等性保证，否则消息将会被重复消费。使用分布式锁解决幂等性问题。</p>
              </blockquote>
            </li>
            <li>
              <p><code>message</code>
                <hanla></hanla>的请求头中两个键值分别为
              </p>
              <ul>
                <li><code>spring_listener_return_correlation</code>: 该属性是用来确定消息被退回时调用哪个监听器</li>
                <li><code>spring_returned_message_correlation</code>: 该属性是指退回待确认消息的唯一标识</li>
              </ul>
            </li>
            <li>
              <p>业务代码中实现幂等性</p>
              <ol>
                <li>
                  <p><code>publisher-confirm-type: correlated </code>开启<hanla></hanla><code>confirm</code>
                    <hanla></hanla>请求头中将会使⽤ “<code>spring_returned_message_correlation</code>”<hanla></hanla>键来传递业务<hanla></hanla><code>id</code>
                  </p>
                  <figure class="highlight yml">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment"># ⽣产者端修改配置⽂件<hanla></hanla></span></span><br><span class="line"><span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>⽣产者端传递业务<hanla></hanla><code>id</code></p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMessage</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">//<hanla></hanla>业务<hanla></hanla>id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    <span class="comment">//<hanla></hanla>封装了业务<hanla></hanla>id<hanla></hanla>的消息元数据</span></span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(id);</span><br><span class="line">    <span class="comment">//<hanla></hanla>发送消息，并且携带消息的业务<hanla></hanla>id</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">"my_boot_topic_exchange"</span>,</span><br><span class="line">                                  <span class="string">"product.add"</span>,</span><br><span class="line">                                  <span class="string">"hello message"</span>,</span><br><span class="line">                                  correlationData</span><br><span class="line">                                 );</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
                <li>
                  <p>消费者端进⾏业务逻辑判断</p>
                  <figure class="highlight java">
                    <table>
                      <tbody>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消费端的幂等性的实现</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = "my_boot_topic_queue")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processByMSG</span><span class="params">(Message message, Channel channel)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="comment">//<hanla></hanla>如何获得消息的业务<hanla></hanla>id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">messageId</span> <span class="operator">=</span></span><br><span class="line">        message.getMessageProperties().getHeader(<span class="string">"spring_returned_message_correlation"</span>);</span><br><span class="line">    <span class="comment">//<hanla></hanla>设置分布式锁</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">lock</span> <span class="operator">=</span></span><br><span class="line">        redisTemplate.opsForValue().setIfAbsent(messageId, <span class="number">1</span>, <span class="number">100000</span>,TimeUnit.MILLISECONDS);</span><br><span class="line">    <span class="keyword">if</span> (lock) {</span><br><span class="line">        <span class="comment">//<hanla></hanla>做消费</span></span><br><span class="line">    }</span><br><span class="line">    System.out.println(<span class="string">"添加⽤户成功"</span>);</span><br><span class="line">    <span class="comment">//<hanla></hanla>⼿动<hanla></hanla>ack</span></span><br><span class="line">    channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">    <span class="comment">//<hanla></hanla>不做消费</span></span><br><span class="line">    System.out.println(<span class="string">"已重复消费"</span>);</span><br><span class="line"></span><br><span class="line">    channel.basicReject(message.getMessageProperties().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">}</span><br></pre>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </figure>
                </li>
              </ol>
            </li>
          </ul>
          <h3 id="死信队列"><a href="#死信队列" class="headerlink" title="死信队列"></a>死信队列</h3>
          <ul>
            <li>
              <p>死信队列的介绍</p>
              <blockquote>
                <p>死信队列 ，让⼀条消息，在满⾜⼀定的条件下，成为死信，会被发送到另⼀个交换 机上，再被消费。 这个过程就是死信队列的作⽤。 死信队列就可以做出<hanla></hanla>“延迟”<hanla></hanla>队列的效果。⽐如，在订单超时未⽀付 ，将订单状态改 成<hanla></hanla>“已取消”，这个操作就可以使⽤死信队列来完成。设置消息的超时时间，当消息 超时则消息成为死信，于是通过监听死信队列的消费者来做取消订单的动作。</p>
              </blockquote>
            </li>
            <li>
              <p>消息成为死信的条件</p>
              <ul>
                <li>消息被拒签，并且没有重回队列，消息将成为死信。 </li>
                <li>消息过期了，消息将成为死信。</li>
                <li>队列⻓度有限，存不下消息了，存不下的消息将会成为死信。</li>
              </ul>
            </li>
            <li></li>
          </ul>
        </article>
        <div class="post-copyright">
          <div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://coderitl.github.io">coder-itl</a></span></div>
          <div class="post-copyright__type"><span class="post-copyright-meta">
              <hanla></hanla>文章链接:
            </span><span class="post-copyright-info"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.nesxc.com/post/hexocc.html">https://www.nesxc.com/post/hexocc.html</a></span></div>
          <div class="post-copyright__notice"><span class="post-copyright-meta">
              <hanla></hanla>版权声明:
            </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external nofollow noopener noreferrer">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://coderitl.github.io" target="_blank">coder-itl</a>！</span></div>
        </div>
        <div class="tag_share">
          <div class="post-meta__tag-list"></div>
          <div class="post_share">
            <div class="social-share" data-image="https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.10/day321/32.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'">
            <script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script>
          </div>
        </div>
        <nav class="pagination-post" id="pagination">
          <div class="prev-post pull-left"><a href="/2022/11/14/5568.html" title="Mybatis-3.5.10"><img class="cover" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img-blog.csdnimg.cn/aa0ba969536a413d91a2929f3ce85921.jpeg" onerror="onerror=null;src='/null'" alt="cover of previous post">
              <div class="pagination-info">
                <div class="label">上一篇<hanla></hanla>
                </div>
                <div class="prev_info">Mybatis-3.5.10</div>
              </div>
            </a></div>
          <div class="next-post pull-right"><a href="/2022/11/11/22918.html" title="Spring6"><img class="cover" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/hiddenContent@v1.10/day321/28.jpg" onerror="onerror=null;src='/null'" alt="cover of next post">
              <div class="pagination-info">
                <div class="label">
                  <hanla></hanla>下一篇<hanla></hanla>
                </div>
                <div class="next_info">Spring6</div>
              </div>
            </a></div>
        </nav>
        <hr>
        <div id="post-comment">
          <div class="comment-head">
            <div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论<hanla></hanla></span></div>
          </div>
          <div class="comment-wrap">
            <div>
              <div id="twikoo-wrap"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="aside-content" id="aside-content">
        <div class="card-widget card-info">
          <div class="is-center">
            <div class="avatar-img"><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://i.328888.xyz/2023/03/19/MJUXa.jpeg" onerror="this.onerror=null;this.src='https://i.328888.xyz/2023/03/20/P3kfC.gif'" alt="avatar"></div>
            <div class="author-info__name">coder-itl</div>
            <div class="author-info__description">To read without reflecting is like eating without digesting.</div>
          </div>
          <div class="card-info-data site-data is-center"><a href="/archives/">
              <div class="headline">
                <hanla></hanla>文章<hanla></hanla>
              </div>
              <div class="length-num">119</div>
            </a><a href="/tags/">
              <div class="headline">
                <hanla></hanla>标签<hanla></hanla>
              </div>
              <div class="length-num">21</div>
            </a><a href="/categories/">
              <div class="headline">
                <hanla></hanla>分类<hanla></hanla>
              </div>
              <div class="length-num">13</div>
            </a></div><a id="card-info-btn" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a>
        </div>
        <div class="card-widget card-announcement">
          <div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>
              <hanla></hanla>公告
            </span></div>
          <div class="announcement_content">本站所有图片来源于网络,<hanla></hanla>侵权请添加管理员删除【3327511395@qq.com】!</div>
        </div>
        <div class="sticky_layout">
          <div class="card-widget" id="card-toc">
            <div class="item-headline"><i class="fas fa-stream"></i><span>
                <hanla></hanla>目录<hanla></hanla>
              </span><span class="toc-percentage"></span></div>
            <div class="toc-content">
              <ol class="toc">
                <li class="toc-item toc-level-3"><a class="toc-link" href="#MQ-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">MQ 概述<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">RabbitMQ 简介<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E5%AE%89%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">RabbitMQ 安装<hanla></hanla></span></a>
                  <ol class="toc-child">
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-%E5%AE%89%E8%A3%85-RabbitMQ"><span class="toc-number">3.1.</span> <span class="toc-text">Docker-安装-RabbitMQ</span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.</span> <span class="toc-text">独立安装<hanla></hanla></span></a>
                      <ol class="toc-child">
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Erlang"><span class="toc-number">3.2.1.</span> <span class="toc-text">安装 Erlang</span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-RabbitMQ"><span class="toc-number">3.2.2.</span> <span class="toc-text">安装 RabbitMQ</span></a></li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2%E5%8F%8A%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">开启管理界面及配置<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">5.</span> <span class="toc-text">启动<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">基础操作<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">核心组件<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.</span> <span class="toc-text">快速入门<hanla></hanla>(简单模式)</span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.</span> <span class="toc-text">RabbitMQ 工作模式<hanla></hanla></span></a>
                  <ol class="toc-child">
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#Work-queues-%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.1.</span> <span class="toc-text">Work queues 工作队列模式<hanla></hanla></span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#Pub-x2F-Sub-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.2.</span> <span class="toc-text">Pub/Sub 订阅模式<hanla></hanla></span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#Routing-%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.3.</span> <span class="toc-text">Routing 路由模式<hanla></hanla></span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#Topics-%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.4.</span> <span class="toc-text">Topics 模式<hanla></hanla></span></a></li>
                  </ol>
                </li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-%E6%95%B4%E5%90%88RabbitMQ"><span class="toc-number">10.</span> <span class="toc-text">Spring-整合<hanla></hanla>RabbitMQ</span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot%E6%95%B4%E5%90%88-RabbitMQ"><span class="toc-number">11.</span> <span class="toc-text">SpringBoot<hanla></hanla>整合 RabbitMQ</span></a>
                  <ol class="toc-child">
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.1.</span> <span class="toc-text">发布订阅模式<hanla></hanla></span></a>
                      <ol class="toc-child">
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">11.1.1.</span> <span class="toc-text">生产者<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">11.1.2.</span> <span class="toc-text">消费者<hanla></hanla></span></a></li>
                      </ol>
                    </li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#Topics%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.2.</span> <span class="toc-text">Topics<hanla></hanla>模式<hanla></hanla></span></a>
                      <ol class="toc-child">
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85-1"><span class="toc-number">11.2.1.</span> <span class="toc-text">生产者<hanla></hanla></span></a></li>
                        <li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85-1"><span class="toc-number">11.2.2.</span> <span class="toc-text">消费者<hanla></hanla></span></a></li>
                      </ol>
                    </li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8-ACK-%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.3.</span> <span class="toc-text">手动 ACK 实现<hanla></hanla></span></a></li>
                  </ol>
                </li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-number">12.</span> <span class="toc-text">高级特性<hanla></hanla></span></a>
                  <ol class="toc-child">
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7%E6%8A%95%E9%80%92"><span class="toc-number">12.1.</span> <span class="toc-text">消息的可靠性投递<hanla></hanla></span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#Confirm-%E6%9C%BA%E5%88%B6"><span class="toc-number">12.2.</span> <span class="toc-text">Confirm 机制<hanla></hanla></span></a></li>
                    <li class="toc-item toc-level-4"><a class="toc-link" href="#return-%E6%9C%BA%E5%88%B6"><span class="toc-number">12.3.</span> <span class="toc-text">return 机制<hanla></hanla></span></a></li>
                  </ol>
                </li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8-ack-nack-reject%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">13.</span> <span class="toc-text">手动 ack,nack,reject<hanla></hanla>的区别<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%B6%88%E6%81%AF%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">14.</span> <span class="toc-text">封装消息的元数据<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7%E6%B6%88%E8%B4%B9"><span class="toc-number">15.</span> <span class="toc-text">保证消息的幂等性消费<hanla></hanla></span></a></li>
                <li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97"><span class="toc-number">16.</span> <span class="toc-text">死信队列</span></a></li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer id="footer" style="background: transparent">
      <div id="footer-wrap">
        <div class="copyright">©2020 - 2023 By coder-itl</div>
        <div class="framework-info"><span>
            <hanla></hanla>框架
          </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div>
        <div class="footer_custom_text">
          <p><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-orange">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Theme-Buffterfly-blue">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/CDN-jsDeliver-blueviolet">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Source-Github-9cf">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Theme-Matery-ff69b4">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Python-Python-success">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Python-Flask-red"></p>
          <p><img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-red?logo=Castorama&amp;logoWidth=18">&nbsp;<img src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?logo=Grunt&amp;logoWidth=18"></p>
        </div>
      </div>
    </footer>
  </div>
  <div id="rightside">
    <div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div>
    <div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div>
  </div>
  <div id="local-search">
    <div class="search-dialog">
      <nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav>
      <div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中<hanla></hanla></span></div>
      <div class="search-wrap">
        <div id="local-search-input">
          <div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div>
        </div>
        <hr>
        <div id="local-search-results"></div>
      </div>
    </div>
    <div id="search-mask"></div>
  </div>
  <div>
    <script src="/js/utils.js"></script>
    <script src="/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script>
    <script src="/js/search/local-search.js"></script>
    <div class="js-pjax">
      <script>
        (() =>
        {
          const init = () =>
          {
            twikoo.init(Object.assign(
            {
              el: '#twikoo-wrap',
              envId: 'https://twikoo-jlw0ln3jv-coderitl.vercel.app/',
              region: 'ap-shanghai',
              onCommentLoaded: function ()
              {
                btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
              }
            }, null))
          }
          const getCount = () =>
          {
            const countELement = document.getElementById('twikoo-count')
            if (!countELement) return
            twikoo.getCommentsCount(
            {
              envId: 'https://twikoo-jlw0ln3jv-coderitl.vercel.app/',
              region: 'ap-shanghai',
              urls: [window.location.pathname],
              includeReply: false
            }).then(function (res)
            {
              countELement.innerText = res[0].count
            }).catch(function (err)
            {
              console.error(err);
            });
          }
          const runFn = () =>
          {
            init()
          }
          const loadTwikoo = () =>
          {
            if (typeof twikoo === 'object')
            {
              setTimeout(runFn, 0)
              return
            }
            getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
          }
          if ('Twikoo' === 'Twikoo' || !false)
          {
            if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
            else loadTwikoo()
          }
          else
          {
            window.loadOtherComment = () =>
            {
              loadTwikoo()
            }
          }
        })()

      </script>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
    <script defer="" src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <script data-pjax="" src="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiper.min.js"></script>
    <script data-pjax="" src="https://cdn.jsdelivr.net/gh/coderitl/FileJsDeliver@v1.1.13/swiper/swiperindex.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script>
    <script src="https://www.youxiaohou.com/mactype.user.js"></script>
    <script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script>
    <script>
      let pjaxSelectors = ["head > title", "#config-diff", "#body-wrap", "#rightside-config-hide", "#rightside-config-show", ".js-pjax"]
      var pjax = new Pjax(
      {
        elements: 'a:not([target="_blank"])',
        selectors: pjaxSelectors,
        cacheBust: false,
        analytics: false,
        scrollRestoration: false
      })
      document.addEventListener('pjax:send', function ()
      {
        // removeEventListener scroll 
        window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
        window.scrollCollect && window.removeEventListener('scroll', scrollCollect)
        document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
        if (window.aplayers)
        {
          for (let i = 0; i < window.aplayers.length; i++)
          {
            if (!window.aplayers[i].options.fixed)
            {
              window.aplayers[i].destroy()
            }
          }
        }
        typeof typed === 'object' && typed.destroy()
        //reset readmode
        const $bodyClassList = document.body.classList
        $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
        typeof disqusjs === 'object' && disqusjs.destroy()
      })
      document.addEventListener('pjax:complete', function ()
      {
        window.refreshFn()
        document.querySelectorAll('script[data-pjax]').forEach(item =>
        {
          const newScript = document.createElement('script')
          const content = item.text || item.textContent || item.innerHTML || ""
          Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
          newScript.appendChild(document.createTextNode(content))
          item.parentNode.replaceChild(newScript, item)
        })
        GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()
        typeof chatBtnFn === 'function' && chatBtnFn()
        typeof panguInit === 'function' && panguInit()
        // google analytics
        typeof gtag === 'function' && gtag('config', '',
        {
          'page_path': window.location.pathname
        });
        // baidu analytics
        typeof _hmt === 'object' && _hmt.push(['_trackPageview', window.location.pathname]);
        typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
        // prismjs
        typeof Prism === 'object' && Prism.highlightAll()
      })
      document.addEventListener('pjax:error', (e) =>
      {
        if (e.request.status === 404)
        {
          pjax.loadUrl('/404.html')
        }
      })

    </script>
    <script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  </div><!-- hexo injector body_end start -->
  <script data-pjax="">
    function history_calendar_injector_config()
    {
      var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
      var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span><hanla></hanla>那年今日<hanla></hanla></span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
      console.log('已挂载<hanla></hanla>history_calendar')
      // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用<hanla></hanla>(支持<hanla></hanla>pjax<hanla></hanla>跳转)
      parent_div_git.insertAdjacentHTML("afterbegin", item_html) // 有报错，但不影响使用<hanla></hanla>(支持<hanla></hanla>pjax<hanla></hanla>跳转)
    }
    if (document.getElementsByClassName('sticky_layout')[0] & amp; & amp;
      (location.pathname === 'all' || 'all' === 'all'))
    {
      history_calendar_injector_config()
    } < /div>

  </script>
  <script data-pjax="" src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script>
  <script data-pjax="">
    function butterfly_swiper_injector_config()
    {
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/08/13/15497.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/Access@v1.0/medias/featureimages/7.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-13</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/08/13/15497.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>文件上传下载实战<hanla></hanla></a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/08/13/15497.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/09/04/27324.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/Access@v1.0/medias/featureimages/8.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-09-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/09/04/27324.html&quot;);" href="javascript:void(0);" alt="">Docker<hanla></hanla>安装<hanla></hanla>Oracle</a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/09/04/27324.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/11/30/42622.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://i.328888.xyz/2023/04/01/i2p4AN.jpeg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/11/30/42622.html&quot;);" href="javascript:void(0);" alt="">SpringCloud</a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/11/30/42622.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/12/29/2485.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "https://i.328888.xyz/2023/03/20/P3kfC.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/coderitl/Access@v1.0/medias/featureimages/2.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/12/29/2485.html&quot;);" href="javascript:void(0);" alt="">Ubuntu-系统<hanla></hanla></a><div class="blog-slider__text"><hanla></hanla>再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/12/29/2485.html&quot;);" href="javascript:void(0);" alt=""><hanla></hanla>详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
      console.log('已挂载<hanla></hanla>butterfly_swiper')
      parent_div_git.insertAdjacentHTML("afterbegin", item_html)
    }
    var elist = 'undefined'.split(',');
    var cpage = location.pathname;
    var epage = 'all';
    var flag = 0;
    for (var i = 0; i

  </script>
  <script defer="" src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script>
  <script defer="" data-pjax="" src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script>
  <script data-pjax="" src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script>
  <script data-pjax="">
    function gitcalendar_injector_config()
    {
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin", item_html)
      console.log('已挂载<hanla></hanla>gitcalendar')
    }
    if (document.getElementById('recent-posts') && (location.pathname === '/' || '/' === 'all'))
    {
      gitcalendar_injector_config()
      GitCalendarInit("https://python-github-calenda-4cx5gxbnc-coderitl.vercel.app/api?coderitl", ['#e4dfd7', '#f9f4dc', '#f7e8aa', '#f7e8aa', '#f8df72', '#fcd217', '#fcc515', '#f28e16', '#fb8b05', '#d85916', '#f43e06'], 'coderitl')
    }

  </script>
  <script async="" src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end -->
  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script>
  <script>
    L2Dwidget.init(
    {
      "pluginModelPath": "assets/",
      "model":
      {
        "jsonPath": "/live2dw/assets/shizuku.model.json"
      },
      "display":
      {
        "position": "left",
        "width": 150,
        "height": 300
      },
      "mobile":
      {
        "show": false
      },
      "rect":
      {
        "opacity": 0.7
      },
      "log": false,
      "pluginJsPath": "lib/",
      "pluginRootPath": "live2dw/",
      "tagMode": false
    });

  </script>



</body></html>